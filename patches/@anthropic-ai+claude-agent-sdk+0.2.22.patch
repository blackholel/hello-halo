diff --git a/node_modules/@anthropic-ai/claude-agent-sdk/sdk.mjs b/node_modules/@anthropic-ai/claude-agent-sdk/sdk.mjs
index 11a1d40..7848bd7 100755
--- a/node_modules/@anthropic-ai/claude-agent-sdk/sdk.mjs
+++ b/node_modules/@anthropic-ai/claude-agent-sdk/sdk.mjs
@@ -16,12 +16,12 @@ var QK=Object.create;var{getPrototypeOf:$K,defineProperty:Y9,getOwnPropertyNames
 `))X=Z0(X);let Y=`${new Date().toISOString()} [${Q.toUpperCase()}] ${X.trim()}
 `;if(YW()){d7(Y);return}_U().write(Y)}function JW(){return WW()??process.env.CLAUDE_CODE_DEBUG_LOGS_DIR??$W(V4(),"debug",`${a7()}.txt`)}var xU=k1(()=>{if(process.argv[2]==="--ripgrep")return;try{let X=JW(),Q=z9(X),$=$W(Q,"latest");if(!n0().existsSync(Q))n0().mkdirSync(Q);if(n0().existsSync($))try{n0().unlinkSync($)}catch{}n0().symlinkSync(X,$)}catch{}});var lU=!1;function F0(X,Q){let $=performance.now();try{return Q()}finally{performance.now()-$>B9}}var mU={cwd(){return process.cwd()},existsSync(X){return F0(`existsSync(${X})`,()=>h.existsSync(X))},async stat(X){return yU(X)},async readdir(X){return gU(X,{withFileTypes:!0})},async unlink(X){return fU(X)},async rmdir(X){return hU(X)},async rm(X,Q){return uU(X,Q)},statSync(X){return F0(`statSync(${X})`,()=>h.statSync(X))},lstatSync(X){return F0(`lstatSync(${X})`,()=>h.lstatSync(X))},readFileSync(X,Q){return F0(`readFileSync(${X})`,()=>h.readFileSync(X,{encoding:Q.encoding}))},readFileBytesSync(X){return F0(`readFileBytesSync(${X})`,()=>h.readFileSync(X))},readSync(X,Q){return F0(`readSync(${X}, ${Q.length} bytes)`,()=>{let $=void 0;try{$=h.openSync(X,"r");let Y=Buffer.alloc(Q.length),W=h.readSync($,Y,0,Q.length,0);return{buffer:Y,bytesRead:W}}finally{if($)h.closeSync($)}})},appendFileSync(X,Q,$){return F0(`appendFileSync(${X}, ${Q.length} chars)`,()=>{if(!h.existsSync(X)&&$?.mode!==void 0){let Y=h.openSync(X,"a",$.mode);try{h.appendFileSync(Y,Q)}finally{h.closeSync(Y)}}else h.appendFileSync(X,Q)})},copyFileSync(X,Q){return F0(`copyFileSync(${X} → ${Q})`,()=>h.copyFileSync(X,Q))},unlinkSync(X){return F0(`unlinkSync(${X})`,()=>h.unlinkSync(X))},renameSync(X,Q){return F0(`renameSync(${X} → ${Q})`,()=>h.renameSync(X,Q))},linkSync(X,Q){return F0(`linkSync(${X} → ${Q})`,()=>h.linkSync(X,Q))},symlinkSync(X,Q){return F0(`symlinkSync(${X} → ${Q})`,()=>h.symlinkSync(X,Q))},readlinkSync(X){return F0(`readlinkSync(${X})`,()=>h.readlinkSync(X))},realpathSync(X){return F0(`realpathSync(${X})`,()=>h.realpathSync(X))},mkdirSync(X,Q){return F0(`mkdirSync(${X})`,()=>{if(!h.existsSync(X)){let $={recursive:!0};if(Q?.mode!==void 0)$.mode=Q.mode;h.mkdirSync(X,$)}})},readdirSync(X){return F0(`readdirSync(${X})`,()=>h.readdirSync(X,{withFileTypes:!0}))},readdirStringSync(X){return F0(`readdirStringSync(${X})`,()=>h.readdirSync(X))},isDirEmptySync(X){return F0(`isDirEmptySync(${X})`,()=>{return this.readdirSync(X).length===0})},rmdirSync(X){return F0(`rmdirSync(${X})`,()=>h.rmdirSync(X))},rmSync(X,Q){return F0(`rmSync(${X})`,()=>h.rmSync(X,Q))},createWriteStream(X){return h.createWriteStream(X)}},cU=mU;function n0(){return cU}var pU=["PreToolUse","PostToolUse","PostToolUseFailure","Notification","UserPromptSubmit","SessionStart","SessionEnd","Stop","SubagentStart","SubagentStop","PreCompact","PermissionRequest","Setup"],dU=["clear","logout","prompt_input_exit","other","bypass_permissions_disabled"];class F1 extends Error{}function j6(){return process.versions.bun!==void 0}import{randomUUID as iU}from"crypto";import{appendFileSync as nU,existsSync as rU,mkdirSync as oU}from"fs";import{join as GW}from"path";var F4=null,HW=!1;function tU(){if(HW)return F4;if(HW=!0,!process.env.DEBUG_CLAUDE_AGENT_SDK)return null;let X=GW(V4(),"debug");if(F4=GW(X,`sdk-${iU()}.txt`),!rU(X))oU(X,{recursive:!0});return process.stderr.write(`SDK debug logs: ${F4}
 `),F4}function N1(X){let Q=tU();if(!Q)return;let Y=`${new Date().toISOString()} ${X}
-`;nU(Q,Y)}function BW(X,Q){let $={...X};if(Q){let Y={sandbox:Q};if($.settings)try{Y={...L4($.settings),sandbox:Q}}catch{}$.settings=Z0(Y)}return $}class XX{options;process;processStdin;processStdout;ready=!1;abortController;exitError;exitListeners=[];processExitHandler;abortHandler;constructor(X){this.options=X;this.abortController=X.abortController||N6(),this.initialize()}getDefaultExecutable(){return j6()?"bun":"node"}spawnLocalProcess(X){let{command:Q,args:$,cwd:Y,env:W,signal:J}=X,G=W.DEBUG_CLAUDE_AGENT_SDK||this.options.stderr?"pipe":"ignore",H=aU(Q,$,{cwd:Y,stdio:["pipe","pipe",G],signal:J,env:W,windowsHide:!0});if(W.DEBUG_CLAUDE_AGENT_SDK||this.options.stderr)H.stderr.on("data",(z)=>{let K=z.toString();if(N1(K),this.options.stderr)this.options.stderr(K)});return{stdin:H.stdin,stdout:H.stdout,get killed(){return H.killed},get exitCode(){return H.exitCode},kill:H.kill.bind(H),on:H.on.bind(H),once:H.once.bind(H),off:H.off.bind(H)}}initialize(){try{let{additionalDirectories:X=[],agent:Q,betas:$,cwd:Y,executable:W=this.getDefaultExecutable(),executableArgs:J=[],extraArgs:G={},pathToClaudeCodeExecutable:H,env:B={...process.env},maxThinkingTokens:z,maxTurns:K,maxBudgetUsd:V,model:L,fallbackModel:U,jsonSchema:F,permissionMode:q,allowDangerouslySkipPermissions:N,permissionPromptToolName:A,continueConversation:M,resume:R,settingSources:S,allowedTools:C=[],disallowedTools:K0=[],tools:U0,mcpServers:s,strictMcpConfig:D0,canUseTool:q0,includePartialMessages:W1,plugins:P1,sandbox:U6}=this.options,d=["--output-format","stream-json","--verbose","--input-format","stream-json"];if(z!==void 0)d.push("--max-thinking-tokens",z.toString());if(K)d.push("--max-turns",K.toString());if(V!==void 0)d.push("--max-budget-usd",V.toString());if(L)d.push("--model",L);if(Q)d.push("--agent",Q);if($&&$.length>0)d.push("--betas",$.join(","));if(F)d.push("--json-schema",Z0(F));if(B.DEBUG_CLAUDE_AGENT_SDK)d.push("--debug-to-stderr");if(q0){if(A)throw Error("canUseTool callback cannot be used with permissionPromptToolName. Please use one or the other.");d.push("--permission-prompt-tool","stdio")}else if(A)d.push("--permission-prompt-tool",A);if(M)d.push("--continue");if(R)d.push("--resume",R);if(C.length>0)d.push("--allowedTools",C.join(","));if(K0.length>0)d.push("--disallowedTools",K0.join(","));if(U0!==void 0)if(Array.isArray(U0))if(U0.length===0)d.push("--tools","");else d.push("--tools",U0.join(","));else d.push("--tools","default");if(s&&Object.keys(s).length>0)d.push("--mcp-config",Z0({mcpServers:s}));if(S)d.push("--setting-sources",S.join(","));if(D0)d.push("--strict-mcp-config");if(q)d.push("--permission-mode",q);if(N)d.push("--allow-dangerously-skip-permissions");if(U){if(L&&U===L)throw Error("Fallback model cannot be the same as the main model. Please specify a different model for fallbackModel option.");d.push("--fallback-model",U)}if(W1)d.push("--include-partial-messages");for(let S0 of X)d.push("--add-dir",S0);if(P1&&P1.length>0)for(let S0 of P1)if(S0.type==="local")d.push("--plugin-dir",S0.path);else throw Error(`Unsupported plugin type: ${S0.type}`);if(this.options.forkSession)d.push("--fork-session");if(this.options.resumeSessionAt)d.push("--resume-session-at",this.options.resumeSessionAt);if(this.options.persistSession===!1)d.push("--no-session-persistence");let Q9=BW(G??{},U6);for(let[S0,S1]of Object.entries(Q9))if(S1===null)d.push(`--${S0}`);else d.push(`--${S0}`,S1);if(!B.CLAUDE_CODE_ENTRYPOINT)B.CLAUDE_CODE_ENTRYPOINT="sdk-ts";if(delete B.NODE_OPTIONS,B.DEBUG_CLAUDE_AGENT_SDK)B.DEBUG="1";else delete B.DEBUG;let o6=eU(H),V6=o6?H:W,t6=o6?[...J,...d]:[...J,H,...d],a6={command:V6,args:t6,cwd:Y,env:B,signal:this.abortController.signal};if(this.options.spawnClaudeCodeProcess)N1(`Spawning Claude Code (custom): ${V6} ${t6.join(" ")}`),this.process=this.options.spawnClaudeCodeProcess(a6);else{if(!n0().existsSync(H)){let S1=o6?`Claude Code native binary not found at ${H}. Please ensure Claude Code is installed via native installer or specify a valid path with options.pathToClaudeCodeExecutable.`:`Claude Code executable not found at ${H}. Is options.pathToClaudeCodeExecutable set?`;throw ReferenceError(S1)}N1(`Spawning Claude Code: ${V6} ${t6.join(" ")}`),this.process=this.spawnLocalProcess(a6)}this.processStdin=this.process.stdin,this.processStdout=this.process.stdout;let B4=()=>{if(this.process&&!this.process.killed)this.process.kill("SIGTERM")};this.processExitHandler=B4,this.abortHandler=B4,process.on("exit",this.processExitHandler),this.abortController.signal.addEventListener("abort",this.abortHandler),this.process.on("error",(S0)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new F1("Claude Code process aborted by user");else this.exitError=Error(`Failed to spawn Claude Code process: ${S0.message}`),N1(this.exitError.message)}),this.process.on("exit",(S0,S1)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new F1("Claude Code process aborted by user");else{let s6=this.getProcessExitError(S0,S1);if(s6)this.exitError=s6,N1(s6.message)}}),this.ready=!0}catch(X){throw this.ready=!1,X}}getProcessExitError(X,Q){if(X!==0&&X!==null)return Error(`Claude Code process exited with code ${X}`);else if(Q)return Error(`Claude Code process terminated by signal ${Q}`);return}write(X){if(this.abortController.signal.aborted)throw new F1("Operation aborted");if(!this.ready||!this.processStdin)throw Error("ProcessTransport is not ready for writing");if(this.process?.killed||this.process?.exitCode!==null)throw Error("Cannot write to terminated process");if(this.exitError)throw Error(`Cannot write to process that exited with error: ${this.exitError.message}`);N1(`[ProcessTransport] Writing to stdin: ${X.substring(0,100)}`);try{if(!this.processStdin.write(X))N1("[ProcessTransport] Write buffer full, data queued")}catch(Q){throw this.ready=!1,Error(`Failed to write to process stdin: ${Q.message}`)}}close(){if(this.processStdin)this.processStdin.end(),this.processStdin=void 0;if(this.abortHandler)this.abortController.signal.removeEventListener("abort",this.abortHandler),this.abortHandler=void 0;for(let{handler:X}of this.exitListeners)this.process?.off("exit",X);if(this.exitListeners=[],this.process&&!this.process.killed)this.process.kill("SIGTERM"),setTimeout(()=>{if(this.process&&!this.process.killed)this.process.kill("SIGKILL")},5000);if(this.ready=!1,this.processExitHandler)process.off("exit",this.processExitHandler),this.processExitHandler=void 0}isReady(){return this.ready}async*readMessages(){if(!this.processStdout)throw Error("ProcessTransport output stream not available");let X=sU({input:this.processStdout});try{for await(let Q of X)if(Q.trim())try{yield L4(Q)}catch($){throw N1(`Non-JSON stdout: ${Q}`),Error(`CLI output was not valid JSON. This may indicate an error during startup. Output: ${Q.slice(0,200)}${Q.length>200?"...":""}`)}await this.waitForExit()}catch(Q){throw Q}finally{X.close()}}endInput(){if(this.processStdin)this.processStdin.end()}getInputStream(){return this.processStdin}onExit(X){if(!this.process)return()=>{};let Q=($,Y)=>{let W=this.getProcessExitError($,Y);X(W)};return this.process.on("exit",Q),this.exitListeners.push({callback:X,handler:Q}),()=>{if(this.process)this.process.off("exit",Q);let $=this.exitListeners.findIndex((Y)=>Y.handler===Q);if($!==-1)this.exitListeners.splice($,1)}}async waitForExit(){if(!this.process){if(this.exitError)throw this.exitError;return}if(this.process.exitCode!==null||this.process.killed){if(this.exitError)throw this.exitError;return}return new Promise((X,Q)=>{let $=(W,J)=>{if(this.abortController.signal.aborted){Q(new F1("Operation aborted"));return}let G=this.getProcessExitError(W,J);if(G)Q(G);else X()};this.process.once("exit",$);let Y=(W)=>{this.process.off("exit",$),Q(W)};this.process.once("error",Y),this.process.once("exit",()=>{this.process.off("error",Y)})})}}function eU(X){return![".js",".mjs",".tsx",".ts",".jsx"].some(($)=>X.endsWith($))}class QX{returned;queue=[];readResolve;readReject;isDone=!1;hasError;started=!1;constructor(X){this.returned=X}[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){if(this.queue.length>0)return Promise.resolve({done:!1,value:this.queue.shift()});if(this.isDone)return Promise.resolve({done:!0,value:void 0});if(this.hasError)return Promise.reject(this.hasError);return new Promise((X,Q)=>{this.readResolve=X,this.readReject=Q})}enqueue(X){if(this.readResolve){let Q=this.readResolve;this.readResolve=void 0,this.readReject=void 0,Q({done:!1,value:X})}else this.queue.push(X)}done(){if(this.isDone=!0,this.readResolve){let X=this.readResolve;this.readResolve=void 0,this.readReject=void 0,X({done:!0,value:void 0})}}error(X){if(this.hasError=X,this.readReject){let Q=this.readReject;this.readResolve=void 0,this.readReject=void 0,Q(X)}}return(){if(this.isDone=!0,this.returned)this.returned();return Promise.resolve({done:!0,value:void 0})}}class K9{sendMcpMessage;isClosed=!1;constructor(X){this.sendMcpMessage=X}onclose;onerror;onmessage;async start(){}async send(X){if(this.isClosed)throw Error("Transport is closed");this.sendMcpMessage(X)}async close(){if(this.isClosed)return;this.isClosed=!0,this.onclose?.()}}import{randomUUID as XV}from"crypto";class $X{transport;isSingleUserTurn;canUseTool;hooks;abortController;jsonSchema;initConfig;pendingControlResponses=new Map;cleanupPerformed=!1;sdkMessages;inputStream=new QX;initialization;cancelControllers=new Map;hookCallbacks=new Map;nextCallbackId=0;sdkMcpTransports=new Map;sdkMcpServerInstances=new Map;pendingMcpResponses=new Map;firstResultReceivedResolve;firstResultReceived=!1;hasBidirectionalNeeds(){return this.sdkMcpTransports.size>0||this.hooks!==void 0&&Object.keys(this.hooks).length>0||this.canUseTool!==void 0}constructor(X,Q,$,Y,W,J=new Map,G,H){this.transport=X;this.isSingleUserTurn=Q;this.canUseTool=$;this.hooks=Y;this.abortController=W;this.jsonSchema=G;this.initConfig=H;for(let[B,z]of J)this.connectSdkMcpServer(B,z);this.sdkMessages=this.readSdkMessages(),this.readMessages(),this.initialization=this.initialize(),this.initialization.catch(()=>{})}setError(X){this.inputStream.error(X)}close(){this.cleanup()}cleanup(X){if(this.cleanupPerformed)return;this.cleanupPerformed=!0;try{this.transport.close(),this.pendingControlResponses.clear(),this.pendingMcpResponses.clear(),this.cancelControllers.clear(),this.hookCallbacks.clear();for(let Q of this.sdkMcpTransports.values())try{Q.close()}catch{}if(this.sdkMcpTransports.clear(),X)this.inputStream.error(X);else this.inputStream.done()}catch(Q){}}next(...[X]){return this.sdkMessages.next(...[X])}return(X){return this.sdkMessages.return(X)}throw(X){return this.sdkMessages.throw(X)}[Symbol.asyncIterator](){return this.sdkMessages}[Symbol.asyncDispose](){return this.sdkMessages[Symbol.asyncDispose]()}async readMessages(){try{for await(let X of this.transport.readMessages()){if(X.type==="control_response"){let Q=this.pendingControlResponses.get(X.response.request_id);if(Q)Q(X.response);continue}else if(X.type==="control_request"){this.handleControlRequest(X);continue}else if(X.type==="control_cancel_request"){this.handleControlCancelRequest(X);continue}else if(X.type==="keep_alive")continue;if(X.type==="result"){if(this.firstResultReceived=!0,this.firstResultReceivedResolve)this.firstResultReceivedResolve();if(this.isSingleUserTurn)v1("[Query.readMessages] First result received for single-turn query, closing stdin"),this.transport.endInput()}this.inputStream.enqueue(X)}if(this.firstResultReceivedResolve)this.firstResultReceivedResolve();this.inputStream.done(),this.cleanup()}catch(X){if(this.firstResultReceivedResolve)this.firstResultReceivedResolve();this.inputStream.error(X),this.cleanup(X)}}async handleControlRequest(X){let Q=new AbortController;this.cancelControllers.set(X.request_id,Q);try{let $=await this.processControlRequest(X,Q.signal),Y={type:"control_response",response:{subtype:"success",request_id:X.request_id,response:$}};await Promise.resolve(this.transport.write(Z0(Y)+`
+`;nU(Q,Y)}function BW(X,Q){let $={...X};if(Q){let Y={sandbox:Q};if($.settings)try{Y={...L4($.settings),sandbox:Q}}catch{}$.settings=Z0(Y)}return $}class XX{options;process;processStdin;processStdout;ready=!1;abortController;exitError;exitListeners=[];processExitHandler;abortHandler;constructor(X){this.options=X;this.abortController=X.abortController||N6(),this.initialize()}getDefaultExecutable(){return j6()?"bun":"node"}spawnLocalProcess(X){let{command:Q,args:$,cwd:Y,env:W,signal:J}=X,G=W.DEBUG_CLAUDE_AGENT_SDK||this.options.stderr?"pipe":"ignore",H=aU(Q,$,{cwd:Y,stdio:["pipe","pipe",G],signal:J,env:W,windowsHide:!0});if(W.DEBUG_CLAUDE_AGENT_SDK||this.options.stderr)H.stderr.on("data",(z)=>{let K=z.toString();if(N1(K),this.options.stderr)this.options.stderr(K)});return{stdin:H.stdin,stdout:H.stdout,get killed(){return H.killed},get exitCode(){return H.exitCode},kill:H.kill.bind(H),on:H.on.bind(H),once:H.once.bind(H),off:H.off.bind(H)}}initialize(){try{let{additionalDirectories:X=[],agent:Q,betas:$,cwd:Y,executable:W=this.getDefaultExecutable(),executableArgs:J=[],extraArgs:G={},pathToClaudeCodeExecutable:H,env:B={...process.env},maxThinkingTokens:z,maxTurns:K,maxBudgetUsd:V,model:L,fallbackModel:U,jsonSchema:F,permissionMode:q,allowDangerouslySkipPermissions:N,permissionPromptToolName:A,continueConversation:M,resume:R,settingSources:S,allowedTools:C=[],disallowedTools:K0=[],tools:U0,mcpServers:s,strictMcpConfig:D0,canUseTool:q0,includePartialMessages:W1,plugins:P1,sandbox:U6}=this.options,d=["--output-format","stream-json","--verbose","--input-format","stream-json"];if(z!==void 0)d.push("--max-thinking-tokens",z.toString());if(K)d.push("--max-turns",K.toString());if(V!==void 0)d.push("--max-budget-usd",V.toString());if(L)d.push("--model",L);if(Q)d.push("--agent",Q);if($&&$.length>0)d.push("--betas",$.join(","));if(F)d.push("--json-schema",Z0(F));if(B.DEBUG_CLAUDE_AGENT_SDK)d.push("--debug-to-stderr");if(q0){if(A)throw Error("canUseTool callback cannot be used with permissionPromptToolName. Please use one or the other.");d.push("--permission-prompt-tool","stdio")}else if(A)d.push("--permission-prompt-tool",A);if(M)d.push("--continue");if(R)d.push("--resume",R);if(C.length>0)d.push("--allowedTools",C.join(","));if(K0.length>0)d.push("--disallowedTools",K0.join(","));if(U0!==void 0)if(Array.isArray(U0))if(U0.length===0)d.push("--tools","");else d.push("--tools",U0.join(","));else d.push("--tools","default");if(s&&Object.keys(s).length>0)d.push("--mcp-config",Z0({mcpServers:s}));if(S)d.push("--setting-sources",S.join(","));if(D0)d.push("--strict-mcp-config");if(q)d.push("--permission-mode",q);if(N)d.push("--allow-dangerously-skip-permissions");if(U){if(L&&U===L)throw Error("Fallback model cannot be the same as the main model. Please specify a different model for fallbackModel option.");d.push("--fallback-model",U)}if(W1)d.push("--include-partial-messages");for(let S0 of X)d.push("--add-dir",S0);if(P1&&P1.length>0)for(let S0 of P1)if(S0.type==="local")d.push("--plugin-dir",S0.path);else throw Error(`Unsupported plugin type: ${S0.type}`);if(this.options.forkSession)d.push("--fork-session");if(this.options.resumeSessionAt)d.push("--resume-session-at",this.options.resumeSessionAt);if(this.options.persistSession===!1)d.push("--no-session-persistence");let Q9=BW(G??{},U6);for(let[S0,S1]of Object.entries(Q9))if(S1===null)d.push(`--${S0}`);else d.push(`--${S0}`,S1);if(!B.CLAUDE_CODE_ENTRYPOINT){};if(delete B.NODE_OPTIONS,B.DEBUG_CLAUDE_AGENT_SDK)B.DEBUG="1";else delete B.DEBUG;let o6=eU(H),V6=o6?H:W,t6=o6?[...J,...d]:[...J,H,...d],a6={command:V6,args:t6,cwd:Y,env:B,signal:this.abortController.signal};if(this.options.spawnClaudeCodeProcess)N1(`Spawning Claude Code (custom): ${V6} ${t6.join(" ")}`),this.process=this.options.spawnClaudeCodeProcess(a6);else{if(!n0().existsSync(H)){let S1=o6?`Claude Code native binary not found at ${H}. Please ensure Claude Code is installed via native installer or specify a valid path with options.pathToClaudeCodeExecutable.`:`Claude Code executable not found at ${H}. Is options.pathToClaudeCodeExecutable set?`;throw ReferenceError(S1)}N1(`Spawning Claude Code: ${V6} ${t6.join(" ")}`),this.process=this.spawnLocalProcess(a6)}this.processStdin=this.process.stdin,this.processStdout=this.process.stdout;let B4=()=>{if(this.process&&!this.process.killed)this.process.kill("SIGTERM")};this.processExitHandler=B4,this.abortHandler=B4,process.on("exit",this.processExitHandler),this.abortController.signal.addEventListener("abort",this.abortHandler),this.process.on("error",(S0)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new F1("Claude Code process aborted by user");else this.exitError=Error(`Failed to spawn Claude Code process: ${S0.message}`),N1(this.exitError.message)}),this.process.on("exit",(S0,S1)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new F1("Claude Code process aborted by user");else{let s6=this.getProcessExitError(S0,S1);if(s6)this.exitError=s6,N1(s6.message)}}),this.ready=!0}catch(X){throw this.ready=!1,X}}getProcessExitError(X,Q){if(X!==0&&X!==null)return Error(`Claude Code process exited with code ${X}`);else if(Q)return Error(`Claude Code process terminated by signal ${Q}`);return}write(X){if(this.abortController.signal.aborted)throw new F1("Operation aborted");if(!this.ready||!this.processStdin)throw Error("ProcessTransport is not ready for writing");if(this.process?.killed||this.process?.exitCode!==null)throw Error("Cannot write to terminated process");if(this.exitError)throw Error(`Cannot write to process that exited with error: ${this.exitError.message}`);N1(`[ProcessTransport] Writing to stdin: ${X.substring(0,100)}`);try{if(!this.processStdin.write(X))N1("[ProcessTransport] Write buffer full, data queued")}catch(Q){throw this.ready=!1,Error(`Failed to write to process stdin: ${Q.message}`)}}close(){if(this.processStdin)this.processStdin.end(),this.processStdin=void 0;if(this.abortHandler)this.abortController.signal.removeEventListener("abort",this.abortHandler),this.abortHandler=void 0;for(let{handler:X}of this.exitListeners)this.process?.off("exit",X);if(this.exitListeners=[],this.process&&!this.process.killed)this.process.kill("SIGTERM"),setTimeout(()=>{if(this.process&&!this.process.killed)this.process.kill("SIGKILL")},5000);if(this.ready=!1,this.processExitHandler)process.off("exit",this.processExitHandler),this.processExitHandler=void 0}isReady(){return this.ready}async*readMessages(){if(!this.processStdout)throw Error("ProcessTransport output stream not available");let X=sU({input:this.processStdout});try{for await(let Q of X)if(Q.trim())try{yield L4(Q)}catch($){throw N1(`Non-JSON stdout: ${Q}`),Error(`CLI output was not valid JSON. This may indicate an error during startup. Output: ${Q.slice(0,200)}${Q.length>200?"...":""}`)}await this.waitForExit()}catch(Q){throw Q}finally{X.close()}}endInput(){if(this.processStdin)this.processStdin.end()}getInputStream(){return this.processStdin}onExit(X){if(!this.process)return()=>{};let Q=($,Y)=>{let W=this.getProcessExitError($,Y);X(W)};return this.process.on("exit",Q),this.exitListeners.push({callback:X,handler:Q}),()=>{if(this.process)this.process.off("exit",Q);let $=this.exitListeners.findIndex((Y)=>Y.handler===Q);if($!==-1)this.exitListeners.splice($,1)}}async waitForExit(){if(!this.process){if(this.exitError)throw this.exitError;return}if(this.process.exitCode!==null||this.process.killed){if(this.exitError)throw this.exitError;return}return new Promise((X,Q)=>{let $=(W,J)=>{if(this.abortController.signal.aborted){Q(new F1("Operation aborted"));return}let G=this.getProcessExitError(W,J);if(G)Q(G);else X()};this.process.once("exit",$);let Y=(W)=>{this.process.off("exit",$),Q(W)};this.process.once("error",Y),this.process.once("exit",()=>{this.process.off("error",Y)})})}}function eU(X){return![".js",".mjs",".tsx",".ts",".jsx"].some(($)=>X.endsWith($))}class QX{returned;queue=[];readResolve;readReject;isDone=!1;hasError;started=!1;constructor(X){this.returned=X}[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){if(this.queue.length>0)return Promise.resolve({done:!1,value:this.queue.shift()});if(this.isDone)return Promise.resolve({done:!0,value:void 0});if(this.hasError)return Promise.reject(this.hasError);return new Promise((X,Q)=>{this.readResolve=X,this.readReject=Q})}enqueue(X){if(this.readResolve){let Q=this.readResolve;this.readResolve=void 0,this.readReject=void 0,Q({done:!1,value:X})}else this.queue.push(X)}done(){if(this.isDone=!0,this.readResolve){let X=this.readResolve;this.readResolve=void 0,this.readReject=void 0,X({done:!0,value:void 0})}}error(X){if(this.hasError=X,this.readReject){let Q=this.readReject;this.readResolve=void 0,this.readReject=void 0,Q(X)}}return(){if(this.isDone=!0,this.returned)this.returned();return Promise.resolve({done:!0,value:void 0})}}class K9{sendMcpMessage;isClosed=!1;constructor(X){this.sendMcpMessage=X}onclose;onerror;onmessage;async start(){}async send(X){if(this.isClosed)throw Error("Transport is closed");this.sendMcpMessage(X)}async close(){if(this.isClosed)return;this.isClosed=!0,this.onclose?.()}}import{randomUUID as XV}from"crypto";class $X{transport;isSingleUserTurn;canUseTool;hooks;abortController;jsonSchema;initConfig;pendingControlResponses=new Map;cleanupPerformed=!1;sdkMessages;inputStream=new QX;initialization;cancelControllers=new Map;hookCallbacks=new Map;nextCallbackId=0;sdkMcpTransports=new Map;sdkMcpServerInstances=new Map;pendingMcpResponses=new Map;firstResultReceivedResolve;firstResultReceived=!1;hasBidirectionalNeeds(){return this.sdkMcpTransports.size>0||this.hooks!==void 0&&Object.keys(this.hooks).length>0||this.canUseTool!==void 0}constructor(X,Q,$,Y,W,J=new Map,G,H){this.transport=X;this.isSingleUserTurn=Q;this.canUseTool=$;this.hooks=Y;this.abortController=W;this.jsonSchema=G;this.initConfig=H;for(let[B,z]of J)this.connectSdkMcpServer(B,z);this.sdkMessages=this.readSdkMessages(),this.readMessages(),this.initialization=this.initialize(),this.initialization.catch(()=>{})}setError(X){this.inputStream.error(X)}close(){this.cleanup()}cleanup(X){if(this.cleanupPerformed)return;this.cleanupPerformed=!0;try{this.transport.close(),this.pendingControlResponses.clear(),this.pendingMcpResponses.clear(),this.cancelControllers.clear(),this.hookCallbacks.clear();for(let Q of this.sdkMcpTransports.values())try{Q.close()}catch{}if(this.sdkMcpTransports.clear(),X)this.inputStream.error(X);else this.inputStream.done()}catch(Q){}}next(...[X]){return this.sdkMessages.next(...[X])}return(X){return this.sdkMessages.return(X)}throw(X){return this.sdkMessages.throw(X)}[Symbol.asyncIterator](){return this.sdkMessages}[Symbol.asyncDispose](){return this.sdkMessages[Symbol.asyncDispose]()}async readMessages(){try{for await(let X of this.transport.readMessages()){if(X.type==="control_response"){let Q=this.pendingControlResponses.get(X.response.request_id);if(Q)Q(X.response);continue}else if(X.type==="control_request"){this.handleControlRequest(X);continue}else if(X.type==="control_cancel_request"){this.handleControlCancelRequest(X);continue}else if(X.type==="keep_alive")continue;if(X.type==="result"){if(this.firstResultReceived=!0,this.firstResultReceivedResolve)this.firstResultReceivedResolve();if(this.isSingleUserTurn)v1("[Query.readMessages] First result received for single-turn query, closing stdin"),this.transport.endInput()}this.inputStream.enqueue(X)}if(this.firstResultReceivedResolve)this.firstResultReceivedResolve();this.inputStream.done(),this.cleanup()}catch(X){if(this.firstResultReceivedResolve)this.firstResultReceivedResolve();this.inputStream.error(X),this.cleanup(X)}}async handleControlRequest(X){let Q=new AbortController;this.cancelControllers.set(X.request_id,Q);try{let $=await this.processControlRequest(X,Q.signal),Y={type:"control_response",response:{subtype:"success",request_id:X.request_id,response:$}};await Promise.resolve(this.transport.write(Z0(Y)+`
 `))}catch($){let Y={type:"control_response",response:{subtype:"error",request_id:X.request_id,error:$.message||String($)}};await Promise.resolve(this.transport.write(Z0(Y)+`
 `))}finally{this.cancelControllers.delete(X.request_id)}}handleControlCancelRequest(X){let Q=this.cancelControllers.get(X.request_id);if(Q)Q.abort(),this.cancelControllers.delete(X.request_id)}async processControlRequest(X,Q){if(X.request.subtype==="can_use_tool"){if(!this.canUseTool)throw Error("canUseTool callback is not provided.");return{...await this.canUseTool(X.request.tool_name,X.request.input,{signal:Q,suggestions:X.request.permission_suggestions,blockedPath:X.request.blocked_path,decisionReason:X.request.decision_reason,toolUseID:X.request.tool_use_id,agentID:X.request.agent_id}),toolUseID:X.request.tool_use_id}}else if(X.request.subtype==="hook_callback")return await this.handleHookCallbacks(X.request.callback_id,X.request.input,X.request.tool_use_id,Q);else if(X.request.subtype==="mcp_message"){let $=X.request,Y=this.sdkMcpTransports.get($.server_name);if(!Y)throw Error(`SDK MCP server not found: ${$.server_name}`);if("method"in $.message&&"id"in $.message&&$.message.id!==null)return{mcp_response:await this.handleMcpControlRequest($.server_name,$,Y)};else{if(Y.onmessage)Y.onmessage($.message);return{mcp_response:{jsonrpc:"2.0",result:{},id:0}}}}throw Error("Unsupported control request subtype: "+X.request.subtype)}async*readSdkMessages(){for await(let X of this.inputStream)yield X}async initialize(){let X;if(this.hooks){X={};for(let[W,J]of Object.entries(this.hooks))if(J.length>0)X[W]=J.map((G)=>{let H=[];for(let B of G.hooks){let z=`hook_${this.nextCallbackId++}`;this.hookCallbacks.set(z,B),H.push(z)}return{matcher:G.matcher,hookCallbackIds:H,timeout:G.timeout}})}let Q=this.sdkMcpTransports.size>0?Array.from(this.sdkMcpTransports.keys()):void 0,$={subtype:"initialize",hooks:X,sdkMcpServers:Q,jsonSchema:this.jsonSchema,systemPrompt:this.initConfig?.systemPrompt,appendSystemPrompt:this.initConfig?.appendSystemPrompt,agents:this.initConfig?.agents};return(await this.request($)).response}async interrupt(){await this.request({subtype:"interrupt"})}async setPermissionMode(X){await this.request({subtype:"set_permission_mode",mode:X})}async setModel(X){await this.request({subtype:"set_model",model:X})}async setMaxThinkingTokens(X){await this.request({subtype:"set_max_thinking_tokens",max_thinking_tokens:X})}async rewindFiles(X,Q){return(await this.request({subtype:"rewind_files",user_message_id:X,dry_run:Q?.dryRun})).response}async processPendingPermissionRequests(X){for(let Q of X)if(Q.request.subtype==="can_use_tool")this.handleControlRequest(Q).catch(()=>{})}request(X){let Q=Math.random().toString(36).substring(2,15),$={request_id:Q,type:"control_request",request:X};return new Promise((Y,W)=>{this.pendingControlResponses.set(Q,(J)=>{if(J.subtype==="success")Y(J);else if(W(Error(J.error)),J.pending_permission_requests)this.processPendingPermissionRequests(J.pending_permission_requests)}),Promise.resolve(this.transport.write(Z0($)+`
 `))})}async supportedCommands(){return(await this.initialization).commands}async supportedModels(){return(await this.initialization).models}async reconnectMcpServer(X){await this.request({subtype:"mcp_reconnect",serverName:X})}async toggleMcpServer(X,Q){await this.request({subtype:"mcp_toggle",serverName:X,enabled:Q})}async mcpServerStatus(){return(await this.request({subtype:"mcp_status"})).response.mcpServers}async setMcpServers(X){let Q={},$={};for(let[H,B]of Object.entries(X))if(B.type==="sdk"&&"instance"in B)Q[H]=B.instance;else $[H]=B;let Y=new Set(this.sdkMcpServerInstances.keys()),W=new Set(Object.keys(Q));for(let H of Y)if(!W.has(H))await this.disconnectSdkMcpServer(H);for(let[H,B]of Object.entries(Q))if(!Y.has(H))this.connectSdkMcpServer(H,B);let J={};for(let H of Object.keys(Q))J[H]={type:"sdk",name:H};return(await this.request({subtype:"mcp_set_servers",servers:{...$,...J}})).response}async accountInfo(){return(await this.initialization).account}async streamInput(X){v1("[Query.streamInput] Starting to process input stream");try{let Q=0;for await(let $ of X){if(Q++,v1(`[Query.streamInput] Processing message ${Q}: ${$.type}`),this.abortController?.signal.aborted)break;await Promise.resolve(this.transport.write(Z0($)+`
 `))}if(v1(`[Query.streamInput] Finished processing ${Q} messages from input stream`),Q>0&&this.hasBidirectionalNeeds())v1("[Query.streamInput] Has bidirectional needs, waiting for first result"),await this.waitForFirstResult();v1("[Query] Calling transport.endInput() to close stdin to CLI process"),this.transport.endInput()}catch(Q){if(!(Q instanceof F1))throw Q}}waitForFirstResult(){if(this.firstResultReceived)return v1("[Query.waitForFirstResult] Result already received, returning immediately"),Promise.resolve();return new Promise((X)=>{if(this.abortController?.signal.aborted){X();return}this.abortController?.signal.addEventListener("abort",()=>X(),{once:!0}),this.firstResultReceivedResolve=X})}handleHookCallbacks(X,Q,$,Y){let W=this.hookCallbacks.get(X);if(!W)throw Error(`No hook callback found for ID: ${X}`);return W(Q,$,{signal:Y})}connectSdkMcpServer(X,Q){let $=new K9((Y)=>this.sendMcpServerMessageToCli(X,Y));this.sdkMcpTransports.set(X,$),this.sdkMcpServerInstances.set(X,Q),Q.connect($)}async disconnectSdkMcpServer(X){let Q=this.sdkMcpTransports.get(X);if(Q)await Q.close(),this.sdkMcpTransports.delete(X);this.sdkMcpServerInstances.delete(X)}sendMcpServerMessageToCli(X,Q){if("id"in Q&&Q.id!==null&&Q.id!==void 0){let Y=`${X}:${Q.id}`,W=this.pendingMcpResponses.get(Y);if(W){W.resolve(Q),this.pendingMcpResponses.delete(Y);return}}let $={type:"control_request",request_id:XV(),request:{subtype:"mcp_message",server_name:X,message:Q}};this.transport.write(Z0($)+`
-`)}handleMcpControlRequest(X,Q,$){let Y="id"in Q.message?Q.message.id:null,W=`${X}:${Y}`;return new Promise((J,G)=>{let H=()=>{this.pendingMcpResponses.delete(W)},B=(K)=>{H(),J(K)},z=(K)=>{H(),G(K)};if(this.pendingMcpResponses.set(W,{resolve:B,reject:z}),$.onmessage)$.onmessage(Q.message);else{H(),G(Error("No message handler registered"));return}})}}import{join as zW}from"path";import{fileURLToPath as QV}from"url";class U9{closed=!1;inputStream;query;queryIterator=null;abortController;_sessionId=null;get sessionId(){if(this._sessionId===null)throw Error("Session ID not available until after receiving messages");return this._sessionId}constructor(X){if(X.resume)this._sessionId=X.resume;this.inputStream=new QX;let Q=X.pathToClaudeCodeExecutable;if(!Q){let W=QV(import.meta.url),J=zW(W,"..");Q=zW(J,"cli.js")}let $={...X.env??process.env};if(!$.CLAUDE_CODE_ENTRYPOINT)$.CLAUDE_CODE_ENTRYPOINT="sdk-ts";this.abortController=N6();let Y=new XX({abortController:this.abortController,pathToClaudeCodeExecutable:Q,env:$,executable:X.executable??(j6()?"bun":"node"),executableArgs:X.executableArgs??[],extraArgs:{},maxThinkingTokens:void 0,maxTurns:void 0,maxBudgetUsd:void 0,model:X.model,fallbackModel:void 0,permissionMode:X.permissionMode??"default",allowDangerouslySkipPermissions:!1,continueConversation:!1,resume:X.resume,settingSources:[],allowedTools:X.allowedTools??[],disallowedTools:X.disallowedTools??[],mcpServers:{},strictMcpConfig:!1,canUseTool:!!X.canUseTool,hooks:!!X.hooks,includePartialMessages:!1,forkSession:!1,resumeSessionAt:void 0});this.query=new $X(Y,!1,X.canUseTool,X.hooks,this.abortController,new Map),this.query.streamInput(this.inputStream)}async send(X){if(this.closed)throw Error("Cannot send to closed session");let Q=typeof X==="string"?{type:"user",session_id:"",message:{role:"user",content:[{type:"text",text:X}]},parent_tool_use_id:null}:X;this.inputStream.enqueue(Q)}async*stream(){if(!this.queryIterator)this.queryIterator=this.query[Symbol.asyncIterator]();while(!0){let{value:X,done:Q}=await this.queryIterator.next();if(Q)return;if(X.type==="system"&&X.subtype==="init")this._sessionId=X.session_id;if(yield X,X.type==="result")return}}close(){if(this.closed)return;this.closed=!0,this.inputStream.done(),this.abortController.abort()}async[Symbol.asyncDispose](){this.close()}}function V9(X){return new U9(X)}function KW(X,Q){return new U9({...Q,resume:X})}var n;(function(X){X.assertEqual=(W)=>{};function Q(W){}X.assertIs=Q;function $(W){throw Error()}X.assertNever=$,X.arrayToEnum=(W)=>{let J={};for(let G of W)J[G]=G;return J},X.getValidEnumValues=(W)=>{let J=X.objectKeys(W).filter((H)=>typeof W[W[H]]!=="number"),G={};for(let H of J)G[H]=W[H];return X.objectValues(G)},X.objectValues=(W)=>{return X.objectKeys(W).map(function(J){return W[J]})},X.objectKeys=typeof Object.keys==="function"?(W)=>Object.keys(W):(W)=>{let J=[];for(let G in W)if(Object.prototype.hasOwnProperty.call(W,G))J.push(G);return J},X.find=(W,J)=>{for(let G of W)if(J(G))return G;return},X.isInteger=typeof Number.isInteger==="function"?(W)=>Number.isInteger(W):(W)=>typeof W==="number"&&Number.isFinite(W)&&Math.floor(W)===W;function Y(W,J=" | "){return W.map((G)=>typeof G==="string"?`'${G}'`:G).join(J)}X.joinValues=Y,X.jsonStringifyReplacer=(W,J)=>{if(typeof J==="bigint")return J.toString();return J}})(n||(n={}));var UW;(function(X){X.mergeShapes=(Q,$)=>{return{...Q,...$}}})(UW||(UW={}));var E=n.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),O1=(X)=>{switch(typeof X){case"undefined":return E.undefined;case"string":return E.string;case"number":return Number.isNaN(X)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":if(Array.isArray(X))return E.array;if(X===null)return E.null;if(X.then&&typeof X.then==="function"&&X.catch&&typeof X.catch==="function")return E.promise;if(typeof Map<"u"&&X instanceof Map)return E.map;if(typeof Set<"u"&&X instanceof Set)return E.set;if(typeof Date<"u"&&X instanceof Date)return E.date;return E.object;default:return E.unknown}};var w=n.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class h0 extends Error{get errors(){return this.issues}constructor(X){super();this.issues=[],this.addIssue=($)=>{this.issues=[...this.issues,$]},this.addIssues=($=[])=>{this.issues=[...this.issues,...$]};let Q=new.target.prototype;if(Object.setPrototypeOf)Object.setPrototypeOf(this,Q);else this.__proto__=Q;this.name="ZodError",this.issues=X}format(X){let Q=X||function(W){return W.message},$={_errors:[]},Y=(W)=>{for(let J of W.issues)if(J.code==="invalid_union")J.unionErrors.map(Y);else if(J.code==="invalid_return_type")Y(J.returnTypeError);else if(J.code==="invalid_arguments")Y(J.argumentsError);else if(J.path.length===0)$._errors.push(Q(J));else{let G=$,H=0;while(H<J.path.length){let B=J.path[H];if(H!==J.path.length-1)G[B]=G[B]||{_errors:[]};else G[B]=G[B]||{_errors:[]},G[B]._errors.push(Q(J));G=G[B],H++}}};return Y(this),$}static assert(X){if(!(X instanceof h0))throw Error(`Not a ZodError: ${X}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(X=(Q)=>Q.message){let Q={},$=[];for(let Y of this.issues)if(Y.path.length>0){let W=Y.path[0];Q[W]=Q[W]||[],Q[W].push(X(Y))}else $.push(X(Y));return{formErrors:$,fieldErrors:Q}}get formErrors(){return this.flatten()}}h0.create=(X)=>{return new h0(X)};var $V=(X,Q)=>{let $;switch(X.code){case w.invalid_type:if(X.received===E.undefined)$="Required";else $=`Expected ${X.expected}, received ${X.received}`;break;case w.invalid_literal:$=`Invalid literal value, expected ${JSON.stringify(X.expected,n.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:$=`Unrecognized key(s) in object: ${n.joinValues(X.keys,", ")}`;break;case w.invalid_union:$="Invalid input";break;case w.invalid_union_discriminator:$=`Invalid discriminator value. Expected ${n.joinValues(X.options)}`;break;case w.invalid_enum_value:$=`Invalid enum value. Expected ${n.joinValues(X.options)}, received '${X.received}'`;break;case w.invalid_arguments:$="Invalid function arguments";break;case w.invalid_return_type:$="Invalid function return type";break;case w.invalid_date:$="Invalid date";break;case w.invalid_string:if(typeof X.validation==="object")if("includes"in X.validation){if($=`Invalid input: must include "${X.validation.includes}"`,typeof X.validation.position==="number")$=`${$} at one or more positions greater than or equal to ${X.validation.position}`}else if("startsWith"in X.validation)$=`Invalid input: must start with "${X.validation.startsWith}"`;else if("endsWith"in X.validation)$=`Invalid input: must end with "${X.validation.endsWith}"`;else n.assertNever(X.validation);else if(X.validation!=="regex")$=`Invalid ${X.validation}`;else $="Invalid";break;case w.too_small:if(X.type==="array")$=`Array must contain ${X.exact?"exactly":X.inclusive?"at least":"more than"} ${X.minimum} element(s)`;else if(X.type==="string")$=`String must contain ${X.exact?"exactly":X.inclusive?"at least":"over"} ${X.minimum} character(s)`;else if(X.type==="number")$=`Number must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${X.minimum}`;else if(X.type==="bigint")$=`Number must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${X.minimum}`;else if(X.type==="date")$=`Date must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(X.minimum))}`;else $="Invalid input";break;case w.too_big:if(X.type==="array")$=`Array must contain ${X.exact?"exactly":X.inclusive?"at most":"less than"} ${X.maximum} element(s)`;else if(X.type==="string")$=`String must contain ${X.exact?"exactly":X.inclusive?"at most":"under"} ${X.maximum} character(s)`;else if(X.type==="number")$=`Number must be ${X.exact?"exactly":X.inclusive?"less than or equal to":"less than"} ${X.maximum}`;else if(X.type==="bigint")$=`BigInt must be ${X.exact?"exactly":X.inclusive?"less than or equal to":"less than"} ${X.maximum}`;else if(X.type==="date")$=`Date must be ${X.exact?"exactly":X.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(X.maximum))}`;else $="Invalid input";break;case w.custom:$="Invalid input";break;case w.invalid_intersection_types:$="Intersection results could not be merged";break;case w.not_multiple_of:$=`Number must be a multiple of ${X.multipleOf}`;break;case w.not_finite:$="Number must be finite";break;default:$=Q.defaultError,n.assertNever(X)}return{message:$}},T1=$V;var YV=T1;function YX(){return YV}var N4=(X)=>{let{data:Q,path:$,errorMaps:Y,issueData:W}=X,J=[...$,...W.path||[]],G={...W,path:J};if(W.message!==void 0)return{...W,path:J,message:W.message};let H="",B=Y.filter((z)=>!!z).slice().reverse();for(let z of B)H=z(G,{data:Q,defaultError:H}).message;return{...W,path:J,message:H}};function b(X,Q){let $=YX(),Y=N4({issueData:Q,data:X.data,path:X.path,errorMaps:[X.common.contextualErrorMap,X.schemaErrorMap,$,$===T1?void 0:T1].filter((W)=>!!W)});X.common.issues.push(Y)}class I0{constructor(){this.value="valid"}dirty(){if(this.value==="valid")this.value="dirty"}abort(){if(this.value!=="aborted")this.value="aborted"}static mergeArray(X,Q){let $=[];for(let Y of Q){if(Y.status==="aborted")return g;if(Y.status==="dirty")X.dirty();$.push(Y.value)}return{status:X.value,value:$}}static async mergeObjectAsync(X,Q){let $=[];for(let Y of Q){let W=await Y.key,J=await Y.value;$.push({key:W,value:J})}return I0.mergeObjectSync(X,$)}static mergeObjectSync(X,Q){let $={};for(let Y of Q){let{key:W,value:J}=Y;if(W.status==="aborted")return g;if(J.status==="aborted")return g;if(W.status==="dirty")X.dirty();if(J.status==="dirty")X.dirty();if(W.value!=="__proto__"&&(typeof J.value<"u"||Y.alwaysSet))$[W.value]=J.value}return{status:X.value,value:$}}}var g=Object.freeze({status:"aborted"}),R6=(X)=>({status:"dirty",value:X}),C0=(X)=>({status:"valid",value:X}),L9=(X)=>X.status==="aborted",q9=(X)=>X.status==="dirty",o1=(X)=>X.status==="valid",WX=(X)=>typeof Promise<"u"&&X instanceof Promise;var Z;(function(X){X.errToObj=(Q)=>typeof Q==="string"?{message:Q}:Q||{},X.toString=(Q)=>typeof Q==="string"?Q:Q?.message})(Z||(Z={}));class r0{constructor(X,Q,$,Y){this._cachedPath=[],this.parent=X,this.data=Q,this._path=$,this._key=Y}get path(){if(!this._cachedPath.length)if(Array.isArray(this._key))this._cachedPath.push(...this._path,...this._key);else this._cachedPath.push(...this._path,this._key);return this._cachedPath}}var VW=(X,Q)=>{if(o1(Q))return{success:!0,data:Q.value};else{if(!X.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let $=new h0(X.common.issues);return this._error=$,this._error}}}};function l(X){if(!X)return{};let{errorMap:Q,invalid_type_error:$,required_error:Y,description:W}=X;if(Q&&($||Y))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);if(Q)return{errorMap:Q,description:W};return{errorMap:(G,H)=>{let{message:B}=X;if(G.code==="invalid_enum_value")return{message:B??H.defaultError};if(typeof H.data>"u")return{message:B??Y??H.defaultError};if(G.code!=="invalid_type")return{message:H.defaultError};return{message:B??$??H.defaultError}},description:W}}class p{get description(){return this._def.description}_getType(X){return O1(X.data)}_getOrReturnCtx(X,Q){return Q||{common:X.parent.common,data:X.data,parsedType:O1(X.data),schemaErrorMap:this._def.errorMap,path:X.path,parent:X.parent}}_processInputParams(X){return{status:new I0,ctx:{common:X.parent.common,data:X.data,parsedType:O1(X.data),schemaErrorMap:this._def.errorMap,path:X.path,parent:X.parent}}}_parseSync(X){let Q=this._parse(X);if(WX(Q))throw Error("Synchronous parse encountered promise.");return Q}_parseAsync(X){let Q=this._parse(X);return Promise.resolve(Q)}parse(X,Q){let $=this.safeParse(X,Q);if($.success)return $.data;throw $.error}safeParse(X,Q){let $={common:{issues:[],async:Q?.async??!1,contextualErrorMap:Q?.errorMap},path:Q?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)},Y=this._parseSync({data:X,path:$.path,parent:$});return VW($,Y)}"~validate"(X){let Q={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)};if(!this["~standard"].async)try{let $=this._parseSync({data:X,path:[],parent:Q});return o1($)?{value:$.value}:{issues:Q.common.issues}}catch($){if($?.message?.toLowerCase()?.includes("encountered"))this["~standard"].async=!0;Q.common={issues:[],async:!0}}return this._parseAsync({data:X,path:[],parent:Q}).then(($)=>o1($)?{value:$.value}:{issues:Q.common.issues})}async parseAsync(X,Q){let $=await this.safeParseAsync(X,Q);if($.success)return $.data;throw $.error}async safeParseAsync(X,Q){let $={common:{issues:[],contextualErrorMap:Q?.errorMap,async:!0},path:Q?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)},Y=this._parse({data:X,path:$.path,parent:$}),W=await(WX(Y)?Y:Promise.resolve(Y));return VW($,W)}refine(X,Q){let $=(Y)=>{if(typeof Q==="string"||typeof Q>"u")return{message:Q};else if(typeof Q==="function")return Q(Y);else return Q};return this._refinement((Y,W)=>{let J=X(Y),G=()=>W.addIssue({code:w.custom,...$(Y)});if(typeof Promise<"u"&&J instanceof Promise)return J.then((H)=>{if(!H)return G(),!1;else return!0});if(!J)return G(),!1;else return!0})}refinement(X,Q){return this._refinement(($,Y)=>{if(!X($))return Y.addIssue(typeof Q==="function"?Q($,Y):Q),!1;else return!0})}_refinement(X){return new H1({schema:this,typeName:j.ZodEffects,effect:{type:"refinement",refinement:X}})}superRefine(X){return this._refinement(X)}constructor(X){this.spa=this.safeParseAsync,this._def=X,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:(Q)=>this["~validate"](Q)}}optional(){return G1.create(this,this._def)}nullable(){return _1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return J1.create(this)}promise(){return S6.create(this,this._def)}or(X){return zX.create([this,X],this._def)}and(X){return KX.create(this,X,this._def)}transform(X){return new H1({...l(this._def),schema:this,typeName:j.ZodEffects,effect:{type:"transform",transform:X}})}default(X){let Q=typeof X==="function"?X:()=>X;return new qX({...l(this._def),innerType:this,defaultValue:Q,typeName:j.ZodDefault})}brand(){return new D9({typeName:j.ZodBranded,type:this,...l(this._def)})}catch(X){let Q=typeof X==="function"?X:()=>X;return new FX({...l(this._def),innerType:this,catchValue:Q,typeName:j.ZodCatch})}describe(X){return new this.constructor({...this._def,description:X})}pipe(X){return E4.create(this,X)}readonly(){return NX.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var WV=/^c[^\s-]{8,}$/i,JV=/^[0-9a-z]+$/,GV=/^[0-9A-HJKMNP-TV-Z]{26}$/i,HV=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,BV=/^[a-z0-9_-]{21}$/i,zV=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,KV=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,UV=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,VV="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",F9,LV=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qV=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,FV=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,NV=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,OV=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,DV=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,LW="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",AV=new RegExp(`^${LW}$`);function qW(X){let Q="[0-5]\\d";if(X.precision)Q=`${Q}\\.\\d{${X.precision}}`;else if(X.precision==null)Q=`${Q}(\\.\\d+)?`;let $=X.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${Q})${$}`}function wV(X){return new RegExp(`^${qW(X)}$`)}function MV(X){let Q=`${LW}T${qW(X)}`,$=[];if($.push(X.local?"Z?":"Z"),X.offset)$.push("([+-]\\d{2}:?\\d{2})");return Q=`${Q}(${$.join("|")})`,new RegExp(`^${Q}$`)}function jV(X,Q){if((Q==="v4"||!Q)&&LV.test(X))return!0;if((Q==="v6"||!Q)&&FV.test(X))return!0;return!1}function RV(X,Q){if(!zV.test(X))return!1;try{let[$]=X.split(".");if(!$)return!1;let Y=$.replace(/-/g,"+").replace(/_/g,"/").padEnd($.length+(4-$.length%4)%4,"="),W=JSON.parse(atob(Y));if(typeof W!=="object"||W===null)return!1;if("typ"in W&&W?.typ!=="JWT")return!1;if(!W.alg)return!1;if(Q&&W.alg!==Q)return!1;return!0}catch{return!1}}function EV(X,Q){if((Q==="v4"||!Q)&&qV.test(X))return!0;if((Q==="v6"||!Q)&&NV.test(X))return!0;return!1}class A1 extends p{_parse(X){if(this._def.coerce)X.data=String(X.data);if(this._getType(X)!==E.string){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.string,received:W.parsedType}),g}let $=new I0,Y=void 0;for(let W of this._def.checks)if(W.kind==="min"){if(X.data.length<W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_small,minimum:W.value,type:"string",inclusive:!0,exact:!1,message:W.message}),$.dirty()}else if(W.kind==="max"){if(X.data.length>W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_big,maximum:W.value,type:"string",inclusive:!0,exact:!1,message:W.message}),$.dirty()}else if(W.kind==="length"){let J=X.data.length>W.value,G=X.data.length<W.value;if(J||G){if(Y=this._getOrReturnCtx(X,Y),J)b(Y,{code:w.too_big,maximum:W.value,type:"string",inclusive:!0,exact:!0,message:W.message});else if(G)b(Y,{code:w.too_small,minimum:W.value,type:"string",inclusive:!0,exact:!0,message:W.message});$.dirty()}}else if(W.kind==="email"){if(!UV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"email",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="emoji"){if(!F9)F9=new RegExp(VV,"u");if(!F9.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"emoji",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="uuid"){if(!HV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"uuid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="nanoid"){if(!BV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"nanoid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cuid"){if(!WV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cuid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cuid2"){if(!JV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cuid2",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="ulid"){if(!GV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"ulid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="url")try{new URL(X.data)}catch{Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"url",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="regex"){if(W.regex.lastIndex=0,!W.regex.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"regex",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="trim")X.data=X.data.trim();else if(W.kind==="includes"){if(!X.data.includes(W.value,W.position))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{includes:W.value,position:W.position},message:W.message}),$.dirty()}else if(W.kind==="toLowerCase")X.data=X.data.toLowerCase();else if(W.kind==="toUpperCase")X.data=X.data.toUpperCase();else if(W.kind==="startsWith"){if(!X.data.startsWith(W.value))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{startsWith:W.value},message:W.message}),$.dirty()}else if(W.kind==="endsWith"){if(!X.data.endsWith(W.value))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{endsWith:W.value},message:W.message}),$.dirty()}else if(W.kind==="datetime"){if(!MV(W).test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"datetime",message:W.message}),$.dirty()}else if(W.kind==="date"){if(!AV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"date",message:W.message}),$.dirty()}else if(W.kind==="time"){if(!wV(W).test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"time",message:W.message}),$.dirty()}else if(W.kind==="duration"){if(!KV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"duration",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="ip"){if(!jV(X.data,W.version))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"ip",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="jwt"){if(!RV(X.data,W.alg))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"jwt",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cidr"){if(!EV(X.data,W.version))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cidr",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="base64"){if(!OV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"base64",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="base64url"){if(!DV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"base64url",code:w.invalid_string,message:W.message}),$.dirty()}else n.assertNever(W);return{status:$.value,value:X.data}}_regex(X,Q,$){return this.refinement((Y)=>X.test(Y),{validation:Q,code:w.invalid_string,...Z.errToObj($)})}_addCheck(X){return new A1({...this._def,checks:[...this._def.checks,X]})}email(X){return this._addCheck({kind:"email",...Z.errToObj(X)})}url(X){return this._addCheck({kind:"url",...Z.errToObj(X)})}emoji(X){return this._addCheck({kind:"emoji",...Z.errToObj(X)})}uuid(X){return this._addCheck({kind:"uuid",...Z.errToObj(X)})}nanoid(X){return this._addCheck({kind:"nanoid",...Z.errToObj(X)})}cuid(X){return this._addCheck({kind:"cuid",...Z.errToObj(X)})}cuid2(X){return this._addCheck({kind:"cuid2",...Z.errToObj(X)})}ulid(X){return this._addCheck({kind:"ulid",...Z.errToObj(X)})}base64(X){return this._addCheck({kind:"base64",...Z.errToObj(X)})}base64url(X){return this._addCheck({kind:"base64url",...Z.errToObj(X)})}jwt(X){return this._addCheck({kind:"jwt",...Z.errToObj(X)})}ip(X){return this._addCheck({kind:"ip",...Z.errToObj(X)})}cidr(X){return this._addCheck({kind:"cidr",...Z.errToObj(X)})}datetime(X){if(typeof X==="string")return this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:X});return this._addCheck({kind:"datetime",precision:typeof X?.precision>"u"?null:X?.precision,offset:X?.offset??!1,local:X?.local??!1,...Z.errToObj(X?.message)})}date(X){return this._addCheck({kind:"date",message:X})}time(X){if(typeof X==="string")return this._addCheck({kind:"time",precision:null,message:X});return this._addCheck({kind:"time",precision:typeof X?.precision>"u"?null:X?.precision,...Z.errToObj(X?.message)})}duration(X){return this._addCheck({kind:"duration",...Z.errToObj(X)})}regex(X,Q){return this._addCheck({kind:"regex",regex:X,...Z.errToObj(Q)})}includes(X,Q){return this._addCheck({kind:"includes",value:X,position:Q?.position,...Z.errToObj(Q?.message)})}startsWith(X,Q){return this._addCheck({kind:"startsWith",value:X,...Z.errToObj(Q)})}endsWith(X,Q){return this._addCheck({kind:"endsWith",value:X,...Z.errToObj(Q)})}min(X,Q){return this._addCheck({kind:"min",value:X,...Z.errToObj(Q)})}max(X,Q){return this._addCheck({kind:"max",value:X,...Z.errToObj(Q)})}length(X,Q){return this._addCheck({kind:"length",value:X,...Z.errToObj(Q)})}nonempty(X){return this.min(1,Z.errToObj(X))}trim(){return new A1({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new A1({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new A1({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((X)=>X.kind==="datetime")}get isDate(){return!!this._def.checks.find((X)=>X.kind==="date")}get isTime(){return!!this._def.checks.find((X)=>X.kind==="time")}get isDuration(){return!!this._def.checks.find((X)=>X.kind==="duration")}get isEmail(){return!!this._def.checks.find((X)=>X.kind==="email")}get isURL(){return!!this._def.checks.find((X)=>X.kind==="url")}get isEmoji(){return!!this._def.checks.find((X)=>X.kind==="emoji")}get isUUID(){return!!this._def.checks.find((X)=>X.kind==="uuid")}get isNANOID(){return!!this._def.checks.find((X)=>X.kind==="nanoid")}get isCUID(){return!!this._def.checks.find((X)=>X.kind==="cuid")}get isCUID2(){return!!this._def.checks.find((X)=>X.kind==="cuid2")}get isULID(){return!!this._def.checks.find((X)=>X.kind==="ulid")}get isIP(){return!!this._def.checks.find((X)=>X.kind==="ip")}get isCIDR(){return!!this._def.checks.find((X)=>X.kind==="cidr")}get isBase64(){return!!this._def.checks.find((X)=>X.kind==="base64")}get isBase64url(){return!!this._def.checks.find((X)=>X.kind==="base64url")}get minLength(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxLength(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}}A1.create=(X)=>{return new A1({checks:[],typeName:j.ZodString,coerce:X?.coerce??!1,...l(X)})};function IV(X,Q){let $=(X.toString().split(".")[1]||"").length,Y=(Q.toString().split(".")[1]||"").length,W=$>Y?$:Y,J=Number.parseInt(X.toFixed(W).replace(".","")),G=Number.parseInt(Q.toFixed(W).replace(".",""));return J%G/10**W}class I6 extends p{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(X){if(this._def.coerce)X.data=Number(X.data);if(this._getType(X)!==E.number){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.number,received:W.parsedType}),g}let $=void 0,Y=new I0;for(let W of this._def.checks)if(W.kind==="int"){if(!n.isInteger(X.data))$=this._getOrReturnCtx(X,$),b($,{code:w.invalid_type,expected:"integer",received:"float",message:W.message}),Y.dirty()}else if(W.kind==="min"){if(W.inclusive?X.data<W.value:X.data<=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_small,minimum:W.value,type:"number",inclusive:W.inclusive,exact:!1,message:W.message}),Y.dirty()}else if(W.kind==="max"){if(W.inclusive?X.data>W.value:X.data>=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_big,maximum:W.value,type:"number",inclusive:W.inclusive,exact:!1,message:W.message}),Y.dirty()}else if(W.kind==="multipleOf"){if(IV(X.data,W.value)!==0)$=this._getOrReturnCtx(X,$),b($,{code:w.not_multiple_of,multipleOf:W.value,message:W.message}),Y.dirty()}else if(W.kind==="finite"){if(!Number.isFinite(X.data))$=this._getOrReturnCtx(X,$),b($,{code:w.not_finite,message:W.message}),Y.dirty()}else n.assertNever(W);return{status:Y.value,value:X.data}}gte(X,Q){return this.setLimit("min",X,!0,Z.toString(Q))}gt(X,Q){return this.setLimit("min",X,!1,Z.toString(Q))}lte(X,Q){return this.setLimit("max",X,!0,Z.toString(Q))}lt(X,Q){return this.setLimit("max",X,!1,Z.toString(Q))}setLimit(X,Q,$,Y){return new I6({...this._def,checks:[...this._def.checks,{kind:X,value:Q,inclusive:$,message:Z.toString(Y)}]})}_addCheck(X){return new I6({...this._def,checks:[...this._def.checks,X]})}int(X){return this._addCheck({kind:"int",message:Z.toString(X)})}positive(X){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(X)})}negative(X){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(X)})}nonpositive(X){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(X)})}nonnegative(X){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(X)})}multipleOf(X,Q){return this._addCheck({kind:"multipleOf",value:X,message:Z.toString(Q)})}finite(X){return this._addCheck({kind:"finite",message:Z.toString(X)})}safe(X){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(X)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(X)})}get minValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}get isInt(){return!!this._def.checks.find((X)=>X.kind==="int"||X.kind==="multipleOf"&&n.isInteger(X.value))}get isFinite(){let X=null,Q=null;for(let $ of this._def.checks)if($.kind==="finite"||$.kind==="int"||$.kind==="multipleOf")return!0;else if($.kind==="min"){if(Q===null||$.value>Q)Q=$.value}else if($.kind==="max"){if(X===null||$.value<X)X=$.value}return Number.isFinite(Q)&&Number.isFinite(X)}}I6.create=(X)=>{return new I6({checks:[],typeName:j.ZodNumber,coerce:X?.coerce||!1,...l(X)})};class b6 extends p{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte}_parse(X){if(this._def.coerce)try{X.data=BigInt(X.data)}catch{return this._getInvalidInput(X)}if(this._getType(X)!==E.bigint)return this._getInvalidInput(X);let $=void 0,Y=new I0;for(let W of this._def.checks)if(W.kind==="min"){if(W.inclusive?X.data<W.value:X.data<=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_small,type:"bigint",minimum:W.value,inclusive:W.inclusive,message:W.message}),Y.dirty()}else if(W.kind==="max"){if(W.inclusive?X.data>W.value:X.data>=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_big,type:"bigint",maximum:W.value,inclusive:W.inclusive,message:W.message}),Y.dirty()}else if(W.kind==="multipleOf"){if(X.data%W.value!==BigInt(0))$=this._getOrReturnCtx(X,$),b($,{code:w.not_multiple_of,multipleOf:W.value,message:W.message}),Y.dirty()}else n.assertNever(W);return{status:Y.value,value:X.data}}_getInvalidInput(X){let Q=this._getOrReturnCtx(X);return b(Q,{code:w.invalid_type,expected:E.bigint,received:Q.parsedType}),g}gte(X,Q){return this.setLimit("min",X,!0,Z.toString(Q))}gt(X,Q){return this.setLimit("min",X,!1,Z.toString(Q))}lte(X,Q){return this.setLimit("max",X,!0,Z.toString(Q))}lt(X,Q){return this.setLimit("max",X,!1,Z.toString(Q))}setLimit(X,Q,$,Y){return new b6({...this._def,checks:[...this._def.checks,{kind:X,value:Q,inclusive:$,message:Z.toString(Y)}]})}_addCheck(X){return new b6({...this._def,checks:[...this._def.checks,X]})}positive(X){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(X)})}negative(X){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(X)})}nonpositive(X){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(X)})}nonnegative(X){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(X)})}multipleOf(X,Q){return this._addCheck({kind:"multipleOf",value:X,message:Z.toString(Q)})}get minValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}}b6.create=(X)=>{return new b6({checks:[],typeName:j.ZodBigInt,coerce:X?.coerce??!1,...l(X)})};class O4 extends p{_parse(X){if(this._def.coerce)X.data=Boolean(X.data);if(this._getType(X)!==E.boolean){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.boolean,received:$.parsedType}),g}return C0(X.data)}}O4.create=(X)=>{return new O4({typeName:j.ZodBoolean,coerce:X?.coerce||!1,...l(X)})};class GX extends p{_parse(X){if(this._def.coerce)X.data=new Date(X.data);if(this._getType(X)!==E.date){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.date,received:W.parsedType}),g}if(Number.isNaN(X.data.getTime())){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_date}),g}let $=new I0,Y=void 0;for(let W of this._def.checks)if(W.kind==="min"){if(X.data.getTime()<W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_small,message:W.message,inclusive:!0,exact:!1,minimum:W.value,type:"date"}),$.dirty()}else if(W.kind==="max"){if(X.data.getTime()>W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_big,message:W.message,inclusive:!0,exact:!1,maximum:W.value,type:"date"}),$.dirty()}else n.assertNever(W);return{status:$.value,value:new Date(X.data.getTime())}}_addCheck(X){return new GX({...this._def,checks:[...this._def.checks,X]})}min(X,Q){return this._addCheck({kind:"min",value:X.getTime(),message:Z.toString(Q)})}max(X,Q){return this._addCheck({kind:"max",value:X.getTime(),message:Z.toString(Q)})}get minDate(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X!=null?new Date(X):null}get maxDate(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X!=null?new Date(X):null}}GX.create=(X)=>{return new GX({checks:[],coerce:X?.coerce||!1,typeName:j.ZodDate,...l(X)})};class D4 extends p{_parse(X){if(this._getType(X)!==E.symbol){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.symbol,received:$.parsedType}),g}return C0(X.data)}}D4.create=(X)=>{return new D4({typeName:j.ZodSymbol,...l(X)})};class HX extends p{_parse(X){if(this._getType(X)!==E.undefined){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.undefined,received:$.parsedType}),g}return C0(X.data)}}HX.create=(X)=>{return new HX({typeName:j.ZodUndefined,...l(X)})};class BX extends p{_parse(X){if(this._getType(X)!==E.null){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.null,received:$.parsedType}),g}return C0(X.data)}}BX.create=(X)=>{return new BX({typeName:j.ZodNull,...l(X)})};class A4 extends p{constructor(){super(...arguments);this._any=!0}_parse(X){return C0(X.data)}}A4.create=(X)=>{return new A4({typeName:j.ZodAny,...l(X)})};class t1 extends p{constructor(){super(...arguments);this._unknown=!0}_parse(X){return C0(X.data)}}t1.create=(X)=>{return new t1({typeName:j.ZodUnknown,...l(X)})};class w1 extends p{_parse(X){let Q=this._getOrReturnCtx(X);return b(Q,{code:w.invalid_type,expected:E.never,received:Q.parsedType}),g}}w1.create=(X)=>{return new w1({typeName:j.ZodNever,...l(X)})};class w4 extends p{_parse(X){if(this._getType(X)!==E.undefined){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.void,received:$.parsedType}),g}return C0(X.data)}}w4.create=(X)=>{return new w4({typeName:j.ZodVoid,...l(X)})};class J1 extends p{_parse(X){let{ctx:Q,status:$}=this._processInputParams(X),Y=this._def;if(Q.parsedType!==E.array)return b(Q,{code:w.invalid_type,expected:E.array,received:Q.parsedType}),g;if(Y.exactLength!==null){let J=Q.data.length>Y.exactLength.value,G=Q.data.length<Y.exactLength.value;if(J||G)b(Q,{code:J?w.too_big:w.too_small,minimum:G?Y.exactLength.value:void 0,maximum:J?Y.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:Y.exactLength.message}),$.dirty()}if(Y.minLength!==null){if(Q.data.length<Y.minLength.value)b(Q,{code:w.too_small,minimum:Y.minLength.value,type:"array",inclusive:!0,exact:!1,message:Y.minLength.message}),$.dirty()}if(Y.maxLength!==null){if(Q.data.length>Y.maxLength.value)b(Q,{code:w.too_big,maximum:Y.maxLength.value,type:"array",inclusive:!0,exact:!1,message:Y.maxLength.message}),$.dirty()}if(Q.common.async)return Promise.all([...Q.data].map((J,G)=>{return Y.type._parseAsync(new r0(Q,J,Q.path,G))})).then((J)=>{return I0.mergeArray($,J)});let W=[...Q.data].map((J,G)=>{return Y.type._parseSync(new r0(Q,J,Q.path,G))});return I0.mergeArray($,W)}get element(){return this._def.type}min(X,Q){return new J1({...this._def,minLength:{value:X,message:Z.toString(Q)}})}max(X,Q){return new J1({...this._def,maxLength:{value:X,message:Z.toString(Q)}})}length(X,Q){return new J1({...this._def,exactLength:{value:X,message:Z.toString(Q)}})}nonempty(X){return this.min(1,X)}}J1.create=(X,Q)=>{return new J1({type:X,minLength:null,maxLength:null,exactLength:null,typeName:j.ZodArray,...l(Q)})};function E6(X){if(X instanceof V0){let Q={};for(let $ in X.shape){let Y=X.shape[$];Q[$]=G1.create(E6(Y))}return new V0({...X._def,shape:()=>Q})}else if(X instanceof J1)return new J1({...X._def,type:E6(X.element)});else if(X instanceof G1)return G1.create(E6(X.unwrap()));else if(X instanceof _1)return _1.create(E6(X.unwrap()));else if(X instanceof M1)return M1.create(X.items.map((Q)=>E6(Q)));else return X}class V0 extends p{constructor(){super(...arguments);this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let X=this._def.shape(),Q=n.objectKeys(X);return this._cached={shape:X,keys:Q},this._cached}_parse(X){if(this._getType(X)!==E.object){let B=this._getOrReturnCtx(X);return b(B,{code:w.invalid_type,expected:E.object,received:B.parsedType}),g}let{status:$,ctx:Y}=this._processInputParams(X),{shape:W,keys:J}=this._getCached(),G=[];if(!(this._def.catchall instanceof w1&&this._def.unknownKeys==="strip")){for(let B in Y.data)if(!J.includes(B))G.push(B)}let H=[];for(let B of J){let z=W[B],K=Y.data[B];H.push({key:{status:"valid",value:B},value:z._parse(new r0(Y,K,Y.path,B)),alwaysSet:B in Y.data})}if(this._def.catchall instanceof w1){let B=this._def.unknownKeys;if(B==="passthrough")for(let z of G)H.push({key:{status:"valid",value:z},value:{status:"valid",value:Y.data[z]}});else if(B==="strict"){if(G.length>0)b(Y,{code:w.unrecognized_keys,keys:G}),$.dirty()}else if(B==="strip");else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let B=this._def.catchall;for(let z of G){let K=Y.data[z];H.push({key:{status:"valid",value:z},value:B._parse(new r0(Y,K,Y.path,z)),alwaysSet:z in Y.data})}}if(Y.common.async)return Promise.resolve().then(async()=>{let B=[];for(let z of H){let K=await z.key,V=await z.value;B.push({key:K,value:V,alwaysSet:z.alwaysSet})}return B}).then((B)=>{return I0.mergeObjectSync($,B)});else return I0.mergeObjectSync($,H)}get shape(){return this._def.shape()}strict(X){return Z.errToObj,new V0({...this._def,unknownKeys:"strict",...X!==void 0?{errorMap:(Q,$)=>{let Y=this._def.errorMap?.(Q,$).message??$.defaultError;if(Q.code==="unrecognized_keys")return{message:Z.errToObj(X).message??Y};return{message:Y}}}:{}})}strip(){return new V0({...this._def,unknownKeys:"strip"})}passthrough(){return new V0({...this._def,unknownKeys:"passthrough"})}extend(X){return new V0({...this._def,shape:()=>({...this._def.shape(),...X})})}merge(X){return new V0({unknownKeys:X._def.unknownKeys,catchall:X._def.catchall,shape:()=>({...this._def.shape(),...X._def.shape()}),typeName:j.ZodObject})}setKey(X,Q){return this.augment({[X]:Q})}catchall(X){return new V0({...this._def,catchall:X})}pick(X){let Q={};for(let $ of n.objectKeys(X))if(X[$]&&this.shape[$])Q[$]=this.shape[$];return new V0({...this._def,shape:()=>Q})}omit(X){let Q={};for(let $ of n.objectKeys(this.shape))if(!X[$])Q[$]=this.shape[$];return new V0({...this._def,shape:()=>Q})}deepPartial(){return E6(this)}partial(X){let Q={};for(let $ of n.objectKeys(this.shape)){let Y=this.shape[$];if(X&&!X[$])Q[$]=Y;else Q[$]=Y.optional()}return new V0({...this._def,shape:()=>Q})}required(X){let Q={};for(let $ of n.objectKeys(this.shape))if(X&&!X[$])Q[$]=this.shape[$];else{let W=this.shape[$];while(W instanceof G1)W=W._def.innerType;Q[$]=W}return new V0({...this._def,shape:()=>Q})}keyof(){return FW(n.objectKeys(this.shape))}}V0.create=(X,Q)=>{return new V0({shape:()=>X,unknownKeys:"strip",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};V0.strictCreate=(X,Q)=>{return new V0({shape:()=>X,unknownKeys:"strict",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};V0.lazycreate=(X,Q)=>{return new V0({shape:X,unknownKeys:"strip",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};class zX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=this._def.options;function Y(W){for(let G of W)if(G.result.status==="valid")return G.result;for(let G of W)if(G.result.status==="dirty")return Q.common.issues.push(...G.ctx.common.issues),G.result;let J=W.map((G)=>new h0(G.ctx.common.issues));return b(Q,{code:w.invalid_union,unionErrors:J}),g}if(Q.common.async)return Promise.all($.map(async(W)=>{let J={...Q,common:{...Q.common,issues:[]},parent:null};return{result:await W._parseAsync({data:Q.data,path:Q.path,parent:J}),ctx:J}})).then(Y);else{let W=void 0,J=[];for(let H of $){let B={...Q,common:{...Q.common,issues:[]},parent:null},z=H._parseSync({data:Q.data,path:Q.path,parent:B});if(z.status==="valid")return z;else if(z.status==="dirty"&&!W)W={result:z,ctx:B};if(B.common.issues.length)J.push(B.common.issues)}if(W)return Q.common.issues.push(...W.ctx.common.issues),W.result;let G=J.map((H)=>new h0(H));return b(Q,{code:w.invalid_union,unionErrors:G}),g}}get options(){return this._def.options}}zX.create=(X,Q)=>{return new zX({options:X,typeName:j.ZodUnion,...l(Q)})};var D1=(X)=>{if(X instanceof UX)return D1(X.schema);else if(X instanceof H1)return D1(X.innerType());else if(X instanceof VX)return[X.value];else if(X instanceof a1)return X.options;else if(X instanceof LX)return n.objectValues(X.enum);else if(X instanceof qX)return D1(X._def.innerType);else if(X instanceof HX)return[void 0];else if(X instanceof BX)return[null];else if(X instanceof G1)return[void 0,...D1(X.unwrap())];else if(X instanceof _1)return[null,...D1(X.unwrap())];else if(X instanceof D9)return D1(X.unwrap());else if(X instanceof NX)return D1(X.unwrap());else if(X instanceof FX)return D1(X._def.innerType);else return[]};class O9 extends p{_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.object)return b(Q,{code:w.invalid_type,expected:E.object,received:Q.parsedType}),g;let $=this.discriminator,Y=Q.data[$],W=this.optionsMap.get(Y);if(!W)return b(Q,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[$]}),g;if(Q.common.async)return W._parseAsync({data:Q.data,path:Q.path,parent:Q});else return W._parseSync({data:Q.data,path:Q.path,parent:Q})}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(X,Q,$){let Y=new Map;for(let W of Q){let J=D1(W.shape[X]);if(!J.length)throw Error(`A discriminator value for key \`${X}\` could not be extracted from all schema options`);for(let G of J){if(Y.has(G))throw Error(`Discriminator property ${String(X)} has duplicate value ${String(G)}`);Y.set(G,W)}}return new O9({typeName:j.ZodDiscriminatedUnion,discriminator:X,options:Q,optionsMap:Y,...l($)})}}function N9(X,Q){let $=O1(X),Y=O1(Q);if(X===Q)return{valid:!0,data:X};else if($===E.object&&Y===E.object){let W=n.objectKeys(Q),J=n.objectKeys(X).filter((H)=>W.indexOf(H)!==-1),G={...X,...Q};for(let H of J){let B=N9(X[H],Q[H]);if(!B.valid)return{valid:!1};G[H]=B.data}return{valid:!0,data:G}}else if($===E.array&&Y===E.array){if(X.length!==Q.length)return{valid:!1};let W=[];for(let J=0;J<X.length;J++){let G=X[J],H=Q[J],B=N9(G,H);if(!B.valid)return{valid:!1};W.push(B.data)}return{valid:!0,data:W}}else if($===E.date&&Y===E.date&&+X===+Q)return{valid:!0,data:X};else return{valid:!1}}class KX extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X),Y=(W,J)=>{if(L9(W)||L9(J))return g;let G=N9(W.value,J.value);if(!G.valid)return b($,{code:w.invalid_intersection_types}),g;if(q9(W)||q9(J))Q.dirty();return{status:Q.value,value:G.data}};if($.common.async)return Promise.all([this._def.left._parseAsync({data:$.data,path:$.path,parent:$}),this._def.right._parseAsync({data:$.data,path:$.path,parent:$})]).then(([W,J])=>Y(W,J));else return Y(this._def.left._parseSync({data:$.data,path:$.path,parent:$}),this._def.right._parseSync({data:$.data,path:$.path,parent:$}))}}KX.create=(X,Q,$)=>{return new KX({left:X,right:Q,typeName:j.ZodIntersection,...l($)})};class M1 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.array)return b($,{code:w.invalid_type,expected:E.array,received:$.parsedType}),g;if($.data.length<this._def.items.length)return b($,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;if(!this._def.rest&&$.data.length>this._def.items.length)b($,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Q.dirty();let W=[...$.data].map((J,G)=>{let H=this._def.items[G]||this._def.rest;if(!H)return null;return H._parse(new r0($,J,$.path,G))}).filter((J)=>!!J);if($.common.async)return Promise.all(W).then((J)=>{return I0.mergeArray(Q,J)});else return I0.mergeArray(Q,W)}get items(){return this._def.items}rest(X){return new M1({...this._def,rest:X})}}M1.create=(X,Q)=>{if(!Array.isArray(X))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new M1({items:X,typeName:j.ZodTuple,rest:null,...l(Q)})};class M4 extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.object)return b($,{code:w.invalid_type,expected:E.object,received:$.parsedType}),g;let Y=[],W=this._def.keyType,J=this._def.valueType;for(let G in $.data)Y.push({key:W._parse(new r0($,G,$.path,G)),value:J._parse(new r0($,$.data[G],$.path,G)),alwaysSet:G in $.data});if($.common.async)return I0.mergeObjectAsync(Q,Y);else return I0.mergeObjectSync(Q,Y)}get element(){return this._def.valueType}static create(X,Q,$){if(Q instanceof p)return new M4({keyType:X,valueType:Q,typeName:j.ZodRecord,...l($)});return new M4({keyType:A1.create(),valueType:X,typeName:j.ZodRecord,...l(Q)})}}class j4 extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.map)return b($,{code:w.invalid_type,expected:E.map,received:$.parsedType}),g;let Y=this._def.keyType,W=this._def.valueType,J=[...$.data.entries()].map(([G,H],B)=>{return{key:Y._parse(new r0($,G,$.path,[B,"key"])),value:W._parse(new r0($,H,$.path,[B,"value"]))}});if($.common.async){let G=new Map;return Promise.resolve().then(async()=>{for(let H of J){let B=await H.key,z=await H.value;if(B.status==="aborted"||z.status==="aborted")return g;if(B.status==="dirty"||z.status==="dirty")Q.dirty();G.set(B.value,z.value)}return{status:Q.value,value:G}})}else{let G=new Map;for(let H of J){let{key:B,value:z}=H;if(B.status==="aborted"||z.status==="aborted")return g;if(B.status==="dirty"||z.status==="dirty")Q.dirty();G.set(B.value,z.value)}return{status:Q.value,value:G}}}}j4.create=(X,Q,$)=>{return new j4({valueType:Q,keyType:X,typeName:j.ZodMap,...l($)})};class P6 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.set)return b($,{code:w.invalid_type,expected:E.set,received:$.parsedType}),g;let Y=this._def;if(Y.minSize!==null){if($.data.size<Y.minSize.value)b($,{code:w.too_small,minimum:Y.minSize.value,type:"set",inclusive:!0,exact:!1,message:Y.minSize.message}),Q.dirty()}if(Y.maxSize!==null){if($.data.size>Y.maxSize.value)b($,{code:w.too_big,maximum:Y.maxSize.value,type:"set",inclusive:!0,exact:!1,message:Y.maxSize.message}),Q.dirty()}let W=this._def.valueType;function J(H){let B=new Set;for(let z of H){if(z.status==="aborted")return g;if(z.status==="dirty")Q.dirty();B.add(z.value)}return{status:Q.value,value:B}}let G=[...$.data.values()].map((H,B)=>W._parse(new r0($,H,$.path,B)));if($.common.async)return Promise.all(G).then((H)=>J(H));else return J(G)}min(X,Q){return new P6({...this._def,minSize:{value:X,message:Z.toString(Q)}})}max(X,Q){return new P6({...this._def,maxSize:{value:X,message:Z.toString(Q)}})}size(X,Q){return this.min(X,Q).max(X,Q)}nonempty(X){return this.min(1,X)}}P6.create=(X,Q)=>{return new P6({valueType:X,minSize:null,maxSize:null,typeName:j.ZodSet,...l(Q)})};class JX extends p{constructor(){super(...arguments);this.validate=this.implement}_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.function)return b(Q,{code:w.invalid_type,expected:E.function,received:Q.parsedType}),g;function $(G,H){return N4({data:G,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,YX(),T1].filter((B)=>!!B),issueData:{code:w.invalid_arguments,argumentsError:H}})}function Y(G,H){return N4({data:G,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,YX(),T1].filter((B)=>!!B),issueData:{code:w.invalid_return_type,returnTypeError:H}})}let W={errorMap:Q.common.contextualErrorMap},J=Q.data;if(this._def.returns instanceof S6){let G=this;return C0(async function(...H){let B=new h0([]),z=await G._def.args.parseAsync(H,W).catch((L)=>{throw B.addIssue($(H,L)),B}),K=await Reflect.apply(J,this,z);return await G._def.returns._def.type.parseAsync(K,W).catch((L)=>{throw B.addIssue(Y(K,L)),B})})}else{let G=this;return C0(function(...H){let B=G._def.args.safeParse(H,W);if(!B.success)throw new h0([$(H,B.error)]);let z=Reflect.apply(J,this,B.data),K=G._def.returns.safeParse(z,W);if(!K.success)throw new h0([Y(z,K.error)]);return K.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...X){return new JX({...this._def,args:M1.create(X).rest(t1.create())})}returns(X){return new JX({...this._def,returns:X})}implement(X){return this.parse(X)}strictImplement(X){return this.parse(X)}static create(X,Q,$){return new JX({args:X?X:M1.create([]).rest(t1.create()),returns:Q||t1.create(),typeName:j.ZodFunction,...l($)})}}class UX extends p{get schema(){return this._def.getter()}_parse(X){let{ctx:Q}=this._processInputParams(X);return this._def.getter()._parse({data:Q.data,path:Q.path,parent:Q})}}UX.create=(X,Q)=>{return new UX({getter:X,typeName:j.ZodLazy,...l(Q)})};class VX extends p{_parse(X){if(X.data!==this._def.value){let Q=this._getOrReturnCtx(X);return b(Q,{received:Q.data,code:w.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:X.data}}get value(){return this._def.value}}VX.create=(X,Q)=>{return new VX({value:X,typeName:j.ZodLiteral,...l(Q)})};function FW(X,Q){return new a1({values:X,typeName:j.ZodEnum,...l(Q)})}class a1 extends p{_parse(X){if(typeof X.data!=="string"){let Q=this._getOrReturnCtx(X),$=this._def.values;return b(Q,{expected:n.joinValues($),received:Q.parsedType,code:w.invalid_type}),g}if(!this._cache)this._cache=new Set(this._def.values);if(!this._cache.has(X.data)){let Q=this._getOrReturnCtx(X),$=this._def.values;return b(Q,{received:Q.data,code:w.invalid_enum_value,options:$}),g}return C0(X.data)}get options(){return this._def.values}get enum(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}get Values(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}get Enum(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}extract(X,Q=this._def){return a1.create(X,{...this._def,...Q})}exclude(X,Q=this._def){return a1.create(this.options.filter(($)=>!X.includes($)),{...this._def,...Q})}}a1.create=FW;class LX extends p{_parse(X){let Q=n.getValidEnumValues(this._def.values),$=this._getOrReturnCtx(X);if($.parsedType!==E.string&&$.parsedType!==E.number){let Y=n.objectValues(Q);return b($,{expected:n.joinValues(Y),received:$.parsedType,code:w.invalid_type}),g}if(!this._cache)this._cache=new Set(n.getValidEnumValues(this._def.values));if(!this._cache.has(X.data)){let Y=n.objectValues(Q);return b($,{received:$.data,code:w.invalid_enum_value,options:Y}),g}return C0(X.data)}get enum(){return this._def.values}}LX.create=(X,Q)=>{return new LX({values:X,typeName:j.ZodNativeEnum,...l(Q)})};class S6 extends p{unwrap(){return this._def.type}_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.promise&&Q.common.async===!1)return b(Q,{code:w.invalid_type,expected:E.promise,received:Q.parsedType}),g;let $=Q.parsedType===E.promise?Q.data:Promise.resolve(Q.data);return C0($.then((Y)=>{return this._def.type.parseAsync(Y,{path:Q.path,errorMap:Q.common.contextualErrorMap})}))}}S6.create=(X,Q)=>{return new S6({type:X,typeName:j.ZodPromise,...l(Q)})};class H1 extends p{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===j.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X),Y=this._def.effect||null,W={addIssue:(J)=>{if(b($,J),J.fatal)Q.abort();else Q.dirty()},get path(){return $.path}};if(W.addIssue=W.addIssue.bind(W),Y.type==="preprocess"){let J=Y.transform($.data,W);if($.common.async)return Promise.resolve(J).then(async(G)=>{if(Q.value==="aborted")return g;let H=await this._def.schema._parseAsync({data:G,path:$.path,parent:$});if(H.status==="aborted")return g;if(H.status==="dirty")return R6(H.value);if(Q.value==="dirty")return R6(H.value);return H});else{if(Q.value==="aborted")return g;let G=this._def.schema._parseSync({data:J,path:$.path,parent:$});if(G.status==="aborted")return g;if(G.status==="dirty")return R6(G.value);if(Q.value==="dirty")return R6(G.value);return G}}if(Y.type==="refinement"){let J=(G)=>{let H=Y.refinement(G,W);if($.common.async)return Promise.resolve(H);if(H instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return G};if($.common.async===!1){let G=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(G.status==="aborted")return g;if(G.status==="dirty")Q.dirty();return J(G.value),{status:Q.value,value:G.value}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((G)=>{if(G.status==="aborted")return g;if(G.status==="dirty")Q.dirty();return J(G.value).then(()=>{return{status:Q.value,value:G.value}})})}if(Y.type==="transform")if($.common.async===!1){let J=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(!o1(J))return g;let G=Y.transform(J.value,W);if(G instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:Q.value,value:G}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((J)=>{if(!o1(J))return g;return Promise.resolve(Y.transform(J.value,W)).then((G)=>({status:Q.value,value:G}))});n.assertNever(Y)}}H1.create=(X,Q,$)=>{return new H1({schema:X,typeName:j.ZodEffects,effect:Q,...l($)})};H1.createWithPreprocess=(X,Q,$)=>{return new H1({schema:Q,effect:{type:"preprocess",transform:X},typeName:j.ZodEffects,...l($)})};class G1 extends p{_parse(X){if(this._getType(X)===E.undefined)return C0(void 0);return this._def.innerType._parse(X)}unwrap(){return this._def.innerType}}G1.create=(X,Q)=>{return new G1({innerType:X,typeName:j.ZodOptional,...l(Q)})};class _1 extends p{_parse(X){if(this._getType(X)===E.null)return C0(null);return this._def.innerType._parse(X)}unwrap(){return this._def.innerType}}_1.create=(X,Q)=>{return new _1({innerType:X,typeName:j.ZodNullable,...l(Q)})};class qX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=Q.data;if(Q.parsedType===E.undefined)$=this._def.defaultValue();return this._def.innerType._parse({data:$,path:Q.path,parent:Q})}removeDefault(){return this._def.innerType}}qX.create=(X,Q)=>{return new qX({innerType:X,typeName:j.ZodDefault,defaultValue:typeof Q.default==="function"?Q.default:()=>Q.default,...l(Q)})};class FX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$={...Q,common:{...Q.common,issues:[]}},Y=this._def.innerType._parse({data:$.data,path:$.path,parent:{...$}});if(WX(Y))return Y.then((W)=>{return{status:"valid",value:W.status==="valid"?W.value:this._def.catchValue({get error(){return new h0($.common.issues)},input:$.data})}});else return{status:"valid",value:Y.status==="valid"?Y.value:this._def.catchValue({get error(){return new h0($.common.issues)},input:$.data})}}removeCatch(){return this._def.innerType}}FX.create=(X,Q)=>{return new FX({innerType:X,typeName:j.ZodCatch,catchValue:typeof Q.catch==="function"?Q.catch:()=>Q.catch,...l(Q)})};class R4 extends p{_parse(X){if(this._getType(X)!==E.nan){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.nan,received:$.parsedType}),g}return{status:"valid",value:X.data}}}R4.create=(X)=>{return new R4({typeName:j.ZodNaN,...l(X)})};var D2=Symbol("zod_brand");class D9 extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=Q.data;return this._def.type._parse({data:$,path:Q.path,parent:Q})}unwrap(){return this._def.type}}class E4 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.common.async)return(async()=>{let W=await this._def.in._parseAsync({data:$.data,path:$.path,parent:$});if(W.status==="aborted")return g;if(W.status==="dirty")return Q.dirty(),R6(W.value);else return this._def.out._parseAsync({data:W.value,path:$.path,parent:$})})();else{let Y=this._def.in._parseSync({data:$.data,path:$.path,parent:$});if(Y.status==="aborted")return g;if(Y.status==="dirty")return Q.dirty(),{status:"dirty",value:Y.value};else return this._def.out._parseSync({data:Y.value,path:$.path,parent:$})}}static create(X,Q){return new E4({in:X,out:Q,typeName:j.ZodPipeline})}}class NX extends p{_parse(X){let Q=this._def.innerType._parse(X),$=(Y)=>{if(o1(Y))Y.value=Object.freeze(Y.value);return Y};return WX(Q)?Q.then((Y)=>$(Y)):$(Q)}unwrap(){return this._def.innerType}}NX.create=(X,Q)=>{return new NX({innerType:X,typeName:j.ZodReadonly,...l(Q)})};var A2={object:V0.lazycreate},j;(function(X){X.ZodString="ZodString",X.ZodNumber="ZodNumber",X.ZodNaN="ZodNaN",X.ZodBigInt="ZodBigInt",X.ZodBoolean="ZodBoolean",X.ZodDate="ZodDate",X.ZodSymbol="ZodSymbol",X.ZodUndefined="ZodUndefined",X.ZodNull="ZodNull",X.ZodAny="ZodAny",X.ZodUnknown="ZodUnknown",X.ZodNever="ZodNever",X.ZodVoid="ZodVoid",X.ZodArray="ZodArray",X.ZodObject="ZodObject",X.ZodUnion="ZodUnion",X.ZodDiscriminatedUnion="ZodDiscriminatedUnion",X.ZodIntersection="ZodIntersection",X.ZodTuple="ZodTuple",X.ZodRecord="ZodRecord",X.ZodMap="ZodMap",X.ZodSet="ZodSet",X.ZodFunction="ZodFunction",X.ZodLazy="ZodLazy",X.ZodLiteral="ZodLiteral",X.ZodEnum="ZodEnum",X.ZodEffects="ZodEffects",X.ZodNativeEnum="ZodNativeEnum",X.ZodOptional="ZodOptional",X.ZodNullable="ZodNullable",X.ZodDefault="ZodDefault",X.ZodCatch="ZodCatch",X.ZodPromise="ZodPromise",X.ZodBranded="ZodBranded",X.ZodPipeline="ZodPipeline",X.ZodReadonly="ZodReadonly"})(j||(j={}));var w2=A1.create,M2=I6.create,j2=R4.create,R2=b6.create,E2=O4.create,I2=GX.create,b2=D4.create,P2=HX.create,S2=BX.create,Z2=A4.create,C2=t1.create,k2=w1.create,v2=w4.create,T2=J1.create,NW=V0.create,_2=V0.strictCreate,x2=zX.create,y2=O9.create,g2=KX.create,f2=M1.create,h2=M4.create,u2=j4.create,l2=P6.create,m2=JX.create,c2=UX.create,p2=VX.create,d2=a1.create,i2=LX.create,n2=S6.create,r2=H1.create,o2=G1.create,t2=_1.create,a2=H1.createWithPreprocess,s2=E4.create;var bV=Object.freeze({status:"aborted"});function O(X,Q,$){function Y(H,B){var z;Object.defineProperty(H,"_zod",{value:H._zod??{},enumerable:!1}),(z=H._zod).traits??(z.traits=new Set),H._zod.traits.add(X),Q(H,B);for(let K in G.prototype)if(!(K in H))Object.defineProperty(H,K,{value:G.prototype[K].bind(H)});H._zod.constr=G,H._zod.def=B}let W=$?.Parent??Object;class J extends W{}Object.defineProperty(J,"name",{value:X});function G(H){var B;let z=$?.Parent?new J:this;Y(z,H),(B=z._zod).deferred??(B.deferred=[]);for(let K of z._zod.deferred)K();return z}return Object.defineProperty(G,"init",{value:Y}),Object.defineProperty(G,Symbol.hasInstance,{value:(H)=>{if($?.Parent&&H instanceof $.Parent)return!0;return H?._zod?.traits?.has(X)}}),Object.defineProperty(G,"name",{value:X}),G}var PV=Symbol("zod_brand");class x1 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}var I4={};function u0(X){if(X)Object.assign(I4,X);return I4}var i={};U7(i,{unwrapMessage:()=>OX,stringifyPrimitive:()=>S4,required:()=>pV,randomString:()=>xV,propertyKeyTypes:()=>E9,promiseAllObject:()=>_V,primitiveTypes:()=>OW,prefixIssues:()=>B1,pick:()=>hV,partial:()=>cV,optionalKeys:()=>I9,omit:()=>uV,numKeys:()=>yV,nullish:()=>wX,normalizeParams:()=>y,merge:()=>mV,jsonStringifyReplacer:()=>w9,joinValues:()=>b4,issue:()=>P9,isPlainObject:()=>C6,isObject:()=>Z6,getSizableOrigin:()=>AW,getParsedType:()=>gV,getLengthableOrigin:()=>jX,getEnumValues:()=>DX,getElementAtPath:()=>TV,floatSafeRemainder:()=>M9,finalizeIssue:()=>o0,extend:()=>lV,escapeRegex:()=>y1,esc:()=>s1,defineLazy:()=>Y0,createTransparentProxy:()=>fV,clone:()=>l0,cleanRegex:()=>MX,cleanEnum:()=>dV,captureStackTrace:()=>P4,cached:()=>AX,assignProp:()=>j9,assertNotEqual:()=>ZV,assertNever:()=>kV,assertIs:()=>CV,assertEqual:()=>SV,assert:()=>vV,allowsEval:()=>R9,aborted:()=>e1,NUMBER_FORMAT_RANGES:()=>b9,Class:()=>wW,BIGINT_FORMAT_RANGES:()=>DW});function SV(X){return X}function ZV(X){return X}function CV(X){}function kV(X){throw Error()}function vV(X){}function DX(X){let Q=Object.values(X).filter((Y)=>typeof Y==="number");return Object.entries(X).filter(([Y,W])=>Q.indexOf(+Y)===-1).map(([Y,W])=>W)}function b4(X,Q="|"){return X.map(($)=>S4($)).join(Q)}function w9(X,Q){if(typeof Q==="bigint")return Q.toString();return Q}function AX(X){return{get value(){{let $=X();return Object.defineProperty(this,"value",{value:$}),$}throw Error("cached value already set")}}}function wX(X){return X===null||X===void 0}function MX(X){let Q=X.startsWith("^")?1:0,$=X.endsWith("$")?X.length-1:X.length;return X.slice(Q,$)}function M9(X,Q){let $=(X.toString().split(".")[1]||"").length,Y=(Q.toString().split(".")[1]||"").length,W=$>Y?$:Y,J=Number.parseInt(X.toFixed(W).replace(".","")),G=Number.parseInt(Q.toFixed(W).replace(".",""));return J%G/10**W}function Y0(X,Q,$){Object.defineProperty(X,Q,{get(){{let W=$();return X[Q]=W,W}throw Error("cached value already set")},set(W){Object.defineProperty(X,Q,{value:W})},configurable:!0})}function j9(X,Q,$){Object.defineProperty(X,Q,{value:$,writable:!0,enumerable:!0,configurable:!0})}function TV(X,Q){if(!Q)return X;return Q.reduce(($,Y)=>$?.[Y],X)}function _V(X){let Q=Object.keys(X),$=Q.map((Y)=>X[Y]);return Promise.all($).then((Y)=>{let W={};for(let J=0;J<Q.length;J++)W[Q[J]]=Y[J];return W})}function xV(X=10){let $="";for(let Y=0;Y<X;Y++)$+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return $}function s1(X){return JSON.stringify(X)}var P4=Error.captureStackTrace?Error.captureStackTrace:(...X)=>{};function Z6(X){return typeof X==="object"&&X!==null&&!Array.isArray(X)}var R9=AX(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(X){return!1}});function C6(X){if(Z6(X)===!1)return!1;let Q=X.constructor;if(Q===void 0)return!0;let $=Q.prototype;if(Z6($)===!1)return!1;if(Object.prototype.hasOwnProperty.call($,"isPrototypeOf")===!1)return!1;return!0}function yV(X){let Q=0;for(let $ in X)if(Object.prototype.hasOwnProperty.call(X,$))Q++;return Q}var gV=(X)=>{let Q=typeof X;switch(Q){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(X)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(X))return"array";if(X===null)return"null";if(X.then&&typeof X.then==="function"&&X.catch&&typeof X.catch==="function")return"promise";if(typeof Map<"u"&&X instanceof Map)return"map";if(typeof Set<"u"&&X instanceof Set)return"set";if(typeof Date<"u"&&X instanceof Date)return"date";if(typeof File<"u"&&X instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${Q}`)}},E9=new Set(["string","number","symbol"]),OW=new Set(["string","number","bigint","boolean","symbol","undefined"]);function y1(X){return X.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l0(X,Q,$){let Y=new X._zod.constr(Q??X._zod.def);if(!Q||$?.parent)Y._zod.parent=X;return Y}function y(X){let Q=X;if(!Q)return{};if(typeof Q==="string")return{error:()=>Q};if(Q?.message!==void 0){if(Q?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");Q.error=Q.message}if(delete Q.message,typeof Q.error==="string")return{...Q,error:()=>Q.error};return Q}function fV(X){let Q;return new Proxy({},{get($,Y,W){return Q??(Q=X()),Reflect.get(Q,Y,W)},set($,Y,W,J){return Q??(Q=X()),Reflect.set(Q,Y,W,J)},has($,Y){return Q??(Q=X()),Reflect.has(Q,Y)},deleteProperty($,Y){return Q??(Q=X()),Reflect.deleteProperty(Q,Y)},ownKeys($){return Q??(Q=X()),Reflect.ownKeys(Q)},getOwnPropertyDescriptor($,Y){return Q??(Q=X()),Reflect.getOwnPropertyDescriptor(Q,Y)},defineProperty($,Y,W){return Q??(Q=X()),Reflect.defineProperty(Q,Y,W)}})}function S4(X){if(typeof X==="bigint")return X.toString()+"n";if(typeof X==="string")return`"${X}"`;return`${X}`}function I9(X){return Object.keys(X).filter((Q)=>{return X[Q]._zod.optin==="optional"&&X[Q]._zod.optout==="optional"})}var b9={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-340282346638528860000000000000000000000,340282346638528860000000000000000000000],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},DW={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function hV(X,Q){let $={},Y=X._zod.def;for(let W in Q){if(!(W in Y.shape))throw Error(`Unrecognized key: "${W}"`);if(!Q[W])continue;$[W]=Y.shape[W]}return l0(X,{...X._zod.def,shape:$,checks:[]})}function uV(X,Q){let $={...X._zod.def.shape},Y=X._zod.def;for(let W in Q){if(!(W in Y.shape))throw Error(`Unrecognized key: "${W}"`);if(!Q[W])continue;delete $[W]}return l0(X,{...X._zod.def,shape:$,checks:[]})}function lV(X,Q){if(!C6(Q))throw Error("Invalid input to extend: expected a plain object");let $={...X._zod.def,get shape(){let Y={...X._zod.def.shape,...Q};return j9(this,"shape",Y),Y},checks:[]};return l0(X,$)}function mV(X,Q){return l0(X,{...X._zod.def,get shape(){let $={...X._zod.def.shape,...Q._zod.def.shape};return j9(this,"shape",$),$},catchall:Q._zod.def.catchall,checks:[]})}function cV(X,Q,$){let Y=Q._zod.def.shape,W={...Y};if($)for(let J in $){if(!(J in Y))throw Error(`Unrecognized key: "${J}"`);if(!$[J])continue;W[J]=X?new X({type:"optional",innerType:Y[J]}):Y[J]}else for(let J in Y)W[J]=X?new X({type:"optional",innerType:Y[J]}):Y[J];return l0(Q,{...Q._zod.def,shape:W,checks:[]})}function pV(X,Q,$){let Y=Q._zod.def.shape,W={...Y};if($)for(let J in $){if(!(J in W))throw Error(`Unrecognized key: "${J}"`);if(!$[J])continue;W[J]=new X({type:"nonoptional",innerType:Y[J]})}else for(let J in Y)W[J]=new X({type:"nonoptional",innerType:Y[J]});return l0(Q,{...Q._zod.def,shape:W,checks:[]})}function e1(X,Q=0){for(let $=Q;$<X.issues.length;$++)if(X.issues[$]?.continue!==!0)return!0;return!1}function B1(X,Q){return Q.map(($)=>{var Y;return(Y=$).path??(Y.path=[]),$.path.unshift(X),$})}function OX(X){return typeof X==="string"?X:X?.message}function o0(X,Q,$){let Y={...X,path:X.path??[]};if(!X.message){let W=OX(X.inst?._zod.def?.error?.(X))??OX(Q?.error?.(X))??OX($.customError?.(X))??OX($.localeError?.(X))??"Invalid input";Y.message=W}if(delete Y.inst,delete Y.continue,!Q?.reportInput)delete Y.input;return Y}function AW(X){if(X instanceof Set)return"set";if(X instanceof Map)return"map";if(X instanceof File)return"file";return"unknown"}function jX(X){if(Array.isArray(X))return"array";if(typeof X==="string")return"string";return"unknown"}function P9(...X){let[Q,$,Y]=X;if(typeof Q==="string")return{message:Q,code:"custom",input:$,inst:Y};return{...Q}}function dV(X){return Object.entries(X).filter(([Q,$])=>{return Number.isNaN(Number.parseInt(Q,10))}).map((Q)=>Q[1])}class wW{constructor(...X){}}var MW=(X,Q)=>{X.name="$ZodError",Object.defineProperty(X,"_zod",{value:X._zod,enumerable:!1}),Object.defineProperty(X,"issues",{value:Q,enumerable:!1}),Object.defineProperty(X,"message",{get(){return JSON.stringify(Q,w9,2)},enumerable:!0})},Z4=O("$ZodError",MW),RX=O("$ZodError",MW,{Parent:Error});function S9(X,Q=($)=>$.message){let $={},Y=[];for(let W of X.issues)if(W.path.length>0)$[W.path[0]]=$[W.path[0]]||[],$[W.path[0]].push(Q(W));else Y.push(Q(W));return{formErrors:Y,fieldErrors:$}}function Z9(X,Q){let $=Q||function(J){return J.message},Y={_errors:[]},W=(J)=>{for(let G of J.issues)if(G.code==="invalid_union"&&G.errors.length)G.errors.map((H)=>W({issues:H}));else if(G.code==="invalid_key")W({issues:G.issues});else if(G.code==="invalid_element")W({issues:G.issues});else if(G.path.length===0)Y._errors.push($(G));else{let H=Y,B=0;while(B<G.path.length){let z=G.path[B];if(B!==G.path.length-1)H[z]=H[z]||{_errors:[]};else H[z]=H[z]||{_errors:[]},H[z]._errors.push($(G));H=H[z],B++}}};return W(X),Y}var C9=(X)=>(Q,$,Y,W)=>{let J=Y?Object.assign(Y,{async:!1}):{async:!1},G=Q._zod.run({value:$,issues:[]},J);if(G instanceof Promise)throw new x1;if(G.issues.length){let H=new(W?.Err??X)(G.issues.map((B)=>o0(B,J,u0())));throw P4(H,W?.callee),H}return G.value},k9=C9(RX),v9=(X)=>async(Q,$,Y,W)=>{let J=Y?Object.assign(Y,{async:!0}):{async:!0},G=Q._zod.run({value:$,issues:[]},J);if(G instanceof Promise)G=await G;if(G.issues.length){let H=new(W?.Err??X)(G.issues.map((B)=>o0(B,J,u0())));throw P4(H,W?.callee),H}return G.value},T9=v9(RX),_9=(X)=>(Q,$,Y)=>{let W=Y?{...Y,async:!1}:{async:!1},J=Q._zod.run({value:$,issues:[]},W);if(J instanceof Promise)throw new x1;return J.issues.length?{success:!1,error:new(X??Z4)(J.issues.map((G)=>o0(G,W,u0())))}:{success:!0,data:J.value}},X6=_9(RX),x9=(X)=>async(Q,$,Y)=>{let W=Y?Object.assign(Y,{async:!0}):{async:!0},J=Q._zod.run({value:$,issues:[]},W);if(J instanceof Promise)J=await J;return J.issues.length?{success:!1,error:new X(J.issues.map((G)=>o0(G,W,u0())))}:{success:!0,data:J.value}},Q6=x9(RX);var jW=/^[cC][^\s-]{8,}$/,RW=/^[0-9a-z]+$/,EW=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,IW=/^[0-9a-vA-V]{20}$/,bW=/^[A-Za-z0-9]{27}$/,PW=/^[a-zA-Z0-9_-]{21}$/,SW=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var ZW=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,y9=(X)=>{if(!X)return/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${X}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`)};var CW=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function kW(){return new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}var vW=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,TW=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,_W=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,xW=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,yW=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,g9=/^[A-Za-z0-9_-]*$/,gW=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var fW=/^\+(?:[0-9]){6,14}[0-9]$/,hW="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",uW=new RegExp(`^${hW}$`);function lW(X){return typeof X.precision==="number"?X.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":X.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${X.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function mW(X){return new RegExp(`^${lW(X)}$`)}function cW(X){let Q=lW({precision:X.precision}),$=["Z"];if(X.local)$.push("");if(X.offset)$.push("([+-]\\d{2}:\\d{2})");let Y=`${Q}(?:${$.join("|")})`;return new RegExp(`^${hW}T(?:${Y})$`)}var pW=(X)=>{let Q=X?`[\\s\\S]{${X?.minimum??0},${X?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${Q}$`)};var dW=/^\d+$/,iW=/^-?\d+(?:\.\d+)?/i,nW=/true|false/i,rW=/null/i;var oW=/^[^A-Z]*$/,tW=/^[^a-z]*$/;var w0=O("$ZodCheck",(X,Q)=>{var $;X._zod??(X._zod={}),X._zod.def=Q,($=X._zod).onattach??($.onattach=[])}),aW={number:"number",bigint:"bigint",object:"date"},f9=O("$ZodCheckLessThan",(X,Q)=>{w0.init(X,Q);let $=aW[typeof Q.value];X._zod.onattach.push((Y)=>{let W=Y._zod.bag,J=(Q.inclusive?W.maximum:W.exclusiveMaximum)??Number.POSITIVE_INFINITY;if(Q.value<J)if(Q.inclusive)W.maximum=Q.value;else W.exclusiveMaximum=Q.value}),X._zod.check=(Y)=>{if(Q.inclusive?Y.value<=Q.value:Y.value<Q.value)return;Y.issues.push({origin:$,code:"too_big",maximum:Q.value,input:Y.value,inclusive:Q.inclusive,inst:X,continue:!Q.abort})}}),h9=O("$ZodCheckGreaterThan",(X,Q)=>{w0.init(X,Q);let $=aW[typeof Q.value];X._zod.onattach.push((Y)=>{let W=Y._zod.bag,J=(Q.inclusive?W.minimum:W.exclusiveMinimum)??Number.NEGATIVE_INFINITY;if(Q.value>J)if(Q.inclusive)W.minimum=Q.value;else W.exclusiveMinimum=Q.value}),X._zod.check=(Y)=>{if(Q.inclusive?Y.value>=Q.value:Y.value>Q.value)return;Y.issues.push({origin:$,code:"too_small",minimum:Q.value,input:Y.value,inclusive:Q.inclusive,inst:X,continue:!Q.abort})}}),sW=O("$ZodCheckMultipleOf",(X,Q)=>{w0.init(X,Q),X._zod.onattach.push(($)=>{var Y;(Y=$._zod.bag).multipleOf??(Y.multipleOf=Q.value)}),X._zod.check=($)=>{if(typeof $.value!==typeof Q.value)throw Error("Cannot mix number and bigint in multiple_of check.");if(typeof $.value==="bigint"?$.value%Q.value===BigInt(0):M9($.value,Q.value)===0)return;$.issues.push({origin:typeof $.value,code:"not_multiple_of",divisor:Q.value,input:$.value,inst:X,continue:!Q.abort})}}),eW=O("$ZodCheckNumberFormat",(X,Q)=>{w0.init(X,Q),Q.format=Q.format||"float64";let $=Q.format?.includes("int"),Y=$?"int":"number",[W,J]=b9[Q.format];X._zod.onattach.push((G)=>{let H=G._zod.bag;if(H.format=Q.format,H.minimum=W,H.maximum=J,$)H.pattern=dW}),X._zod.check=(G)=>{let H=G.value;if($){if(!Number.isInteger(H)){G.issues.push({expected:Y,format:Q.format,code:"invalid_type",input:H,inst:X});return}if(!Number.isSafeInteger(H)){if(H>0)G.issues.push({input:H,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:X,origin:Y,continue:!Q.abort});else G.issues.push({input:H,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:X,origin:Y,continue:!Q.abort});return}}if(H<W)G.issues.push({origin:"number",input:H,code:"too_small",minimum:W,inclusive:!0,inst:X,continue:!Q.abort});if(H>J)G.issues.push({origin:"number",input:H,code:"too_big",maximum:J,inst:X})}});var XJ=O("$ZodCheckMaxLength",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag.maximum??Number.POSITIVE_INFINITY;if(Q.maximum<Y)$._zod.bag.maximum=Q.maximum}),X._zod.check=($)=>{let Y=$.value;if(Y.length<=Q.maximum)return;let J=jX(Y);$.issues.push({origin:J,code:"too_big",maximum:Q.maximum,inclusive:!0,input:Y,inst:X,continue:!Q.abort})}}),QJ=O("$ZodCheckMinLength",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag.minimum??Number.NEGATIVE_INFINITY;if(Q.minimum>Y)$._zod.bag.minimum=Q.minimum}),X._zod.check=($)=>{let Y=$.value;if(Y.length>=Q.minimum)return;let J=jX(Y);$.issues.push({origin:J,code:"too_small",minimum:Q.minimum,inclusive:!0,input:Y,inst:X,continue:!Q.abort})}}),$J=O("$ZodCheckLengthEquals",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.minimum=Q.length,Y.maximum=Q.length,Y.length=Q.length}),X._zod.check=($)=>{let Y=$.value,W=Y.length;if(W===Q.length)return;let J=jX(Y),G=W>Q.length;$.issues.push({origin:J,...G?{code:"too_big",maximum:Q.length}:{code:"too_small",minimum:Q.length},inclusive:!0,exact:!0,input:$.value,inst:X,continue:!Q.abort})}}),EX=O("$ZodCheckStringFormat",(X,Q)=>{var $,Y;if(w0.init(X,Q),X._zod.onattach.push((W)=>{let J=W._zod.bag;if(J.format=Q.format,Q.pattern)J.patterns??(J.patterns=new Set),J.patterns.add(Q.pattern)}),Q.pattern)($=X._zod).check??($.check=(W)=>{if(Q.pattern.lastIndex=0,Q.pattern.test(W.value))return;W.issues.push({origin:"string",code:"invalid_format",format:Q.format,input:W.value,...Q.pattern?{pattern:Q.pattern.toString()}:{},inst:X,continue:!Q.abort})});else(Y=X._zod).check??(Y.check=()=>{})}),YJ=O("$ZodCheckRegex",(X,Q)=>{EX.init(X,Q),X._zod.check=($)=>{if(Q.pattern.lastIndex=0,Q.pattern.test($.value))return;$.issues.push({origin:"string",code:"invalid_format",format:"regex",input:$.value,pattern:Q.pattern.toString(),inst:X,continue:!Q.abort})}}),WJ=O("$ZodCheckLowerCase",(X,Q)=>{Q.pattern??(Q.pattern=oW),EX.init(X,Q)}),JJ=O("$ZodCheckUpperCase",(X,Q)=>{Q.pattern??(Q.pattern=tW),EX.init(X,Q)}),GJ=O("$ZodCheckIncludes",(X,Q)=>{w0.init(X,Q);let $=y1(Q.includes),Y=new RegExp(typeof Q.position==="number"?`^.{${Q.position}}${$}`:$);Q.pattern=Y,X._zod.onattach.push((W)=>{let J=W._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add(Y)}),X._zod.check=(W)=>{if(W.value.includes(Q.includes,Q.position))return;W.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:Q.includes,input:W.value,inst:X,continue:!Q.abort})}}),HJ=O("$ZodCheckStartsWith",(X,Q)=>{w0.init(X,Q);let $=new RegExp(`^${y1(Q.prefix)}.*`);Q.pattern??(Q.pattern=$),X._zod.onattach.push((Y)=>{let W=Y._zod.bag;W.patterns??(W.patterns=new Set),W.patterns.add($)}),X._zod.check=(Y)=>{if(Y.value.startsWith(Q.prefix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:Q.prefix,input:Y.value,inst:X,continue:!Q.abort})}}),BJ=O("$ZodCheckEndsWith",(X,Q)=>{w0.init(X,Q);let $=new RegExp(`.*${y1(Q.suffix)}$`);Q.pattern??(Q.pattern=$),X._zod.onattach.push((Y)=>{let W=Y._zod.bag;W.patterns??(W.patterns=new Set),W.patterns.add($)}),X._zod.check=(Y)=>{if(Y.value.endsWith(Q.suffix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:Q.suffix,input:Y.value,inst:X,continue:!Q.abort})}});var zJ=O("$ZodCheckOverwrite",(X,Q)=>{w0.init(X,Q),X._zod.check=($)=>{$.value=Q.tx($.value)}});class u9{constructor(X=[]){if(this.content=[],this.indent=0,this)this.args=X}indented(X){this.indent+=1,X(this),this.indent-=1}write(X){if(typeof X==="function"){X(this,{execution:"sync"}),X(this,{execution:"async"});return}let $=X.split(`
+`)}handleMcpControlRequest(X,Q,$){let Y="id"in Q.message?Q.message.id:null,W=`${X}:${Y}`;return new Promise((J,G)=>{let H=()=>{this.pendingMcpResponses.delete(W)},B=(K)=>{H(),J(K)},z=(K)=>{H(),G(K)};if(this.pendingMcpResponses.set(W,{resolve:B,reject:z}),$.onmessage)$.onmessage(Q.message);else{H(),G(Error("No message handler registered"));return}})}}import{join as zW}from"path";import{fileURLToPath as QV}from"url";class U9{closed=!1;inputStream;query;queryIterator=null;abortController;_sessionId=null;get sessionId(){if(this._sessionId===null)throw Error("Session ID not available until after receiving messages");return this._sessionId}constructor(X){if(X.resume)this._sessionId=X.resume;this.inputStream=new QX;let Q=X.pathToClaudeCodeExecutable;if(!Q){let W=QV(import.meta.url),J=zW(W,"..");Q=zW(J,"cli.js")}let $={...X.env??process.env};if(!$.CLAUDE_CODE_ENTRYPOINT){};this.abortController=N6();let Y=new XX({abortController:this.abortController,pathToClaudeCodeExecutable:Q,cwd:X.cwd,stderr:X.stderr,env:$,executable:X.executable??(j6()?"bun":"node"),executableArgs:X.executableArgs??[],extraArgs:X.extraArgs??{},maxThinkingTokens:X.maxThinkingTokens,maxTurns:X.maxTurns,maxBudgetUsd:X.maxBudgetUsd,model:X.model,fallbackModel:X.fallbackModel,permissionMode:X.permissionMode??"default",allowDangerouslySkipPermissions:X.allowDangerouslySkipPermissions??!1,continueConversation:X.continueConversation??!1,resume:X.resume,settingSources:X.settingSources??[],allowedTools:X.allowedTools??[],disallowedTools:X.disallowedTools??[],mcpServers:X.mcpServers??{},strictMcpConfig:X.strictMcpConfig??!1,canUseTool:!!X.canUseTool,hooks:!!X.hooks,includePartialMessages:X.includePartialMessages??!0,forkSession:X.forkSession??!1,resumeSessionAt:X.resumeSessionAt,plugins:X.plugins??[]});this.query=new $X(Y,!1,X.canUseTool,X.hooks,this.abortController,new Map),this.query.streamInput(this.inputStream)}async send(X){if(this.closed)throw Error("Cannot send to closed session");let Q=typeof X==="string"?{type:"user",session_id:"",message:{role:"user",content:[{type:"text",text:X}]},parent_tool_use_id:null}:X;this.inputStream.enqueue(Q)}async*stream(){if(!this.queryIterator)this.queryIterator=this.query[Symbol.asyncIterator]();while(!0){let{value:X,done:Q}=await this.queryIterator.next();if(Q)return;if(X.type==="system"&&X.subtype==="init")this._sessionId=X.session_id;if(yield X,X.type==="result")return}}close(){if(this.closed)return;this.closed=!0,this.inputStream.done(),this.abortController.abort()}async[Symbol.asyncDispose](){this.close()}}function V9(X){return new U9(X)}function KW(X,Q){return new U9({...Q,resume:X})}var n;(function(X){X.assertEqual=(W)=>{};function Q(W){}X.assertIs=Q;function $(W){throw Error()}X.assertNever=$,X.arrayToEnum=(W)=>{let J={};for(let G of W)J[G]=G;return J},X.getValidEnumValues=(W)=>{let J=X.objectKeys(W).filter((H)=>typeof W[W[H]]!=="number"),G={};for(let H of J)G[H]=W[H];return X.objectValues(G)},X.objectValues=(W)=>{return X.objectKeys(W).map(function(J){return W[J]})},X.objectKeys=typeof Object.keys==="function"?(W)=>Object.keys(W):(W)=>{let J=[];for(let G in W)if(Object.prototype.hasOwnProperty.call(W,G))J.push(G);return J},X.find=(W,J)=>{for(let G of W)if(J(G))return G;return},X.isInteger=typeof Number.isInteger==="function"?(W)=>Number.isInteger(W):(W)=>typeof W==="number"&&Number.isFinite(W)&&Math.floor(W)===W;function Y(W,J=" | "){return W.map((G)=>typeof G==="string"?`'${G}'`:G).join(J)}X.joinValues=Y,X.jsonStringifyReplacer=(W,J)=>{if(typeof J==="bigint")return J.toString();return J}})(n||(n={}));var UW;(function(X){X.mergeShapes=(Q,$)=>{return{...Q,...$}}})(UW||(UW={}));var E=n.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),O1=(X)=>{switch(typeof X){case"undefined":return E.undefined;case"string":return E.string;case"number":return Number.isNaN(X)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":if(Array.isArray(X))return E.array;if(X===null)return E.null;if(X.then&&typeof X.then==="function"&&X.catch&&typeof X.catch==="function")return E.promise;if(typeof Map<"u"&&X instanceof Map)return E.map;if(typeof Set<"u"&&X instanceof Set)return E.set;if(typeof Date<"u"&&X instanceof Date)return E.date;return E.object;default:return E.unknown}};var w=n.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class h0 extends Error{get errors(){return this.issues}constructor(X){super();this.issues=[],this.addIssue=($)=>{this.issues=[...this.issues,$]},this.addIssues=($=[])=>{this.issues=[...this.issues,...$]};let Q=new.target.prototype;if(Object.setPrototypeOf)Object.setPrototypeOf(this,Q);else this.__proto__=Q;this.name="ZodError",this.issues=X}format(X){let Q=X||function(W){return W.message},$={_errors:[]},Y=(W)=>{for(let J of W.issues)if(J.code==="invalid_union")J.unionErrors.map(Y);else if(J.code==="invalid_return_type")Y(J.returnTypeError);else if(J.code==="invalid_arguments")Y(J.argumentsError);else if(J.path.length===0)$._errors.push(Q(J));else{let G=$,H=0;while(H<J.path.length){let B=J.path[H];if(H!==J.path.length-1)G[B]=G[B]||{_errors:[]};else G[B]=G[B]||{_errors:[]},G[B]._errors.push(Q(J));G=G[B],H++}}};return Y(this),$}static assert(X){if(!(X instanceof h0))throw Error(`Not a ZodError: ${X}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(X=(Q)=>Q.message){let Q={},$=[];for(let Y of this.issues)if(Y.path.length>0){let W=Y.path[0];Q[W]=Q[W]||[],Q[W].push(X(Y))}else $.push(X(Y));return{formErrors:$,fieldErrors:Q}}get formErrors(){return this.flatten()}}h0.create=(X)=>{return new h0(X)};var $V=(X,Q)=>{let $;switch(X.code){case w.invalid_type:if(X.received===E.undefined)$="Required";else $=`Expected ${X.expected}, received ${X.received}`;break;case w.invalid_literal:$=`Invalid literal value, expected ${JSON.stringify(X.expected,n.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:$=`Unrecognized key(s) in object: ${n.joinValues(X.keys,", ")}`;break;case w.invalid_union:$="Invalid input";break;case w.invalid_union_discriminator:$=`Invalid discriminator value. Expected ${n.joinValues(X.options)}`;break;case w.invalid_enum_value:$=`Invalid enum value. Expected ${n.joinValues(X.options)}, received '${X.received}'`;break;case w.invalid_arguments:$="Invalid function arguments";break;case w.invalid_return_type:$="Invalid function return type";break;case w.invalid_date:$="Invalid date";break;case w.invalid_string:if(typeof X.validation==="object")if("includes"in X.validation){if($=`Invalid input: must include "${X.validation.includes}"`,typeof X.validation.position==="number")$=`${$} at one or more positions greater than or equal to ${X.validation.position}`}else if("startsWith"in X.validation)$=`Invalid input: must start with "${X.validation.startsWith}"`;else if("endsWith"in X.validation)$=`Invalid input: must end with "${X.validation.endsWith}"`;else n.assertNever(X.validation);else if(X.validation!=="regex")$=`Invalid ${X.validation}`;else $="Invalid";break;case w.too_small:if(X.type==="array")$=`Array must contain ${X.exact?"exactly":X.inclusive?"at least":"more than"} ${X.minimum} element(s)`;else if(X.type==="string")$=`String must contain ${X.exact?"exactly":X.inclusive?"at least":"over"} ${X.minimum} character(s)`;else if(X.type==="number")$=`Number must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${X.minimum}`;else if(X.type==="bigint")$=`Number must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${X.minimum}`;else if(X.type==="date")$=`Date must be ${X.exact?"exactly equal to ":X.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(X.minimum))}`;else $="Invalid input";break;case w.too_big:if(X.type==="array")$=`Array must contain ${X.exact?"exactly":X.inclusive?"at most":"less than"} ${X.maximum} element(s)`;else if(X.type==="string")$=`String must contain ${X.exact?"exactly":X.inclusive?"at most":"under"} ${X.maximum} character(s)`;else if(X.type==="number")$=`Number must be ${X.exact?"exactly":X.inclusive?"less than or equal to":"less than"} ${X.maximum}`;else if(X.type==="bigint")$=`BigInt must be ${X.exact?"exactly":X.inclusive?"less than or equal to":"less than"} ${X.maximum}`;else if(X.type==="date")$=`Date must be ${X.exact?"exactly":X.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(X.maximum))}`;else $="Invalid input";break;case w.custom:$="Invalid input";break;case w.invalid_intersection_types:$="Intersection results could not be merged";break;case w.not_multiple_of:$=`Number must be a multiple of ${X.multipleOf}`;break;case w.not_finite:$="Number must be finite";break;default:$=Q.defaultError,n.assertNever(X)}return{message:$}},T1=$V;var YV=T1;function YX(){return YV}var N4=(X)=>{let{data:Q,path:$,errorMaps:Y,issueData:W}=X,J=[...$,...W.path||[]],G={...W,path:J};if(W.message!==void 0)return{...W,path:J,message:W.message};let H="",B=Y.filter((z)=>!!z).slice().reverse();for(let z of B)H=z(G,{data:Q,defaultError:H}).message;return{...W,path:J,message:H}};function b(X,Q){let $=YX(),Y=N4({issueData:Q,data:X.data,path:X.path,errorMaps:[X.common.contextualErrorMap,X.schemaErrorMap,$,$===T1?void 0:T1].filter((W)=>!!W)});X.common.issues.push(Y)}class I0{constructor(){this.value="valid"}dirty(){if(this.value==="valid")this.value="dirty"}abort(){if(this.value!=="aborted")this.value="aborted"}static mergeArray(X,Q){let $=[];for(let Y of Q){if(Y.status==="aborted")return g;if(Y.status==="dirty")X.dirty();$.push(Y.value)}return{status:X.value,value:$}}static async mergeObjectAsync(X,Q){let $=[];for(let Y of Q){let W=await Y.key,J=await Y.value;$.push({key:W,value:J})}return I0.mergeObjectSync(X,$)}static mergeObjectSync(X,Q){let $={};for(let Y of Q){let{key:W,value:J}=Y;if(W.status==="aborted")return g;if(J.status==="aborted")return g;if(W.status==="dirty")X.dirty();if(J.status==="dirty")X.dirty();if(W.value!=="__proto__"&&(typeof J.value<"u"||Y.alwaysSet))$[W.value]=J.value}return{status:X.value,value:$}}}var g=Object.freeze({status:"aborted"}),R6=(X)=>({status:"dirty",value:X}),C0=(X)=>({status:"valid",value:X}),L9=(X)=>X.status==="aborted",q9=(X)=>X.status==="dirty",o1=(X)=>X.status==="valid",WX=(X)=>typeof Promise<"u"&&X instanceof Promise;var Z;(function(X){X.errToObj=(Q)=>typeof Q==="string"?{message:Q}:Q||{},X.toString=(Q)=>typeof Q==="string"?Q:Q?.message})(Z||(Z={}));class r0{constructor(X,Q,$,Y){this._cachedPath=[],this.parent=X,this.data=Q,this._path=$,this._key=Y}get path(){if(!this._cachedPath.length)if(Array.isArray(this._key))this._cachedPath.push(...this._path,...this._key);else this._cachedPath.push(...this._path,this._key);return this._cachedPath}}var VW=(X,Q)=>{if(o1(Q))return{success:!0,data:Q.value};else{if(!X.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let $=new h0(X.common.issues);return this._error=$,this._error}}}};function l(X){if(!X)return{};let{errorMap:Q,invalid_type_error:$,required_error:Y,description:W}=X;if(Q&&($||Y))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);if(Q)return{errorMap:Q,description:W};return{errorMap:(G,H)=>{let{message:B}=X;if(G.code==="invalid_enum_value")return{message:B??H.defaultError};if(typeof H.data>"u")return{message:B??Y??H.defaultError};if(G.code!=="invalid_type")return{message:H.defaultError};return{message:B??$??H.defaultError}},description:W}}class p{get description(){return this._def.description}_getType(X){return O1(X.data)}_getOrReturnCtx(X,Q){return Q||{common:X.parent.common,data:X.data,parsedType:O1(X.data),schemaErrorMap:this._def.errorMap,path:X.path,parent:X.parent}}_processInputParams(X){return{status:new I0,ctx:{common:X.parent.common,data:X.data,parsedType:O1(X.data),schemaErrorMap:this._def.errorMap,path:X.path,parent:X.parent}}}_parseSync(X){let Q=this._parse(X);if(WX(Q))throw Error("Synchronous parse encountered promise.");return Q}_parseAsync(X){let Q=this._parse(X);return Promise.resolve(Q)}parse(X,Q){let $=this.safeParse(X,Q);if($.success)return $.data;throw $.error}safeParse(X,Q){let $={common:{issues:[],async:Q?.async??!1,contextualErrorMap:Q?.errorMap},path:Q?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)},Y=this._parseSync({data:X,path:$.path,parent:$});return VW($,Y)}"~validate"(X){let Q={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)};if(!this["~standard"].async)try{let $=this._parseSync({data:X,path:[],parent:Q});return o1($)?{value:$.value}:{issues:Q.common.issues}}catch($){if($?.message?.toLowerCase()?.includes("encountered"))this["~standard"].async=!0;Q.common={issues:[],async:!0}}return this._parseAsync({data:X,path:[],parent:Q}).then(($)=>o1($)?{value:$.value}:{issues:Q.common.issues})}async parseAsync(X,Q){let $=await this.safeParseAsync(X,Q);if($.success)return $.data;throw $.error}async safeParseAsync(X,Q){let $={common:{issues:[],contextualErrorMap:Q?.errorMap,async:!0},path:Q?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:X,parsedType:O1(X)},Y=this._parse({data:X,path:$.path,parent:$}),W=await(WX(Y)?Y:Promise.resolve(Y));return VW($,W)}refine(X,Q){let $=(Y)=>{if(typeof Q==="string"||typeof Q>"u")return{message:Q};else if(typeof Q==="function")return Q(Y);else return Q};return this._refinement((Y,W)=>{let J=X(Y),G=()=>W.addIssue({code:w.custom,...$(Y)});if(typeof Promise<"u"&&J instanceof Promise)return J.then((H)=>{if(!H)return G(),!1;else return!0});if(!J)return G(),!1;else return!0})}refinement(X,Q){return this._refinement(($,Y)=>{if(!X($))return Y.addIssue(typeof Q==="function"?Q($,Y):Q),!1;else return!0})}_refinement(X){return new H1({schema:this,typeName:j.ZodEffects,effect:{type:"refinement",refinement:X}})}superRefine(X){return this._refinement(X)}constructor(X){this.spa=this.safeParseAsync,this._def=X,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:(Q)=>this["~validate"](Q)}}optional(){return G1.create(this,this._def)}nullable(){return _1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return J1.create(this)}promise(){return S6.create(this,this._def)}or(X){return zX.create([this,X],this._def)}and(X){return KX.create(this,X,this._def)}transform(X){return new H1({...l(this._def),schema:this,typeName:j.ZodEffects,effect:{type:"transform",transform:X}})}default(X){let Q=typeof X==="function"?X:()=>X;return new qX({...l(this._def),innerType:this,defaultValue:Q,typeName:j.ZodDefault})}brand(){return new D9({typeName:j.ZodBranded,type:this,...l(this._def)})}catch(X){let Q=typeof X==="function"?X:()=>X;return new FX({...l(this._def),innerType:this,catchValue:Q,typeName:j.ZodCatch})}describe(X){return new this.constructor({...this._def,description:X})}pipe(X){return E4.create(this,X)}readonly(){return NX.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var WV=/^c[^\s-]{8,}$/i,JV=/^[0-9a-z]+$/,GV=/^[0-9A-HJKMNP-TV-Z]{26}$/i,HV=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,BV=/^[a-z0-9_-]{21}$/i,zV=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,KV=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,UV=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,VV="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",F9,LV=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qV=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,FV=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,NV=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,OV=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,DV=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,LW="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",AV=new RegExp(`^${LW}$`);function qW(X){let Q="[0-5]\\d";if(X.precision)Q=`${Q}\\.\\d{${X.precision}}`;else if(X.precision==null)Q=`${Q}(\\.\\d+)?`;let $=X.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${Q})${$}`}function wV(X){return new RegExp(`^${qW(X)}$`)}function MV(X){let Q=`${LW}T${qW(X)}`,$=[];if($.push(X.local?"Z?":"Z"),X.offset)$.push("([+-]\\d{2}:?\\d{2})");return Q=`${Q}(${$.join("|")})`,new RegExp(`^${Q}$`)}function jV(X,Q){if((Q==="v4"||!Q)&&LV.test(X))return!0;if((Q==="v6"||!Q)&&FV.test(X))return!0;return!1}function RV(X,Q){if(!zV.test(X))return!1;try{let[$]=X.split(".");if(!$)return!1;let Y=$.replace(/-/g,"+").replace(/_/g,"/").padEnd($.length+(4-$.length%4)%4,"="),W=JSON.parse(atob(Y));if(typeof W!=="object"||W===null)return!1;if("typ"in W&&W?.typ!=="JWT")return!1;if(!W.alg)return!1;if(Q&&W.alg!==Q)return!1;return!0}catch{return!1}}function EV(X,Q){if((Q==="v4"||!Q)&&qV.test(X))return!0;if((Q==="v6"||!Q)&&NV.test(X))return!0;return!1}class A1 extends p{_parse(X){if(this._def.coerce)X.data=String(X.data);if(this._getType(X)!==E.string){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.string,received:W.parsedType}),g}let $=new I0,Y=void 0;for(let W of this._def.checks)if(W.kind==="min"){if(X.data.length<W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_small,minimum:W.value,type:"string",inclusive:!0,exact:!1,message:W.message}),$.dirty()}else if(W.kind==="max"){if(X.data.length>W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_big,maximum:W.value,type:"string",inclusive:!0,exact:!1,message:W.message}),$.dirty()}else if(W.kind==="length"){let J=X.data.length>W.value,G=X.data.length<W.value;if(J||G){if(Y=this._getOrReturnCtx(X,Y),J)b(Y,{code:w.too_big,maximum:W.value,type:"string",inclusive:!0,exact:!0,message:W.message});else if(G)b(Y,{code:w.too_small,minimum:W.value,type:"string",inclusive:!0,exact:!0,message:W.message});$.dirty()}}else if(W.kind==="email"){if(!UV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"email",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="emoji"){if(!F9)F9=new RegExp(VV,"u");if(!F9.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"emoji",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="uuid"){if(!HV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"uuid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="nanoid"){if(!BV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"nanoid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cuid"){if(!WV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cuid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cuid2"){if(!JV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cuid2",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="ulid"){if(!GV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"ulid",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="url")try{new URL(X.data)}catch{Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"url",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="regex"){if(W.regex.lastIndex=0,!W.regex.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"regex",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="trim")X.data=X.data.trim();else if(W.kind==="includes"){if(!X.data.includes(W.value,W.position))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{includes:W.value,position:W.position},message:W.message}),$.dirty()}else if(W.kind==="toLowerCase")X.data=X.data.toLowerCase();else if(W.kind==="toUpperCase")X.data=X.data.toUpperCase();else if(W.kind==="startsWith"){if(!X.data.startsWith(W.value))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{startsWith:W.value},message:W.message}),$.dirty()}else if(W.kind==="endsWith"){if(!X.data.endsWith(W.value))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:{endsWith:W.value},message:W.message}),$.dirty()}else if(W.kind==="datetime"){if(!MV(W).test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"datetime",message:W.message}),$.dirty()}else if(W.kind==="date"){if(!AV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"date",message:W.message}),$.dirty()}else if(W.kind==="time"){if(!wV(W).test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.invalid_string,validation:"time",message:W.message}),$.dirty()}else if(W.kind==="duration"){if(!KV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"duration",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="ip"){if(!jV(X.data,W.version))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"ip",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="jwt"){if(!RV(X.data,W.alg))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"jwt",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="cidr"){if(!EV(X.data,W.version))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"cidr",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="base64"){if(!OV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"base64",code:w.invalid_string,message:W.message}),$.dirty()}else if(W.kind==="base64url"){if(!DV.test(X.data))Y=this._getOrReturnCtx(X,Y),b(Y,{validation:"base64url",code:w.invalid_string,message:W.message}),$.dirty()}else n.assertNever(W);return{status:$.value,value:X.data}}_regex(X,Q,$){return this.refinement((Y)=>X.test(Y),{validation:Q,code:w.invalid_string,...Z.errToObj($)})}_addCheck(X){return new A1({...this._def,checks:[...this._def.checks,X]})}email(X){return this._addCheck({kind:"email",...Z.errToObj(X)})}url(X){return this._addCheck({kind:"url",...Z.errToObj(X)})}emoji(X){return this._addCheck({kind:"emoji",...Z.errToObj(X)})}uuid(X){return this._addCheck({kind:"uuid",...Z.errToObj(X)})}nanoid(X){return this._addCheck({kind:"nanoid",...Z.errToObj(X)})}cuid(X){return this._addCheck({kind:"cuid",...Z.errToObj(X)})}cuid2(X){return this._addCheck({kind:"cuid2",...Z.errToObj(X)})}ulid(X){return this._addCheck({kind:"ulid",...Z.errToObj(X)})}base64(X){return this._addCheck({kind:"base64",...Z.errToObj(X)})}base64url(X){return this._addCheck({kind:"base64url",...Z.errToObj(X)})}jwt(X){return this._addCheck({kind:"jwt",...Z.errToObj(X)})}ip(X){return this._addCheck({kind:"ip",...Z.errToObj(X)})}cidr(X){return this._addCheck({kind:"cidr",...Z.errToObj(X)})}datetime(X){if(typeof X==="string")return this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:X});return this._addCheck({kind:"datetime",precision:typeof X?.precision>"u"?null:X?.precision,offset:X?.offset??!1,local:X?.local??!1,...Z.errToObj(X?.message)})}date(X){return this._addCheck({kind:"date",message:X})}time(X){if(typeof X==="string")return this._addCheck({kind:"time",precision:null,message:X});return this._addCheck({kind:"time",precision:typeof X?.precision>"u"?null:X?.precision,...Z.errToObj(X?.message)})}duration(X){return this._addCheck({kind:"duration",...Z.errToObj(X)})}regex(X,Q){return this._addCheck({kind:"regex",regex:X,...Z.errToObj(Q)})}includes(X,Q){return this._addCheck({kind:"includes",value:X,position:Q?.position,...Z.errToObj(Q?.message)})}startsWith(X,Q){return this._addCheck({kind:"startsWith",value:X,...Z.errToObj(Q)})}endsWith(X,Q){return this._addCheck({kind:"endsWith",value:X,...Z.errToObj(Q)})}min(X,Q){return this._addCheck({kind:"min",value:X,...Z.errToObj(Q)})}max(X,Q){return this._addCheck({kind:"max",value:X,...Z.errToObj(Q)})}length(X,Q){return this._addCheck({kind:"length",value:X,...Z.errToObj(Q)})}nonempty(X){return this.min(1,Z.errToObj(X))}trim(){return new A1({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new A1({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new A1({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((X)=>X.kind==="datetime")}get isDate(){return!!this._def.checks.find((X)=>X.kind==="date")}get isTime(){return!!this._def.checks.find((X)=>X.kind==="time")}get isDuration(){return!!this._def.checks.find((X)=>X.kind==="duration")}get isEmail(){return!!this._def.checks.find((X)=>X.kind==="email")}get isURL(){return!!this._def.checks.find((X)=>X.kind==="url")}get isEmoji(){return!!this._def.checks.find((X)=>X.kind==="emoji")}get isUUID(){return!!this._def.checks.find((X)=>X.kind==="uuid")}get isNANOID(){return!!this._def.checks.find((X)=>X.kind==="nanoid")}get isCUID(){return!!this._def.checks.find((X)=>X.kind==="cuid")}get isCUID2(){return!!this._def.checks.find((X)=>X.kind==="cuid2")}get isULID(){return!!this._def.checks.find((X)=>X.kind==="ulid")}get isIP(){return!!this._def.checks.find((X)=>X.kind==="ip")}get isCIDR(){return!!this._def.checks.find((X)=>X.kind==="cidr")}get isBase64(){return!!this._def.checks.find((X)=>X.kind==="base64")}get isBase64url(){return!!this._def.checks.find((X)=>X.kind==="base64url")}get minLength(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxLength(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}}A1.create=(X)=>{return new A1({checks:[],typeName:j.ZodString,coerce:X?.coerce??!1,...l(X)})};function IV(X,Q){let $=(X.toString().split(".")[1]||"").length,Y=(Q.toString().split(".")[1]||"").length,W=$>Y?$:Y,J=Number.parseInt(X.toFixed(W).replace(".","")),G=Number.parseInt(Q.toFixed(W).replace(".",""));return J%G/10**W}class I6 extends p{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(X){if(this._def.coerce)X.data=Number(X.data);if(this._getType(X)!==E.number){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.number,received:W.parsedType}),g}let $=void 0,Y=new I0;for(let W of this._def.checks)if(W.kind==="int"){if(!n.isInteger(X.data))$=this._getOrReturnCtx(X,$),b($,{code:w.invalid_type,expected:"integer",received:"float",message:W.message}),Y.dirty()}else if(W.kind==="min"){if(W.inclusive?X.data<W.value:X.data<=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_small,minimum:W.value,type:"number",inclusive:W.inclusive,exact:!1,message:W.message}),Y.dirty()}else if(W.kind==="max"){if(W.inclusive?X.data>W.value:X.data>=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_big,maximum:W.value,type:"number",inclusive:W.inclusive,exact:!1,message:W.message}),Y.dirty()}else if(W.kind==="multipleOf"){if(IV(X.data,W.value)!==0)$=this._getOrReturnCtx(X,$),b($,{code:w.not_multiple_of,multipleOf:W.value,message:W.message}),Y.dirty()}else if(W.kind==="finite"){if(!Number.isFinite(X.data))$=this._getOrReturnCtx(X,$),b($,{code:w.not_finite,message:W.message}),Y.dirty()}else n.assertNever(W);return{status:Y.value,value:X.data}}gte(X,Q){return this.setLimit("min",X,!0,Z.toString(Q))}gt(X,Q){return this.setLimit("min",X,!1,Z.toString(Q))}lte(X,Q){return this.setLimit("max",X,!0,Z.toString(Q))}lt(X,Q){return this.setLimit("max",X,!1,Z.toString(Q))}setLimit(X,Q,$,Y){return new I6({...this._def,checks:[...this._def.checks,{kind:X,value:Q,inclusive:$,message:Z.toString(Y)}]})}_addCheck(X){return new I6({...this._def,checks:[...this._def.checks,X]})}int(X){return this._addCheck({kind:"int",message:Z.toString(X)})}positive(X){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(X)})}negative(X){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(X)})}nonpositive(X){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(X)})}nonnegative(X){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(X)})}multipleOf(X,Q){return this._addCheck({kind:"multipleOf",value:X,message:Z.toString(Q)})}finite(X){return this._addCheck({kind:"finite",message:Z.toString(X)})}safe(X){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(X)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(X)})}get minValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}get isInt(){return!!this._def.checks.find((X)=>X.kind==="int"||X.kind==="multipleOf"&&n.isInteger(X.value))}get isFinite(){let X=null,Q=null;for(let $ of this._def.checks)if($.kind==="finite"||$.kind==="int"||$.kind==="multipleOf")return!0;else if($.kind==="min"){if(Q===null||$.value>Q)Q=$.value}else if($.kind==="max"){if(X===null||$.value<X)X=$.value}return Number.isFinite(Q)&&Number.isFinite(X)}}I6.create=(X)=>{return new I6({checks:[],typeName:j.ZodNumber,coerce:X?.coerce||!1,...l(X)})};class b6 extends p{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte}_parse(X){if(this._def.coerce)try{X.data=BigInt(X.data)}catch{return this._getInvalidInput(X)}if(this._getType(X)!==E.bigint)return this._getInvalidInput(X);let $=void 0,Y=new I0;for(let W of this._def.checks)if(W.kind==="min"){if(W.inclusive?X.data<W.value:X.data<=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_small,type:"bigint",minimum:W.value,inclusive:W.inclusive,message:W.message}),Y.dirty()}else if(W.kind==="max"){if(W.inclusive?X.data>W.value:X.data>=W.value)$=this._getOrReturnCtx(X,$),b($,{code:w.too_big,type:"bigint",maximum:W.value,inclusive:W.inclusive,message:W.message}),Y.dirty()}else if(W.kind==="multipleOf"){if(X.data%W.value!==BigInt(0))$=this._getOrReturnCtx(X,$),b($,{code:w.not_multiple_of,multipleOf:W.value,message:W.message}),Y.dirty()}else n.assertNever(W);return{status:Y.value,value:X.data}}_getInvalidInput(X){let Q=this._getOrReturnCtx(X);return b(Q,{code:w.invalid_type,expected:E.bigint,received:Q.parsedType}),g}gte(X,Q){return this.setLimit("min",X,!0,Z.toString(Q))}gt(X,Q){return this.setLimit("min",X,!1,Z.toString(Q))}lte(X,Q){return this.setLimit("max",X,!0,Z.toString(Q))}lt(X,Q){return this.setLimit("max",X,!1,Z.toString(Q))}setLimit(X,Q,$,Y){return new b6({...this._def,checks:[...this._def.checks,{kind:X,value:Q,inclusive:$,message:Z.toString(Y)}]})}_addCheck(X){return new b6({...this._def,checks:[...this._def.checks,X]})}positive(X){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(X)})}negative(X){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(X)})}nonpositive(X){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(X)})}nonnegative(X){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(X)})}multipleOf(X,Q){return this._addCheck({kind:"multipleOf",value:X,message:Z.toString(Q)})}get minValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X}get maxValue(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X}}b6.create=(X)=>{return new b6({checks:[],typeName:j.ZodBigInt,coerce:X?.coerce??!1,...l(X)})};class O4 extends p{_parse(X){if(this._def.coerce)X.data=Boolean(X.data);if(this._getType(X)!==E.boolean){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.boolean,received:$.parsedType}),g}return C0(X.data)}}O4.create=(X)=>{return new O4({typeName:j.ZodBoolean,coerce:X?.coerce||!1,...l(X)})};class GX extends p{_parse(X){if(this._def.coerce)X.data=new Date(X.data);if(this._getType(X)!==E.date){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_type,expected:E.date,received:W.parsedType}),g}if(Number.isNaN(X.data.getTime())){let W=this._getOrReturnCtx(X);return b(W,{code:w.invalid_date}),g}let $=new I0,Y=void 0;for(let W of this._def.checks)if(W.kind==="min"){if(X.data.getTime()<W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_small,message:W.message,inclusive:!0,exact:!1,minimum:W.value,type:"date"}),$.dirty()}else if(W.kind==="max"){if(X.data.getTime()>W.value)Y=this._getOrReturnCtx(X,Y),b(Y,{code:w.too_big,message:W.message,inclusive:!0,exact:!1,maximum:W.value,type:"date"}),$.dirty()}else n.assertNever(W);return{status:$.value,value:new Date(X.data.getTime())}}_addCheck(X){return new GX({...this._def,checks:[...this._def.checks,X]})}min(X,Q){return this._addCheck({kind:"min",value:X.getTime(),message:Z.toString(Q)})}max(X,Q){return this._addCheck({kind:"max",value:X.getTime(),message:Z.toString(Q)})}get minDate(){let X=null;for(let Q of this._def.checks)if(Q.kind==="min"){if(X===null||Q.value>X)X=Q.value}return X!=null?new Date(X):null}get maxDate(){let X=null;for(let Q of this._def.checks)if(Q.kind==="max"){if(X===null||Q.value<X)X=Q.value}return X!=null?new Date(X):null}}GX.create=(X)=>{return new GX({checks:[],coerce:X?.coerce||!1,typeName:j.ZodDate,...l(X)})};class D4 extends p{_parse(X){if(this._getType(X)!==E.symbol){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.symbol,received:$.parsedType}),g}return C0(X.data)}}D4.create=(X)=>{return new D4({typeName:j.ZodSymbol,...l(X)})};class HX extends p{_parse(X){if(this._getType(X)!==E.undefined){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.undefined,received:$.parsedType}),g}return C0(X.data)}}HX.create=(X)=>{return new HX({typeName:j.ZodUndefined,...l(X)})};class BX extends p{_parse(X){if(this._getType(X)!==E.null){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.null,received:$.parsedType}),g}return C0(X.data)}}BX.create=(X)=>{return new BX({typeName:j.ZodNull,...l(X)})};class A4 extends p{constructor(){super(...arguments);this._any=!0}_parse(X){return C0(X.data)}}A4.create=(X)=>{return new A4({typeName:j.ZodAny,...l(X)})};class t1 extends p{constructor(){super(...arguments);this._unknown=!0}_parse(X){return C0(X.data)}}t1.create=(X)=>{return new t1({typeName:j.ZodUnknown,...l(X)})};class w1 extends p{_parse(X){let Q=this._getOrReturnCtx(X);return b(Q,{code:w.invalid_type,expected:E.never,received:Q.parsedType}),g}}w1.create=(X)=>{return new w1({typeName:j.ZodNever,...l(X)})};class w4 extends p{_parse(X){if(this._getType(X)!==E.undefined){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.void,received:$.parsedType}),g}return C0(X.data)}}w4.create=(X)=>{return new w4({typeName:j.ZodVoid,...l(X)})};class J1 extends p{_parse(X){let{ctx:Q,status:$}=this._processInputParams(X),Y=this._def;if(Q.parsedType!==E.array)return b(Q,{code:w.invalid_type,expected:E.array,received:Q.parsedType}),g;if(Y.exactLength!==null){let J=Q.data.length>Y.exactLength.value,G=Q.data.length<Y.exactLength.value;if(J||G)b(Q,{code:J?w.too_big:w.too_small,minimum:G?Y.exactLength.value:void 0,maximum:J?Y.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:Y.exactLength.message}),$.dirty()}if(Y.minLength!==null){if(Q.data.length<Y.minLength.value)b(Q,{code:w.too_small,minimum:Y.minLength.value,type:"array",inclusive:!0,exact:!1,message:Y.minLength.message}),$.dirty()}if(Y.maxLength!==null){if(Q.data.length>Y.maxLength.value)b(Q,{code:w.too_big,maximum:Y.maxLength.value,type:"array",inclusive:!0,exact:!1,message:Y.maxLength.message}),$.dirty()}if(Q.common.async)return Promise.all([...Q.data].map((J,G)=>{return Y.type._parseAsync(new r0(Q,J,Q.path,G))})).then((J)=>{return I0.mergeArray($,J)});let W=[...Q.data].map((J,G)=>{return Y.type._parseSync(new r0(Q,J,Q.path,G))});return I0.mergeArray($,W)}get element(){return this._def.type}min(X,Q){return new J1({...this._def,minLength:{value:X,message:Z.toString(Q)}})}max(X,Q){return new J1({...this._def,maxLength:{value:X,message:Z.toString(Q)}})}length(X,Q){return new J1({...this._def,exactLength:{value:X,message:Z.toString(Q)}})}nonempty(X){return this.min(1,X)}}J1.create=(X,Q)=>{return new J1({type:X,minLength:null,maxLength:null,exactLength:null,typeName:j.ZodArray,...l(Q)})};function E6(X){if(X instanceof V0){let Q={};for(let $ in X.shape){let Y=X.shape[$];Q[$]=G1.create(E6(Y))}return new V0({...X._def,shape:()=>Q})}else if(X instanceof J1)return new J1({...X._def,type:E6(X.element)});else if(X instanceof G1)return G1.create(E6(X.unwrap()));else if(X instanceof _1)return _1.create(E6(X.unwrap()));else if(X instanceof M1)return M1.create(X.items.map((Q)=>E6(Q)));else return X}class V0 extends p{constructor(){super(...arguments);this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let X=this._def.shape(),Q=n.objectKeys(X);return this._cached={shape:X,keys:Q},this._cached}_parse(X){if(this._getType(X)!==E.object){let B=this._getOrReturnCtx(X);return b(B,{code:w.invalid_type,expected:E.object,received:B.parsedType}),g}let{status:$,ctx:Y}=this._processInputParams(X),{shape:W,keys:J}=this._getCached(),G=[];if(!(this._def.catchall instanceof w1&&this._def.unknownKeys==="strip")){for(let B in Y.data)if(!J.includes(B))G.push(B)}let H=[];for(let B of J){let z=W[B],K=Y.data[B];H.push({key:{status:"valid",value:B},value:z._parse(new r0(Y,K,Y.path,B)),alwaysSet:B in Y.data})}if(this._def.catchall instanceof w1){let B=this._def.unknownKeys;if(B==="passthrough")for(let z of G)H.push({key:{status:"valid",value:z},value:{status:"valid",value:Y.data[z]}});else if(B==="strict"){if(G.length>0)b(Y,{code:w.unrecognized_keys,keys:G}),$.dirty()}else if(B==="strip");else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let B=this._def.catchall;for(let z of G){let K=Y.data[z];H.push({key:{status:"valid",value:z},value:B._parse(new r0(Y,K,Y.path,z)),alwaysSet:z in Y.data})}}if(Y.common.async)return Promise.resolve().then(async()=>{let B=[];for(let z of H){let K=await z.key,V=await z.value;B.push({key:K,value:V,alwaysSet:z.alwaysSet})}return B}).then((B)=>{return I0.mergeObjectSync($,B)});else return I0.mergeObjectSync($,H)}get shape(){return this._def.shape()}strict(X){return Z.errToObj,new V0({...this._def,unknownKeys:"strict",...X!==void 0?{errorMap:(Q,$)=>{let Y=this._def.errorMap?.(Q,$).message??$.defaultError;if(Q.code==="unrecognized_keys")return{message:Z.errToObj(X).message??Y};return{message:Y}}}:{}})}strip(){return new V0({...this._def,unknownKeys:"strip"})}passthrough(){return new V0({...this._def,unknownKeys:"passthrough"})}extend(X){return new V0({...this._def,shape:()=>({...this._def.shape(),...X})})}merge(X){return new V0({unknownKeys:X._def.unknownKeys,catchall:X._def.catchall,shape:()=>({...this._def.shape(),...X._def.shape()}),typeName:j.ZodObject})}setKey(X,Q){return this.augment({[X]:Q})}catchall(X){return new V0({...this._def,catchall:X})}pick(X){let Q={};for(let $ of n.objectKeys(X))if(X[$]&&this.shape[$])Q[$]=this.shape[$];return new V0({...this._def,shape:()=>Q})}omit(X){let Q={};for(let $ of n.objectKeys(this.shape))if(!X[$])Q[$]=this.shape[$];return new V0({...this._def,shape:()=>Q})}deepPartial(){return E6(this)}partial(X){let Q={};for(let $ of n.objectKeys(this.shape)){let Y=this.shape[$];if(X&&!X[$])Q[$]=Y;else Q[$]=Y.optional()}return new V0({...this._def,shape:()=>Q})}required(X){let Q={};for(let $ of n.objectKeys(this.shape))if(X&&!X[$])Q[$]=this.shape[$];else{let W=this.shape[$];while(W instanceof G1)W=W._def.innerType;Q[$]=W}return new V0({...this._def,shape:()=>Q})}keyof(){return FW(n.objectKeys(this.shape))}}V0.create=(X,Q)=>{return new V0({shape:()=>X,unknownKeys:"strip",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};V0.strictCreate=(X,Q)=>{return new V0({shape:()=>X,unknownKeys:"strict",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};V0.lazycreate=(X,Q)=>{return new V0({shape:X,unknownKeys:"strip",catchall:w1.create(),typeName:j.ZodObject,...l(Q)})};class zX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=this._def.options;function Y(W){for(let G of W)if(G.result.status==="valid")return G.result;for(let G of W)if(G.result.status==="dirty")return Q.common.issues.push(...G.ctx.common.issues),G.result;let J=W.map((G)=>new h0(G.ctx.common.issues));return b(Q,{code:w.invalid_union,unionErrors:J}),g}if(Q.common.async)return Promise.all($.map(async(W)=>{let J={...Q,common:{...Q.common,issues:[]},parent:null};return{result:await W._parseAsync({data:Q.data,path:Q.path,parent:J}),ctx:J}})).then(Y);else{let W=void 0,J=[];for(let H of $){let B={...Q,common:{...Q.common,issues:[]},parent:null},z=H._parseSync({data:Q.data,path:Q.path,parent:B});if(z.status==="valid")return z;else if(z.status==="dirty"&&!W)W={result:z,ctx:B};if(B.common.issues.length)J.push(B.common.issues)}if(W)return Q.common.issues.push(...W.ctx.common.issues),W.result;let G=J.map((H)=>new h0(H));return b(Q,{code:w.invalid_union,unionErrors:G}),g}}get options(){return this._def.options}}zX.create=(X,Q)=>{return new zX({options:X,typeName:j.ZodUnion,...l(Q)})};var D1=(X)=>{if(X instanceof UX)return D1(X.schema);else if(X instanceof H1)return D1(X.innerType());else if(X instanceof VX)return[X.value];else if(X instanceof a1)return X.options;else if(X instanceof LX)return n.objectValues(X.enum);else if(X instanceof qX)return D1(X._def.innerType);else if(X instanceof HX)return[void 0];else if(X instanceof BX)return[null];else if(X instanceof G1)return[void 0,...D1(X.unwrap())];else if(X instanceof _1)return[null,...D1(X.unwrap())];else if(X instanceof D9)return D1(X.unwrap());else if(X instanceof NX)return D1(X.unwrap());else if(X instanceof FX)return D1(X._def.innerType);else return[]};class O9 extends p{_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.object)return b(Q,{code:w.invalid_type,expected:E.object,received:Q.parsedType}),g;let $=this.discriminator,Y=Q.data[$],W=this.optionsMap.get(Y);if(!W)return b(Q,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[$]}),g;if(Q.common.async)return W._parseAsync({data:Q.data,path:Q.path,parent:Q});else return W._parseSync({data:Q.data,path:Q.path,parent:Q})}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(X,Q,$){let Y=new Map;for(let W of Q){let J=D1(W.shape[X]);if(!J.length)throw Error(`A discriminator value for key \`${X}\` could not be extracted from all schema options`);for(let G of J){if(Y.has(G))throw Error(`Discriminator property ${String(X)} has duplicate value ${String(G)}`);Y.set(G,W)}}return new O9({typeName:j.ZodDiscriminatedUnion,discriminator:X,options:Q,optionsMap:Y,...l($)})}}function N9(X,Q){let $=O1(X),Y=O1(Q);if(X===Q)return{valid:!0,data:X};else if($===E.object&&Y===E.object){let W=n.objectKeys(Q),J=n.objectKeys(X).filter((H)=>W.indexOf(H)!==-1),G={...X,...Q};for(let H of J){let B=N9(X[H],Q[H]);if(!B.valid)return{valid:!1};G[H]=B.data}return{valid:!0,data:G}}else if($===E.array&&Y===E.array){if(X.length!==Q.length)return{valid:!1};let W=[];for(let J=0;J<X.length;J++){let G=X[J],H=Q[J],B=N9(G,H);if(!B.valid)return{valid:!1};W.push(B.data)}return{valid:!0,data:W}}else if($===E.date&&Y===E.date&&+X===+Q)return{valid:!0,data:X};else return{valid:!1}}class KX extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X),Y=(W,J)=>{if(L9(W)||L9(J))return g;let G=N9(W.value,J.value);if(!G.valid)return b($,{code:w.invalid_intersection_types}),g;if(q9(W)||q9(J))Q.dirty();return{status:Q.value,value:G.data}};if($.common.async)return Promise.all([this._def.left._parseAsync({data:$.data,path:$.path,parent:$}),this._def.right._parseAsync({data:$.data,path:$.path,parent:$})]).then(([W,J])=>Y(W,J));else return Y(this._def.left._parseSync({data:$.data,path:$.path,parent:$}),this._def.right._parseSync({data:$.data,path:$.path,parent:$}))}}KX.create=(X,Q,$)=>{return new KX({left:X,right:Q,typeName:j.ZodIntersection,...l($)})};class M1 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.array)return b($,{code:w.invalid_type,expected:E.array,received:$.parsedType}),g;if($.data.length<this._def.items.length)return b($,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;if(!this._def.rest&&$.data.length>this._def.items.length)b($,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Q.dirty();let W=[...$.data].map((J,G)=>{let H=this._def.items[G]||this._def.rest;if(!H)return null;return H._parse(new r0($,J,$.path,G))}).filter((J)=>!!J);if($.common.async)return Promise.all(W).then((J)=>{return I0.mergeArray(Q,J)});else return I0.mergeArray(Q,W)}get items(){return this._def.items}rest(X){return new M1({...this._def,rest:X})}}M1.create=(X,Q)=>{if(!Array.isArray(X))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new M1({items:X,typeName:j.ZodTuple,rest:null,...l(Q)})};class M4 extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.object)return b($,{code:w.invalid_type,expected:E.object,received:$.parsedType}),g;let Y=[],W=this._def.keyType,J=this._def.valueType;for(let G in $.data)Y.push({key:W._parse(new r0($,G,$.path,G)),value:J._parse(new r0($,$.data[G],$.path,G)),alwaysSet:G in $.data});if($.common.async)return I0.mergeObjectAsync(Q,Y);else return I0.mergeObjectSync(Q,Y)}get element(){return this._def.valueType}static create(X,Q,$){if(Q instanceof p)return new M4({keyType:X,valueType:Q,typeName:j.ZodRecord,...l($)});return new M4({keyType:A1.create(),valueType:X,typeName:j.ZodRecord,...l(Q)})}}class j4 extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.map)return b($,{code:w.invalid_type,expected:E.map,received:$.parsedType}),g;let Y=this._def.keyType,W=this._def.valueType,J=[...$.data.entries()].map(([G,H],B)=>{return{key:Y._parse(new r0($,G,$.path,[B,"key"])),value:W._parse(new r0($,H,$.path,[B,"value"]))}});if($.common.async){let G=new Map;return Promise.resolve().then(async()=>{for(let H of J){let B=await H.key,z=await H.value;if(B.status==="aborted"||z.status==="aborted")return g;if(B.status==="dirty"||z.status==="dirty")Q.dirty();G.set(B.value,z.value)}return{status:Q.value,value:G}})}else{let G=new Map;for(let H of J){let{key:B,value:z}=H;if(B.status==="aborted"||z.status==="aborted")return g;if(B.status==="dirty"||z.status==="dirty")Q.dirty();G.set(B.value,z.value)}return{status:Q.value,value:G}}}}j4.create=(X,Q,$)=>{return new j4({valueType:Q,keyType:X,typeName:j.ZodMap,...l($)})};class P6 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.parsedType!==E.set)return b($,{code:w.invalid_type,expected:E.set,received:$.parsedType}),g;let Y=this._def;if(Y.minSize!==null){if($.data.size<Y.minSize.value)b($,{code:w.too_small,minimum:Y.minSize.value,type:"set",inclusive:!0,exact:!1,message:Y.minSize.message}),Q.dirty()}if(Y.maxSize!==null){if($.data.size>Y.maxSize.value)b($,{code:w.too_big,maximum:Y.maxSize.value,type:"set",inclusive:!0,exact:!1,message:Y.maxSize.message}),Q.dirty()}let W=this._def.valueType;function J(H){let B=new Set;for(let z of H){if(z.status==="aborted")return g;if(z.status==="dirty")Q.dirty();B.add(z.value)}return{status:Q.value,value:B}}let G=[...$.data.values()].map((H,B)=>W._parse(new r0($,H,$.path,B)));if($.common.async)return Promise.all(G).then((H)=>J(H));else return J(G)}min(X,Q){return new P6({...this._def,minSize:{value:X,message:Z.toString(Q)}})}max(X,Q){return new P6({...this._def,maxSize:{value:X,message:Z.toString(Q)}})}size(X,Q){return this.min(X,Q).max(X,Q)}nonempty(X){return this.min(1,X)}}P6.create=(X,Q)=>{return new P6({valueType:X,minSize:null,maxSize:null,typeName:j.ZodSet,...l(Q)})};class JX extends p{constructor(){super(...arguments);this.validate=this.implement}_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.function)return b(Q,{code:w.invalid_type,expected:E.function,received:Q.parsedType}),g;function $(G,H){return N4({data:G,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,YX(),T1].filter((B)=>!!B),issueData:{code:w.invalid_arguments,argumentsError:H}})}function Y(G,H){return N4({data:G,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,YX(),T1].filter((B)=>!!B),issueData:{code:w.invalid_return_type,returnTypeError:H}})}let W={errorMap:Q.common.contextualErrorMap},J=Q.data;if(this._def.returns instanceof S6){let G=this;return C0(async function(...H){let B=new h0([]),z=await G._def.args.parseAsync(H,W).catch((L)=>{throw B.addIssue($(H,L)),B}),K=await Reflect.apply(J,this,z);return await G._def.returns._def.type.parseAsync(K,W).catch((L)=>{throw B.addIssue(Y(K,L)),B})})}else{let G=this;return C0(function(...H){let B=G._def.args.safeParse(H,W);if(!B.success)throw new h0([$(H,B.error)]);let z=Reflect.apply(J,this,B.data),K=G._def.returns.safeParse(z,W);if(!K.success)throw new h0([Y(z,K.error)]);return K.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...X){return new JX({...this._def,args:M1.create(X).rest(t1.create())})}returns(X){return new JX({...this._def,returns:X})}implement(X){return this.parse(X)}strictImplement(X){return this.parse(X)}static create(X,Q,$){return new JX({args:X?X:M1.create([]).rest(t1.create()),returns:Q||t1.create(),typeName:j.ZodFunction,...l($)})}}class UX extends p{get schema(){return this._def.getter()}_parse(X){let{ctx:Q}=this._processInputParams(X);return this._def.getter()._parse({data:Q.data,path:Q.path,parent:Q})}}UX.create=(X,Q)=>{return new UX({getter:X,typeName:j.ZodLazy,...l(Q)})};class VX extends p{_parse(X){if(X.data!==this._def.value){let Q=this._getOrReturnCtx(X);return b(Q,{received:Q.data,code:w.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:X.data}}get value(){return this._def.value}}VX.create=(X,Q)=>{return new VX({value:X,typeName:j.ZodLiteral,...l(Q)})};function FW(X,Q){return new a1({values:X,typeName:j.ZodEnum,...l(Q)})}class a1 extends p{_parse(X){if(typeof X.data!=="string"){let Q=this._getOrReturnCtx(X),$=this._def.values;return b(Q,{expected:n.joinValues($),received:Q.parsedType,code:w.invalid_type}),g}if(!this._cache)this._cache=new Set(this._def.values);if(!this._cache.has(X.data)){let Q=this._getOrReturnCtx(X),$=this._def.values;return b(Q,{received:Q.data,code:w.invalid_enum_value,options:$}),g}return C0(X.data)}get options(){return this._def.values}get enum(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}get Values(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}get Enum(){let X={};for(let Q of this._def.values)X[Q]=Q;return X}extract(X,Q=this._def){return a1.create(X,{...this._def,...Q})}exclude(X,Q=this._def){return a1.create(this.options.filter(($)=>!X.includes($)),{...this._def,...Q})}}a1.create=FW;class LX extends p{_parse(X){let Q=n.getValidEnumValues(this._def.values),$=this._getOrReturnCtx(X);if($.parsedType!==E.string&&$.parsedType!==E.number){let Y=n.objectValues(Q);return b($,{expected:n.joinValues(Y),received:$.parsedType,code:w.invalid_type}),g}if(!this._cache)this._cache=new Set(n.getValidEnumValues(this._def.values));if(!this._cache.has(X.data)){let Y=n.objectValues(Q);return b($,{received:$.data,code:w.invalid_enum_value,options:Y}),g}return C0(X.data)}get enum(){return this._def.values}}LX.create=(X,Q)=>{return new LX({values:X,typeName:j.ZodNativeEnum,...l(Q)})};class S6 extends p{unwrap(){return this._def.type}_parse(X){let{ctx:Q}=this._processInputParams(X);if(Q.parsedType!==E.promise&&Q.common.async===!1)return b(Q,{code:w.invalid_type,expected:E.promise,received:Q.parsedType}),g;let $=Q.parsedType===E.promise?Q.data:Promise.resolve(Q.data);return C0($.then((Y)=>{return this._def.type.parseAsync(Y,{path:Q.path,errorMap:Q.common.contextualErrorMap})}))}}S6.create=(X,Q)=>{return new S6({type:X,typeName:j.ZodPromise,...l(Q)})};class H1 extends p{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===j.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(X){let{status:Q,ctx:$}=this._processInputParams(X),Y=this._def.effect||null,W={addIssue:(J)=>{if(b($,J),J.fatal)Q.abort();else Q.dirty()},get path(){return $.path}};if(W.addIssue=W.addIssue.bind(W),Y.type==="preprocess"){let J=Y.transform($.data,W);if($.common.async)return Promise.resolve(J).then(async(G)=>{if(Q.value==="aborted")return g;let H=await this._def.schema._parseAsync({data:G,path:$.path,parent:$});if(H.status==="aborted")return g;if(H.status==="dirty")return R6(H.value);if(Q.value==="dirty")return R6(H.value);return H});else{if(Q.value==="aborted")return g;let G=this._def.schema._parseSync({data:J,path:$.path,parent:$});if(G.status==="aborted")return g;if(G.status==="dirty")return R6(G.value);if(Q.value==="dirty")return R6(G.value);return G}}if(Y.type==="refinement"){let J=(G)=>{let H=Y.refinement(G,W);if($.common.async)return Promise.resolve(H);if(H instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return G};if($.common.async===!1){let G=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(G.status==="aborted")return g;if(G.status==="dirty")Q.dirty();return J(G.value),{status:Q.value,value:G.value}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((G)=>{if(G.status==="aborted")return g;if(G.status==="dirty")Q.dirty();return J(G.value).then(()=>{return{status:Q.value,value:G.value}})})}if(Y.type==="transform")if($.common.async===!1){let J=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(!o1(J))return g;let G=Y.transform(J.value,W);if(G instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:Q.value,value:G}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((J)=>{if(!o1(J))return g;return Promise.resolve(Y.transform(J.value,W)).then((G)=>({status:Q.value,value:G}))});n.assertNever(Y)}}H1.create=(X,Q,$)=>{return new H1({schema:X,typeName:j.ZodEffects,effect:Q,...l($)})};H1.createWithPreprocess=(X,Q,$)=>{return new H1({schema:Q,effect:{type:"preprocess",transform:X},typeName:j.ZodEffects,...l($)})};class G1 extends p{_parse(X){if(this._getType(X)===E.undefined)return C0(void 0);return this._def.innerType._parse(X)}unwrap(){return this._def.innerType}}G1.create=(X,Q)=>{return new G1({innerType:X,typeName:j.ZodOptional,...l(Q)})};class _1 extends p{_parse(X){if(this._getType(X)===E.null)return C0(null);return this._def.innerType._parse(X)}unwrap(){return this._def.innerType}}_1.create=(X,Q)=>{return new _1({innerType:X,typeName:j.ZodNullable,...l(Q)})};class qX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=Q.data;if(Q.parsedType===E.undefined)$=this._def.defaultValue();return this._def.innerType._parse({data:$,path:Q.path,parent:Q})}removeDefault(){return this._def.innerType}}qX.create=(X,Q)=>{return new qX({innerType:X,typeName:j.ZodDefault,defaultValue:typeof Q.default==="function"?Q.default:()=>Q.default,...l(Q)})};class FX extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$={...Q,common:{...Q.common,issues:[]}},Y=this._def.innerType._parse({data:$.data,path:$.path,parent:{...$}});if(WX(Y))return Y.then((W)=>{return{status:"valid",value:W.status==="valid"?W.value:this._def.catchValue({get error(){return new h0($.common.issues)},input:$.data})}});else return{status:"valid",value:Y.status==="valid"?Y.value:this._def.catchValue({get error(){return new h0($.common.issues)},input:$.data})}}removeCatch(){return this._def.innerType}}FX.create=(X,Q)=>{return new FX({innerType:X,typeName:j.ZodCatch,catchValue:typeof Q.catch==="function"?Q.catch:()=>Q.catch,...l(Q)})};class R4 extends p{_parse(X){if(this._getType(X)!==E.nan){let $=this._getOrReturnCtx(X);return b($,{code:w.invalid_type,expected:E.nan,received:$.parsedType}),g}return{status:"valid",value:X.data}}}R4.create=(X)=>{return new R4({typeName:j.ZodNaN,...l(X)})};var D2=Symbol("zod_brand");class D9 extends p{_parse(X){let{ctx:Q}=this._processInputParams(X),$=Q.data;return this._def.type._parse({data:$,path:Q.path,parent:Q})}unwrap(){return this._def.type}}class E4 extends p{_parse(X){let{status:Q,ctx:$}=this._processInputParams(X);if($.common.async)return(async()=>{let W=await this._def.in._parseAsync({data:$.data,path:$.path,parent:$});if(W.status==="aborted")return g;if(W.status==="dirty")return Q.dirty(),R6(W.value);else return this._def.out._parseAsync({data:W.value,path:$.path,parent:$})})();else{let Y=this._def.in._parseSync({data:$.data,path:$.path,parent:$});if(Y.status==="aborted")return g;if(Y.status==="dirty")return Q.dirty(),{status:"dirty",value:Y.value};else return this._def.out._parseSync({data:Y.value,path:$.path,parent:$})}}static create(X,Q){return new E4({in:X,out:Q,typeName:j.ZodPipeline})}}class NX extends p{_parse(X){let Q=this._def.innerType._parse(X),$=(Y)=>{if(o1(Y))Y.value=Object.freeze(Y.value);return Y};return WX(Q)?Q.then((Y)=>$(Y)):$(Q)}unwrap(){return this._def.innerType}}NX.create=(X,Q)=>{return new NX({innerType:X,typeName:j.ZodReadonly,...l(Q)})};var A2={object:V0.lazycreate},j;(function(X){X.ZodString="ZodString",X.ZodNumber="ZodNumber",X.ZodNaN="ZodNaN",X.ZodBigInt="ZodBigInt",X.ZodBoolean="ZodBoolean",X.ZodDate="ZodDate",X.ZodSymbol="ZodSymbol",X.ZodUndefined="ZodUndefined",X.ZodNull="ZodNull",X.ZodAny="ZodAny",X.ZodUnknown="ZodUnknown",X.ZodNever="ZodNever",X.ZodVoid="ZodVoid",X.ZodArray="ZodArray",X.ZodObject="ZodObject",X.ZodUnion="ZodUnion",X.ZodDiscriminatedUnion="ZodDiscriminatedUnion",X.ZodIntersection="ZodIntersection",X.ZodTuple="ZodTuple",X.ZodRecord="ZodRecord",X.ZodMap="ZodMap",X.ZodSet="ZodSet",X.ZodFunction="ZodFunction",X.ZodLazy="ZodLazy",X.ZodLiteral="ZodLiteral",X.ZodEnum="ZodEnum",X.ZodEffects="ZodEffects",X.ZodNativeEnum="ZodNativeEnum",X.ZodOptional="ZodOptional",X.ZodNullable="ZodNullable",X.ZodDefault="ZodDefault",X.ZodCatch="ZodCatch",X.ZodPromise="ZodPromise",X.ZodBranded="ZodBranded",X.ZodPipeline="ZodPipeline",X.ZodReadonly="ZodReadonly"})(j||(j={}));var w2=A1.create,M2=I6.create,j2=R4.create,R2=b6.create,E2=O4.create,I2=GX.create,b2=D4.create,P2=HX.create,S2=BX.create,Z2=A4.create,C2=t1.create,k2=w1.create,v2=w4.create,T2=J1.create,NW=V0.create,_2=V0.strictCreate,x2=zX.create,y2=O9.create,g2=KX.create,f2=M1.create,h2=M4.create,u2=j4.create,l2=P6.create,m2=JX.create,c2=UX.create,p2=VX.create,d2=a1.create,i2=LX.create,n2=S6.create,r2=H1.create,o2=G1.create,t2=_1.create,a2=H1.createWithPreprocess,s2=E4.create;var bV=Object.freeze({status:"aborted"});function O(X,Q,$){function Y(H,B){var z;Object.defineProperty(H,"_zod",{value:H._zod??{},enumerable:!1}),(z=H._zod).traits??(z.traits=new Set),H._zod.traits.add(X),Q(H,B);for(let K in G.prototype)if(!(K in H))Object.defineProperty(H,K,{value:G.prototype[K].bind(H)});H._zod.constr=G,H._zod.def=B}let W=$?.Parent??Object;class J extends W{}Object.defineProperty(J,"name",{value:X});function G(H){var B;let z=$?.Parent?new J:this;Y(z,H),(B=z._zod).deferred??(B.deferred=[]);for(let K of z._zod.deferred)K();return z}return Object.defineProperty(G,"init",{value:Y}),Object.defineProperty(G,Symbol.hasInstance,{value:(H)=>{if($?.Parent&&H instanceof $.Parent)return!0;return H?._zod?.traits?.has(X)}}),Object.defineProperty(G,"name",{value:X}),G}var PV=Symbol("zod_brand");class x1 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}var I4={};function u0(X){if(X)Object.assign(I4,X);return I4}var i={};U7(i,{unwrapMessage:()=>OX,stringifyPrimitive:()=>S4,required:()=>pV,randomString:()=>xV,propertyKeyTypes:()=>E9,promiseAllObject:()=>_V,primitiveTypes:()=>OW,prefixIssues:()=>B1,pick:()=>hV,partial:()=>cV,optionalKeys:()=>I9,omit:()=>uV,numKeys:()=>yV,nullish:()=>wX,normalizeParams:()=>y,merge:()=>mV,jsonStringifyReplacer:()=>w9,joinValues:()=>b4,issue:()=>P9,isPlainObject:()=>C6,isObject:()=>Z6,getSizableOrigin:()=>AW,getParsedType:()=>gV,getLengthableOrigin:()=>jX,getEnumValues:()=>DX,getElementAtPath:()=>TV,floatSafeRemainder:()=>M9,finalizeIssue:()=>o0,extend:()=>lV,escapeRegex:()=>y1,esc:()=>s1,defineLazy:()=>Y0,createTransparentProxy:()=>fV,clone:()=>l0,cleanRegex:()=>MX,cleanEnum:()=>dV,captureStackTrace:()=>P4,cached:()=>AX,assignProp:()=>j9,assertNotEqual:()=>ZV,assertNever:()=>kV,assertIs:()=>CV,assertEqual:()=>SV,assert:()=>vV,allowsEval:()=>R9,aborted:()=>e1,NUMBER_FORMAT_RANGES:()=>b9,Class:()=>wW,BIGINT_FORMAT_RANGES:()=>DW});function SV(X){return X}function ZV(X){return X}function CV(X){}function kV(X){throw Error()}function vV(X){}function DX(X){let Q=Object.values(X).filter((Y)=>typeof Y==="number");return Object.entries(X).filter(([Y,W])=>Q.indexOf(+Y)===-1).map(([Y,W])=>W)}function b4(X,Q="|"){return X.map(($)=>S4($)).join(Q)}function w9(X,Q){if(typeof Q==="bigint")return Q.toString();return Q}function AX(X){return{get value(){{let $=X();return Object.defineProperty(this,"value",{value:$}),$}throw Error("cached value already set")}}}function wX(X){return X===null||X===void 0}function MX(X){let Q=X.startsWith("^")?1:0,$=X.endsWith("$")?X.length-1:X.length;return X.slice(Q,$)}function M9(X,Q){let $=(X.toString().split(".")[1]||"").length,Y=(Q.toString().split(".")[1]||"").length,W=$>Y?$:Y,J=Number.parseInt(X.toFixed(W).replace(".","")),G=Number.parseInt(Q.toFixed(W).replace(".",""));return J%G/10**W}function Y0(X,Q,$){Object.defineProperty(X,Q,{get(){{let W=$();return X[Q]=W,W}throw Error("cached value already set")},set(W){Object.defineProperty(X,Q,{value:W})},configurable:!0})}function j9(X,Q,$){Object.defineProperty(X,Q,{value:$,writable:!0,enumerable:!0,configurable:!0})}function TV(X,Q){if(!Q)return X;return Q.reduce(($,Y)=>$?.[Y],X)}function _V(X){let Q=Object.keys(X),$=Q.map((Y)=>X[Y]);return Promise.all($).then((Y)=>{let W={};for(let J=0;J<Q.length;J++)W[Q[J]]=Y[J];return W})}function xV(X=10){let $="";for(let Y=0;Y<X;Y++)$+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return $}function s1(X){return JSON.stringify(X)}var P4=Error.captureStackTrace?Error.captureStackTrace:(...X)=>{};function Z6(X){return typeof X==="object"&&X!==null&&!Array.isArray(X)}var R9=AX(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(X){return!1}});function C6(X){if(Z6(X)===!1)return!1;let Q=X.constructor;if(Q===void 0)return!0;let $=Q.prototype;if(Z6($)===!1)return!1;if(Object.prototype.hasOwnProperty.call($,"isPrototypeOf")===!1)return!1;return!0}function yV(X){let Q=0;for(let $ in X)if(Object.prototype.hasOwnProperty.call(X,$))Q++;return Q}var gV=(X)=>{let Q=typeof X;switch(Q){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(X)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(X))return"array";if(X===null)return"null";if(X.then&&typeof X.then==="function"&&X.catch&&typeof X.catch==="function")return"promise";if(typeof Map<"u"&&X instanceof Map)return"map";if(typeof Set<"u"&&X instanceof Set)return"set";if(typeof Date<"u"&&X instanceof Date)return"date";if(typeof File<"u"&&X instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${Q}`)}},E9=new Set(["string","number","symbol"]),OW=new Set(["string","number","bigint","boolean","symbol","undefined"]);function y1(X){return X.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l0(X,Q,$){let Y=new X._zod.constr(Q??X._zod.def);if(!Q||$?.parent)Y._zod.parent=X;return Y}function y(X){let Q=X;if(!Q)return{};if(typeof Q==="string")return{error:()=>Q};if(Q?.message!==void 0){if(Q?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");Q.error=Q.message}if(delete Q.message,typeof Q.error==="string")return{...Q,error:()=>Q.error};return Q}function fV(X){let Q;return new Proxy({},{get($,Y,W){return Q??(Q=X()),Reflect.get(Q,Y,W)},set($,Y,W,J){return Q??(Q=X()),Reflect.set(Q,Y,W,J)},has($,Y){return Q??(Q=X()),Reflect.has(Q,Y)},deleteProperty($,Y){return Q??(Q=X()),Reflect.deleteProperty(Q,Y)},ownKeys($){return Q??(Q=X()),Reflect.ownKeys(Q)},getOwnPropertyDescriptor($,Y){return Q??(Q=X()),Reflect.getOwnPropertyDescriptor(Q,Y)},defineProperty($,Y,W){return Q??(Q=X()),Reflect.defineProperty(Q,Y,W)}})}function S4(X){if(typeof X==="bigint")return X.toString()+"n";if(typeof X==="string")return`"${X}"`;return`${X}`}function I9(X){return Object.keys(X).filter((Q)=>{return X[Q]._zod.optin==="optional"&&X[Q]._zod.optout==="optional"})}var b9={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-340282346638528860000000000000000000000,340282346638528860000000000000000000000],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},DW={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function hV(X,Q){let $={},Y=X._zod.def;for(let W in Q){if(!(W in Y.shape))throw Error(`Unrecognized key: "${W}"`);if(!Q[W])continue;$[W]=Y.shape[W]}return l0(X,{...X._zod.def,shape:$,checks:[]})}function uV(X,Q){let $={...X._zod.def.shape},Y=X._zod.def;for(let W in Q){if(!(W in Y.shape))throw Error(`Unrecognized key: "${W}"`);if(!Q[W])continue;delete $[W]}return l0(X,{...X._zod.def,shape:$,checks:[]})}function lV(X,Q){if(!C6(Q))throw Error("Invalid input to extend: expected a plain object");let $={...X._zod.def,get shape(){let Y={...X._zod.def.shape,...Q};return j9(this,"shape",Y),Y},checks:[]};return l0(X,$)}function mV(X,Q){return l0(X,{...X._zod.def,get shape(){let $={...X._zod.def.shape,...Q._zod.def.shape};return j9(this,"shape",$),$},catchall:Q._zod.def.catchall,checks:[]})}function cV(X,Q,$){let Y=Q._zod.def.shape,W={...Y};if($)for(let J in $){if(!(J in Y))throw Error(`Unrecognized key: "${J}"`);if(!$[J])continue;W[J]=X?new X({type:"optional",innerType:Y[J]}):Y[J]}else for(let J in Y)W[J]=X?new X({type:"optional",innerType:Y[J]}):Y[J];return l0(Q,{...Q._zod.def,shape:W,checks:[]})}function pV(X,Q,$){let Y=Q._zod.def.shape,W={...Y};if($)for(let J in $){if(!(J in W))throw Error(`Unrecognized key: "${J}"`);if(!$[J])continue;W[J]=new X({type:"nonoptional",innerType:Y[J]})}else for(let J in Y)W[J]=new X({type:"nonoptional",innerType:Y[J]});return l0(Q,{...Q._zod.def,shape:W,checks:[]})}function e1(X,Q=0){for(let $=Q;$<X.issues.length;$++)if(X.issues[$]?.continue!==!0)return!0;return!1}function B1(X,Q){return Q.map(($)=>{var Y;return(Y=$).path??(Y.path=[]),$.path.unshift(X),$})}function OX(X){return typeof X==="string"?X:X?.message}function o0(X,Q,$){let Y={...X,path:X.path??[]};if(!X.message){let W=OX(X.inst?._zod.def?.error?.(X))??OX(Q?.error?.(X))??OX($.customError?.(X))??OX($.localeError?.(X))??"Invalid input";Y.message=W}if(delete Y.inst,delete Y.continue,!Q?.reportInput)delete Y.input;return Y}function AW(X){if(X instanceof Set)return"set";if(X instanceof Map)return"map";if(X instanceof File)return"file";return"unknown"}function jX(X){if(Array.isArray(X))return"array";if(typeof X==="string")return"string";return"unknown"}function P9(...X){let[Q,$,Y]=X;if(typeof Q==="string")return{message:Q,code:"custom",input:$,inst:Y};return{...Q}}function dV(X){return Object.entries(X).filter(([Q,$])=>{return Number.isNaN(Number.parseInt(Q,10))}).map((Q)=>Q[1])}class wW{constructor(...X){}}var MW=(X,Q)=>{X.name="$ZodError",Object.defineProperty(X,"_zod",{value:X._zod,enumerable:!1}),Object.defineProperty(X,"issues",{value:Q,enumerable:!1}),Object.defineProperty(X,"message",{get(){return JSON.stringify(Q,w9,2)},enumerable:!0})},Z4=O("$ZodError",MW),RX=O("$ZodError",MW,{Parent:Error});function S9(X,Q=($)=>$.message){let $={},Y=[];for(let W of X.issues)if(W.path.length>0)$[W.path[0]]=$[W.path[0]]||[],$[W.path[0]].push(Q(W));else Y.push(Q(W));return{formErrors:Y,fieldErrors:$}}function Z9(X,Q){let $=Q||function(J){return J.message},Y={_errors:[]},W=(J)=>{for(let G of J.issues)if(G.code==="invalid_union"&&G.errors.length)G.errors.map((H)=>W({issues:H}));else if(G.code==="invalid_key")W({issues:G.issues});else if(G.code==="invalid_element")W({issues:G.issues});else if(G.path.length===0)Y._errors.push($(G));else{let H=Y,B=0;while(B<G.path.length){let z=G.path[B];if(B!==G.path.length-1)H[z]=H[z]||{_errors:[]};else H[z]=H[z]||{_errors:[]},H[z]._errors.push($(G));H=H[z],B++}}};return W(X),Y}var C9=(X)=>(Q,$,Y,W)=>{let J=Y?Object.assign(Y,{async:!1}):{async:!1},G=Q._zod.run({value:$,issues:[]},J);if(G instanceof Promise)throw new x1;if(G.issues.length){let H=new(W?.Err??X)(G.issues.map((B)=>o0(B,J,u0())));throw P4(H,W?.callee),H}return G.value},k9=C9(RX),v9=(X)=>async(Q,$,Y,W)=>{let J=Y?Object.assign(Y,{async:!0}):{async:!0},G=Q._zod.run({value:$,issues:[]},J);if(G instanceof Promise)G=await G;if(G.issues.length){let H=new(W?.Err??X)(G.issues.map((B)=>o0(B,J,u0())));throw P4(H,W?.callee),H}return G.value},T9=v9(RX),_9=(X)=>(Q,$,Y)=>{let W=Y?{...Y,async:!1}:{async:!1},J=Q._zod.run({value:$,issues:[]},W);if(J instanceof Promise)throw new x1;return J.issues.length?{success:!1,error:new(X??Z4)(J.issues.map((G)=>o0(G,W,u0())))}:{success:!0,data:J.value}},X6=_9(RX),x9=(X)=>async(Q,$,Y)=>{let W=Y?Object.assign(Y,{async:!0}):{async:!0},J=Q._zod.run({value:$,issues:[]},W);if(J instanceof Promise)J=await J;return J.issues.length?{success:!1,error:new X(J.issues.map((G)=>o0(G,W,u0())))}:{success:!0,data:J.value}},Q6=x9(RX);var jW=/^[cC][^\s-]{8,}$/,RW=/^[0-9a-z]+$/,EW=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,IW=/^[0-9a-vA-V]{20}$/,bW=/^[A-Za-z0-9]{27}$/,PW=/^[a-zA-Z0-9_-]{21}$/,SW=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var ZW=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,y9=(X)=>{if(!X)return/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${X}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`)};var CW=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function kW(){return new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}var vW=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,TW=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,_W=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,xW=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,yW=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,g9=/^[A-Za-z0-9_-]*$/,gW=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var fW=/^\+(?:[0-9]){6,14}[0-9]$/,hW="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",uW=new RegExp(`^${hW}$`);function lW(X){return typeof X.precision==="number"?X.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":X.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${X.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function mW(X){return new RegExp(`^${lW(X)}$`)}function cW(X){let Q=lW({precision:X.precision}),$=["Z"];if(X.local)$.push("");if(X.offset)$.push("([+-]\\d{2}:\\d{2})");let Y=`${Q}(?:${$.join("|")})`;return new RegExp(`^${hW}T(?:${Y})$`)}var pW=(X)=>{let Q=X?`[\\s\\S]{${X?.minimum??0},${X?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${Q}$`)};var dW=/^\d+$/,iW=/^-?\d+(?:\.\d+)?/i,nW=/true|false/i,rW=/null/i;var oW=/^[^A-Z]*$/,tW=/^[^a-z]*$/;var w0=O("$ZodCheck",(X,Q)=>{var $;X._zod??(X._zod={}),X._zod.def=Q,($=X._zod).onattach??($.onattach=[])}),aW={number:"number",bigint:"bigint",object:"date"},f9=O("$ZodCheckLessThan",(X,Q)=>{w0.init(X,Q);let $=aW[typeof Q.value];X._zod.onattach.push((Y)=>{let W=Y._zod.bag,J=(Q.inclusive?W.maximum:W.exclusiveMaximum)??Number.POSITIVE_INFINITY;if(Q.value<J)if(Q.inclusive)W.maximum=Q.value;else W.exclusiveMaximum=Q.value}),X._zod.check=(Y)=>{if(Q.inclusive?Y.value<=Q.value:Y.value<Q.value)return;Y.issues.push({origin:$,code:"too_big",maximum:Q.value,input:Y.value,inclusive:Q.inclusive,inst:X,continue:!Q.abort})}}),h9=O("$ZodCheckGreaterThan",(X,Q)=>{w0.init(X,Q);let $=aW[typeof Q.value];X._zod.onattach.push((Y)=>{let W=Y._zod.bag,J=(Q.inclusive?W.minimum:W.exclusiveMinimum)??Number.NEGATIVE_INFINITY;if(Q.value>J)if(Q.inclusive)W.minimum=Q.value;else W.exclusiveMinimum=Q.value}),X._zod.check=(Y)=>{if(Q.inclusive?Y.value>=Q.value:Y.value>Q.value)return;Y.issues.push({origin:$,code:"too_small",minimum:Q.value,input:Y.value,inclusive:Q.inclusive,inst:X,continue:!Q.abort})}}),sW=O("$ZodCheckMultipleOf",(X,Q)=>{w0.init(X,Q),X._zod.onattach.push(($)=>{var Y;(Y=$._zod.bag).multipleOf??(Y.multipleOf=Q.value)}),X._zod.check=($)=>{if(typeof $.value!==typeof Q.value)throw Error("Cannot mix number and bigint in multiple_of check.");if(typeof $.value==="bigint"?$.value%Q.value===BigInt(0):M9($.value,Q.value)===0)return;$.issues.push({origin:typeof $.value,code:"not_multiple_of",divisor:Q.value,input:$.value,inst:X,continue:!Q.abort})}}),eW=O("$ZodCheckNumberFormat",(X,Q)=>{w0.init(X,Q),Q.format=Q.format||"float64";let $=Q.format?.includes("int"),Y=$?"int":"number",[W,J]=b9[Q.format];X._zod.onattach.push((G)=>{let H=G._zod.bag;if(H.format=Q.format,H.minimum=W,H.maximum=J,$)H.pattern=dW}),X._zod.check=(G)=>{let H=G.value;if($){if(!Number.isInteger(H)){G.issues.push({expected:Y,format:Q.format,code:"invalid_type",input:H,inst:X});return}if(!Number.isSafeInteger(H)){if(H>0)G.issues.push({input:H,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:X,origin:Y,continue:!Q.abort});else G.issues.push({input:H,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:X,origin:Y,continue:!Q.abort});return}}if(H<W)G.issues.push({origin:"number",input:H,code:"too_small",minimum:W,inclusive:!0,inst:X,continue:!Q.abort});if(H>J)G.issues.push({origin:"number",input:H,code:"too_big",maximum:J,inst:X})}});var XJ=O("$ZodCheckMaxLength",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag.maximum??Number.POSITIVE_INFINITY;if(Q.maximum<Y)$._zod.bag.maximum=Q.maximum}),X._zod.check=($)=>{let Y=$.value;if(Y.length<=Q.maximum)return;let J=jX(Y);$.issues.push({origin:J,code:"too_big",maximum:Q.maximum,inclusive:!0,input:Y,inst:X,continue:!Q.abort})}}),QJ=O("$ZodCheckMinLength",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag.minimum??Number.NEGATIVE_INFINITY;if(Q.minimum>Y)$._zod.bag.minimum=Q.minimum}),X._zod.check=($)=>{let Y=$.value;if(Y.length>=Q.minimum)return;let J=jX(Y);$.issues.push({origin:J,code:"too_small",minimum:Q.minimum,inclusive:!0,input:Y,inst:X,continue:!Q.abort})}}),$J=O("$ZodCheckLengthEquals",(X,Q)=>{w0.init(X,Q),X._zod.when=($)=>{let Y=$.value;return!wX(Y)&&Y.length!==void 0},X._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.minimum=Q.length,Y.maximum=Q.length,Y.length=Q.length}),X._zod.check=($)=>{let Y=$.value,W=Y.length;if(W===Q.length)return;let J=jX(Y),G=W>Q.length;$.issues.push({origin:J,...G?{code:"too_big",maximum:Q.length}:{code:"too_small",minimum:Q.length},inclusive:!0,exact:!0,input:$.value,inst:X,continue:!Q.abort})}}),EX=O("$ZodCheckStringFormat",(X,Q)=>{var $,Y;if(w0.init(X,Q),X._zod.onattach.push((W)=>{let J=W._zod.bag;if(J.format=Q.format,Q.pattern)J.patterns??(J.patterns=new Set),J.patterns.add(Q.pattern)}),Q.pattern)($=X._zod).check??($.check=(W)=>{if(Q.pattern.lastIndex=0,Q.pattern.test(W.value))return;W.issues.push({origin:"string",code:"invalid_format",format:Q.format,input:W.value,...Q.pattern?{pattern:Q.pattern.toString()}:{},inst:X,continue:!Q.abort})});else(Y=X._zod).check??(Y.check=()=>{})}),YJ=O("$ZodCheckRegex",(X,Q)=>{EX.init(X,Q),X._zod.check=($)=>{if(Q.pattern.lastIndex=0,Q.pattern.test($.value))return;$.issues.push({origin:"string",code:"invalid_format",format:"regex",input:$.value,pattern:Q.pattern.toString(),inst:X,continue:!Q.abort})}}),WJ=O("$ZodCheckLowerCase",(X,Q)=>{Q.pattern??(Q.pattern=oW),EX.init(X,Q)}),JJ=O("$ZodCheckUpperCase",(X,Q)=>{Q.pattern??(Q.pattern=tW),EX.init(X,Q)}),GJ=O("$ZodCheckIncludes",(X,Q)=>{w0.init(X,Q);let $=y1(Q.includes),Y=new RegExp(typeof Q.position==="number"?`^.{${Q.position}}${$}`:$);Q.pattern=Y,X._zod.onattach.push((W)=>{let J=W._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add(Y)}),X._zod.check=(W)=>{if(W.value.includes(Q.includes,Q.position))return;W.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:Q.includes,input:W.value,inst:X,continue:!Q.abort})}}),HJ=O("$ZodCheckStartsWith",(X,Q)=>{w0.init(X,Q);let $=new RegExp(`^${y1(Q.prefix)}.*`);Q.pattern??(Q.pattern=$),X._zod.onattach.push((Y)=>{let W=Y._zod.bag;W.patterns??(W.patterns=new Set),W.patterns.add($)}),X._zod.check=(Y)=>{if(Y.value.startsWith(Q.prefix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:Q.prefix,input:Y.value,inst:X,continue:!Q.abort})}}),BJ=O("$ZodCheckEndsWith",(X,Q)=>{w0.init(X,Q);let $=new RegExp(`.*${y1(Q.suffix)}$`);Q.pattern??(Q.pattern=$),X._zod.onattach.push((Y)=>{let W=Y._zod.bag;W.patterns??(W.patterns=new Set),W.patterns.add($)}),X._zod.check=(Y)=>{if(Y.value.endsWith(Q.suffix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:Q.suffix,input:Y.value,inst:X,continue:!Q.abort})}});var zJ=O("$ZodCheckOverwrite",(X,Q)=>{w0.init(X,Q),X._zod.check=($)=>{$.value=Q.tx($.value)}});class u9{constructor(X=[]){if(this.content=[],this.indent=0,this)this.args=X}indented(X){this.indent+=1,X(this),this.indent-=1}write(X){if(typeof X==="function"){X(this,{execution:"sync"}),X(this,{execution:"async"});return}let $=X.split(`
 `).filter((J)=>J),Y=Math.min(...$.map((J)=>J.length-J.trimStart().length)),W=$.map((J)=>J.slice(Y)).map((J)=>" ".repeat(this.indent*2)+J);for(let J of W)this.content.push(J)}compile(){let X=Function,Q=this?.args,Y=[...(this?.content??[""]).map((W)=>`  ${W}`)];return new X(...Q,Y.join(`
 `))}}var UJ={major:4,minor:0,patch:0};var X0=O("$ZodType",(X,Q)=>{var $;X??(X={}),X._zod.def=Q,X._zod.bag=X._zod.bag||{},X._zod.version=UJ;let Y=[...X._zod.def.checks??[]];if(X._zod.traits.has("$ZodCheck"))Y.unshift(X);for(let W of Y)for(let J of W._zod.onattach)J(X);if(Y.length===0)($=X._zod).deferred??($.deferred=[]),X._zod.deferred?.push(()=>{X._zod.run=X._zod.parse});else{let W=(J,G,H)=>{let B=e1(J),z;for(let K of G){if(K._zod.when){if(!K._zod.when(J))continue}else if(B)continue;let V=J.issues.length,L=K._zod.check(J);if(L instanceof Promise&&H?.async===!1)throw new x1;if(z||L instanceof Promise)z=(z??Promise.resolve()).then(async()=>{if(await L,J.issues.length===V)return;if(!B)B=e1(J,V)});else{if(J.issues.length===V)continue;if(!B)B=e1(J,V)}}if(z)return z.then(()=>{return J});return J};X._zod.run=(J,G)=>{let H=X._zod.parse(J,G);if(H instanceof Promise){if(G.async===!1)throw new x1;return H.then((B)=>W(B,Y,G))}return W(H,Y,G)}}X["~standard"]={validate:(W)=>{try{let J=X6(X,W);return J.success?{value:J.data}:{issues:J.error?.issues}}catch(J){return Q6(X,W).then((G)=>G.success?{value:G.data}:{issues:G.error?.issues})}},vendor:"zod",version:1}}),IX=O("$ZodString",(X,Q)=>{X0.init(X,Q),X._zod.pattern=[...X?._zod.bag?.patterns??[]].pop()??pW(X._zod.bag),X._zod.parse=($,Y)=>{if(Q.coerce)try{$.value=String($.value)}catch(W){}if(typeof $.value==="string")return $;return $.issues.push({expected:"string",code:"invalid_type",input:$.value,inst:X}),$}}),W0=O("$ZodStringFormat",(X,Q)=>{EX.init(X,Q),IX.init(X,Q)}),m9=O("$ZodGUID",(X,Q)=>{Q.pattern??(Q.pattern=ZW),W0.init(X,Q)}),c9=O("$ZodUUID",(X,Q)=>{if(Q.version){let Y={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[Q.version];if(Y===void 0)throw Error(`Invalid UUID version: "${Q.version}"`);Q.pattern??(Q.pattern=y9(Y))}else Q.pattern??(Q.pattern=y9());W0.init(X,Q)}),p9=O("$ZodEmail",(X,Q)=>{Q.pattern??(Q.pattern=CW),W0.init(X,Q)}),d9=O("$ZodURL",(X,Q)=>{W0.init(X,Q),X._zod.check=($)=>{try{let Y=$.value,W=new URL(Y),J=W.href;if(Q.hostname){if(Q.hostname.lastIndex=0,!Q.hostname.test(W.hostname))$.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:gW.source,input:$.value,inst:X,continue:!Q.abort})}if(Q.protocol){if(Q.protocol.lastIndex=0,!Q.protocol.test(W.protocol.endsWith(":")?W.protocol.slice(0,-1):W.protocol))$.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:Q.protocol.source,input:$.value,inst:X,continue:!Q.abort})}if(!Y.endsWith("/")&&J.endsWith("/"))$.value=J.slice(0,-1);else $.value=J;return}catch(Y){$.issues.push({code:"invalid_format",format:"url",input:$.value,inst:X,continue:!Q.abort})}}}),i9=O("$ZodEmoji",(X,Q)=>{Q.pattern??(Q.pattern=kW()),W0.init(X,Q)}),n9=O("$ZodNanoID",(X,Q)=>{Q.pattern??(Q.pattern=PW),W0.init(X,Q)}),r9=O("$ZodCUID",(X,Q)=>{Q.pattern??(Q.pattern=jW),W0.init(X,Q)}),o9=O("$ZodCUID2",(X,Q)=>{Q.pattern??(Q.pattern=RW),W0.init(X,Q)}),t9=O("$ZodULID",(X,Q)=>{Q.pattern??(Q.pattern=EW),W0.init(X,Q)}),a9=O("$ZodXID",(X,Q)=>{Q.pattern??(Q.pattern=IW),W0.init(X,Q)}),s9=O("$ZodKSUID",(X,Q)=>{Q.pattern??(Q.pattern=bW),W0.init(X,Q)}),MJ=O("$ZodISODateTime",(X,Q)=>{Q.pattern??(Q.pattern=cW(Q)),W0.init(X,Q)}),jJ=O("$ZodISODate",(X,Q)=>{Q.pattern??(Q.pattern=uW),W0.init(X,Q)}),RJ=O("$ZodISOTime",(X,Q)=>{Q.pattern??(Q.pattern=mW(Q)),W0.init(X,Q)}),EJ=O("$ZodISODuration",(X,Q)=>{Q.pattern??(Q.pattern=SW),W0.init(X,Q)}),e9=O("$ZodIPv4",(X,Q)=>{Q.pattern??(Q.pattern=vW),W0.init(X,Q),X._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv4"})}),XQ=O("$ZodIPv6",(X,Q)=>{Q.pattern??(Q.pattern=TW),W0.init(X,Q),X._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv6"}),X._zod.check=($)=>{try{new URL(`http://[${$.value}]`)}catch{$.issues.push({code:"invalid_format",format:"ipv6",input:$.value,inst:X,continue:!Q.abort})}}}),QQ=O("$ZodCIDRv4",(X,Q)=>{Q.pattern??(Q.pattern=_W),W0.init(X,Q)}),$Q=O("$ZodCIDRv6",(X,Q)=>{Q.pattern??(Q.pattern=xW),W0.init(X,Q),X._zod.check=($)=>{let[Y,W]=$.value.split("/");try{if(!W)throw Error();let J=Number(W);if(`${J}`!==W)throw Error();if(J<0||J>128)throw Error();new URL(`http://[${Y}]`)}catch{$.issues.push({code:"invalid_format",format:"cidrv6",input:$.value,inst:X,continue:!Q.abort})}}});function IJ(X){if(X==="")return!0;if(X.length%4!==0)return!1;try{return atob(X),!0}catch{return!1}}var YQ=O("$ZodBase64",(X,Q)=>{Q.pattern??(Q.pattern=yW),W0.init(X,Q),X._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64"}),X._zod.check=($)=>{if(IJ($.value))return;$.issues.push({code:"invalid_format",format:"base64",input:$.value,inst:X,continue:!Q.abort})}});function nV(X){if(!g9.test(X))return!1;let Q=X.replace(/[-_]/g,(Y)=>Y==="-"?"+":"/"),$=Q.padEnd(Math.ceil(Q.length/4)*4,"=");return IJ($)}var WQ=O("$ZodBase64URL",(X,Q)=>{Q.pattern??(Q.pattern=g9),W0.init(X,Q),X._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64url"}),X._zod.check=($)=>{if(nV($.value))return;$.issues.push({code:"invalid_format",format:"base64url",input:$.value,inst:X,continue:!Q.abort})}}),JQ=O("$ZodE164",(X,Q)=>{Q.pattern??(Q.pattern=fW),W0.init(X,Q)});function rV(X,Q=null){try{let $=X.split(".");if($.length!==3)return!1;let[Y]=$;if(!Y)return!1;let W=JSON.parse(atob(Y));if("typ"in W&&W?.typ!=="JWT")return!1;if(!W.alg)return!1;if(Q&&(!("alg"in W)||W.alg!==Q))return!1;return!0}catch{return!1}}var GQ=O("$ZodJWT",(X,Q)=>{W0.init(X,Q),X._zod.check=($)=>{if(rV($.value,Q.alg))return;$.issues.push({code:"invalid_format",format:"jwt",input:$.value,inst:X,continue:!Q.abort})}});var v4=O("$ZodNumber",(X,Q)=>{X0.init(X,Q),X._zod.pattern=X._zod.bag.pattern??iW,X._zod.parse=($,Y)=>{if(Q.coerce)try{$.value=Number($.value)}catch(G){}let W=$.value;if(typeof W==="number"&&!Number.isNaN(W)&&Number.isFinite(W))return $;let J=typeof W==="number"?Number.isNaN(W)?"NaN":!Number.isFinite(W)?"Infinity":void 0:void 0;return $.issues.push({expected:"number",code:"invalid_type",input:W,inst:X,...J?{received:J}:{}}),$}}),HQ=O("$ZodNumber",(X,Q)=>{eW.init(X,Q),v4.init(X,Q)}),BQ=O("$ZodBoolean",(X,Q)=>{X0.init(X,Q),X._zod.pattern=nW,X._zod.parse=($,Y)=>{if(Q.coerce)try{$.value=Boolean($.value)}catch(J){}let W=$.value;if(typeof W==="boolean")return $;return $.issues.push({expected:"boolean",code:"invalid_type",input:W,inst:X}),$}});var zQ=O("$ZodNull",(X,Q)=>{X0.init(X,Q),X._zod.pattern=rW,X._zod.values=new Set([null]),X._zod.parse=($,Y)=>{let W=$.value;if(W===null)return $;return $.issues.push({expected:"null",code:"invalid_type",input:W,inst:X}),$}});var KQ=O("$ZodUnknown",(X,Q)=>{X0.init(X,Q),X._zod.parse=($)=>$}),UQ=O("$ZodNever",(X,Q)=>{X0.init(X,Q),X._zod.parse=($,Y)=>{return $.issues.push({expected:"never",code:"invalid_type",input:$.value,inst:X}),$}});function VJ(X,Q,$){if(X.issues.length)Q.issues.push(...B1($,X.issues));Q.value[$]=X.value}var VQ=O("$ZodArray",(X,Q)=>{X0.init(X,Q),X._zod.parse=($,Y)=>{let W=$.value;if(!Array.isArray(W))return $.issues.push({expected:"array",code:"invalid_type",input:W,inst:X}),$;$.value=Array(W.length);let J=[];for(let G=0;G<W.length;G++){let H=W[G],B=Q.element._zod.run({value:H,issues:[]},Y);if(B instanceof Promise)J.push(B.then((z)=>VJ(z,$,G)));else VJ(B,$,G)}if(J.length)return Promise.all(J).then(()=>$);return $}});function k4(X,Q,$){if(X.issues.length)Q.issues.push(...B1($,X.issues));Q.value[$]=X.value}function LJ(X,Q,$,Y){if(X.issues.length)if(Y[$]===void 0)if($ in Y)Q.value[$]=void 0;else Q.value[$]=X.value;else Q.issues.push(...B1($,X.issues));else if(X.value===void 0){if($ in Y)Q.value[$]=void 0}else Q.value[$]=X.value}var T4=O("$ZodObject",(X,Q)=>{X0.init(X,Q);let $=AX(()=>{let V=Object.keys(Q.shape);for(let U of V)if(!(Q.shape[U]instanceof X0))throw Error(`Invalid element at key "${U}": expected a Zod schema`);let L=I9(Q.shape);return{shape:Q.shape,keys:V,keySet:new Set(V),numKeys:V.length,optionalKeys:new Set(L)}});Y0(X._zod,"propValues",()=>{let V=Q.shape,L={};for(let U in V){let F=V[U]._zod;if(F.values){L[U]??(L[U]=new Set);for(let q of F.values)L[U].add(q)}}return L});let Y=(V)=>{let L=new u9(["shape","payload","ctx"]),U=$.value,F=(M)=>{let R=s1(M);return`shape[${R}]._zod.run({ value: input[${R}], issues: [] }, ctx)`};L.write("const input = payload.value;");let q=Object.create(null),N=0;for(let M of U.keys)q[M]=`key_${N++}`;L.write("const newResult = {}");for(let M of U.keys)if(U.optionalKeys.has(M)){let R=q[M];L.write(`const ${R} = ${F(M)};`);let S=s1(M);L.write(`
         if (${R}.issues.length) {
@@ -52,5 +52,5 @@ Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.
 ]))`;continue}else if(Y[B]==="$"){W+=`($|(?=[\r
 ]))`;continue}}if($.s&&Y[B]==="."){W+=G?`${Y[B]}\r
 `:`[${Y[B]}\r
-]`;continue}if(W+=Y[B],Y[B]==="\\")J=!0;else if(G&&Y[B]==="]")G=!1;else if(!G&&Y[B]==="[")G=!0}try{new RegExp(W)}catch{return console.warn(`Could not convert regex pattern at ${Q.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),X.source}return W}function O8(X,Q){if(Q.target==="openAi")console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead.");if(Q.target==="openApi3"&&X.keyType?._def.typeName===j.ZodEnum)return{type:"object",required:X.keyType._def.values,properties:X.keyType._def.values.reduce((Y,W)=>({...Y,[W]:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"properties",W]})??B0(Q)}),{}),additionalProperties:Q.rejectedAdditionalProperties};let $={type:"object",additionalProperties:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"additionalProperties"]})??Q.allowedAdditionalProperties};if(Q.target==="openApi3")return $;if(X.keyType?._def.typeName===j.ZodString&&X.keyType._def.checks?.length){let{type:Y,...W}=N8(X.keyType._def,Q);return{...$,propertyNames:W}}else if(X.keyType?._def.typeName===j.ZodEnum)return{...$,propertyNames:{enum:X.keyType._def.values}};else if(X.keyType?._def.typeName===j.ZodBranded&&X.keyType._def.type._def.typeName===j.ZodString&&X.keyType._def.type._def.checks?.length){let{type:Y,...W}=F8(X.keyType._def,Q);return{...$,propertyNames:W}}return $}function y5(X,Q){if(Q.mapStrategy==="record")return O8(X,Q);let $=f(X.keyType._def,{...Q,currentPath:[...Q.currentPath,"items","items","0"]})||B0(Q),Y=f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"items","items","1"]})||B0(Q);return{type:"array",maxItems:125,items:{type:"array",items:[$,Y],minItems:2,maxItems:2}}}function g5(X){let Q=X.values,Y=Object.keys(X.values).filter((J)=>{return typeof Q[Q[J]]!=="number"}).map((J)=>Q[J]),W=Array.from(new Set(Y.map((J)=>typeof J)));return{type:W.length===1?W[0]==="string"?"string":"number":["string","number"],enum:Y}}function f5(X){return X.target==="openAi"?void 0:{not:B0({...X,currentPath:[...X.currentPath,"not"]})}}function h5(X){return X.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var gX={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function l5(X,Q){if(Q.target==="openApi3")return u5(X,Q);let $=X.options instanceof Map?Array.from(X.options.values()):X.options;if($.every((Y)=>(Y._def.typeName in gX)&&(!Y._def.checks||!Y._def.checks.length))){let Y=$.reduce((W,J)=>{let G=gX[J._def.typeName];return G&&!W.includes(G)?[...W,G]:W},[]);return{type:Y.length>1?Y:Y[0]}}else if($.every((Y)=>Y._def.typeName==="ZodLiteral"&&!Y.description)){let Y=$.reduce((W,J)=>{let G=typeof J._def.value;switch(G){case"string":case"number":case"boolean":return[...W,G];case"bigint":return[...W,"integer"];case"object":if(J._def.value===null)return[...W,"null"];case"symbol":case"undefined":case"function":default:return W}},[]);if(Y.length===$.length){let W=Y.filter((J,G,H)=>H.indexOf(J)===G);return{type:W.length>1?W:W[0],enum:$.reduce((J,G)=>{return J.includes(G._def.value)?J:[...J,G._def.value]},[])}}}else if($.every((Y)=>Y._def.typeName==="ZodEnum"))return{type:"string",enum:$.reduce((Y,W)=>[...Y,...W._def.values.filter((J)=>!Y.includes(J))],[])};return u5(X,Q)}var u5=(X,Q)=>{let $=(X.options instanceof Map?Array.from(X.options.values()):X.options).map((Y,W)=>f(Y._def,{...Q,currentPath:[...Q.currentPath,"anyOf",`${W}`]})).filter((Y)=>!!Y&&(!Q.strictUnions||typeof Y==="object"&&Object.keys(Y).length>0));return $.length?{anyOf:$}:void 0};function m5(X,Q){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(X.innerType._def.typeName)&&(!X.innerType._def.checks||!X.innerType._def.checks.length)){if(Q.target==="openApi3")return{type:gX[X.innerType._def.typeName],nullable:!0};return{type:[gX[X.innerType._def.typeName],"null"]}}if(Q.target==="openApi3"){let Y=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath]});if(Y&&"$ref"in Y)return{allOf:[Y],nullable:!0};return Y&&{...Y,nullable:!0}}let $=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath,"anyOf","0"]});return $&&{anyOf:[$,{type:"null"}]}}function c5(X,Q){let $={type:"number"};if(!X.checks)return $;for(let Y of X.checks)switch(Y.kind){case"int":$.type="integer",m$($,"type",Y.message,Q);break;case"min":if(Q.target==="jsonSchema7")if(Y.inclusive)o($,"minimum",Y.value,Y.message,Q);else o($,"exclusiveMinimum",Y.value,Y.message,Q);else{if(!Y.inclusive)$.exclusiveMinimum=!0;o($,"minimum",Y.value,Y.message,Q)}break;case"max":if(Q.target==="jsonSchema7")if(Y.inclusive)o($,"maximum",Y.value,Y.message,Q);else o($,"exclusiveMaximum",Y.value,Y.message,Q);else{if(!Y.inclusive)$.exclusiveMaximum=!0;o($,"maximum",Y.value,Y.message,Q)}break;case"multipleOf":o($,"multipleOf",Y.value,Y.message,Q);break}return $}function p5(X,Q){let $=Q.target==="openAi",Y={type:"object",properties:{}},W=[],J=X.shape();for(let H in J){let B=J[H];if(B===void 0||B._def===void 0)continue;let z=zN(B);if(z&&$){if(B._def.typeName==="ZodOptional")B=B._def.innerType;if(!B.isNullable())B=B.nullable();z=!1}let K=f(B._def,{...Q,currentPath:[...Q.currentPath,"properties",H],propertyPath:[...Q.currentPath,"properties",H]});if(K===void 0)continue;if(Y.properties[H]=K,!z)W.push(H)}if(W.length)Y.required=W;let G=BN(X,Q);if(G!==void 0)Y.additionalProperties=G;return Y}function BN(X,Q){if(X.catchall._def.typeName!=="ZodNever")return f(X.catchall._def,{...Q,currentPath:[...Q.currentPath,"additionalProperties"]});switch(X.unknownKeys){case"passthrough":return Q.allowedAdditionalProperties;case"strict":return Q.rejectedAdditionalProperties;case"strip":return Q.removeAdditionalStrategy==="strict"?Q.allowedAdditionalProperties:Q.rejectedAdditionalProperties}}function zN(X){try{return X.isOptional()}catch{return!0}}var d5=(X,Q)=>{if(Q.currentPath.toString()===Q.propertyPath?.toString())return f(X.innerType._def,Q);let $=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath,"anyOf","1"]});return $?{anyOf:[{not:B0(Q)},$]}:B0(Q)};var i5=(X,Q)=>{if(Q.pipeStrategy==="input")return f(X.in._def,Q);else if(Q.pipeStrategy==="output")return f(X.out._def,Q);let $=f(X.in._def,{...Q,currentPath:[...Q.currentPath,"allOf","0"]}),Y=f(X.out._def,{...Q,currentPath:[...Q.currentPath,"allOf",$?"1":"0"]});return{allOf:[$,Y].filter((W)=>W!==void 0)}};function n5(X,Q){return f(X.type._def,Q)}function r5(X,Q){let Y={type:"array",uniqueItems:!0,items:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"items"]})};if(X.minSize)o(Y,"minItems",X.minSize.value,X.minSize.message,Q);if(X.maxSize)o(Y,"maxItems",X.maxSize.value,X.maxSize.message,Q);return Y}function o5(X,Q){if(X.rest)return{type:"array",minItems:X.items.length,items:X.items.map(($,Y)=>f($._def,{...Q,currentPath:[...Q.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[]),additionalItems:f(X.rest._def,{...Q,currentPath:[...Q.currentPath,"additionalItems"]})};else return{type:"array",minItems:X.items.length,maxItems:X.items.length,items:X.items.map(($,Y)=>f($._def,{...Q,currentPath:[...Q.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[])}}function t5(X){return{not:B0(X)}}function a5(X){return B0(X)}var s5=(X,Q)=>{return f(X.innerType._def,Q)};var e5=(X,Q,$)=>{switch(Q){case j.ZodString:return N8(X,$);case j.ZodNumber:return c5(X,$);case j.ZodObject:return p5(X,$);case j.ZodBigInt:return P5(X,$);case j.ZodBoolean:return S5();case j.ZodDate:return c$(X,$);case j.ZodUndefined:return t5($);case j.ZodNull:return h5($);case j.ZodArray:return b5(X,$);case j.ZodUnion:case j.ZodDiscriminatedUnion:return l5(X,$);case j.ZodIntersection:return T5(X,$);case j.ZodTuple:return o5(X,$);case j.ZodRecord:return O8(X,$);case j.ZodLiteral:return _5(X,$);case j.ZodEnum:return v5(X);case j.ZodNativeEnum:return g5(X);case j.ZodNullable:return m5(X,$);case j.ZodOptional:return d5(X,$);case j.ZodMap:return y5(X,$);case j.ZodSet:return r5(X,$);case j.ZodLazy:return()=>X.getter()._def;case j.ZodPromise:return n5(X,$);case j.ZodNaN:case j.ZodNever:return f5($);case j.ZodEffects:return k5(X,$);case j.ZodAny:return B0($);case j.ZodUnknown:return a5($);case j.ZodDefault:return C5(X,$);case j.ZodBranded:return F8(X,$);case j.ZodReadonly:return s5(X,$);case j.ZodCatch:return Z5(X,$);case j.ZodPipeline:return i5(X,$);case j.ZodFunction:case j.ZodVoid:case j.ZodSymbol:return;default:return((Y)=>{return})(Q)}};function f(X,Q,$=!1){let Y=Q.seen.get(X);if(Q.override){let H=Q.override?.(X,Q,Y,$);if(H!==R5)return H}if(Y&&!$){let H=KN(Y,Q);if(H!==void 0)return H}let W={def:X,path:Q.currentPath,jsonSchema:void 0};Q.seen.set(X,W);let J=e5(X,X.typeName,Q),G=typeof J==="function"?f(J(),Q):J;if(G)UN(X,Q,G);if(Q.postProcess){let H=Q.postProcess(G,X,Q);return W.jsonSchema=G,H}return W.jsonSchema=G,G}var KN=(X,Q)=>{switch(Q.$refStrategy){case"root":return{$ref:X.path.join("/")};case"relative":return{$ref:q8(Q.currentPath,X.path)};case"none":case"seen":{if(X.path.length<Q.currentPath.length&&X.path.every(($,Y)=>Q.currentPath[Y]===$))return console.warn(`Recursive reference detected at ${Q.currentPath.join("/")}! Defaulting to any`),B0(Q);return Q.$refStrategy==="seen"?B0(Q):void 0}}},UN=(X,Q,$)=>{if(X.description){if($.description=X.description,Q.markdownDescription)$.markdownDescription=X.description}return $};var i$=(X,Q)=>{let $=I5(Q),Y=typeof Q==="object"&&Q.definitions?Object.entries(Q.definitions).reduce((B,[z,K])=>({...B,[z]:f(K._def,{...$,currentPath:[...$.basePath,$.definitionPath,z]},!0)??B0($)}),{}):void 0,W=typeof Q==="string"?Q:Q?.nameStrategy==="title"?void 0:Q?.name,J=f(X._def,W===void 0?$:{...$,currentPath:[...$.basePath,$.definitionPath,W]},!1)??B0($),G=typeof Q==="object"&&Q.name!==void 0&&Q.nameStrategy==="title"?Q.name:void 0;if(G!==void 0)J.title=G;if($.flags.hasReferencedOpenAiAnyType){if(!Y)Y={};if(!Y[$.openAiAnyTypeName])Y[$.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:$.$refStrategy==="relative"?"1":[...$.basePath,$.definitionPath,$.openAiAnyTypeName].join("/")}}}let H=W===void 0?Y?{...J,[$.definitionPath]:Y}:J:{$ref:[...$.$refStrategy==="relative"?[]:$.basePath,$.definitionPath,W].join("/"),[$.definitionPath]:{...Y,[W]:J}};if($.target==="jsonSchema7")H.$schema="http://json-schema.org/draft-07/schema#";else if($.target==="jsonSchema2019-09"||$.target==="openAi")H.$schema="https://json-schema.org/draft/2019-09/schema#";if($.target==="openAi"&&(("anyOf"in H)||("oneOf"in H)||("allOf"in H)||("type"in H)&&Array.isArray(H.type)))console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property.");return H};function VN(X){if(!X)return"draft-7";if(X==="jsonSchema7"||X==="draft-7")return"draft-7";if(X==="jsonSchema2019-09"||X==="draft-2020-12")return"draft-2020-12";return"draft-7"}function n$(X,Q){var $,Y,W;if(m0(X))return N$(X,{target:VN(Q===null||Q===void 0?void 0:Q.target),io:($=Q===null||Q===void 0?void 0:Q.pipeStrategy)!==null&&$!==void 0?$:"input"});return i$(X,{strictUnions:(Y=Q===null||Q===void 0?void 0:Q.strictUnions)!==null&&Y!==void 0?Y:!0,pipeStrategy:(W=Q===null||Q===void 0?void 0:Q.pipeStrategy)!==null&&W!==void 0?W:"input"})}function r$(X){let Q=h1(X),$=Q===null||Q===void 0?void 0:Q.method;if(!$)throw Error("Schema is missing a method literal");let Y=p4($);if(typeof Y!=="string")throw Error("Schema method literal must be a string");return Y}function o$(X,Q){let $=f1(X,Q);if(!$.success)throw $.error;return $.data}var LN=60000;class t${constructor(X){if(this._options=X,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(a4,(Q)=>{this._oncancel(Q)}),this.setNotificationHandler(e4,(Q)=>{this._onprogress(Q)}),this.setRequestHandler(s4,(Q)=>({})),this._taskStore=X===null||X===void 0?void 0:X.taskStore,this._taskMessageQueue=X===null||X===void 0?void 0:X.taskMessageQueue,this._taskStore)this.setRequestHandler(X8,async(Q,$)=>{let Y=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!Y)throw new k(x.InvalidParams,"Failed to retrieve task: Task not found");return{...Y}}),this.setRequestHandler($8,async(Q,$)=>{let Y=async()=>{var W;let J=Q.params.taskId;if(this._taskMessageQueue){let H;while(H=await this._taskMessageQueue.dequeue(J,$.sessionId)){if(H.type==="response"||H.type==="error"){let B=H.message,z=B.id,K=this._requestResolvers.get(z);if(K)if(this._requestResolvers.delete(z),H.type==="response")K(B);else{let V=B,L=new k(V.error.code,V.error.message,V.error.data);K(L)}else{let V=H.type==="response"?"Response":"Error";this._onerror(Error(`${V} handler missing for request ${z}`))}continue}await((W=this._transport)===null||W===void 0?void 0:W.send(H.message,{relatedRequestId:$.requestId}))}}let G=await this._taskStore.getTask(J,$.sessionId);if(!G)throw new k(x.InvalidParams,`Task not found: ${J}`);if(!u1(G.status))return await this._waitForTaskUpdate(J,$.signal),await Y();if(u1(G.status)){let H=await this._taskStore.getTaskResult(J,$.sessionId);return this._clearTaskQueue(J),{...H,_meta:{...H._meta,[K1]:{taskId:J}}}}return await Y()};return await Y()}),this.setRequestHandler(Y8,async(Q,$)=>{var Y;try{let{tasks:W,nextCursor:J}=await this._taskStore.listTasks((Y=Q.params)===null||Y===void 0?void 0:Y.cursor,$.sessionId);return{tasks:W,nextCursor:J,_meta:{}}}catch(W){throw new k(x.InvalidParams,`Failed to list tasks: ${W instanceof Error?W.message:String(W)}`)}}),this.setRequestHandler(V5,async(Q,$)=>{try{let Y=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!Y)throw new k(x.InvalidParams,`Task not found: ${Q.params.taskId}`);if(u1(Y.status))throw new k(x.InvalidParams,`Cannot cancel task in terminal status: ${Y.status}`);await this._taskStore.updateTaskStatus(Q.params.taskId,"cancelled","Client cancelled task execution.",$.sessionId),this._clearTaskQueue(Q.params.taskId);let W=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!W)throw new k(x.InvalidParams,`Task not found after cancellation: ${Q.params.taskId}`);return{_meta:{},...W}}catch(Y){if(Y instanceof k)throw Y;throw new k(x.InvalidRequest,`Failed to cancel task: ${Y instanceof Error?Y.message:String(Y)}`)}})}async _oncancel(X){let Q=this._requestHandlerAbortControllers.get(X.params.requestId);Q===null||Q===void 0||Q.abort(X.params.reason)}_setupTimeout(X,Q,$,Y,W=!1){this._timeoutInfo.set(X,{timeoutId:setTimeout(Y,Q),startTime:Date.now(),timeout:Q,maxTotalTimeout:$,resetTimeoutOnProgress:W,onTimeout:Y})}_resetTimeout(X){let Q=this._timeoutInfo.get(X);if(!Q)return!1;let $=Date.now()-Q.startTime;if(Q.maxTotalTimeout&&$>=Q.maxTotalTimeout)throw this._timeoutInfo.delete(X),k.fromError(x.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:Q.maxTotalTimeout,totalElapsed:$});return clearTimeout(Q.timeoutId),Q.timeoutId=setTimeout(Q.onTimeout,Q.timeout),!0}_cleanupTimeout(X){let Q=this._timeoutInfo.get(X);if(Q)clearTimeout(Q.timeoutId),this._timeoutInfo.delete(X)}async connect(X){var Q,$,Y;this._transport=X;let W=(Q=this.transport)===null||Q===void 0?void 0:Q.onclose;this._transport.onclose=()=>{W===null||W===void 0||W(),this._onclose()};let J=($=this.transport)===null||$===void 0?void 0:$.onerror;this._transport.onerror=(H)=>{J===null||J===void 0||J(H),this._onerror(H)};let G=(Y=this._transport)===null||Y===void 0?void 0:Y.onmessage;this._transport.onmessage=(H,B)=>{if(G===null||G===void 0||G(H,B),CX(H)||K5(H))this._onresponse(H);else if(Z$(H))this._onrequest(H,B);else if(H5(H))this._onnotification(H);else this._onerror(Error(`Unknown message type: ${JSON.stringify(H)}`))},await this._transport.start()}_onclose(){var X;let Q=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let $=k.fromError(x.ConnectionClosed,"Connection closed");this._transport=void 0,(X=this.onclose)===null||X===void 0||X.call(this);for(let Y of Q.values())Y($)}_onerror(X){var Q;(Q=this.onerror)===null||Q===void 0||Q.call(this,X)}_onnotification(X){var Q;let $=(Q=this._notificationHandlers.get(X.method))!==null&&Q!==void 0?Q:this.fallbackNotificationHandler;if($===void 0)return;Promise.resolve().then(()=>$(X)).catch((Y)=>this._onerror(Error(`Uncaught error in notification handler: ${Y}`)))}_onrequest(X,Q){var $,Y,W,J,G,H;let B=($=this._requestHandlers.get(X.method))!==null&&$!==void 0?$:this.fallbackRequestHandler,z=this._transport,K=(J=(W=(Y=X.params)===null||Y===void 0?void 0:Y._meta)===null||W===void 0?void 0:W[K1])===null||J===void 0?void 0:J.taskId;if(B===void 0){let q={jsonrpc:"2.0",id:X.id,error:{code:x.MethodNotFound,message:"Method not found"}};if(K&&this._taskMessageQueue)this._enqueueTaskMessage(K,{type:"error",message:q,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId).catch((N)=>this._onerror(Error(`Failed to enqueue error response: ${N}`)));else z===null||z===void 0||z.send(q).catch((N)=>this._onerror(Error(`Failed to send an error response: ${N}`)));return}let V=new AbortController;this._requestHandlerAbortControllers.set(X.id,V);let L=(G=X.params)===null||G===void 0?void 0:G.task,U=this._taskStore?this.requestTaskStore(X,z===null||z===void 0?void 0:z.sessionId):void 0,F={signal:V.signal,sessionId:z===null||z===void 0?void 0:z.sessionId,_meta:(H=X.params)===null||H===void 0?void 0:H._meta,sendNotification:async(q)=>{let N={relatedRequestId:X.id};if(K)N.relatedTask={taskId:K};await this.notification(q,N)},sendRequest:async(q,N,A)=>{var M,R;let S={...A,relatedRequestId:X.id};if(K&&!S.relatedTask)S.relatedTask={taskId:K};let C=(R=(M=S.relatedTask)===null||M===void 0?void 0:M.taskId)!==null&&R!==void 0?R:K;if(C&&U)await U.updateTaskStatus(C,"input_required");return await this.request(q,N,S)},authInfo:Q===null||Q===void 0?void 0:Q.authInfo,requestId:X.id,requestInfo:Q===null||Q===void 0?void 0:Q.requestInfo,taskId:K,taskStore:U,taskRequestedTtl:L===null||L===void 0?void 0:L.ttl,closeSSEStream:Q===null||Q===void 0?void 0:Q.closeSSEStream,closeStandaloneSSEStream:Q===null||Q===void 0?void 0:Q.closeStandaloneSSEStream};Promise.resolve().then(()=>{if(L)this.assertTaskHandlerCapability(X.method)}).then(()=>B(X,F)).then(async(q)=>{if(V.signal.aborted)return;let N={result:q,jsonrpc:"2.0",id:X.id};if(K&&this._taskMessageQueue)await this._enqueueTaskMessage(K,{type:"response",message:N,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId);else await(z===null||z===void 0?void 0:z.send(N))},async(q)=>{var N;if(V.signal.aborted)return;let A={jsonrpc:"2.0",id:X.id,error:{code:Number.isSafeInteger(q.code)?q.code:x.InternalError,message:(N=q.message)!==null&&N!==void 0?N:"Internal error",...q.data!==void 0&&{data:q.data}}};if(K&&this._taskMessageQueue)await this._enqueueTaskMessage(K,{type:"error",message:A,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId);else await(z===null||z===void 0?void 0:z.send(A))}).catch((q)=>this._onerror(Error(`Failed to send response: ${q}`))).finally(()=>{this._requestHandlerAbortControllers.delete(X.id)})}_onprogress(X){let{progressToken:Q,...$}=X.params,Y=Number(Q),W=this._progressHandlers.get(Y);if(!W){this._onerror(Error(`Received a progress notification for an unknown token: ${JSON.stringify(X)}`));return}let J=this._responseHandlers.get(Y),G=this._timeoutInfo.get(Y);if(G&&J&&G.resetTimeoutOnProgress)try{this._resetTimeout(Y)}catch(H){this._responseHandlers.delete(Y),this._progressHandlers.delete(Y),this._cleanupTimeout(Y),J(H);return}W($)}_onresponse(X){let Q=Number(X.id),$=this._requestResolvers.get(Q);if($){if(this._requestResolvers.delete(Q),CX(X))$(X);else{let J=new k(X.error.code,X.error.message,X.error.data);$(J)}return}let Y=this._responseHandlers.get(Q);if(Y===void 0){this._onerror(Error(`Received a response for an unknown message ID: ${JSON.stringify(X)}`));return}this._responseHandlers.delete(Q),this._cleanupTimeout(Q);let W=!1;if(CX(X)&&X.result&&typeof X.result==="object"){let J=X.result;if(J.task&&typeof J.task==="object"){let G=J.task;if(typeof G.taskId==="string")W=!0,this._taskProgressTokens.set(G.taskId,Q)}}if(!W)this._progressHandlers.delete(Q);if(CX(X))Y(X);else{let J=k.fromError(X.error.code,X.error.message,X.error.data);Y(J)}}get transport(){return this._transport}async close(){var X;await((X=this._transport)===null||X===void 0?void 0:X.close())}async*requestStream(X,Q,$){var Y,W,J,G;let{task:H}=$!==null&&$!==void 0?$:{};if(!H){try{yield{type:"result",result:await this.request(X,Q,$)}}catch(z){yield{type:"error",error:z instanceof k?z:new k(x.InternalError,String(z))}}return}let B;try{let z=await this.request(X,x6,$);if(z.task)B=z.task.taskId,yield{type:"taskCreated",task:z.task};else throw new k(x.InternalError,"Task creation did not return a task");while(!0){let K=await this.getTask({taskId:B},$);if(yield{type:"taskStatus",task:K},u1(K.status)){if(K.status==="completed")yield{type:"result",result:await this.getTaskResult({taskId:B},Q,$)};else if(K.status==="failed")yield{type:"error",error:new k(x.InternalError,`Task ${B} failed`)};else if(K.status==="cancelled")yield{type:"error",error:new k(x.InternalError,`Task ${B} was cancelled`)};return}if(K.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:B},Q,$)};return}let V=(J=(Y=K.pollInterval)!==null&&Y!==void 0?Y:(W=this._options)===null||W===void 0?void 0:W.defaultTaskPollInterval)!==null&&J!==void 0?J:1000;await new Promise((L)=>setTimeout(L,V)),(G=$===null||$===void 0?void 0:$.signal)===null||G===void 0||G.throwIfAborted()}}catch(z){yield{type:"error",error:z instanceof k?z:new k(x.InternalError,String(z))}}}request(X,Q,$){let{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J,task:G,relatedTask:H}=$!==null&&$!==void 0?$:{};return new Promise((B,z)=>{var K,V,L,U,F,q,N;let A=(s)=>{z(s)};if(!this._transport){A(Error("Not connected"));return}if(((K=this._options)===null||K===void 0?void 0:K.enforceStrictCapabilities)===!0)try{if(this.assertCapabilityForMethod(X.method),G)this.assertTaskCapability(X.method)}catch(s){A(s);return}(V=$===null||$===void 0?void 0:$.signal)===null||V===void 0||V.throwIfAborted();let M=this._requestMessageId++,R={...X,jsonrpc:"2.0",id:M};if($===null||$===void 0?void 0:$.onprogress)this._progressHandlers.set(M,$.onprogress),R.params={...X.params,_meta:{...((L=X.params)===null||L===void 0?void 0:L._meta)||{},progressToken:M}};if(G)R.params={...R.params,task:G};if(H)R.params={...R.params,_meta:{...((U=R.params)===null||U===void 0?void 0:U._meta)||{},[K1]:H}};let S=(s)=>{var D0;this._responseHandlers.delete(M),this._progressHandlers.delete(M),this._cleanupTimeout(M),(D0=this._transport)===null||D0===void 0||D0.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:M,reason:String(s)}},{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J}).catch((W1)=>this._onerror(Error(`Failed to send cancellation: ${W1}`)));let q0=s instanceof k?s:new k(x.RequestTimeout,String(s));z(q0)};this._responseHandlers.set(M,(s)=>{var D0;if((D0=$===null||$===void 0?void 0:$.signal)===null||D0===void 0?void 0:D0.aborted)return;if(s instanceof Error)return z(s);try{let q0=f1(Q,s.result);if(!q0.success)z(q0.error);else B(q0.data)}catch(q0){z(q0)}}),(F=$===null||$===void 0?void 0:$.signal)===null||F===void 0||F.addEventListener("abort",()=>{var s;S((s=$===null||$===void 0?void 0:$.signal)===null||s===void 0?void 0:s.reason)});let C=(q=$===null||$===void 0?void 0:$.timeout)!==null&&q!==void 0?q:LN,K0=()=>S(k.fromError(x.RequestTimeout,"Request timed out",{timeout:C}));this._setupTimeout(M,C,$===null||$===void 0?void 0:$.maxTotalTimeout,K0,(N=$===null||$===void 0?void 0:$.resetTimeoutOnProgress)!==null&&N!==void 0?N:!1);let U0=H===null||H===void 0?void 0:H.taskId;if(U0){let s=(D0)=>{let q0=this._responseHandlers.get(M);if(q0)q0(D0);else this._onerror(Error(`Response handler missing for side-channeled request ${M}`))};this._requestResolvers.set(M,s),this._enqueueTaskMessage(U0,{type:"request",message:R,timestamp:Date.now()}).catch((D0)=>{this._cleanupTimeout(M),z(D0)})}else this._transport.send(R,{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J}).catch((s)=>{this._cleanupTimeout(M),z(s)})})}async getTask(X,Q){return this.request({method:"tasks/get",params:X},Q8,Q)}async getTaskResult(X,Q,$){return this.request({method:"tasks/result",params:X},Q,$)}async listTasks(X,Q){return this.request({method:"tasks/list",params:X},W8,Q)}async cancelTask(X,Q){return this.request({method:"tasks/cancel",params:X},L5,Q)}async notification(X,Q){var $,Y,W,J,G;if(!this._transport)throw Error("Not connected");this.assertNotificationCapability(X.method);let H=($=Q===null||Q===void 0?void 0:Q.relatedTask)===null||$===void 0?void 0:$.taskId;if(H){let V={...X,jsonrpc:"2.0",params:{...X.params,_meta:{...((Y=X.params)===null||Y===void 0?void 0:Y._meta)||{},[K1]:Q.relatedTask}}};await this._enqueueTaskMessage(H,{type:"notification",message:V,timestamp:Date.now()});return}if(((J=(W=this._options)===null||W===void 0?void 0:W.debouncedNotificationMethods)!==null&&J!==void 0?J:[]).includes(X.method)&&!X.params&&!(Q===null||Q===void 0?void 0:Q.relatedRequestId)&&!(Q===null||Q===void 0?void 0:Q.relatedTask)){if(this._pendingDebouncedNotifications.has(X.method))return;this._pendingDebouncedNotifications.add(X.method),Promise.resolve().then(()=>{var V,L;if(this._pendingDebouncedNotifications.delete(X.method),!this._transport)return;let U={...X,jsonrpc:"2.0"};if(Q===null||Q===void 0?void 0:Q.relatedTask)U={...U,params:{...U.params,_meta:{...((V=U.params)===null||V===void 0?void 0:V._meta)||{},[K1]:Q.relatedTask}}};(L=this._transport)===null||L===void 0||L.send(U,Q).catch((F)=>this._onerror(F))});return}let K={...X,jsonrpc:"2.0"};if(Q===null||Q===void 0?void 0:Q.relatedTask)K={...K,params:{...K.params,_meta:{...((G=K.params)===null||G===void 0?void 0:G._meta)||{},[K1]:Q.relatedTask}}};await this._transport.send(K,Q)}setRequestHandler(X,Q){let $=r$(X);this.assertRequestHandlerCapability($),this._requestHandlers.set($,(Y,W)=>{let J=o$(X,Y);return Promise.resolve(Q(J,W))})}removeRequestHandler(X){this._requestHandlers.delete(X)}assertCanSetRequestHandler(X){if(this._requestHandlers.has(X))throw Error(`A request handler for ${X} already exists, which would be overridden`)}setNotificationHandler(X,Q){let $=r$(X);this._notificationHandlers.set($,(Y)=>{let W=o$(X,Y);return Promise.resolve(Q(W))})}removeNotificationHandler(X){this._notificationHandlers.delete(X)}_cleanupTaskProgressHandler(X){let Q=this._taskProgressTokens.get(X);if(Q!==void 0)this._progressHandlers.delete(Q),this._taskProgressTokens.delete(X)}async _enqueueTaskMessage(X,Q,$){var Y;if(!this._taskStore||!this._taskMessageQueue)throw Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let W=(Y=this._options)===null||Y===void 0?void 0:Y.maxTaskQueueSize;await this._taskMessageQueue.enqueue(X,Q,$,W)}async _clearTaskQueue(X,Q){if(this._taskMessageQueue){let $=await this._taskMessageQueue.dequeueAll(X,Q);for(let Y of $)if(Y.type==="request"&&Z$(Y.message)){let W=Y.message.id,J=this._requestResolvers.get(W);if(J)J(new k(x.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(W);else this._onerror(Error(`Resolver missing for request ${W} during task ${X} cleanup`))}}}async _waitForTaskUpdate(X,Q){var $,Y,W;let J=(Y=($=this._options)===null||$===void 0?void 0:$.defaultTaskPollInterval)!==null&&Y!==void 0?Y:1000;try{let G=await((W=this._taskStore)===null||W===void 0?void 0:W.getTask(X));if(G===null||G===void 0?void 0:G.pollInterval)J=G.pollInterval}catch(G){}return new Promise((G,H)=>{if(Q.aborted){H(new k(x.InvalidRequest,"Request cancelled"));return}let B=setTimeout(G,J);Q.addEventListener("abort",()=>{clearTimeout(B),H(new k(x.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(X,Q){let $=this._taskStore;if(!$)throw Error("No task store configured");return{createTask:async(Y)=>{if(!X)throw Error("No request provided");return await $.createTask(Y,X.id,{method:X.method,params:X.params},Q)},getTask:async(Y)=>{let W=await $.getTask(Y,Q);if(!W)throw new k(x.InvalidParams,"Failed to retrieve task: Task not found");return W},storeTaskResult:async(Y,W,J)=>{await $.storeTaskResult(Y,W,J,Q);let G=await $.getTask(Y,Q);if(G){let H=xX.parse({method:"notifications/tasks/status",params:G});if(await this.notification(H),u1(G.status))this._cleanupTaskProgressHandler(Y)}},getTaskResult:(Y)=>{return $.getTaskResult(Y,Q)},updateTaskStatus:async(Y,W,J)=>{let G=await $.getTask(Y,Q);if(!G)throw new k(x.InvalidParams,`Task "${Y}" not found - it may have been cleaned up`);if(u1(G.status))throw new k(x.InvalidParams,`Cannot update task "${Y}" from terminal status "${G.status}" to "${W}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await $.updateTaskStatus(Y,W,J,Q);let H=await $.getTask(Y,Q);if(H){let B=xX.parse({method:"notifications/tasks/status",params:H});if(await this.notification(B),u1(H.status))this._cleanupTaskProgressHandler(Y)}},listTasks:(Y)=>{return $.listTasks(Y,Q)}}}}function XG(X){return X!==null&&typeof X==="object"&&!Array.isArray(X)}function QG(X,Q){let $={...X};for(let Y in Q){let W=Y,J=Q[W];if(J===void 0)continue;let G=$[W];if(XG(G)&&XG(J))$[W]={...G,...J};else $[W]=J}return $}var fz=K7(cY(),1),hz=K7(gz(),1);function ME(){let X=new fz.Ajv({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return hz.default(X),X}class eY{constructor(X){this._ajv=X!==null&&X!==void 0?X:ME()}getValidator(X){var Q;let $="$id"in X&&typeof X.$id==="string"?(Q=this._ajv.getSchema(X.$id))!==null&&Q!==void 0?Q:this._ajv.compile(X):this._ajv.compile(X);return(Y)=>{if($(Y))return{valid:!0,data:Y,errorMessage:void 0};else return{valid:!1,data:void 0,errorMessage:this._ajv.errorsText($.errors)}}}}class X7{constructor(X){this._server=X}requestStream(X,Q,$){return this._server.requestStream(X,Q,$)}async getTask(X,Q){return this._server.getTask({taskId:X},Q)}async getTaskResult(X,Q,$){return this._server.getTaskResult({taskId:X},Q,$)}async listTasks(X,Q){return this._server.listTasks(X?{cursor:X}:void 0,Q)}async cancelTask(X,Q){return this._server.cancelTask({taskId:X},Q)}}function uz(X,Q,$){var Y;if(!X)throw Error(`${$} does not support task creation (required for ${Q})`);switch(Q){case"tools/call":if(!((Y=X.tools)===null||Y===void 0?void 0:Y.call))throw Error(`${$} does not support task creation for tools/call (required for ${Q})`);break;default:break}}function lz(X,Q,$){var Y,W;if(!X)throw Error(`${$} does not support task creation (required for ${Q})`);switch(Q){case"sampling/createMessage":if(!((Y=X.sampling)===null||Y===void 0?void 0:Y.createMessage))throw Error(`${$} does not support task creation for sampling/createMessage (required for ${Q})`);break;case"elicitation/create":if(!((W=X.elicitation)===null||W===void 0?void 0:W.create))throw Error(`${$} does not support task creation for elicitation/create (required for ${Q})`);break;default:break}}class Q7 extends t${constructor(X,Q){var $,Y;super(Q);if(this._serverInfo=X,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(yX.options.map((W,J)=>[W,J])),this.isMessageIgnored=(W,J)=>{let G=this._loggingLevels.get(J);return G?this.LOG_LEVEL_SEVERITY.get(W)<this.LOG_LEVEL_SEVERITY.get(G):!1},this._capabilities=($=Q===null||Q===void 0?void 0:Q.capabilities)!==null&&$!==void 0?$:{},this._instructions=Q===null||Q===void 0?void 0:Q.instructions,this._jsonSchemaValidator=(Y=Q===null||Q===void 0?void 0:Q.jsonSchemaValidator)!==null&&Y!==void 0?Y:new eY,this.setRequestHandler(C$,(W)=>this._oninitialize(W)),this.setNotificationHandler(k$,()=>{var W;return(W=this.oninitialized)===null||W===void 0?void 0:W.call(this)}),this._capabilities.logging)this.setRequestHandler(f$,async(W,J)=>{var G;let H=J.sessionId||((G=J.requestInfo)===null||G===void 0?void 0:G.headers["mcp-session-id"])||void 0,{level:B}=W.params,z=yX.safeParse(B);if(z.success)this._loggingLevels.set(H,z.data);return{}})}get experimental(){if(!this._experimental)this._experimental={tasks:new X7(this)};return this._experimental}registerCapabilities(X){if(this.transport)throw Error("Cannot register capabilities after connecting to transport");this._capabilities=QG(this._capabilities,X)}setRequestHandler(X,Q){var $,Y,W;let J=h1(X),G=J===null||J===void 0?void 0:J.method;if(!G)throw Error("Schema is missing a method literal");let H;if(m0(G)){let z=G,K=($=z._zod)===null||$===void 0?void 0:$.def;H=(Y=K===null||K===void 0?void 0:K.value)!==null&&Y!==void 0?Y:z.value}else{let z=G,K=z._def;H=(W=K===null||K===void 0?void 0:K.value)!==null&&W!==void 0?W:z.value}if(typeof H!=="string")throw Error("Schema method literal must be a string");if(H==="tools/call"){let z=async(K,V)=>{let L=f1(g6,K);if(!L.success){let N=L.error instanceof Error?L.error.message:String(L.error);throw new k(x.InvalidParams,`Invalid tools/call request: ${N}`)}let{params:U}=L.data,F=await Promise.resolve(Q(K,V));if(U.task){let N=f1(x6,F);if(!N.success){let A=N.error instanceof Error?N.error.message:String(N.error);throw new k(x.InvalidParams,`Invalid task creation result: ${A}`)}return N.data}let q=f1(U8,F);if(!q.success){let N=q.error instanceof Error?q.error.message:String(q.error);throw new k(x.InvalidParams,`Invalid tools/call result: ${N}`)}return q.data};return super.setRequestHandler(X,z)}return super.setRequestHandler(X,Q)}assertCapabilityForMethod(X){var Q,$,Y;switch(X){case"sampling/createMessage":if(!((Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.sampling))throw Error(`Client does not support sampling (required for ${X})`);break;case"elicitation/create":if(!(($=this._clientCapabilities)===null||$===void 0?void 0:$.elicitation))throw Error(`Client does not support elicitation (required for ${X})`);break;case"roots/list":if(!((Y=this._clientCapabilities)===null||Y===void 0?void 0:Y.roots))throw Error(`Client does not support listing roots (required for ${X})`);break;case"ping":break}}assertNotificationCapability(X){var Q,$;switch(X){case"notifications/message":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${X})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw Error(`Server does not support notifying about resources (required for ${X})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw Error(`Server does not support notifying of tool list changes (required for ${X})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw Error(`Server does not support notifying of prompt list changes (required for ${X})`);break;case"notifications/elicitation/complete":if(!(($=(Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.elicitation)===null||$===void 0?void 0:$.url))throw Error(`Client does not support URL elicitation (required for ${X})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(X){if(!this._capabilities)return;switch(X){case"completion/complete":if(!this._capabilities.completions)throw Error(`Server does not support completions (required for ${X})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${X})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw Error(`Server does not support prompts (required for ${X})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw Error(`Server does not support resources (required for ${X})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Server does not support tools (required for ${X})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw Error(`Server does not support tasks capability (required for ${X})`);break;case"ping":case"initialize":break}}assertTaskCapability(X){var Q,$;lz(($=(Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.tasks)===null||$===void 0?void 0:$.requests,X,"Client")}assertTaskHandlerCapability(X){var Q;if(!this._capabilities)return;uz((Q=this._capabilities.tasks)===null||Q===void 0?void 0:Q.requests,X,"Server")}async _oninitialize(X){let Q=X.params.protocolVersion;return this._clientCapabilities=X.params.capabilities,this._clientVersion=X.params.clientInfo,{protocolVersion:$5.includes(Q)?Q:P$,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},t4)}async createMessage(X,Q){var $,Y;if(X.tools||X.toolChoice){if(!((Y=($=this._clientCapabilities)===null||$===void 0?void 0:$.sampling)===null||Y===void 0?void 0:Y.tools))throw Error("Client does not support sampling tools capability.")}if(X.messages.length>0){let W=X.messages[X.messages.length-1],J=Array.isArray(W.content)?W.content:[W.content],G=J.some((K)=>K.type==="tool_result"),H=X.messages.length>1?X.messages[X.messages.length-2]:void 0,B=H?Array.isArray(H.content)?H.content:[H.content]:[],z=B.some((K)=>K.type==="tool_use");if(G){if(J.some((K)=>K.type!=="tool_result"))throw Error("The last message must contain only tool_result content if any is present");if(!z)throw Error("tool_result blocks are not matching any tool_use from the previous message")}if(z){let K=new Set(B.filter((L)=>L.type==="tool_use").map((L)=>L.id)),V=new Set(J.filter((L)=>L.type==="tool_result").map((L)=>L.toolUseId));if(K.size!==V.size||![...K].every((L)=>V.has(L)))throw Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}if(X.tools)return this.request({method:"sampling/createMessage",params:X},u$,Q);return this.request({method:"sampling/createMessage",params:X},h$,Q)}async elicitInput(X,Q){var $,Y,W,J,G;switch(($=X.mode)!==null&&$!==void 0?$:"form"){case"url":{if(!((W=(Y=this._clientCapabilities)===null||Y===void 0?void 0:Y.elicitation)===null||W===void 0?void 0:W.url))throw Error("Client does not support url elicitation.");let B=X;return this.request({method:"elicitation/create",params:B},V8,Q)}case"form":{if(!((G=(J=this._clientCapabilities)===null||J===void 0?void 0:J.elicitation)===null||G===void 0?void 0:G.form))throw Error("Client does not support form elicitation.");let B=X.mode==="form"?X:{...X,mode:"form"},z=await this.request({method:"elicitation/create",params:B},V8,Q);if(z.action==="accept"&&z.content&&B.requestedSchema)try{let V=this._jsonSchemaValidator.getValidator(B.requestedSchema)(z.content);if(!V.valid)throw new k(x.InvalidParams,`Elicitation response content does not match requested schema: ${V.errorMessage}`)}catch(K){if(K instanceof k)throw K;throw new k(x.InternalError,`Error validating elicitation response: ${K instanceof Error?K.message:String(K)}`)}return z}}}createElicitationCompletionNotifier(X,Q){var $,Y;if(!((Y=($=this._clientCapabilities)===null||$===void 0?void 0:$.elicitation)===null||Y===void 0?void 0:Y.url))throw Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:X}},Q)}async listRoots(X,Q){return this.request({method:"roots/list",params:X},l$,Q)}async sendLoggingMessage(X,Q){if(this._capabilities.logging){if(!this.isMessageIgnored(X.level,Q))return this.notification({method:"notifications/message",params:X})}}async sendResourceUpdated(X){return this.notification({method:"notifications/resources/updated",params:X})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}var cz=Symbol.for("mcp.completable");function pz(X){return!!X&&typeof X==="object"&&cz in X}function dz(X){let Q=X[cz];return Q===null||Q===void 0?void 0:Q.complete}var mz;(function(X){X.Completable="McpCompletable"})(mz||(mz={}));var jE=/^[A-Za-z0-9._-]{1,128}$/;function RE(X){let Q=[];if(X.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(X.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${X.length})`]};if(X.includes(" "))Q.push("Tool name contains spaces, which may cause parsing issues");if(X.includes(","))Q.push("Tool name contains commas, which may cause parsing issues");if(X.startsWith("-")||X.endsWith("-"))Q.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts");if(X.startsWith(".")||X.endsWith("."))Q.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts");if(!jE.test(X)){let $=X.split("").filter((Y)=>!/[A-Za-z0-9._-]/.test(Y)).filter((Y,W,J)=>J.indexOf(Y)===W);return Q.push(`Tool name contains invalid characters: ${$.map((Y)=>`"${Y}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:Q}}return{isValid:!0,warnings:Q}}function EE(X,Q){if(Q.length>0){console.warn(`Tool name validation warning for "${X}":`);for(let $ of Q)console.warn(`  - ${$}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function $7(X){let Q=RE(X);return EE(X,Q.warnings),Q.isValid}class Y7{constructor(X){this._mcpServer=X}registerToolTask(X,Q,$){let Y={taskSupport:"required",...Q.execution};if(Y.taskSupport==="forbidden")throw Error(`Cannot register task-based tool '${X}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(X,Q.title,Q.description,Q.inputSchema,Q.outputSchema,Q.annotations,Y,Q._meta,$)}}class J7{constructor(X,Q){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Q7(X,Q)}get experimental(){if(!this._experimental)this._experimental={tasks:new Y7(this)};return this._experimental}async connect(X){return await this.server.connect(X)}async close(){await this.server.close()}setToolRequestHandlers(){if(this._toolHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(K8)),this.server.assertCanSetRequestHandler(r1(g6)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(K8,()=>({tools:Object.entries(this._registeredTools).filter(([,X])=>X.enabled).map(([X,Q])=>{let $={name:X,title:Q.title,description:Q.description,inputSchema:(()=>{let Y=T6(Q.inputSchema);return Y?n$(Y,{strictUnions:!0,pipeStrategy:"input"}):IE})(),annotations:Q.annotations,execution:Q.execution,_meta:Q._meta};if(Q.outputSchema){let Y=T6(Q.outputSchema);if(Y)$.outputSchema=n$(Y,{strictUnions:!0,pipeStrategy:"output"})}return $})})),this.server.setRequestHandler(g6,async(X,Q)=>{var $;try{let Y=this._registeredTools[X.params.name];if(!Y)throw new k(x.InvalidParams,`Tool ${X.params.name} not found`);if(!Y.enabled)throw new k(x.InvalidParams,`Tool ${X.params.name} disabled`);let W=!!X.params.task,J=($=Y.execution)===null||$===void 0?void 0:$.taskSupport,G="createTask"in Y.handler;if((J==="required"||J==="optional")&&!G)throw new k(x.InternalError,`Tool ${X.params.name} has taskSupport '${J}' but was not registered with registerToolTask`);if(J==="required"&&!W)throw new k(x.MethodNotFound,`Tool ${X.params.name} requires task augmentation (taskSupport: 'required')`);if(J==="optional"&&!W&&G)return await this.handleAutomaticTaskPolling(Y,X,Q);let H=await this.validateToolInput(Y,X.params.arguments,X.params.name),B=await this.executeToolHandler(Y,H,Q);if(W)return B;return await this.validateToolOutput(Y,B,X.params.name),B}catch(Y){if(Y instanceof k){if(Y.code===x.UrlElicitationRequired)throw Y}return this.createToolError(Y instanceof Error?Y.message:String(Y))}}),this._toolHandlersInitialized=!0}createToolError(X){return{content:[{type:"text",text:X}],isError:!0}}async validateToolInput(X,Q,$){if(!X.inputSchema)return;let Y=T6(X.inputSchema),W=Y!==null&&Y!==void 0?Y:X.inputSchema,J=await m4(W,Q);if(!J.success){let G="error"in J?J.error:"Unknown error",H=c4(G);throw new k(x.InvalidParams,`Input validation error: Invalid arguments for tool ${$}: ${H}`)}return J.data}async validateToolOutput(X,Q,$){if(!X.outputSchema)return;if(!("content"in Q))return;if(Q.isError)return;if(!Q.structuredContent)throw new k(x.InvalidParams,`Output validation error: Tool ${$} has an output schema but no structured content was provided`);let Y=T6(X.outputSchema),W=await m4(Y,Q.structuredContent);if(!W.success){let J="error"in W?W.error:"Unknown error",G=c4(J);throw new k(x.InvalidParams,`Output validation error: Invalid structured content for tool ${$}: ${G}`)}}async executeToolHandler(X,Q,$){let Y=X.handler;if("createTask"in Y){if(!$.taskStore)throw Error("No task store provided.");let J={...$,taskStore:$.taskStore};if(X.inputSchema)return await Promise.resolve(Y.createTask(Q,J));else return await Promise.resolve(Y.createTask(J))}if(X.inputSchema)return await Promise.resolve(Y(Q,$));else return await Promise.resolve(Y($))}async handleAutomaticTaskPolling(X,Q,$){var Y;if(!$.taskStore)throw Error("No task store provided for task-capable tool.");let W=await this.validateToolInput(X,Q.params.arguments,Q.params.name),J=X.handler,G={...$,taskStore:$.taskStore},H=W?await Promise.resolve(J.createTask(W,G)):await Promise.resolve(J.createTask(G)),B=H.task.taskId,z=H.task,K=(Y=z.pollInterval)!==null&&Y!==void 0?Y:5000;while(z.status!=="completed"&&z.status!=="failed"&&z.status!=="cancelled"){await new Promise((L)=>setTimeout(L,K));let V=await $.taskStore.getTask(B);if(!V)throw new k(x.InternalError,`Task ${B} not found during polling`);z=V}return await $.taskStore.getTaskResult(B)}setCompletionRequestHandler(){if(this._completionHandlerInitialized)return;this.server.assertCanSetRequestHandler(r1(L8)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(L8,async(X)=>{switch(X.params.ref.type){case"ref/prompt":return A5(X),this.handlePromptCompletion(X,X.params.ref);case"ref/resource":return w5(X),this.handleResourceCompletion(X,X.params.ref);default:throw new k(x.InvalidParams,`Invalid completion reference: ${X.params.ref}`)}}),this._completionHandlerInitialized=!0}async handlePromptCompletion(X,Q){let $=this._registeredPrompts[Q.name];if(!$)throw new k(x.InvalidParams,`Prompt ${Q.name} not found`);if(!$.enabled)throw new k(x.InvalidParams,`Prompt ${Q.name} disabled`);if(!$.argsSchema)return H4;let Y=h1($.argsSchema),W=Y===null||Y===void 0?void 0:Y[X.params.argument.name];if(!pz(W))return H4;let J=dz(W);if(!J)return H4;let G=await J(X.params.argument.value,X.params.context);return nz(G)}async handleResourceCompletion(X,Q){let $=Object.values(this._registeredResourceTemplates).find((J)=>J.resourceTemplate.uriTemplate.toString()===Q.uri);if(!$){if(this._registeredResources[Q.uri])return H4;throw new k(x.InvalidParams,`Resource template ${X.params.ref.uri} not found`)}let Y=$.resourceTemplate.completeCallback(X.params.argument.name);if(!Y)return H4;let W=await Y(X.params.argument.value,X.params.context);return nz(W)}setResourceRequestHandlers(){if(this._resourceHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(J8)),this.server.assertCanSetRequestHandler(r1(G8)),this.server.assertCanSetRequestHandler(r1(H8)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(J8,async(X,Q)=>{let $=Object.entries(this._registeredResources).filter(([W,J])=>J.enabled).map(([W,J])=>({uri:W,name:J.name,...J.metadata})),Y=[];for(let W of Object.values(this._registeredResourceTemplates)){if(!W.resourceTemplate.listCallback)continue;let J=await W.resourceTemplate.listCallback(Q);for(let G of J.resources)Y.push({...W.metadata,...G})}return{resources:[...$,...Y]}}),this.server.setRequestHandler(G8,async()=>{return{resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([Q,$])=>({name:Q,uriTemplate:$.resourceTemplate.uriTemplate.toString(),...$.metadata}))}}),this.server.setRequestHandler(H8,async(X,Q)=>{let $=new URL(X.params.uri),Y=this._registeredResources[$.toString()];if(Y){if(!Y.enabled)throw new k(x.InvalidParams,`Resource ${$} disabled`);return Y.readCallback($,Q)}for(let W of Object.values(this._registeredResourceTemplates)){let J=W.resourceTemplate.uriTemplate.match($.toString());if(J)return W.readCallback($,J,Q)}throw new k(x.InvalidParams,`Resource ${$} not found`)}),this.setCompletionRequestHandler(),this._resourceHandlersInitialized=!0}setPromptRequestHandlers(){if(this._promptHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(B8)),this.server.assertCanSetRequestHandler(r1(z8)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(B8,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,X])=>X.enabled).map(([X,Q])=>{return{name:X,title:Q.title,description:Q.description,arguments:Q.argsSchema?PE(Q.argsSchema):void 0}})})),this.server.setRequestHandler(z8,async(X,Q)=>{let $=this._registeredPrompts[X.params.name];if(!$)throw new k(x.InvalidParams,`Prompt ${X.params.name} not found`);if(!$.enabled)throw new k(x.InvalidParams,`Prompt ${X.params.name} disabled`);if($.argsSchema){let Y=T6($.argsSchema),W=await m4(Y,X.params.arguments);if(!W.success){let H="error"in W?W.error:"Unknown error",B=c4(H);throw new k(x.InvalidParams,`Invalid arguments for prompt ${X.params.name}: ${B}`)}let J=W.data,G=$.callback;return await Promise.resolve(G(J,Q))}else{let Y=$.callback;return await Promise.resolve(Y(Q))}}),this.setCompletionRequestHandler(),this._promptHandlersInitialized=!0}resource(X,Q,...$){let Y;if(typeof $[0]==="object")Y=$.shift();let W=$[0];if(typeof Q==="string"){if(this._registeredResources[Q])throw Error(`Resource ${Q} is already registered`);let J=this._createRegisteredResource(X,void 0,Q,Y,W);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}else{if(this._registeredResourceTemplates[X])throw Error(`Resource template ${X} is already registered`);let J=this._createRegisteredResourceTemplate(X,void 0,Q,Y,W);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}}registerResource(X,Q,$,Y){if(typeof Q==="string"){if(this._registeredResources[Q])throw Error(`Resource ${Q} is already registered`);let W=this._createRegisteredResource(X,$.title,Q,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),W}else{if(this._registeredResourceTemplates[X])throw Error(`Resource template ${X} is already registered`);let W=this._createRegisteredResourceTemplate(X,$.title,Q,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),W}}_createRegisteredResource(X,Q,$,Y,W){let J={name:X,title:Q,metadata:Y,readCallback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({uri:null}),update:(G)=>{if(typeof G.uri<"u"&&G.uri!==$){if(delete this._registeredResources[$],G.uri)this._registeredResources[G.uri]=J}if(typeof G.name<"u")J.name=G.name;if(typeof G.title<"u")J.title=G.title;if(typeof G.metadata<"u")J.metadata=G.metadata;if(typeof G.callback<"u")J.readCallback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResources[$]=J,J}_createRegisteredResourceTemplate(X,Q,$,Y,W){let J={resourceTemplate:$,title:Q,metadata:Y,readCallback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==X){if(delete this._registeredResourceTemplates[X],G.name)this._registeredResourceTemplates[G.name]=J}if(typeof G.title<"u")J.title=G.title;if(typeof G.template<"u")J.resourceTemplate=G.template;if(typeof G.metadata<"u")J.metadata=G.metadata;if(typeof G.callback<"u")J.readCallback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResourceTemplates[X]=J,J}_createRegisteredPrompt(X,Q,$,Y,W){let J={title:Q,description:$,argsSchema:Y===void 0?void 0:v6(Y),callback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==X){if(delete this._registeredPrompts[X],G.name)this._registeredPrompts[G.name]=J}if(typeof G.title<"u")J.title=G.title;if(typeof G.description<"u")J.description=G.description;if(typeof G.argsSchema<"u")J.argsSchema=v6(G.argsSchema);if(typeof G.callback<"u")J.callback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendPromptListChanged()}};return this._registeredPrompts[X]=J,J}_createRegisteredTool(X,Q,$,Y,W,J,G,H,B){$7(X);let z={title:Q,description:$,inputSchema:iz(Y),outputSchema:iz(W),annotations:J,execution:G,_meta:H,handler:B,enabled:!0,disable:()=>z.update({enabled:!1}),enable:()=>z.update({enabled:!0}),remove:()=>z.update({name:null}),update:(K)=>{if(typeof K.name<"u"&&K.name!==X){if(typeof K.name==="string")$7(K.name);if(delete this._registeredTools[X],K.name)this._registeredTools[K.name]=z}if(typeof K.title<"u")z.title=K.title;if(typeof K.description<"u")z.description=K.description;if(typeof K.paramsSchema<"u")z.inputSchema=v6(K.paramsSchema);if(typeof K.callback<"u")z.handler=K.callback;if(typeof K.annotations<"u")z.annotations=K.annotations;if(typeof K._meta<"u")z._meta=K._meta;if(typeof K.enabled<"u")z.enabled=K.enabled;this.sendToolListChanged()}};return this._registeredTools[X]=z,this.setToolRequestHandlers(),this.sendToolListChanged(),z}tool(X,...Q){if(this._registeredTools[X])throw Error(`Tool ${X} is already registered`);let $,Y,W,J;if(typeof Q[0]==="string")$=Q.shift();if(Q.length>1){let H=Q[0];if(W7(H)){if(Y=Q.shift(),Q.length>1&&typeof Q[0]==="object"&&Q[0]!==null&&!W7(Q[0]))J=Q.shift()}else if(typeof H==="object"&&H!==null)J=Q.shift()}let G=Q[0];return this._createRegisteredTool(X,void 0,$,Y,W,J,{taskSupport:"forbidden"},void 0,G)}registerTool(X,Q,$){if(this._registeredTools[X])throw Error(`Tool ${X} is already registered`);let{title:Y,description:W,inputSchema:J,outputSchema:G,annotations:H,_meta:B}=Q;return this._createRegisteredTool(X,Y,W,J,G,H,{taskSupport:"forbidden"},B,$)}prompt(X,...Q){if(this._registeredPrompts[X])throw Error(`Prompt ${X} is already registered`);let $;if(typeof Q[0]==="string")$=Q.shift();let Y;if(Q.length>1)Y=Q.shift();let W=Q[0],J=this._createRegisteredPrompt(X,void 0,$,Y,W);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),J}registerPrompt(X,Q,$){if(this._registeredPrompts[X])throw Error(`Prompt ${X} is already registered`);let{title:Y,description:W,argsSchema:J}=Q,G=this._createRegisteredPrompt(X,Y,W,J,$);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),G}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(X,Q){return this.server.sendLoggingMessage(X,Q)}sendResourceListChanged(){if(this.isConnected())this.server.sendResourceListChanged()}sendToolListChanged(){if(this.isConnected())this.server.sendToolListChanged()}sendPromptListChanged(){if(this.isConnected())this.server.sendPromptListChanged()}}var IE={type:"object",properties:{}};function rz(X){return X!==null&&typeof X==="object"&&"parse"in X&&typeof X.parse==="function"&&"safeParse"in X&&typeof X.safeParse==="function"}function bE(X){return"_def"in X||"_zod"in X||rz(X)}function W7(X){if(typeof X!=="object"||X===null)return!1;if(bE(X))return!1;if(Object.keys(X).length===0)return!0;return Object.values(X).some(rz)}function iz(X){if(!X)return;if(W7(X))return v6(X);return X}function PE(X){let Q=h1(X);if(!Q)return[];return Object.entries(Q).map(([$,Y])=>{let W=TJ(Y),J=_J(Y);return{name:$,description:W,required:!J}})}function r1(X){let Q=h1(X),$=Q===null||Q===void 0?void 0:Q.method;if(!$)throw Error("Schema is missing a method literal");let Y=p4($);if(typeof Y==="string")return Y;throw Error("Schema method literal must be a string")}function nz(X){return{completion:{values:X.slice(0,100),total:X.length,hasMore:X.length>100}}}var H4={completion:{values:[],hasMore:!1}};function SE(X,Q,$,Y){return{name:X,description:Q,inputSchema:$,handler:Y}}function ZE(X){let Q=new J7({name:X.name,version:X.version??"1.0.0"},{capabilities:{tools:X.tools?{}:void 0}});if(X.tools)X.tools.forEach(($)=>{Q.tool($.name,$.description,$.inputSchema,$.handler)});return{type:"sdk",name:X.name,instance:Q}}function o_({prompt:X,options:Q}){let{systemPrompt:$,settingSources:Y,sandbox:W,...J}=Q??{},G,H;if($===void 0)G="";else if(typeof $==="string")G=$;else if($.type==="preset")H=$.append;let B=J.pathToClaudeCodeExecutable;if(!B){let q6=CE(import.meta.url),F6=oz(q6,"..");B=oz(F6,"cli.js")}process.env.CLAUDE_AGENT_SDK_VERSION="0.2.22";let{abortController:z=N6(),additionalDirectories:K=[],agent:V,agents:L,allowedTools:U=[],betas:F,canUseTool:q,continue:N,cwd:A,disallowedTools:M=[],tools:R,env:S,executable:C=j6()?"bun":"node",executableArgs:K0=[],extraArgs:U0={},fallbackModel:s,enableFileCheckpointing:D0,forkSession:q0,hooks:W1,includePartialMessages:P1,persistSession:U6,maxThinkingTokens:d,maxTurns:Q9,maxBudgetUsd:o6,mcpServers:V6,model:t6,outputFormat:a6,permissionMode:B4="default",allowDangerouslySkipPermissions:S0=!1,permissionPromptToolName:S1,plugins:s6,resume:tz,resumeSessionAt:az,stderr:sz,strictMcpConfig:ez}=J,G7=a6?.type==="json_schema"?a6.schema:void 0,L6=S;if(!L6)L6={...process.env};if(!L6.CLAUDE_CODE_ENTRYPOINT)L6.CLAUDE_CODE_ENTRYPOINT="sdk-ts";if(D0)L6.CLAUDE_CODE_ENABLE_SDK_FILE_CHECKPOINTING="true";if(!B)throw Error("pathToClaudeCodeExecutable is required");let $9={},H7=new Map;if(V6)for(let[q6,F6]of Object.entries(V6))if(F6.type==="sdk"&&"instance"in F6)H7.set(q6,F6.instance),$9[q6]={type:"sdk",name:q6};else $9[q6]=F6;let XK=typeof X==="string",B7=new XX({abortController:z,additionalDirectories:K,agent:V,betas:F,cwd:A,executable:C,executableArgs:K0,extraArgs:U0,pathToClaudeCodeExecutable:B,env:L6,forkSession:q0,stderr:sz,maxThinkingTokens:d,maxTurns:Q9,maxBudgetUsd:o6,model:t6,fallbackModel:s,jsonSchema:G7,permissionMode:B4,allowDangerouslySkipPermissions:S0,permissionPromptToolName:S1,continueConversation:N,resume:tz,resumeSessionAt:az,settingSources:Y??[],allowedTools:U,disallowedTools:M,tools:R,mcpServers:$9,strictMcpConfig:ez,canUseTool:!!q,hooks:!!W1,includePartialMessages:P1,persistSession:U6,plugins:s6,sandbox:W,spawnClaudeCodeProcess:J.spawnClaudeCodeProcess}),z7=new $X(B7,XK,q,W1,z,H7,G7,{systemPrompt:G,appendSystemPrompt:H,agents:L});if(typeof X==="string")B7.write(Z0({type:"user",session_id:"",message:{role:"user",content:[{type:"text",text:X}]},parent_tool_use_id:null})+`
+]`;continue}if(W+=Y[B],Y[B]==="\\")J=!0;else if(G&&Y[B]==="]")G=!1;else if(!G&&Y[B]==="[")G=!0}try{new RegExp(W)}catch{return console.warn(`Could not convert regex pattern at ${Q.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),X.source}return W}function O8(X,Q){if(Q.target==="openAi")console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead.");if(Q.target==="openApi3"&&X.keyType?._def.typeName===j.ZodEnum)return{type:"object",required:X.keyType._def.values,properties:X.keyType._def.values.reduce((Y,W)=>({...Y,[W]:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"properties",W]})??B0(Q)}),{}),additionalProperties:Q.rejectedAdditionalProperties};let $={type:"object",additionalProperties:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"additionalProperties"]})??Q.allowedAdditionalProperties};if(Q.target==="openApi3")return $;if(X.keyType?._def.typeName===j.ZodString&&X.keyType._def.checks?.length){let{type:Y,...W}=N8(X.keyType._def,Q);return{...$,propertyNames:W}}else if(X.keyType?._def.typeName===j.ZodEnum)return{...$,propertyNames:{enum:X.keyType._def.values}};else if(X.keyType?._def.typeName===j.ZodBranded&&X.keyType._def.type._def.typeName===j.ZodString&&X.keyType._def.type._def.checks?.length){let{type:Y,...W}=F8(X.keyType._def,Q);return{...$,propertyNames:W}}return $}function y5(X,Q){if(Q.mapStrategy==="record")return O8(X,Q);let $=f(X.keyType._def,{...Q,currentPath:[...Q.currentPath,"items","items","0"]})||B0(Q),Y=f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"items","items","1"]})||B0(Q);return{type:"array",maxItems:125,items:{type:"array",items:[$,Y],minItems:2,maxItems:2}}}function g5(X){let Q=X.values,Y=Object.keys(X.values).filter((J)=>{return typeof Q[Q[J]]!=="number"}).map((J)=>Q[J]),W=Array.from(new Set(Y.map((J)=>typeof J)));return{type:W.length===1?W[0]==="string"?"string":"number":["string","number"],enum:Y}}function f5(X){return X.target==="openAi"?void 0:{not:B0({...X,currentPath:[...X.currentPath,"not"]})}}function h5(X){return X.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var gX={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function l5(X,Q){if(Q.target==="openApi3")return u5(X,Q);let $=X.options instanceof Map?Array.from(X.options.values()):X.options;if($.every((Y)=>(Y._def.typeName in gX)&&(!Y._def.checks||!Y._def.checks.length))){let Y=$.reduce((W,J)=>{let G=gX[J._def.typeName];return G&&!W.includes(G)?[...W,G]:W},[]);return{type:Y.length>1?Y:Y[0]}}else if($.every((Y)=>Y._def.typeName==="ZodLiteral"&&!Y.description)){let Y=$.reduce((W,J)=>{let G=typeof J._def.value;switch(G){case"string":case"number":case"boolean":return[...W,G];case"bigint":return[...W,"integer"];case"object":if(J._def.value===null)return[...W,"null"];case"symbol":case"undefined":case"function":default:return W}},[]);if(Y.length===$.length){let W=Y.filter((J,G,H)=>H.indexOf(J)===G);return{type:W.length>1?W:W[0],enum:$.reduce((J,G)=>{return J.includes(G._def.value)?J:[...J,G._def.value]},[])}}}else if($.every((Y)=>Y._def.typeName==="ZodEnum"))return{type:"string",enum:$.reduce((Y,W)=>[...Y,...W._def.values.filter((J)=>!Y.includes(J))],[])};return u5(X,Q)}var u5=(X,Q)=>{let $=(X.options instanceof Map?Array.from(X.options.values()):X.options).map((Y,W)=>f(Y._def,{...Q,currentPath:[...Q.currentPath,"anyOf",`${W}`]})).filter((Y)=>!!Y&&(!Q.strictUnions||typeof Y==="object"&&Object.keys(Y).length>0));return $.length?{anyOf:$}:void 0};function m5(X,Q){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(X.innerType._def.typeName)&&(!X.innerType._def.checks||!X.innerType._def.checks.length)){if(Q.target==="openApi3")return{type:gX[X.innerType._def.typeName],nullable:!0};return{type:[gX[X.innerType._def.typeName],"null"]}}if(Q.target==="openApi3"){let Y=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath]});if(Y&&"$ref"in Y)return{allOf:[Y],nullable:!0};return Y&&{...Y,nullable:!0}}let $=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath,"anyOf","0"]});return $&&{anyOf:[$,{type:"null"}]}}function c5(X,Q){let $={type:"number"};if(!X.checks)return $;for(let Y of X.checks)switch(Y.kind){case"int":$.type="integer",m$($,"type",Y.message,Q);break;case"min":if(Q.target==="jsonSchema7")if(Y.inclusive)o($,"minimum",Y.value,Y.message,Q);else o($,"exclusiveMinimum",Y.value,Y.message,Q);else{if(!Y.inclusive)$.exclusiveMinimum=!0;o($,"minimum",Y.value,Y.message,Q)}break;case"max":if(Q.target==="jsonSchema7")if(Y.inclusive)o($,"maximum",Y.value,Y.message,Q);else o($,"exclusiveMaximum",Y.value,Y.message,Q);else{if(!Y.inclusive)$.exclusiveMaximum=!0;o($,"maximum",Y.value,Y.message,Q)}break;case"multipleOf":o($,"multipleOf",Y.value,Y.message,Q);break}return $}function p5(X,Q){let $=Q.target==="openAi",Y={type:"object",properties:{}},W=[],J=X.shape();for(let H in J){let B=J[H];if(B===void 0||B._def===void 0)continue;let z=zN(B);if(z&&$){if(B._def.typeName==="ZodOptional")B=B._def.innerType;if(!B.isNullable())B=B.nullable();z=!1}let K=f(B._def,{...Q,currentPath:[...Q.currentPath,"properties",H],propertyPath:[...Q.currentPath,"properties",H]});if(K===void 0)continue;if(Y.properties[H]=K,!z)W.push(H)}if(W.length)Y.required=W;let G=BN(X,Q);if(G!==void 0)Y.additionalProperties=G;return Y}function BN(X,Q){if(X.catchall._def.typeName!=="ZodNever")return f(X.catchall._def,{...Q,currentPath:[...Q.currentPath,"additionalProperties"]});switch(X.unknownKeys){case"passthrough":return Q.allowedAdditionalProperties;case"strict":return Q.rejectedAdditionalProperties;case"strip":return Q.removeAdditionalStrategy==="strict"?Q.allowedAdditionalProperties:Q.rejectedAdditionalProperties}}function zN(X){try{return X.isOptional()}catch{return!0}}var d5=(X,Q)=>{if(Q.currentPath.toString()===Q.propertyPath?.toString())return f(X.innerType._def,Q);let $=f(X.innerType._def,{...Q,currentPath:[...Q.currentPath,"anyOf","1"]});return $?{anyOf:[{not:B0(Q)},$]}:B0(Q)};var i5=(X,Q)=>{if(Q.pipeStrategy==="input")return f(X.in._def,Q);else if(Q.pipeStrategy==="output")return f(X.out._def,Q);let $=f(X.in._def,{...Q,currentPath:[...Q.currentPath,"allOf","0"]}),Y=f(X.out._def,{...Q,currentPath:[...Q.currentPath,"allOf",$?"1":"0"]});return{allOf:[$,Y].filter((W)=>W!==void 0)}};function n5(X,Q){return f(X.type._def,Q)}function r5(X,Q){let Y={type:"array",uniqueItems:!0,items:f(X.valueType._def,{...Q,currentPath:[...Q.currentPath,"items"]})};if(X.minSize)o(Y,"minItems",X.minSize.value,X.minSize.message,Q);if(X.maxSize)o(Y,"maxItems",X.maxSize.value,X.maxSize.message,Q);return Y}function o5(X,Q){if(X.rest)return{type:"array",minItems:X.items.length,items:X.items.map(($,Y)=>f($._def,{...Q,currentPath:[...Q.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[]),additionalItems:f(X.rest._def,{...Q,currentPath:[...Q.currentPath,"additionalItems"]})};else return{type:"array",minItems:X.items.length,maxItems:X.items.length,items:X.items.map(($,Y)=>f($._def,{...Q,currentPath:[...Q.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[])}}function t5(X){return{not:B0(X)}}function a5(X){return B0(X)}var s5=(X,Q)=>{return f(X.innerType._def,Q)};var e5=(X,Q,$)=>{switch(Q){case j.ZodString:return N8(X,$);case j.ZodNumber:return c5(X,$);case j.ZodObject:return p5(X,$);case j.ZodBigInt:return P5(X,$);case j.ZodBoolean:return S5();case j.ZodDate:return c$(X,$);case j.ZodUndefined:return t5($);case j.ZodNull:return h5($);case j.ZodArray:return b5(X,$);case j.ZodUnion:case j.ZodDiscriminatedUnion:return l5(X,$);case j.ZodIntersection:return T5(X,$);case j.ZodTuple:return o5(X,$);case j.ZodRecord:return O8(X,$);case j.ZodLiteral:return _5(X,$);case j.ZodEnum:return v5(X);case j.ZodNativeEnum:return g5(X);case j.ZodNullable:return m5(X,$);case j.ZodOptional:return d5(X,$);case j.ZodMap:return y5(X,$);case j.ZodSet:return r5(X,$);case j.ZodLazy:return()=>X.getter()._def;case j.ZodPromise:return n5(X,$);case j.ZodNaN:case j.ZodNever:return f5($);case j.ZodEffects:return k5(X,$);case j.ZodAny:return B0($);case j.ZodUnknown:return a5($);case j.ZodDefault:return C5(X,$);case j.ZodBranded:return F8(X,$);case j.ZodReadonly:return s5(X,$);case j.ZodCatch:return Z5(X,$);case j.ZodPipeline:return i5(X,$);case j.ZodFunction:case j.ZodVoid:case j.ZodSymbol:return;default:return((Y)=>{return})(Q)}};function f(X,Q,$=!1){let Y=Q.seen.get(X);if(Q.override){let H=Q.override?.(X,Q,Y,$);if(H!==R5)return H}if(Y&&!$){let H=KN(Y,Q);if(H!==void 0)return H}let W={def:X,path:Q.currentPath,jsonSchema:void 0};Q.seen.set(X,W);let J=e5(X,X.typeName,Q),G=typeof J==="function"?f(J(),Q):J;if(G)UN(X,Q,G);if(Q.postProcess){let H=Q.postProcess(G,X,Q);return W.jsonSchema=G,H}return W.jsonSchema=G,G}var KN=(X,Q)=>{switch(Q.$refStrategy){case"root":return{$ref:X.path.join("/")};case"relative":return{$ref:q8(Q.currentPath,X.path)};case"none":case"seen":{if(X.path.length<Q.currentPath.length&&X.path.every(($,Y)=>Q.currentPath[Y]===$))return console.warn(`Recursive reference detected at ${Q.currentPath.join("/")}! Defaulting to any`),B0(Q);return Q.$refStrategy==="seen"?B0(Q):void 0}}},UN=(X,Q,$)=>{if(X.description){if($.description=X.description,Q.markdownDescription)$.markdownDescription=X.description}return $};var i$=(X,Q)=>{let $=I5(Q),Y=typeof Q==="object"&&Q.definitions?Object.entries(Q.definitions).reduce((B,[z,K])=>({...B,[z]:f(K._def,{...$,currentPath:[...$.basePath,$.definitionPath,z]},!0)??B0($)}),{}):void 0,W=typeof Q==="string"?Q:Q?.nameStrategy==="title"?void 0:Q?.name,J=f(X._def,W===void 0?$:{...$,currentPath:[...$.basePath,$.definitionPath,W]},!1)??B0($),G=typeof Q==="object"&&Q.name!==void 0&&Q.nameStrategy==="title"?Q.name:void 0;if(G!==void 0)J.title=G;if($.flags.hasReferencedOpenAiAnyType){if(!Y)Y={};if(!Y[$.openAiAnyTypeName])Y[$.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:$.$refStrategy==="relative"?"1":[...$.basePath,$.definitionPath,$.openAiAnyTypeName].join("/")}}}let H=W===void 0?Y?{...J,[$.definitionPath]:Y}:J:{$ref:[...$.$refStrategy==="relative"?[]:$.basePath,$.definitionPath,W].join("/"),[$.definitionPath]:{...Y,[W]:J}};if($.target==="jsonSchema7")H.$schema="http://json-schema.org/draft-07/schema#";else if($.target==="jsonSchema2019-09"||$.target==="openAi")H.$schema="https://json-schema.org/draft/2019-09/schema#";if($.target==="openAi"&&(("anyOf"in H)||("oneOf"in H)||("allOf"in H)||("type"in H)&&Array.isArray(H.type)))console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property.");return H};function VN(X){if(!X)return"draft-7";if(X==="jsonSchema7"||X==="draft-7")return"draft-7";if(X==="jsonSchema2019-09"||X==="draft-2020-12")return"draft-2020-12";return"draft-7"}function n$(X,Q){var $,Y,W;if(m0(X))return N$(X,{target:VN(Q===null||Q===void 0?void 0:Q.target),io:($=Q===null||Q===void 0?void 0:Q.pipeStrategy)!==null&&$!==void 0?$:"input"});return i$(X,{strictUnions:(Y=Q===null||Q===void 0?void 0:Q.strictUnions)!==null&&Y!==void 0?Y:!0,pipeStrategy:(W=Q===null||Q===void 0?void 0:Q.pipeStrategy)!==null&&W!==void 0?W:"input"})}function r$(X){let Q=h1(X),$=Q===null||Q===void 0?void 0:Q.method;if(!$)throw Error("Schema is missing a method literal");let Y=p4($);if(typeof Y!=="string")throw Error("Schema method literal must be a string");return Y}function o$(X,Q){let $=f1(X,Q);if(!$.success)throw $.error;return $.data}var LN=60000;class t${constructor(X){if(this._options=X,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(a4,(Q)=>{this._oncancel(Q)}),this.setNotificationHandler(e4,(Q)=>{this._onprogress(Q)}),this.setRequestHandler(s4,(Q)=>({})),this._taskStore=X===null||X===void 0?void 0:X.taskStore,this._taskMessageQueue=X===null||X===void 0?void 0:X.taskMessageQueue,this._taskStore)this.setRequestHandler(X8,async(Q,$)=>{let Y=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!Y)throw new k(x.InvalidParams,"Failed to retrieve task: Task not found");return{...Y}}),this.setRequestHandler($8,async(Q,$)=>{let Y=async()=>{var W;let J=Q.params.taskId;if(this._taskMessageQueue){let H;while(H=await this._taskMessageQueue.dequeue(J,$.sessionId)){if(H.type==="response"||H.type==="error"){let B=H.message,z=B.id,K=this._requestResolvers.get(z);if(K)if(this._requestResolvers.delete(z),H.type==="response")K(B);else{let V=B,L=new k(V.error.code,V.error.message,V.error.data);K(L)}else{let V=H.type==="response"?"Response":"Error";this._onerror(Error(`${V} handler missing for request ${z}`))}continue}await((W=this._transport)===null||W===void 0?void 0:W.send(H.message,{relatedRequestId:$.requestId}))}}let G=await this._taskStore.getTask(J,$.sessionId);if(!G)throw new k(x.InvalidParams,`Task not found: ${J}`);if(!u1(G.status))return await this._waitForTaskUpdate(J,$.signal),await Y();if(u1(G.status)){let H=await this._taskStore.getTaskResult(J,$.sessionId);return this._clearTaskQueue(J),{...H,_meta:{...H._meta,[K1]:{taskId:J}}}}return await Y()};return await Y()}),this.setRequestHandler(Y8,async(Q,$)=>{var Y;try{let{tasks:W,nextCursor:J}=await this._taskStore.listTasks((Y=Q.params)===null||Y===void 0?void 0:Y.cursor,$.sessionId);return{tasks:W,nextCursor:J,_meta:{}}}catch(W){throw new k(x.InvalidParams,`Failed to list tasks: ${W instanceof Error?W.message:String(W)}`)}}),this.setRequestHandler(V5,async(Q,$)=>{try{let Y=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!Y)throw new k(x.InvalidParams,`Task not found: ${Q.params.taskId}`);if(u1(Y.status))throw new k(x.InvalidParams,`Cannot cancel task in terminal status: ${Y.status}`);await this._taskStore.updateTaskStatus(Q.params.taskId,"cancelled","Client cancelled task execution.",$.sessionId),this._clearTaskQueue(Q.params.taskId);let W=await this._taskStore.getTask(Q.params.taskId,$.sessionId);if(!W)throw new k(x.InvalidParams,`Task not found after cancellation: ${Q.params.taskId}`);return{_meta:{},...W}}catch(Y){if(Y instanceof k)throw Y;throw new k(x.InvalidRequest,`Failed to cancel task: ${Y instanceof Error?Y.message:String(Y)}`)}})}async _oncancel(X){let Q=this._requestHandlerAbortControllers.get(X.params.requestId);Q===null||Q===void 0||Q.abort(X.params.reason)}_setupTimeout(X,Q,$,Y,W=!1){this._timeoutInfo.set(X,{timeoutId:setTimeout(Y,Q),startTime:Date.now(),timeout:Q,maxTotalTimeout:$,resetTimeoutOnProgress:W,onTimeout:Y})}_resetTimeout(X){let Q=this._timeoutInfo.get(X);if(!Q)return!1;let $=Date.now()-Q.startTime;if(Q.maxTotalTimeout&&$>=Q.maxTotalTimeout)throw this._timeoutInfo.delete(X),k.fromError(x.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:Q.maxTotalTimeout,totalElapsed:$});return clearTimeout(Q.timeoutId),Q.timeoutId=setTimeout(Q.onTimeout,Q.timeout),!0}_cleanupTimeout(X){let Q=this._timeoutInfo.get(X);if(Q)clearTimeout(Q.timeoutId),this._timeoutInfo.delete(X)}async connect(X){var Q,$,Y;this._transport=X;let W=(Q=this.transport)===null||Q===void 0?void 0:Q.onclose;this._transport.onclose=()=>{W===null||W===void 0||W(),this._onclose()};let J=($=this.transport)===null||$===void 0?void 0:$.onerror;this._transport.onerror=(H)=>{J===null||J===void 0||J(H),this._onerror(H)};let G=(Y=this._transport)===null||Y===void 0?void 0:Y.onmessage;this._transport.onmessage=(H,B)=>{if(G===null||G===void 0||G(H,B),CX(H)||K5(H))this._onresponse(H);else if(Z$(H))this._onrequest(H,B);else if(H5(H))this._onnotification(H);else this._onerror(Error(`Unknown message type: ${JSON.stringify(H)}`))},await this._transport.start()}_onclose(){var X;let Q=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let $=k.fromError(x.ConnectionClosed,"Connection closed");this._transport=void 0,(X=this.onclose)===null||X===void 0||X.call(this);for(let Y of Q.values())Y($)}_onerror(X){var Q;(Q=this.onerror)===null||Q===void 0||Q.call(this,X)}_onnotification(X){var Q;let $=(Q=this._notificationHandlers.get(X.method))!==null&&Q!==void 0?Q:this.fallbackNotificationHandler;if($===void 0)return;Promise.resolve().then(()=>$(X)).catch((Y)=>this._onerror(Error(`Uncaught error in notification handler: ${Y}`)))}_onrequest(X,Q){var $,Y,W,J,G,H;let B=($=this._requestHandlers.get(X.method))!==null&&$!==void 0?$:this.fallbackRequestHandler,z=this._transport,K=(J=(W=(Y=X.params)===null||Y===void 0?void 0:Y._meta)===null||W===void 0?void 0:W[K1])===null||J===void 0?void 0:J.taskId;if(B===void 0){let q={jsonrpc:"2.0",id:X.id,error:{code:x.MethodNotFound,message:"Method not found"}};if(K&&this._taskMessageQueue)this._enqueueTaskMessage(K,{type:"error",message:q,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId).catch((N)=>this._onerror(Error(`Failed to enqueue error response: ${N}`)));else z===null||z===void 0||z.send(q).catch((N)=>this._onerror(Error(`Failed to send an error response: ${N}`)));return}let V=new AbortController;this._requestHandlerAbortControllers.set(X.id,V);let L=(G=X.params)===null||G===void 0?void 0:G.task,U=this._taskStore?this.requestTaskStore(X,z===null||z===void 0?void 0:z.sessionId):void 0,F={signal:V.signal,sessionId:z===null||z===void 0?void 0:z.sessionId,_meta:(H=X.params)===null||H===void 0?void 0:H._meta,sendNotification:async(q)=>{let N={relatedRequestId:X.id};if(K)N.relatedTask={taskId:K};await this.notification(q,N)},sendRequest:async(q,N,A)=>{var M,R;let S={...A,relatedRequestId:X.id};if(K&&!S.relatedTask)S.relatedTask={taskId:K};let C=(R=(M=S.relatedTask)===null||M===void 0?void 0:M.taskId)!==null&&R!==void 0?R:K;if(C&&U)await U.updateTaskStatus(C,"input_required");return await this.request(q,N,S)},authInfo:Q===null||Q===void 0?void 0:Q.authInfo,requestId:X.id,requestInfo:Q===null||Q===void 0?void 0:Q.requestInfo,taskId:K,taskStore:U,taskRequestedTtl:L===null||L===void 0?void 0:L.ttl,closeSSEStream:Q===null||Q===void 0?void 0:Q.closeSSEStream,closeStandaloneSSEStream:Q===null||Q===void 0?void 0:Q.closeStandaloneSSEStream};Promise.resolve().then(()=>{if(L)this.assertTaskHandlerCapability(X.method)}).then(()=>B(X,F)).then(async(q)=>{if(V.signal.aborted)return;let N={result:q,jsonrpc:"2.0",id:X.id};if(K&&this._taskMessageQueue)await this._enqueueTaskMessage(K,{type:"response",message:N,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId);else await(z===null||z===void 0?void 0:z.send(N))},async(q)=>{var N;if(V.signal.aborted)return;let A={jsonrpc:"2.0",id:X.id,error:{code:Number.isSafeInteger(q.code)?q.code:x.InternalError,message:(N=q.message)!==null&&N!==void 0?N:"Internal error",...q.data!==void 0&&{data:q.data}}};if(K&&this._taskMessageQueue)await this._enqueueTaskMessage(K,{type:"error",message:A,timestamp:Date.now()},z===null||z===void 0?void 0:z.sessionId);else await(z===null||z===void 0?void 0:z.send(A))}).catch((q)=>this._onerror(Error(`Failed to send response: ${q}`))).finally(()=>{this._requestHandlerAbortControllers.delete(X.id)})}_onprogress(X){let{progressToken:Q,...$}=X.params,Y=Number(Q),W=this._progressHandlers.get(Y);if(!W){this._onerror(Error(`Received a progress notification for an unknown token: ${JSON.stringify(X)}`));return}let J=this._responseHandlers.get(Y),G=this._timeoutInfo.get(Y);if(G&&J&&G.resetTimeoutOnProgress)try{this._resetTimeout(Y)}catch(H){this._responseHandlers.delete(Y),this._progressHandlers.delete(Y),this._cleanupTimeout(Y),J(H);return}W($)}_onresponse(X){let Q=Number(X.id),$=this._requestResolvers.get(Q);if($){if(this._requestResolvers.delete(Q),CX(X))$(X);else{let J=new k(X.error.code,X.error.message,X.error.data);$(J)}return}let Y=this._responseHandlers.get(Q);if(Y===void 0){this._onerror(Error(`Received a response for an unknown message ID: ${JSON.stringify(X)}`));return}this._responseHandlers.delete(Q),this._cleanupTimeout(Q);let W=!1;if(CX(X)&&X.result&&typeof X.result==="object"){let J=X.result;if(J.task&&typeof J.task==="object"){let G=J.task;if(typeof G.taskId==="string")W=!0,this._taskProgressTokens.set(G.taskId,Q)}}if(!W)this._progressHandlers.delete(Q);if(CX(X))Y(X);else{let J=k.fromError(X.error.code,X.error.message,X.error.data);Y(J)}}get transport(){return this._transport}async close(){var X;await((X=this._transport)===null||X===void 0?void 0:X.close())}async*requestStream(X,Q,$){var Y,W,J,G;let{task:H}=$!==null&&$!==void 0?$:{};if(!H){try{yield{type:"result",result:await this.request(X,Q,$)}}catch(z){yield{type:"error",error:z instanceof k?z:new k(x.InternalError,String(z))}}return}let B;try{let z=await this.request(X,x6,$);if(z.task)B=z.task.taskId,yield{type:"taskCreated",task:z.task};else throw new k(x.InternalError,"Task creation did not return a task");while(!0){let K=await this.getTask({taskId:B},$);if(yield{type:"taskStatus",task:K},u1(K.status)){if(K.status==="completed")yield{type:"result",result:await this.getTaskResult({taskId:B},Q,$)};else if(K.status==="failed")yield{type:"error",error:new k(x.InternalError,`Task ${B} failed`)};else if(K.status==="cancelled")yield{type:"error",error:new k(x.InternalError,`Task ${B} was cancelled`)};return}if(K.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:B},Q,$)};return}let V=(J=(Y=K.pollInterval)!==null&&Y!==void 0?Y:(W=this._options)===null||W===void 0?void 0:W.defaultTaskPollInterval)!==null&&J!==void 0?J:1000;await new Promise((L)=>setTimeout(L,V)),(G=$===null||$===void 0?void 0:$.signal)===null||G===void 0||G.throwIfAborted()}}catch(z){yield{type:"error",error:z instanceof k?z:new k(x.InternalError,String(z))}}}request(X,Q,$){let{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J,task:G,relatedTask:H}=$!==null&&$!==void 0?$:{};return new Promise((B,z)=>{var K,V,L,U,F,q,N;let A=(s)=>{z(s)};if(!this._transport){A(Error("Not connected"));return}if(((K=this._options)===null||K===void 0?void 0:K.enforceStrictCapabilities)===!0)try{if(this.assertCapabilityForMethod(X.method),G)this.assertTaskCapability(X.method)}catch(s){A(s);return}(V=$===null||$===void 0?void 0:$.signal)===null||V===void 0||V.throwIfAborted();let M=this._requestMessageId++,R={...X,jsonrpc:"2.0",id:M};if($===null||$===void 0?void 0:$.onprogress)this._progressHandlers.set(M,$.onprogress),R.params={...X.params,_meta:{...((L=X.params)===null||L===void 0?void 0:L._meta)||{},progressToken:M}};if(G)R.params={...R.params,task:G};if(H)R.params={...R.params,_meta:{...((U=R.params)===null||U===void 0?void 0:U._meta)||{},[K1]:H}};let S=(s)=>{var D0;this._responseHandlers.delete(M),this._progressHandlers.delete(M),this._cleanupTimeout(M),(D0=this._transport)===null||D0===void 0||D0.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:M,reason:String(s)}},{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J}).catch((W1)=>this._onerror(Error(`Failed to send cancellation: ${W1}`)));let q0=s instanceof k?s:new k(x.RequestTimeout,String(s));z(q0)};this._responseHandlers.set(M,(s)=>{var D0;if((D0=$===null||$===void 0?void 0:$.signal)===null||D0===void 0?void 0:D0.aborted)return;if(s instanceof Error)return z(s);try{let q0=f1(Q,s.result);if(!q0.success)z(q0.error);else B(q0.data)}catch(q0){z(q0)}}),(F=$===null||$===void 0?void 0:$.signal)===null||F===void 0||F.addEventListener("abort",()=>{var s;S((s=$===null||$===void 0?void 0:$.signal)===null||s===void 0?void 0:s.reason)});let C=(q=$===null||$===void 0?void 0:$.timeout)!==null&&q!==void 0?q:LN,K0=()=>S(k.fromError(x.RequestTimeout,"Request timed out",{timeout:C}));this._setupTimeout(M,C,$===null||$===void 0?void 0:$.maxTotalTimeout,K0,(N=$===null||$===void 0?void 0:$.resetTimeoutOnProgress)!==null&&N!==void 0?N:!1);let U0=H===null||H===void 0?void 0:H.taskId;if(U0){let s=(D0)=>{let q0=this._responseHandlers.get(M);if(q0)q0(D0);else this._onerror(Error(`Response handler missing for side-channeled request ${M}`))};this._requestResolvers.set(M,s),this._enqueueTaskMessage(U0,{type:"request",message:R,timestamp:Date.now()}).catch((D0)=>{this._cleanupTimeout(M),z(D0)})}else this._transport.send(R,{relatedRequestId:Y,resumptionToken:W,onresumptiontoken:J}).catch((s)=>{this._cleanupTimeout(M),z(s)})})}async getTask(X,Q){return this.request({method:"tasks/get",params:X},Q8,Q)}async getTaskResult(X,Q,$){return this.request({method:"tasks/result",params:X},Q,$)}async listTasks(X,Q){return this.request({method:"tasks/list",params:X},W8,Q)}async cancelTask(X,Q){return this.request({method:"tasks/cancel",params:X},L5,Q)}async notification(X,Q){var $,Y,W,J,G;if(!this._transport)throw Error("Not connected");this.assertNotificationCapability(X.method);let H=($=Q===null||Q===void 0?void 0:Q.relatedTask)===null||$===void 0?void 0:$.taskId;if(H){let V={...X,jsonrpc:"2.0",params:{...X.params,_meta:{...((Y=X.params)===null||Y===void 0?void 0:Y._meta)||{},[K1]:Q.relatedTask}}};await this._enqueueTaskMessage(H,{type:"notification",message:V,timestamp:Date.now()});return}if(((J=(W=this._options)===null||W===void 0?void 0:W.debouncedNotificationMethods)!==null&&J!==void 0?J:[]).includes(X.method)&&!X.params&&!(Q===null||Q===void 0?void 0:Q.relatedRequestId)&&!(Q===null||Q===void 0?void 0:Q.relatedTask)){if(this._pendingDebouncedNotifications.has(X.method))return;this._pendingDebouncedNotifications.add(X.method),Promise.resolve().then(()=>{var V,L;if(this._pendingDebouncedNotifications.delete(X.method),!this._transport)return;let U={...X,jsonrpc:"2.0"};if(Q===null||Q===void 0?void 0:Q.relatedTask)U={...U,params:{...U.params,_meta:{...((V=U.params)===null||V===void 0?void 0:V._meta)||{},[K1]:Q.relatedTask}}};(L=this._transport)===null||L===void 0||L.send(U,Q).catch((F)=>this._onerror(F))});return}let K={...X,jsonrpc:"2.0"};if(Q===null||Q===void 0?void 0:Q.relatedTask)K={...K,params:{...K.params,_meta:{...((G=K.params)===null||G===void 0?void 0:G._meta)||{},[K1]:Q.relatedTask}}};await this._transport.send(K,Q)}setRequestHandler(X,Q){let $=r$(X);this.assertRequestHandlerCapability($),this._requestHandlers.set($,(Y,W)=>{let J=o$(X,Y);return Promise.resolve(Q(J,W))})}removeRequestHandler(X){this._requestHandlers.delete(X)}assertCanSetRequestHandler(X){if(this._requestHandlers.has(X))throw Error(`A request handler for ${X} already exists, which would be overridden`)}setNotificationHandler(X,Q){let $=r$(X);this._notificationHandlers.set($,(Y)=>{let W=o$(X,Y);return Promise.resolve(Q(W))})}removeNotificationHandler(X){this._notificationHandlers.delete(X)}_cleanupTaskProgressHandler(X){let Q=this._taskProgressTokens.get(X);if(Q!==void 0)this._progressHandlers.delete(Q),this._taskProgressTokens.delete(X)}async _enqueueTaskMessage(X,Q,$){var Y;if(!this._taskStore||!this._taskMessageQueue)throw Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let W=(Y=this._options)===null||Y===void 0?void 0:Y.maxTaskQueueSize;await this._taskMessageQueue.enqueue(X,Q,$,W)}async _clearTaskQueue(X,Q){if(this._taskMessageQueue){let $=await this._taskMessageQueue.dequeueAll(X,Q);for(let Y of $)if(Y.type==="request"&&Z$(Y.message)){let W=Y.message.id,J=this._requestResolvers.get(W);if(J)J(new k(x.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(W);else this._onerror(Error(`Resolver missing for request ${W} during task ${X} cleanup`))}}}async _waitForTaskUpdate(X,Q){var $,Y,W;let J=(Y=($=this._options)===null||$===void 0?void 0:$.defaultTaskPollInterval)!==null&&Y!==void 0?Y:1000;try{let G=await((W=this._taskStore)===null||W===void 0?void 0:W.getTask(X));if(G===null||G===void 0?void 0:G.pollInterval)J=G.pollInterval}catch(G){}return new Promise((G,H)=>{if(Q.aborted){H(new k(x.InvalidRequest,"Request cancelled"));return}let B=setTimeout(G,J);Q.addEventListener("abort",()=>{clearTimeout(B),H(new k(x.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(X,Q){let $=this._taskStore;if(!$)throw Error("No task store configured");return{createTask:async(Y)=>{if(!X)throw Error("No request provided");return await $.createTask(Y,X.id,{method:X.method,params:X.params},Q)},getTask:async(Y)=>{let W=await $.getTask(Y,Q);if(!W)throw new k(x.InvalidParams,"Failed to retrieve task: Task not found");return W},storeTaskResult:async(Y,W,J)=>{await $.storeTaskResult(Y,W,J,Q);let G=await $.getTask(Y,Q);if(G){let H=xX.parse({method:"notifications/tasks/status",params:G});if(await this.notification(H),u1(G.status))this._cleanupTaskProgressHandler(Y)}},getTaskResult:(Y)=>{return $.getTaskResult(Y,Q)},updateTaskStatus:async(Y,W,J)=>{let G=await $.getTask(Y,Q);if(!G)throw new k(x.InvalidParams,`Task "${Y}" not found - it may have been cleaned up`);if(u1(G.status))throw new k(x.InvalidParams,`Cannot update task "${Y}" from terminal status "${G.status}" to "${W}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await $.updateTaskStatus(Y,W,J,Q);let H=await $.getTask(Y,Q);if(H){let B=xX.parse({method:"notifications/tasks/status",params:H});if(await this.notification(B),u1(H.status))this._cleanupTaskProgressHandler(Y)}},listTasks:(Y)=>{return $.listTasks(Y,Q)}}}}function XG(X){return X!==null&&typeof X==="object"&&!Array.isArray(X)}function QG(X,Q){let $={...X};for(let Y in Q){let W=Y,J=Q[W];if(J===void 0)continue;let G=$[W];if(XG(G)&&XG(J))$[W]={...G,...J};else $[W]=J}return $}var fz=K7(cY(),1),hz=K7(gz(),1);function ME(){let X=new fz.Ajv({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return hz.default(X),X}class eY{constructor(X){this._ajv=X!==null&&X!==void 0?X:ME()}getValidator(X){var Q;let $="$id"in X&&typeof X.$id==="string"?(Q=this._ajv.getSchema(X.$id))!==null&&Q!==void 0?Q:this._ajv.compile(X):this._ajv.compile(X);return(Y)=>{if($(Y))return{valid:!0,data:Y,errorMessage:void 0};else return{valid:!1,data:void 0,errorMessage:this._ajv.errorsText($.errors)}}}}class X7{constructor(X){this._server=X}requestStream(X,Q,$){return this._server.requestStream(X,Q,$)}async getTask(X,Q){return this._server.getTask({taskId:X},Q)}async getTaskResult(X,Q,$){return this._server.getTaskResult({taskId:X},Q,$)}async listTasks(X,Q){return this._server.listTasks(X?{cursor:X}:void 0,Q)}async cancelTask(X,Q){return this._server.cancelTask({taskId:X},Q)}}function uz(X,Q,$){var Y;if(!X)throw Error(`${$} does not support task creation (required for ${Q})`);switch(Q){case"tools/call":if(!((Y=X.tools)===null||Y===void 0?void 0:Y.call))throw Error(`${$} does not support task creation for tools/call (required for ${Q})`);break;default:break}}function lz(X,Q,$){var Y,W;if(!X)throw Error(`${$} does not support task creation (required for ${Q})`);switch(Q){case"sampling/createMessage":if(!((Y=X.sampling)===null||Y===void 0?void 0:Y.createMessage))throw Error(`${$} does not support task creation for sampling/createMessage (required for ${Q})`);break;case"elicitation/create":if(!((W=X.elicitation)===null||W===void 0?void 0:W.create))throw Error(`${$} does not support task creation for elicitation/create (required for ${Q})`);break;default:break}}class Q7 extends t${constructor(X,Q){var $,Y;super(Q);if(this._serverInfo=X,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(yX.options.map((W,J)=>[W,J])),this.isMessageIgnored=(W,J)=>{let G=this._loggingLevels.get(J);return G?this.LOG_LEVEL_SEVERITY.get(W)<this.LOG_LEVEL_SEVERITY.get(G):!1},this._capabilities=($=Q===null||Q===void 0?void 0:Q.capabilities)!==null&&$!==void 0?$:{},this._instructions=Q===null||Q===void 0?void 0:Q.instructions,this._jsonSchemaValidator=(Y=Q===null||Q===void 0?void 0:Q.jsonSchemaValidator)!==null&&Y!==void 0?Y:new eY,this.setRequestHandler(C$,(W)=>this._oninitialize(W)),this.setNotificationHandler(k$,()=>{var W;return(W=this.oninitialized)===null||W===void 0?void 0:W.call(this)}),this._capabilities.logging)this.setRequestHandler(f$,async(W,J)=>{var G;let H=J.sessionId||((G=J.requestInfo)===null||G===void 0?void 0:G.headers["mcp-session-id"])||void 0,{level:B}=W.params,z=yX.safeParse(B);if(z.success)this._loggingLevels.set(H,z.data);return{}})}get experimental(){if(!this._experimental)this._experimental={tasks:new X7(this)};return this._experimental}registerCapabilities(X){if(this.transport)throw Error("Cannot register capabilities after connecting to transport");this._capabilities=QG(this._capabilities,X)}setRequestHandler(X,Q){var $,Y,W;let J=h1(X),G=J===null||J===void 0?void 0:J.method;if(!G)throw Error("Schema is missing a method literal");let H;if(m0(G)){let z=G,K=($=z._zod)===null||$===void 0?void 0:$.def;H=(Y=K===null||K===void 0?void 0:K.value)!==null&&Y!==void 0?Y:z.value}else{let z=G,K=z._def;H=(W=K===null||K===void 0?void 0:K.value)!==null&&W!==void 0?W:z.value}if(typeof H!=="string")throw Error("Schema method literal must be a string");if(H==="tools/call"){let z=async(K,V)=>{let L=f1(g6,K);if(!L.success){let N=L.error instanceof Error?L.error.message:String(L.error);throw new k(x.InvalidParams,`Invalid tools/call request: ${N}`)}let{params:U}=L.data,F=await Promise.resolve(Q(K,V));if(U.task){let N=f1(x6,F);if(!N.success){let A=N.error instanceof Error?N.error.message:String(N.error);throw new k(x.InvalidParams,`Invalid task creation result: ${A}`)}return N.data}let q=f1(U8,F);if(!q.success){let N=q.error instanceof Error?q.error.message:String(q.error);throw new k(x.InvalidParams,`Invalid tools/call result: ${N}`)}return q.data};return super.setRequestHandler(X,z)}return super.setRequestHandler(X,Q)}assertCapabilityForMethod(X){var Q,$,Y;switch(X){case"sampling/createMessage":if(!((Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.sampling))throw Error(`Client does not support sampling (required for ${X})`);break;case"elicitation/create":if(!(($=this._clientCapabilities)===null||$===void 0?void 0:$.elicitation))throw Error(`Client does not support elicitation (required for ${X})`);break;case"roots/list":if(!((Y=this._clientCapabilities)===null||Y===void 0?void 0:Y.roots))throw Error(`Client does not support listing roots (required for ${X})`);break;case"ping":break}}assertNotificationCapability(X){var Q,$;switch(X){case"notifications/message":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${X})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw Error(`Server does not support notifying about resources (required for ${X})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw Error(`Server does not support notifying of tool list changes (required for ${X})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw Error(`Server does not support notifying of prompt list changes (required for ${X})`);break;case"notifications/elicitation/complete":if(!(($=(Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.elicitation)===null||$===void 0?void 0:$.url))throw Error(`Client does not support URL elicitation (required for ${X})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(X){if(!this._capabilities)return;switch(X){case"completion/complete":if(!this._capabilities.completions)throw Error(`Server does not support completions (required for ${X})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${X})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw Error(`Server does not support prompts (required for ${X})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw Error(`Server does not support resources (required for ${X})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Server does not support tools (required for ${X})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw Error(`Server does not support tasks capability (required for ${X})`);break;case"ping":case"initialize":break}}assertTaskCapability(X){var Q,$;lz(($=(Q=this._clientCapabilities)===null||Q===void 0?void 0:Q.tasks)===null||$===void 0?void 0:$.requests,X,"Client")}assertTaskHandlerCapability(X){var Q;if(!this._capabilities)return;uz((Q=this._capabilities.tasks)===null||Q===void 0?void 0:Q.requests,X,"Server")}async _oninitialize(X){let Q=X.params.protocolVersion;return this._clientCapabilities=X.params.capabilities,this._clientVersion=X.params.clientInfo,{protocolVersion:$5.includes(Q)?Q:P$,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},t4)}async createMessage(X,Q){var $,Y;if(X.tools||X.toolChoice){if(!((Y=($=this._clientCapabilities)===null||$===void 0?void 0:$.sampling)===null||Y===void 0?void 0:Y.tools))throw Error("Client does not support sampling tools capability.")}if(X.messages.length>0){let W=X.messages[X.messages.length-1],J=Array.isArray(W.content)?W.content:[W.content],G=J.some((K)=>K.type==="tool_result"),H=X.messages.length>1?X.messages[X.messages.length-2]:void 0,B=H?Array.isArray(H.content)?H.content:[H.content]:[],z=B.some((K)=>K.type==="tool_use");if(G){if(J.some((K)=>K.type!=="tool_result"))throw Error("The last message must contain only tool_result content if any is present");if(!z)throw Error("tool_result blocks are not matching any tool_use from the previous message")}if(z){let K=new Set(B.filter((L)=>L.type==="tool_use").map((L)=>L.id)),V=new Set(J.filter((L)=>L.type==="tool_result").map((L)=>L.toolUseId));if(K.size!==V.size||![...K].every((L)=>V.has(L)))throw Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}if(X.tools)return this.request({method:"sampling/createMessage",params:X},u$,Q);return this.request({method:"sampling/createMessage",params:X},h$,Q)}async elicitInput(X,Q){var $,Y,W,J,G;switch(($=X.mode)!==null&&$!==void 0?$:"form"){case"url":{if(!((W=(Y=this._clientCapabilities)===null||Y===void 0?void 0:Y.elicitation)===null||W===void 0?void 0:W.url))throw Error("Client does not support url elicitation.");let B=X;return this.request({method:"elicitation/create",params:B},V8,Q)}case"form":{if(!((G=(J=this._clientCapabilities)===null||J===void 0?void 0:J.elicitation)===null||G===void 0?void 0:G.form))throw Error("Client does not support form elicitation.");let B=X.mode==="form"?X:{...X,mode:"form"},z=await this.request({method:"elicitation/create",params:B},V8,Q);if(z.action==="accept"&&z.content&&B.requestedSchema)try{let V=this._jsonSchemaValidator.getValidator(B.requestedSchema)(z.content);if(!V.valid)throw new k(x.InvalidParams,`Elicitation response content does not match requested schema: ${V.errorMessage}`)}catch(K){if(K instanceof k)throw K;throw new k(x.InternalError,`Error validating elicitation response: ${K instanceof Error?K.message:String(K)}`)}return z}}}createElicitationCompletionNotifier(X,Q){var $,Y;if(!((Y=($=this._clientCapabilities)===null||$===void 0?void 0:$.elicitation)===null||Y===void 0?void 0:Y.url))throw Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:X}},Q)}async listRoots(X,Q){return this.request({method:"roots/list",params:X},l$,Q)}async sendLoggingMessage(X,Q){if(this._capabilities.logging){if(!this.isMessageIgnored(X.level,Q))return this.notification({method:"notifications/message",params:X})}}async sendResourceUpdated(X){return this.notification({method:"notifications/resources/updated",params:X})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}var cz=Symbol.for("mcp.completable");function pz(X){return!!X&&typeof X==="object"&&cz in X}function dz(X){let Q=X[cz];return Q===null||Q===void 0?void 0:Q.complete}var mz;(function(X){X.Completable="McpCompletable"})(mz||(mz={}));var jE=/^[A-Za-z0-9._-]{1,128}$/;function RE(X){let Q=[];if(X.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(X.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${X.length})`]};if(X.includes(" "))Q.push("Tool name contains spaces, which may cause parsing issues");if(X.includes(","))Q.push("Tool name contains commas, which may cause parsing issues");if(X.startsWith("-")||X.endsWith("-"))Q.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts");if(X.startsWith(".")||X.endsWith("."))Q.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts");if(!jE.test(X)){let $=X.split("").filter((Y)=>!/[A-Za-z0-9._-]/.test(Y)).filter((Y,W,J)=>J.indexOf(Y)===W);return Q.push(`Tool name contains invalid characters: ${$.map((Y)=>`"${Y}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:Q}}return{isValid:!0,warnings:Q}}function EE(X,Q){if(Q.length>0){console.warn(`Tool name validation warning for "${X}":`);for(let $ of Q)console.warn(`  - ${$}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function $7(X){let Q=RE(X);return EE(X,Q.warnings),Q.isValid}class Y7{constructor(X){this._mcpServer=X}registerToolTask(X,Q,$){let Y={taskSupport:"required",...Q.execution};if(Y.taskSupport==="forbidden")throw Error(`Cannot register task-based tool '${X}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(X,Q.title,Q.description,Q.inputSchema,Q.outputSchema,Q.annotations,Y,Q._meta,$)}}class J7{constructor(X,Q){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Q7(X,Q)}get experimental(){if(!this._experimental)this._experimental={tasks:new Y7(this)};return this._experimental}async connect(X){return await this.server.connect(X)}async close(){await this.server.close()}setToolRequestHandlers(){if(this._toolHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(K8)),this.server.assertCanSetRequestHandler(r1(g6)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(K8,()=>({tools:Object.entries(this._registeredTools).filter(([,X])=>X.enabled).map(([X,Q])=>{let $={name:X,title:Q.title,description:Q.description,inputSchema:(()=>{let Y=T6(Q.inputSchema);return Y?n$(Y,{strictUnions:!0,pipeStrategy:"input"}):IE})(),annotations:Q.annotations,execution:Q.execution,_meta:Q._meta};if(Q.outputSchema){let Y=T6(Q.outputSchema);if(Y)$.outputSchema=n$(Y,{strictUnions:!0,pipeStrategy:"output"})}return $})})),this.server.setRequestHandler(g6,async(X,Q)=>{var $;try{let Y=this._registeredTools[X.params.name];if(!Y)throw new k(x.InvalidParams,`Tool ${X.params.name} not found`);if(!Y.enabled)throw new k(x.InvalidParams,`Tool ${X.params.name} disabled`);let W=!!X.params.task,J=($=Y.execution)===null||$===void 0?void 0:$.taskSupport,G="createTask"in Y.handler;if((J==="required"||J==="optional")&&!G)throw new k(x.InternalError,`Tool ${X.params.name} has taskSupport '${J}' but was not registered with registerToolTask`);if(J==="required"&&!W)throw new k(x.MethodNotFound,`Tool ${X.params.name} requires task augmentation (taskSupport: 'required')`);if(J==="optional"&&!W&&G)return await this.handleAutomaticTaskPolling(Y,X,Q);let H=await this.validateToolInput(Y,X.params.arguments,X.params.name),B=await this.executeToolHandler(Y,H,Q);if(W)return B;return await this.validateToolOutput(Y,B,X.params.name),B}catch(Y){if(Y instanceof k){if(Y.code===x.UrlElicitationRequired)throw Y}return this.createToolError(Y instanceof Error?Y.message:String(Y))}}),this._toolHandlersInitialized=!0}createToolError(X){return{content:[{type:"text",text:X}],isError:!0}}async validateToolInput(X,Q,$){if(!X.inputSchema)return;let Y=T6(X.inputSchema),W=Y!==null&&Y!==void 0?Y:X.inputSchema,J=await m4(W,Q);if(!J.success){let G="error"in J?J.error:"Unknown error",H=c4(G);throw new k(x.InvalidParams,`Input validation error: Invalid arguments for tool ${$}: ${H}`)}return J.data}async validateToolOutput(X,Q,$){if(!X.outputSchema)return;if(!("content"in Q))return;if(Q.isError)return;if(!Q.structuredContent)throw new k(x.InvalidParams,`Output validation error: Tool ${$} has an output schema but no structured content was provided`);let Y=T6(X.outputSchema),W=await m4(Y,Q.structuredContent);if(!W.success){let J="error"in W?W.error:"Unknown error",G=c4(J);throw new k(x.InvalidParams,`Output validation error: Invalid structured content for tool ${$}: ${G}`)}}async executeToolHandler(X,Q,$){let Y=X.handler;if("createTask"in Y){if(!$.taskStore)throw Error("No task store provided.");let J={...$,taskStore:$.taskStore};if(X.inputSchema)return await Promise.resolve(Y.createTask(Q,J));else return await Promise.resolve(Y.createTask(J))}if(X.inputSchema)return await Promise.resolve(Y(Q,$));else return await Promise.resolve(Y($))}async handleAutomaticTaskPolling(X,Q,$){var Y;if(!$.taskStore)throw Error("No task store provided for task-capable tool.");let W=await this.validateToolInput(X,Q.params.arguments,Q.params.name),J=X.handler,G={...$,taskStore:$.taskStore},H=W?await Promise.resolve(J.createTask(W,G)):await Promise.resolve(J.createTask(G)),B=H.task.taskId,z=H.task,K=(Y=z.pollInterval)!==null&&Y!==void 0?Y:5000;while(z.status!=="completed"&&z.status!=="failed"&&z.status!=="cancelled"){await new Promise((L)=>setTimeout(L,K));let V=await $.taskStore.getTask(B);if(!V)throw new k(x.InternalError,`Task ${B} not found during polling`);z=V}return await $.taskStore.getTaskResult(B)}setCompletionRequestHandler(){if(this._completionHandlerInitialized)return;this.server.assertCanSetRequestHandler(r1(L8)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(L8,async(X)=>{switch(X.params.ref.type){case"ref/prompt":return A5(X),this.handlePromptCompletion(X,X.params.ref);case"ref/resource":return w5(X),this.handleResourceCompletion(X,X.params.ref);default:throw new k(x.InvalidParams,`Invalid completion reference: ${X.params.ref}`)}}),this._completionHandlerInitialized=!0}async handlePromptCompletion(X,Q){let $=this._registeredPrompts[Q.name];if(!$)throw new k(x.InvalidParams,`Prompt ${Q.name} not found`);if(!$.enabled)throw new k(x.InvalidParams,`Prompt ${Q.name} disabled`);if(!$.argsSchema)return H4;let Y=h1($.argsSchema),W=Y===null||Y===void 0?void 0:Y[X.params.argument.name];if(!pz(W))return H4;let J=dz(W);if(!J)return H4;let G=await J(X.params.argument.value,X.params.context);return nz(G)}async handleResourceCompletion(X,Q){let $=Object.values(this._registeredResourceTemplates).find((J)=>J.resourceTemplate.uriTemplate.toString()===Q.uri);if(!$){if(this._registeredResources[Q.uri])return H4;throw new k(x.InvalidParams,`Resource template ${X.params.ref.uri} not found`)}let Y=$.resourceTemplate.completeCallback(X.params.argument.name);if(!Y)return H4;let W=await Y(X.params.argument.value,X.params.context);return nz(W)}setResourceRequestHandlers(){if(this._resourceHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(J8)),this.server.assertCanSetRequestHandler(r1(G8)),this.server.assertCanSetRequestHandler(r1(H8)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(J8,async(X,Q)=>{let $=Object.entries(this._registeredResources).filter(([W,J])=>J.enabled).map(([W,J])=>({uri:W,name:J.name,...J.metadata})),Y=[];for(let W of Object.values(this._registeredResourceTemplates)){if(!W.resourceTemplate.listCallback)continue;let J=await W.resourceTemplate.listCallback(Q);for(let G of J.resources)Y.push({...W.metadata,...G})}return{resources:[...$,...Y]}}),this.server.setRequestHandler(G8,async()=>{return{resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([Q,$])=>({name:Q,uriTemplate:$.resourceTemplate.uriTemplate.toString(),...$.metadata}))}}),this.server.setRequestHandler(H8,async(X,Q)=>{let $=new URL(X.params.uri),Y=this._registeredResources[$.toString()];if(Y){if(!Y.enabled)throw new k(x.InvalidParams,`Resource ${$} disabled`);return Y.readCallback($,Q)}for(let W of Object.values(this._registeredResourceTemplates)){let J=W.resourceTemplate.uriTemplate.match($.toString());if(J)return W.readCallback($,J,Q)}throw new k(x.InvalidParams,`Resource ${$} not found`)}),this.setCompletionRequestHandler(),this._resourceHandlersInitialized=!0}setPromptRequestHandlers(){if(this._promptHandlersInitialized)return;this.server.assertCanSetRequestHandler(r1(B8)),this.server.assertCanSetRequestHandler(r1(z8)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(B8,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,X])=>X.enabled).map(([X,Q])=>{return{name:X,title:Q.title,description:Q.description,arguments:Q.argsSchema?PE(Q.argsSchema):void 0}})})),this.server.setRequestHandler(z8,async(X,Q)=>{let $=this._registeredPrompts[X.params.name];if(!$)throw new k(x.InvalidParams,`Prompt ${X.params.name} not found`);if(!$.enabled)throw new k(x.InvalidParams,`Prompt ${X.params.name} disabled`);if($.argsSchema){let Y=T6($.argsSchema),W=await m4(Y,X.params.arguments);if(!W.success){let H="error"in W?W.error:"Unknown error",B=c4(H);throw new k(x.InvalidParams,`Invalid arguments for prompt ${X.params.name}: ${B}`)}let J=W.data,G=$.callback;return await Promise.resolve(G(J,Q))}else{let Y=$.callback;return await Promise.resolve(Y(Q))}}),this.setCompletionRequestHandler(),this._promptHandlersInitialized=!0}resource(X,Q,...$){let Y;if(typeof $[0]==="object")Y=$.shift();let W=$[0];if(typeof Q==="string"){if(this._registeredResources[Q])throw Error(`Resource ${Q} is already registered`);let J=this._createRegisteredResource(X,void 0,Q,Y,W);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}else{if(this._registeredResourceTemplates[X])throw Error(`Resource template ${X} is already registered`);let J=this._createRegisteredResourceTemplate(X,void 0,Q,Y,W);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}}registerResource(X,Q,$,Y){if(typeof Q==="string"){if(this._registeredResources[Q])throw Error(`Resource ${Q} is already registered`);let W=this._createRegisteredResource(X,$.title,Q,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),W}else{if(this._registeredResourceTemplates[X])throw Error(`Resource template ${X} is already registered`);let W=this._createRegisteredResourceTemplate(X,$.title,Q,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),W}}_createRegisteredResource(X,Q,$,Y,W){let J={name:X,title:Q,metadata:Y,readCallback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({uri:null}),update:(G)=>{if(typeof G.uri<"u"&&G.uri!==$){if(delete this._registeredResources[$],G.uri)this._registeredResources[G.uri]=J}if(typeof G.name<"u")J.name=G.name;if(typeof G.title<"u")J.title=G.title;if(typeof G.metadata<"u")J.metadata=G.metadata;if(typeof G.callback<"u")J.readCallback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResources[$]=J,J}_createRegisteredResourceTemplate(X,Q,$,Y,W){let J={resourceTemplate:$,title:Q,metadata:Y,readCallback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==X){if(delete this._registeredResourceTemplates[X],G.name)this._registeredResourceTemplates[G.name]=J}if(typeof G.title<"u")J.title=G.title;if(typeof G.template<"u")J.resourceTemplate=G.template;if(typeof G.metadata<"u")J.metadata=G.metadata;if(typeof G.callback<"u")J.readCallback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResourceTemplates[X]=J,J}_createRegisteredPrompt(X,Q,$,Y,W){let J={title:Q,description:$,argsSchema:Y===void 0?void 0:v6(Y),callback:W,enabled:!0,disable:()=>J.update({enabled:!1}),enable:()=>J.update({enabled:!0}),remove:()=>J.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==X){if(delete this._registeredPrompts[X],G.name)this._registeredPrompts[G.name]=J}if(typeof G.title<"u")J.title=G.title;if(typeof G.description<"u")J.description=G.description;if(typeof G.argsSchema<"u")J.argsSchema=v6(G.argsSchema);if(typeof G.callback<"u")J.callback=G.callback;if(typeof G.enabled<"u")J.enabled=G.enabled;this.sendPromptListChanged()}};return this._registeredPrompts[X]=J,J}_createRegisteredTool(X,Q,$,Y,W,J,G,H,B){$7(X);let z={title:Q,description:$,inputSchema:iz(Y),outputSchema:iz(W),annotations:J,execution:G,_meta:H,handler:B,enabled:!0,disable:()=>z.update({enabled:!1}),enable:()=>z.update({enabled:!0}),remove:()=>z.update({name:null}),update:(K)=>{if(typeof K.name<"u"&&K.name!==X){if(typeof K.name==="string")$7(K.name);if(delete this._registeredTools[X],K.name)this._registeredTools[K.name]=z}if(typeof K.title<"u")z.title=K.title;if(typeof K.description<"u")z.description=K.description;if(typeof K.paramsSchema<"u")z.inputSchema=v6(K.paramsSchema);if(typeof K.callback<"u")z.handler=K.callback;if(typeof K.annotations<"u")z.annotations=K.annotations;if(typeof K._meta<"u")z._meta=K._meta;if(typeof K.enabled<"u")z.enabled=K.enabled;this.sendToolListChanged()}};return this._registeredTools[X]=z,this.setToolRequestHandlers(),this.sendToolListChanged(),z}tool(X,...Q){if(this._registeredTools[X])throw Error(`Tool ${X} is already registered`);let $,Y,W,J;if(typeof Q[0]==="string")$=Q.shift();if(Q.length>1){let H=Q[0];if(W7(H)){if(Y=Q.shift(),Q.length>1&&typeof Q[0]==="object"&&Q[0]!==null&&!W7(Q[0]))J=Q.shift()}else if(typeof H==="object"&&H!==null)J=Q.shift()}let G=Q[0];return this._createRegisteredTool(X,void 0,$,Y,W,J,{taskSupport:"forbidden"},void 0,G)}registerTool(X,Q,$){if(this._registeredTools[X])throw Error(`Tool ${X} is already registered`);let{title:Y,description:W,inputSchema:J,outputSchema:G,annotations:H,_meta:B}=Q;return this._createRegisteredTool(X,Y,W,J,G,H,{taskSupport:"forbidden"},B,$)}prompt(X,...Q){if(this._registeredPrompts[X])throw Error(`Prompt ${X} is already registered`);let $;if(typeof Q[0]==="string")$=Q.shift();let Y;if(Q.length>1)Y=Q.shift();let W=Q[0],J=this._createRegisteredPrompt(X,void 0,$,Y,W);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),J}registerPrompt(X,Q,$){if(this._registeredPrompts[X])throw Error(`Prompt ${X} is already registered`);let{title:Y,description:W,argsSchema:J}=Q,G=this._createRegisteredPrompt(X,Y,W,J,$);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),G}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(X,Q){return this.server.sendLoggingMessage(X,Q)}sendResourceListChanged(){if(this.isConnected())this.server.sendResourceListChanged()}sendToolListChanged(){if(this.isConnected())this.server.sendToolListChanged()}sendPromptListChanged(){if(this.isConnected())this.server.sendPromptListChanged()}}var IE={type:"object",properties:{}};function rz(X){return X!==null&&typeof X==="object"&&"parse"in X&&typeof X.parse==="function"&&"safeParse"in X&&typeof X.safeParse==="function"}function bE(X){return"_def"in X||"_zod"in X||rz(X)}function W7(X){if(typeof X!=="object"||X===null)return!1;if(bE(X))return!1;if(Object.keys(X).length===0)return!0;return Object.values(X).some(rz)}function iz(X){if(!X)return;if(W7(X))return v6(X);return X}function PE(X){let Q=h1(X);if(!Q)return[];return Object.entries(Q).map(([$,Y])=>{let W=TJ(Y),J=_J(Y);return{name:$,description:W,required:!J}})}function r1(X){let Q=h1(X),$=Q===null||Q===void 0?void 0:Q.method;if(!$)throw Error("Schema is missing a method literal");let Y=p4($);if(typeof Y==="string")return Y;throw Error("Schema method literal must be a string")}function nz(X){return{completion:{values:X.slice(0,100),total:X.length,hasMore:X.length>100}}}var H4={completion:{values:[],hasMore:!1}};function SE(X,Q,$,Y){return{name:X,description:Q,inputSchema:$,handler:Y}}function ZE(X){let Q=new J7({name:X.name,version:X.version??"1.0.0"},{capabilities:{tools:X.tools?{}:void 0}});if(X.tools)X.tools.forEach(($)=>{Q.tool($.name,$.description,$.inputSchema,$.handler)});return{type:"sdk",name:X.name,instance:Q}}function o_({prompt:X,options:Q}){let{systemPrompt:$,settingSources:Y,sandbox:W,...J}=Q??{},G,H;if($===void 0)G="";else if(typeof $==="string")G=$;else if($.type==="preset")H=$.append;let B=J.pathToClaudeCodeExecutable;if(!B){let q6=CE(import.meta.url),F6=oz(q6,"..");B=oz(F6,"cli.js")}process.env.CLAUDE_AGENT_SDK_VERSION="0.2.22";let{abortController:z=N6(),additionalDirectories:K=[],agent:V,agents:L,allowedTools:U=[],betas:F,canUseTool:q,continue:N,cwd:A,disallowedTools:M=[],tools:R,env:S,executable:C=j6()?"bun":"node",executableArgs:K0=[],extraArgs:U0={},fallbackModel:s,enableFileCheckpointing:D0,forkSession:q0,hooks:W1,includePartialMessages:P1,persistSession:U6,maxThinkingTokens:d,maxTurns:Q9,maxBudgetUsd:o6,mcpServers:V6,model:t6,outputFormat:a6,permissionMode:B4="default",allowDangerouslySkipPermissions:S0=!1,permissionPromptToolName:S1,plugins:s6,resume:tz,resumeSessionAt:az,stderr:sz,strictMcpConfig:ez}=J,G7=a6?.type==="json_schema"?a6.schema:void 0,L6=S;if(!L6)L6={...process.env};if(!L6.CLAUDE_CODE_ENTRYPOINT){};if(D0)L6.CLAUDE_CODE_ENABLE_SDK_FILE_CHECKPOINTING="true";if(!B)throw Error("pathToClaudeCodeExecutable is required");let $9={},H7=new Map;if(V6)for(let[q6,F6]of Object.entries(V6))if(F6.type==="sdk"&&"instance"in F6)H7.set(q6,F6.instance),$9[q6]={type:"sdk",name:q6};else $9[q6]=F6;let XK=typeof X==="string",B7=new XX({abortController:z,additionalDirectories:K,agent:V,betas:F,cwd:A,executable:C,executableArgs:K0,extraArgs:U0,pathToClaudeCodeExecutable:B,env:L6,forkSession:q0,stderr:sz,maxThinkingTokens:d,maxTurns:Q9,maxBudgetUsd:o6,model:t6,fallbackModel:s,jsonSchema:G7,permissionMode:B4,allowDangerouslySkipPermissions:S0,permissionPromptToolName:S1,continueConversation:N,resume:tz,resumeSessionAt:az,settingSources:Y??[],allowedTools:U,disallowedTools:M,tools:R,mcpServers:$9,strictMcpConfig:ez,canUseTool:!!q,hooks:!!W1,includePartialMessages:P1,persistSession:U6,plugins:s6,sandbox:W,spawnClaudeCodeProcess:J.spawnClaudeCodeProcess}),z7=new $X(B7,XK,q,W1,z,H7,G7,{systemPrompt:G,appendSystemPrompt:H,agents:L});if(typeof X==="string")B7.write(Z0({type:"user",session_id:"",message:{role:"user",content:[{type:"text",text:X}]},parent_tool_use_id:null})+`
 `);else z7.streamInput(X);return z7}function t_(X){return V9(X)}function a_(X,Q){return KW(X,Q)}async function s_(X,Q){let Y=[];try{const $=V7(Y,V9(Q),1);await $.send(X);for await(let B of $.stream())if(B.type==="result")return B;throw Error("Session ended without result message")}catch(W){var J=W,G=1}finally{var H=L7(Y,J,G);H&&await H}}export{a_ as unstable_v2_resumeSession,s_ as unstable_v2_prompt,t_ as unstable_v2_createSession,SE as tool,o_ as query,ZE as createSdkMcpServer,pU as HOOK_EVENTS,dU as EXIT_REASONS,F1 as AbortError};
diff --git a/node_modules/@anthropic-ai/claude-agent-sdk/cli.js b/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
index 0000000..0000000 100644
--- a/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
+++ b/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
@@ -828,7 +828,7 @@
 `,K)+1}return{type:A,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(A){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let K=c91(A),q=eXA(K);return q.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:q,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let K=c91(A),q=eXA(K);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:q,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(A,K){if(this.type!=="comment")return!1;if(this.indent<=K)return!1;return A.every((q)=>q.type==="newline"||q.type==="space")}*documentEnd(A){if(this.type!=="doc-mode"){if(A.end)A.end.push(this.sourceToken);else A.end=[this.sourceToken];if(this.type==="newline")yield*this.pop()}}*lineEnd(A){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:if(A.end)A.end.push(this.sourceToken);else A.end=[this.sourceToken];if(this.type==="newline")yield*this.pop()}}}Af9.Parser=aI4});var KS4=v((Xf9)=>{var sI4=D96(),qf9=hIA(),gIA=bIA(),Yf9=k36(),zf9=MY(),wf9=k96(),tI4=C96();function eI4(A){let K=A.prettyErrors!==!1;return{lineCounter:A.lineCounter||K&&new wf9.LineCounter||null,prettyErrors:K}}function Hf9(A,K={}){let{lineCounter:q,prettyErrors:Y}=eI4(K),z=new tI4.Parser(q?.addNewLine),w=new sI4.Composer(K),H=Array.from(w.compose(z.parse(A)));if(Y&&q)for(let J of H)J.errors.forEach(gIA.prettifyError(A,q)),J.warnings.forEach(gIA.prettifyError(A,q));if(H.length>0)return H;return Object.assign([],{empty:!0},w.streamInfo())}function AS4(A,K={}){let{lineCounter:q,prettyErrors:Y}=eI4(K),z=new tI4.Parser(q?.addNewLine),w=new sI4.Composer(K),H=null;for(let J of w.compose(z.parse(A),!0,A.length))if(!H)H=J;else if(H.options.logLevel!=="silent"){H.errors.push(new gIA.YAMLParseError(J.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}if(Y&&q)H.errors.forEach(gIA.prettifyError(A,q)),H.warnings.forEach(gIA.prettifyError(A,q));return H}function Jf9(A,K,q){let Y=void 0;if(typeof K==="function")Y=K;else if(q===void 0&&K&&typeof K==="object")q=K;let z=AS4(A,q);if(!z)return null;if(z.warnings.forEach((w)=>Yf9.warn(z.options.logLevel,w)),z.errors.length>0)if(z.options.logLevel!=="silent")throw z.errors[0];else z.errors=[];return z.toJS(Object.assign({reviver:Y},q))}function Of9(A,K,q){let Y=null;if(typeof K==="function"||Array.isArray(K))Y=K;else if(q===void 0&&K)q=K;if(typeof q==="string")q=q.length;if(typeof q==="number"){let z=Math.round(q);q=z<1?void 0:z>8?{indent:8}:{indent:z}}if(A===void 0){let{keepUndefined:z}=q??K??{};if(!z)return}if(zf9.isDocument(A)&&!Y)return A.toString(q);return new qf9.Document(A,Y,q).toString(q)}Xf9.parse=Jf9;Xf9.parseAllDocuments=Hf9;Xf9.parseDocument=AS4;Xf9.stringify=Of9});var Wf9,Df9,jf9,L96,Mf9,Sr,Pf9,Vf9,ff9,Nf9,CZw,Tf9,vf9,Ef9,l91,qS4,kf9,Cf9,Lf9,Rf9,yf9,If9,Sf9,hf9,bf9,xf9,uf9,Bf9,mf9,gf9,Ff9,Qf9,Uf9,pf9,df9,cf9,lf9,if9,i91,nf9,rf9,of9,af9,sf9;var YS4=C(()=>{Wf9=D96(),Df9=hIA(),jf9=e36(),L96=bIA(),Mf9=MIA(),Sr=MY(),Pf9=Cr(),Vf9=tX(),ff9=Rr(),Nf9=yr(),CZw=p91(),Tf9=E96(),vf9=k96(),Ef9=C96(),l91=KS4(),qS4=DIA();kf9=Wf9.Composer,Cf9=Df9.Document,Lf9=jf9.Schema,Rf9=L96.YAMLError,yf9=L96.YAMLParseError,If9=L96.YAMLWarning,Sf9=Mf9.Alias,hf9=Sr.isAlias,bf9=Sr.isCollection,xf9=Sr.isDocument,uf9=Sr.isMap,Bf9=Sr.isNode,mf9=Sr.isPair,gf9=Sr.isScalar,Ff9=Sr.isSeq,Qf9=Pf9.Pair,Uf9=Vf9.Scalar,pf9=ff9.YAMLMap,df9=Nf9.YAMLSeq,cf9=Tf9.Lexer,lf9=vf9.LineCounter,if9=Ef9.Parser,i91=l91.parse,nf9=l91.parseAllDocuments,rf9=l91.parseDocument,of9=l91.stringify,af9=qS4.visit,sf9=qS4.visitAsync});function ef9(A){let K=A.split(`
 `),q=[];for(let Y of K){let z=Y.match(/^([a-zA-Z_-]+):\s+(.+)$/);if(z){let[,w,H]=z;if(!w||!H){q.push(Y);continue}if(H.startsWith('"')&&H.endsWith('"')||H.startsWith("'")&&H.endsWith("'")){q.push(Y);continue}if(tf9.test(H)){let J=H.replace(/\\/g,"\\\\").replace(/"/g,"\\\"");q.push(`${w}: "${J}"`);continue}}q.push(Y)}return q.join(`
 `)}function z_(A){let K=/^---\s*\n([\s\S]*?)---\s*\n?/,q=A.match(K);if(!q)return{frontmatter:{},content:A};let Y=q[1]||"",z=A.slice(q[0].length),w={};try{let H=i91(Y);if(H&&typeof H==="object"&&!Array.isArray(H))w=H}catch{try{let H=ef9(Y),J=i91(H);if(J&&typeof J==="object"&&!Array.isArray(J))w=J}catch{}}return{frontmatter:w,content:z}}function zS4(A){let K=[],q="",Y=0;for(let w=0;w<A.length;w++){let H=A[w];if(H==="{")Y++,q+=H;else if(H==="}")Y--,q+=H;else if(H===","&&Y===0){let J=q.trim();if(J)K.push(J);q=""}else q+=H}let z=q.trim();if(z)K.push(z);return K.filter((w)=>w.length>0).flatMap((w)=>wS4(w))}function wS4(A){let K=A.match(/^([^{]*)\{([^}]+)\}(.*)$/);if(!K)return[A];let q=K[1]||"",Y=K[2]||"",z=K[3]||"",w=Y.split(",").map((J)=>J.trim()),H=[];for(let J of w){let O=q+J+z,X=wS4(O);H.push(...X)}return H}function HS4(A){if(A===void 0||A===null)return;let K=typeof A==="number"?A:parseInt(String(A),10);if(Number.isInteger(K)&&K>0)return K;return}var tf9;var mQ=C(()=>{YS4();tf9=/[{}[\]*&#!|>%@`]/});import{dirname as AN9,join as n91,resolve as JS4}from"path";import{readdir as KN9,readFile as qN9,stat as OS4,lstat as YN9,realpath as zN9}from"fs/promises";import{existsSync as y96}from"fs";import{homedir as wN9}from"os";function gQ(A,K="Custom item"){let q=A.split(`
-`);for(let Y of q){let z=Y.trim();if(z){let H=z.match(/^#+\s+(.+)$/)?.[1]??z;return H.length>100?H.substring(0,97)+"...":H}}return K}function $S4(A){if(A===void 0||A===null)return null;if(!A)return[];let K=[];if(typeof A==="string")K=[A];else if(Array.isArray(A))K=A.filter((Y)=>typeof Y==="string");if(K.length===0)return[];let q=UQ(K);if(q.includes("*"))return["*"];return q}function r4A(A){let K=$S4(A);if(K===null)return A===void 0?void 0:[];if(K.includes("*"))return;return K}function Sy(A){let K=$S4(A);if(K===null)return[];return K}async function HN9(A){try{let K=await YN9(A,{bigint:!0});return`${K.dev}:${K.ino}`}catch{return null}}function I96(A,K){let q=JS4(wN9()),Y=fl(K),z=JS4(K),w=[];if(!y96(z))return w;while(!0){if(z===q)break;let H=n91(z,".claude",A);if(y96(H))w.push(H);if(Y&&z===Y)break;let J=AN9(z);if(J===z)break;z=J}return w}async function JN9(A,K){let q=[],Y=new Set;async function z(w){if(K.aborted)return;try{let H=await OS4(w,{bigint:!0});if(H.isDirectory()){let J=H.dev!==void 0&&H.ino!==void 0?`${H.dev}:${H.ino}`:await zN9(w);if(Y.has(J)){h(`Skipping already visited directory (circular symlink): ${w}`);return}Y.add(J)}}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to stat directory ${w}: ${J}`);return}try{let H=await KN9(w,{withFileTypes:!0});for(let J of H){if(K.aborted)break;let O=n91(w,J.name);try{if(J.isSymbolicLink())try{let X=await OS4(O);if(X.isDirectory())await z(O);else if(X.isFile()&&J.name.endsWith(".md"))q.push(O)}catch(X){let $=X instanceof Error?X.message:String(X);h(`Failed to follow symlink ${O}: ${$}`)}else if(J.isDirectory())await z(O);else if(J.isFile()&&J.name.endsWith(".md"))q.push(O)}catch(X){let $=X instanceof Error?X.message:String(X);h(`Failed to access ${O}: ${$}`)}}}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to read directory ${w}: ${J}`)}}return await z(A),q}async function R96(A){let K=s7(),q=setTimeout(()=>K.abort(),3000);try{if(!y96(A))return[];let z=j1(process.env.CLAUDE_CODE_USE_NATIVE_FILE_SEARCH)?await JN9(A,K.signal):await rh(["--files","--hidden","--follow","--no-ignore","--glob","*.md"],A,K.signal);return(await Promise.all(z.map(async(H)=>{try{let J=await qN9(H,{encoding:"utf-8"}),{frontmatter:O,content:X}=z_(J);return{filePath:H,frontmatter:O,content:X}}catch(J){let O=J instanceof Error?J.message:String(J);return h(`Failed to read/parse markdown file:  ${H}: ${O}`),null}}))).filter((H)=>H!==null)}finally{clearTimeout(q)}}var XS4,FQ;var QQ=C(()=>{oh();mQ();hr();W1();Gz();l6();B8();i1();KO();d7();Ow();XS4=["commands","agents","output-styles","skills"];FQ=a1(async function(A,K){let q=Date.now(),Y=n91(H8(),A),z=n91(kT(),".claude",A),w=I96(A,K),[H,J,O]=await Promise.all([R96(z).then((D)=>D.map((j)=>({...j,baseDir:z,source:"policySettings"}))),o$("userSettings")?R96(Y).then((D)=>D.map((j)=>({...j,baseDir:Y,source:"userSettings"}))):Promise.resolve([]),o$("projectSettings")?Promise.all(w.map((D)=>R96(D).then((j)=>j.map((M)=>({...M,baseDir:D,source:"projectSettings"}))))):Promise.resolve([])]),X=O.flat(),$=[...H,...J,...X],_=await Promise.all($.map((D)=>HN9(D.filePath))),Z=new Map,G=[];for(let[D,j]of $.entries()){let M=_[D]??null;if(M===null){G.push(j);continue}let P=Z.get(M);if(P!==void 0){h(`Skipping duplicate file '${j.filePath}' from ${j.source} (same inode already loaded from ${P})`);continue}Z.set(M,j.source),G.push(j)}let W=$.length-G.length;if(W>0)h(`Deduplicated ${W} files in ${A} (same inode via symlinks or hard links)`);return n("tengu_dir_search",{durationMs:Date.now()-q,managedFilesFound:H.length,userFilesFound:J.length,projectFilesFound:X.length,projectDirsSearched:w.length,subdir:A}),G},(A,K)=>`${A}:${K}`)});var hx;var _S4=C(()=>{hx=["PreToolUse","PostToolUse","PostToolUseFailure","Notification","UserPromptSubmit","SessionStart","SessionEnd","Stop","SubagentStart","SubagentStop","PreCompact","PermissionRequest","Setup"]});var ZS4=()=>{};var A$A=C(()=>{_S4();ZS4()});var ON9,XN9,$N9,GS4,WS4,rk;var r91=C(()=>{J7();A$A();ON9=U.object({type:U.literal("command").describe("Bash command hook type"),command:U.string().describe("Shell command to execute"),timeout:U.number().positive().optional().describe("Timeout in seconds for this specific command"),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution"),async:U.boolean().optional().describe("If true, hook runs in background without blocking")}),XN9=U.object({type:U.literal("prompt").describe("LLM prompt hook type"),prompt:U.string().describe("Prompt to evaluate with LLM. Use $ARGUMENTS placeholder for hook input JSON."),timeout:U.number().positive().optional().describe("Timeout in seconds for this specific prompt evaluation"),model:U.string().optional().describe('Model to use for this prompt hook (e.g., "claude-sonnet-4-5-20250929"). If not specified, uses the default small fast model.'),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution")}),$N9=U.object({type:U.literal("agent").describe("Agentic verifier hook type"),prompt:U.string().transform((A)=>(K)=>A).describe('Prompt describing what to verify (e.g. "Verify that unit tests ran and passed."). Use $ARGUMENTS placeholder for hook input JSON.'),timeout:U.number().positive().optional().describe("Timeout in seconds for agent execution (default 60)"),model:U.string().optional().describe('Model to use for this agent hook (e.g., "claude-sonnet-4-5-20250929"). If not specified, uses Haiku.'),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution")}),GS4=U.discriminatedUnion("type",[ON9,XN9,$N9]),WS4=U.object({matcher:U.string().optional().describe('String pattern to match (e.g. tool names like "Write")'),hooks:U.array(GS4).describe("List of hooks to execute when the matcher matches")}),rk=U.partialRecord(U.enum(hx),U.array(WS4))});var S96,YGw,h96,_N9,ZN9,GN9,WN9,DN9,jN9,MN9,bx,DS4;var o4A=C(()=>{J7();S96=U.enum(["local","user","project","dynamic","enterprise","claudeai","managed"]),YGw=U.enum(["stdio","sse","sse-ide","http","ws","sdk"]),h96=U.object({type:U.literal("stdio").optional(),command:U.string().min(1,"Command cannot be empty"),args:U.array(U.string()).default([]),env:U.record(U.string(),U.string()).optional()}),_N9=U.object({type:U.literal("sse"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),ZN9=U.object({type:U.literal("sse-ide"),url:U.string(),ideName:U.string(),ideRunningInWindows:U.boolean().optional()}),GN9=U.object({type:U.literal("ws-ide"),url:U.string(),ideName:U.string(),authToken:U.string().optional(),ideRunningInWindows:U.boolean().optional()}),WN9=U.object({type:U.literal("http"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),DN9=U.object({type:U.literal("ws"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),jN9=U.object({type:U.literal("sdk"),name:U.string()}),MN9=U.object({type:U.literal("claudeai-proxy"),url:U.string(),id:U.string()}),bx=U.union([h96,_N9,ZN9,GN9,WN9,DN9,jN9,MN9]),DS4=U.object({mcpServers:U.record(U.string(),bx)})});function FIA(A,K){return K.autoUpdate??s4A.has(A.toLowerCase())}function fN9(A){if(s4A.has(A.toLowerCase()))return!1;if(VN9.test(A))return!0;return PN9.test(A)}function VS4(A,K){let q=A.toLowerCase();if(!s4A.has(q))return null;if(K.source==="github"){if(!(K.repo||"").toLowerCase().startsWith(`${o91}/`))return`The name '${A}' is reserved for official Anthropic marketplaces. Only repositories from 'github.com/${o91}/' can use this name.`;return null}if(K.source==="git"&&K.url){let Y=K.url.toLowerCase(),z=Y.includes("github.com/anthropics/"),w=Y.includes("git@github.com:anthropics/");if(z||w)return null;return`The name '${A}' is reserved for official Anthropic marketplaces. Only repositories from 'github.com/${o91}/' can use this name.`}return`The name '${A}' is reserved for official Anthropic marketplaces and can only be used with GitHub sources from the '${o91}' organization.`}function xx(A){return typeof A==="string"&&A.startsWith("./")}var s4A,PN9,VN9,o91="anthropics",pQ,K$A,jS4,b96,x96,fS4,NN9,NS4,TN9,vN9,EN9,kN9,CN9,LN9,RN9,MS4,yN9,q$A,IN9,t4A,TS4,QIA,PS4,SN9,hN9,Y$A,a4A,OGw,bN9,UIA,xN9,uN9,pIA,XGw,BN9,u96;var ED=C(()=>{J7();r91();o4A();s4A=new Set(["claude-code-marketplace","claude-code-plugins","claude-plugins-official","anthropic-marketplace","anthropic-plugins","agent-skills","life-sciences"]);PN9=/(?:official[^a-z0-9]*(anthropic|claude)|(?:anthropic|claude)[^a-z0-9]*official|^(?:anthropic|claude)[^a-z0-9]*(marketplace|plugins|official))/i,VN9=/[^\u0020-\u007E]/;pQ=U.string().startsWith("./"),K$A=pQ.endsWith(".json"),jS4=U.union([pQ.refine((A)=>A.endsWith(".mcpb")||A.endsWith(".dxt"),{message:"MCPB file path must end with .mcpb or .dxt"}).describe("Path to MCPB file relative to plugin root"),U.string().url().refine((A)=>A.endsWith(".mcpb")||A.endsWith(".dxt"),{message:"MCPB URL must end with .mcpb or .dxt"}).describe("URL to MCPB file")]),b96=pQ.endsWith(".md"),x96=U.union([b96,pQ]),fS4=U.object({name:U.string().min(1,"Author name cannot be empty").describe("Display name of the plugin author or organization"),email:U.string().optional().describe("Contact email for support or feedback"),url:U.string().optional().describe("Website, GitHub profile, or organization URL")}),NN9=U.object({name:U.string().min(1,"Plugin name cannot be empty").refine((A)=>!A.includes(" "),{message:'Plugin name cannot contain spaces. Use kebab-case (e.g., "my-plugin")'}).describe("Unique identifier for the plugin, used for namespacing (prefer kebab-case)"),version:U.string().optional().describe("Semantic version (e.g., 1.2.3) following semver.org specification"),description:U.string().optional().describe("Brief, user-facing explanation of what the plugin provides"),author:fS4.optional().describe("Information about the plugin creator or maintainer"),homepage:U.string().url().optional().describe("Plugin homepage or documentation URL"),repository:U.string().optional().describe("Source code repository URL"),license:U.string().optional().describe("SPDX license identifier (e.g., MIT, Apache-2.0)"),keywords:U.array(U.string()).optional().describe("Tags for plugin discovery and categorization")}),NS4=U.object({description:U.string().optional().describe("Brief, user-facing explanation of what these hooks provide"),hooks:U.lazy(()=>rk).describe("The hooks provided by the plugin, in the same format as the one used for settings")}),TN9=U.object({hooks:U.union([K$A.describe("Path to file with additional hooks (in addition to those in hooks/hooks.json, if it exists), relative to the plugin root"),U.lazy(()=>rk).describe("Additional hooks (in addition to those in hooks/hooks.json, if it exists)"),U.array(U.union([K$A.describe("Path to file with additional hooks (in addition to those in hooks/hooks.json, if it exists), relative to the plugin root"),U.lazy(()=>rk).describe("Additional hooks (in addition to those in hooks/hooks.json, if it exists)")]))])}),vN9=U.object({source:x96.optional().describe("Path to command markdown file, relative to plugin root"),content:U.string().optional().describe("Inline markdown content for the command"),description:U.string().optional().describe("Command description override"),argumentHint:U.string().optional().describe('Hint for command arguments (e.g., "[file]")'),model:U.string().optional().describe("Default model for this command"),allowedTools:U.array(U.string()).optional().describe("Tools allowed when command runs")}).refine((A)=>A.source&&!A.content||!A.source&&A.content,{message:'Command must have either "source" (file path) or "content" (inline markdown), but not both'}),EN9=U.object({commands:U.union([x96.describe("Path to additional command file or skill directory (in addition to those in the commands/ directory, if it exists), relative to the plugin root"),U.array(x96.describe("Path to additional command file or skill directory (in addition to those in the commands/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional command files or skill directories"),U.record(U.string(),vN9).describe('Object mapping of command names to their metadata and source files. Command name becomes the slash command name (e.g., "about" → "/plugin:about")')])}),kN9=U.object({agents:U.union([b96.describe("Path to additional agent file (in addition to those in the agents/ directory, if it exists), relative to the plugin root"),U.array(b96.describe("Path to additional agent file (in addition to those in the agents/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional agent files")])}),CN9=U.object({skills:U.union([pQ.describe("Path to additional skill directory (in addition to those in the skills/ directory, if it exists), relative to the plugin root"),U.array(pQ.describe("Path to additional skill directory (in addition to those in the skills/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional skill directories")])}),LN9=U.object({outputStyles:U.union([pQ.describe("Path to additional output styles directory or file (in addition to those in the output-styles/ directory, if it exists), relative to the plugin root"),U.array(pQ.describe("Path to additional output styles directory or file (in addition to those in the output-styles/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional output styles directories or files")])}),RN9=U.object({mcpServers:U.union([K$A.describe("MCP servers to include in the plugin (in addition to those in the .mcp.json file, if it exists)"),jS4.describe("Path or URL to MCPB file containing MCP server configuration"),U.record(U.string(),bx).describe("MCP server configurations keyed by server name"),U.array(U.union([K$A.describe("Path to MCP servers configuration file"),jS4.describe("Path or URL to MCPB file"),U.record(U.string(),bx).describe("Inline MCP server configurations")])).describe("Array of MCP server configurations (paths, MCPB files, or inline definitions)")])}),MS4=U.string().min(1),yN9=U.string().min(2).refine((A)=>A.startsWith("."),{message:'File extensions must start with dot (e.g., ".ts", not "ts")'}),q$A=U.strictObject({command:U.string().min(1).refine((A)=>{if(A.includes(" ")&&!A.startsWith("/"))return!1;return!0},{message:"Command should not contain spaces. Use args array for arguments."}).describe('Command to execute the LSP server (e.g., "typescript-language-server")'),args:U.array(MS4).optional().describe("Command-line arguments to pass to the server"),extensionToLanguage:U.record(yN9,MS4).refine((A)=>Object.keys(A).length>0,{message:"extensionToLanguage must have at least one mapping"}).describe("Mapping from file extension to LSP language ID. File extensions and languages are derived from this mapping."),transport:U.enum(["stdio","socket"]).default("stdio").describe("Communication transport mechanism"),env:U.record(U.string(),U.string()).optional().describe("Environment variables to set when starting the server"),initializationOptions:U.unknown().optional().describe("Initialization options passed to the server during initialization"),settings:U.unknown().optional().describe("Settings passed to the server via workspace/didChangeConfiguration"),workspaceFolder:U.string().optional().describe("Workspace folder path to use for the server"),startupTimeout:U.number().int().positive().optional().describe("Maximum time to wait for server startup (milliseconds)"),shutdownTimeout:U.number().int().positive().optional().describe("Maximum time to wait for graceful shutdown (milliseconds)"),restartOnCrash:U.boolean().optional().describe("Whether to restart the server if it crashes"),maxRestarts:U.number().int().nonnegative().optional().describe("Maximum number of restart attempts before giving up")}),IN9=U.object({lspServers:U.union([K$A.describe("Path to .lsp.json configuration file relative to plugin root"),U.record(U.string(),q$A).describe("LSP server configurations keyed by server name"),U.array(U.union([K$A.describe("Path to LSP configuration file"),U.record(U.string(),q$A).describe("Inline LSP server configurations")])).describe("Array of LSP server configurations (paths or inline definitions)")])}),t4A=U.object({...NN9.shape,...TN9.partial().shape,...EN9.partial().shape,...kN9.partial().shape,...CN9.partial().shape,...LN9.partial().shape,...RN9.partial().shape,...IN9.partial().shape}).strict(),TS4=U.string().refine((A)=>!A.includes("..")&&!A.includes("//"),"Package name cannot contain path traversal patterns").refine((A)=>{let K=/^@[a-z0-9][a-z0-9-._]*\/[a-z0-9][a-z0-9-._]*$/,q=/^[a-z0-9][a-z0-9-._]*$/;return K.test(A)||q.test(A)},"Invalid npm package name format"),QIA=U.discriminatedUnion("source",[U.object({source:U.literal("url"),url:U.string().url().describe("Direct URL to marketplace.json file"),headers:U.record(U.string(),U.string()).optional().describe("Custom HTTP headers (e.g., for authentication)")}),U.object({source:U.literal("github"),repo:U.string().describe("GitHub repository in owner/repo format"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),path:U.string().optional().describe("Path to marketplace.json within repo (defaults to .claude-plugin/marketplace.json)")}),U.object({source:U.literal("git"),url:U.string().endsWith(".git").describe("Full git repository URL"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),path:U.string().optional().describe("Path to marketplace.json within repo (defaults to .claude-plugin/marketplace.json)")}),U.object({source:U.literal("npm"),package:TS4.describe("NPM package containing marketplace.json")}),U.object({source:U.literal("file"),path:U.string().describe("Local file path to marketplace.json")}),U.object({source:U.literal("directory"),path:U.string().describe("Local directory containing .claude-plugin/marketplace.json")}),U.object({source:U.literal("hostPattern"),hostPattern:U.string().describe('Regex pattern to match the host/domain extracted from any marketplace source type. For github sources, matches against "github.com". For git sources (SSH or HTTPS), extracts the hostname from the URL. Use in strictKnownMarketplaces to allow all marketplaces from a specific host (e.g., "^github\\.mycompany\\.com$").')})]),PS4=U.string().length(40).regex(/^[a-f0-9]{40}$/,"Must be a full 40-character lowercase git commit SHA"),SN9=U.union([pQ.describe("Path to the plugin root, relative to the marketplace directory"),U.object({source:U.literal("npm"),package:TS4.or(U.string()).describe("Package name (or url, or local path, or anything else that can be passed to `npm` as a package)"),version:U.string().optional().describe("Specific version or version range (e.g., ^1.0.0, ~2.1.0)"),registry:U.string().url().optional().describe("Custom NPM registry URL (defaults to using system default, likely npmjs.org)")}).describe("NPM package as plugin source"),U.object({source:U.literal("pip"),package:U.string().describe("Python package name as it appears on PyPI"),version:U.string().optional().describe("Version specifier (e.g., ==1.0.0, >=2.0.0, <3.0.0)"),registry:U.string().url().optional().describe("Custom PyPI registry URL (defaults to using system default, likely pypi.org)")}).describe("Python package as plugin source"),U.object({source:U.literal("url"),url:U.string().endsWith(".git").describe("Full git repository URL (https:// or git@)"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),sha:PS4.optional().describe("Specific commit SHA to use")}),U.object({source:U.literal("github"),repo:U.string().describe("GitHub repository in owner/repo format"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),sha:PS4.optional().describe("Specific commit SHA to use")})]);hN9=t4A.partial().extend({name:U.string().min(1,"Plugin name cannot be empty").refine((A)=>!A.includes(" "),{message:'Plugin name cannot contain spaces. Use kebab-case (e.g., "my-plugin")'}).describe("Unique identifier matching the plugin name"),source:SN9.describe("Where to fetch the plugin from"),category:U.string().optional().describe('Category for organizing plugins (e.g., "productivity", "development")'),tags:U.array(U.string()).optional().describe("Tags for searchability and discovery"),strict:U.boolean().optional().default(!0).describe("Require the plugin manifest to be present in the plugin folder. If false, the marketplace entry provides the manifest.")}).strict(),Y$A=U.object({name:U.string().min(1,"Marketplace must have a name").refine((A)=>!A.includes(" "),{message:'Marketplace name cannot contain spaces. Use kebab-case (e.g., "my-marketplace")'}).refine((A)=>!fN9(A),{message:'Marketplace name cannot impersonate official Anthropic/Claude marketplaces. Names containing "official", "anthropic", or "claude" in official-sounding combinations are reserved.'}),owner:fS4.describe("Marketplace maintainer or curator information"),plugins:U.array(hN9).describe("Collection of available plugins in this marketplace"),metadata:U.object({pluginRoot:U.string().optional().describe("Base path for relative plugin sources"),version:U.string().optional().describe("Marketplace version"),description:U.string().optional().describe("Marketplace description")}).optional().describe("Optional marketplace metadata")}),a4A=U.string().regex(/^[a-z0-9][-a-z0-9._]*@[a-z0-9][-a-z0-9._]*$/i,"Plugin ID must be in format: plugin@marketplace"),OGw=U.union([a4A,U.object({id:a4A.describe('Plugin identifier (e.g., "formatter@tools")'),version:U.string().optional().describe('Version constraint (e.g., "^2.0.0")'),required:U.boolean().optional().describe("If true, cannot be disabled"),config:U.record(U.string(),U.unknown()).optional().describe("Plugin-specific configuration")})]),bN9=U.object({version:U.string().describe("Currently installed version"),installedAt:U.string().describe("ISO 8601 timestamp of installation"),lastUpdated:U.string().optional().describe("ISO 8601 timestamp of last update"),installPath:U.string().describe("Absolute path to the installed plugin directory"),gitCommitSha:U.string().optional().describe("Git commit SHA for git-based plugins (for version tracking)")}),UIA=U.object({version:U.literal(1).describe("Schema version 1"),plugins:U.record(a4A,bN9).describe("Map of plugin IDs to their installation metadata")}),xN9=U.enum(["managed","user","project","local"]),uN9=U.object({scope:xN9.describe("Installation scope"),projectPath:U.string().optional().describe("Project path (required for project/local scopes)"),installPath:U.string().describe("Absolute path to the versioned plugin directory"),version:U.string().optional().describe("Currently installed version"),installedAt:U.string().optional().describe("ISO 8601 timestamp of installation"),lastUpdated:U.string().optional().describe("ISO 8601 timestamp of last update"),gitCommitSha:U.string().optional().describe("Git commit SHA for git-based plugins")}),pIA=U.object({version:U.literal(2).describe("Schema version 2"),plugins:U.record(a4A,U.array(uN9)).describe("Map of plugin IDs to arrays of installation entries")}),XGw=U.union([UIA,pIA]),BN9=U.object({source:QIA.describe("Where to fetch the marketplace from"),installLocation:U.string().describe("Local cache path where marketplace manifest is stored"),lastUpdated:U.string().describe("ISO 8601 timestamp of last marketplace refresh"),autoUpdate:U.boolean().optional().describe("Whether to automatically update this marketplace and its installed plugins on startup")}),u96=U.record(U.string(),BN9)});import{join as mN9}from"path";function FN9(){if(VnA())return vS4;if(j1(process.env.CLAUDE_CODE_USE_COWORK_PLUGINS))return vS4;return gN9}function CT(){return mN9(H8(),FN9())}var gN9="plugins",vS4="cowork_plugins";var dIA=C(()=>{l6();s1()});async function QN9(A){try{return!!await AV(A)}catch{return!1}}var a91;var B96=C(()=>{d7();nl();a91=a1(async()=>{return QN9("git")})});function z$A(A,K){let Y=A.slice(0,2).map((H)=>{let J=H.reason||H.error||"unknown error";return K?`${H.name} (${J})`:H.name}).join(K?"; ":", "),z=A.length-2,w=z>0?` and ${z} more`:"";return`${Y}${w}`}function cIA(A){switch(A.source){case"github":return A.repo;case"url":return A.url;case"git":return A.url;case"directory":return A.path;case"file":return A.path;default:return"Unknown source"}}function ux(A,K){return`${A}@${K}`}async function dQ(A){let K=[],q=[];for(let[Y,z]of Object.entries(A)){if(!A7A(z.source))continue;let w=null;try{w=await HM(Y)}catch(H){let J=H instanceof Error?H.message:String(H);q.push({name:Y,error:J}),KA(H instanceof Error?H:Error(`Failed to load marketplace ${Y}: ${H}`))}K.push({name:Y,config:z,data:w})}return{marketplaces:K,failures:q}}function w$A(A,K){if(A.length===0)return null;if(K>0)return{type:"warning",message:A.length===1?`Warning: Failed to load marketplace '${A[0].name}': ${A[0].error}`:`Warning: Failed to load ${A.length} marketplaces: ${UN9(A)}`};return{type:"error",message:`Failed to load all marketplaces. Errors: ${pN9(A)}`}}function UN9(A){return A.map((K)=>K.name).join(", ")}function pN9(A){return A.map((K)=>`${K.name}: ${K.error}`).join("; ")}function e4A(){let A=N4("policySettings");if(!A?.strictKnownMarketplaces)return null;return A.strictKnownMarketplaces}function dN9(){let A=N4("policySettings");if(!A?.blockedMarketplaces)return null;return A.blockedMarketplaces}function cN9(A,K){if(A.source!==K.source)return!1;switch(A.source){case"url":return A.url===K.url;case"github":return A.repo===K.repo&&(A.ref||void 0)===(K.ref||void 0)&&(A.path||void 0)===(K.path||void 0);case"git":return A.url===K.url&&(A.ref||void 0)===(K.ref||void 0)&&(A.path||void 0)===(K.path||void 0);case"npm":return A.package===K.package;case"file":return A.path===K.path;case"directory":return A.path===K.path;default:return!1}}function m96(A){switch(A.source){case"github":return"github.com";case"git":{let K=A.url.match(/^[^@]+@([^:]+):/);if(K?.[1])return K[1];try{return new URL(A.url).hostname}catch{return null}}case"url":try{return new URL(A.url).hostname}catch{return null}default:return null}}function lN9(A,K){let q=m96(A);if(!q)return!1;try{return new RegExp(K.hostPattern).test(q)}catch{return KA(Error(`Invalid hostPattern regex: ${K.hostPattern}`)),!1}}function kS4(){let A=e4A();if(!A)return[];return A.filter((K)=>K.source==="hostPattern").map((K)=>K.hostPattern)}function ES4(A){let K=A.match(/^git@github\.com:([^/]+\/[^/]+?)(?:\.git)?$/);if(K&&K[1])return K[1];let q=A.match(/^https?:\/\/github\.com\/([^/]+\/[^/]+?)(?:\.git)?$/);if(q&&q[1])return q[1];return null}function br(A,K){if(!A)return!0;return(A||void 0)===(K||void 0)}function iN9(A,K){if(A.source===K.source)switch(A.source){case"github":{let q=K;if(A.repo!==q.repo)return!1;return br(q.ref,A.ref)&&br(q.path,A.path)}case"git":{let q=K;if(A.url!==q.url)return!1;return br(q.ref,A.ref)&&br(q.path,A.path)}case"url":return A.url===K.url;case"npm":return A.package===K.package;case"file":return A.path===K.path;case"directory":return A.path===K.path;default:return!1}if(A.source==="git"&&K.source==="github"){if(ES4(A.url)===K.repo)return br(K.ref,A.ref)&&br(K.path,A.path)}if(A.source==="github"&&K.source==="git"){if(ES4(K.url)===A.repo)return br(K.ref,A.ref)&&br(K.path,A.path)}return!1}function lIA(A){let K=dN9();if(K===null)return!1;return K.some((q)=>iN9(A,q))}function A7A(A){if(lIA(A))return!1;let K=e4A();if(K===null)return!0;return K.some((q)=>{if(q.source==="hostPattern")return lN9(A,q);return cN9(A,q)})}function H$A(A){switch(A.source){case"github":return`github:${A.repo}${A.ref?`@${A.ref}`:""}`;case"url":return A.url;case"git":return`git:${A.url}${A.ref?`@${A.ref}`:""}`;case"npm":return`npm:${A.package}`;case"file":return`file:${A.path}`;case"directory":return`dir:${A.path}`;case"hostPattern":return`hostPattern:${A.hostPattern}`;default:return"unknown source"}}async function CS4({configuredMarketplaceCount:A,failedMarketplaceCount:K}){if(!await a91())return"git-not-installed";let Y=e4A();if(Y!==null){if(Y.length===0)return"all-blocked-by-policy";if(A===0)return"policy-restricts-sources"}if(A===0)return"no-marketplaces-configured";if(K>0&&K===A)return"all-marketplaces-failed";return"all-plugins-installed"}var xr=C(()=>{kJ();v1();B8();B96()});function J$A(A){if(A.includes("@")){let K=A.split("@");return{name:K[0]||"",marketplace:K[1]}}return{name:A}}function Bx(A){if(A==="managed")throw Error("Cannot install plugins to managed scope");return nN9[A]}function RS4(A){return LS4[A]}var LS4,nN9;var K7A=C(()=>{LS4={policySettings:"managed",userSettings:"user",projectSettings:"project",localSettings:"local",flagSettings:"flag"};nN9={user:"userSettings",project:"projectSettings",local:"localSettings"}});import{dirname as kGw,join as q7A}from"path";function O$A(){return q7A(CT(),"installed_plugins.json")}function rN9(){return q7A(CT(),"installed_plugins_v2.json")}function oN9(){if(g96)return;let A=xA(),K=O$A(),q=rN9();try{let Y=A.existsSync(q),z=A.existsSync(K);if(Y){A.renameSync(q,K),h("Renamed installed_plugins_v2.json to installed_plugins.json");let w=kD();yS4(w)}else if(z){let w=A.readFileSync(K,{encoding:"utf-8"}),H=X6(w);if((typeof H?.version==="number"?H.version:1)===1){let O=UIA.parse(H),X=U96(O);b8(K,QA(X,null,2),{encoding:"utf-8",flush:!0}),h(`Converted installed_plugins.json from V1 to V2 format (${Object.keys(O.plugins).length} plugins)`),yS4(X)}}g96=!0}catch(Y){let z=Y instanceof Error?Y.message:String(Y);h(`Failed to migrate plugin files: ${z}`,{level:"error"}),KA(Y instanceof Error?Y:Error(`Failed to migrate plugin files: ${z}`)),g96=!0}}function yS4(A){let K=xA(),q=Br();if(!K.existsSync(q))return;try{let Y=new Set;for(let w of Object.values(A.plugins))for(let H of w)Y.add(H.installPath);let z=K.readdirSync(q);for(let w of z){if(!w.isDirectory())continue;let H=w.name,J=q7A(q,H);if(K.readdirSync(J).some(($)=>{if(!$.isDirectory())return!1;let _=q7A(J,$.name);return K.readdirSync(_).some((G)=>G.isDirectory())}))continue;if(!Y.has(J))K.rmSync(J,{recursive:!0,force:!0}),h(`Cleaned up legacy cache directory: ${H}`)}}catch(Y){let z=Y instanceof Error?Y.message:String(Y);h(`Failed to clean up legacy cache: ${z}`,{level:"warn"})}}function Q96(){let A=xA(),K=O$A();if(!A.existsSync(K))return null;let q=A.readFileSync(K,{encoding:"utf-8"}),Y=X6(q);return{version:typeof Y?.version==="number"?Y.version:1,data:Y}}function U96(A){let K={};for(let[q,Y]of Object.entries(A.plugins)){let z=gx(q,Y.version);K[q]=[{scope:"user",installPath:z,version:Y.version,installedAt:Y.installedAt,lastUpdated:Y.lastUpdated,gitCommitSha:Y.gitCommitSha}]}return{version:2,plugins:K}}function kD(){if(mx!==null)return mx;let A=O$A();try{let K=Q96();if(K){if(K.version===2){let z=pIA.parse(K.data);return mx=z,h(`Loaded ${Object.keys(z.plugins).length} installed plugins from ${A}`),z}let q=UIA.parse(K.data),Y=U96(q);return mx=Y,h(`Loaded and converted ${Object.keys(q.plugins).length} plugins from V1 format`),Y}return h("installed_plugins.json doesn't exist, returning empty V2 object"),mx={version:2,plugins:{}},mx}catch(K){let q=K instanceof Error?K.message:String(K);return h(`Failed to load installed_plugins.json: ${q}. Starting with empty state.`,{level:"error"}),KA(K instanceof Error?K:Error(`Failed to load installed_plugins.json: ${q}`)),mx={version:2,plugins:{}},mx}}function t91(A){let K=xA(),q=O$A();try{let Y=CT();if(!K.existsSync(Y))K.mkdirSync(Y);let z=QA(A,null,2);b8(q,z,{encoding:"utf-8",flush:!0}),mx=A,h(`Saved ${Object.keys(A.plugins).length} installed plugins to ${q}`)}catch(Y){let z=Y instanceof Error?Y.message:String(Y);throw KA(Y instanceof Error?Y:Error(`Failed to save installed_plugins.json: ${z}`)),Y}}function SS4(A,K,q){let Y=kD(),z=Y.plugins[A];if(!z)return;if(Y.plugins[A]=z.filter((w)=>!(w.scope===K&&w.projectPath===q)),Y.plugins[A].length===0)delete Y.plugins[A];t91(Y),h(`Removed installation for ${A} at scope ${K}`)}function p96(){if(F96===null)F96=kD();return F96}function ur(){try{let A=Q96();if(A){if(A.version===2)return pIA.parse(A.data);let K=UIA.parse(A.data);return U96(K)}return{version:2,plugins:{}}}catch(A){let K=A instanceof Error?A.message:String(A);return h(`Failed to load installed plugins from disk: ${K}`,{level:"error"}),{version:2,plugins:{}}}}function hS4(A,K,q,Y,z){let w=ur(),H=w.plugins[A];if(!H){h(`Cannot update ${A} on disk: plugin not found in installed plugins`);return}let J=H.find((O)=>O.scope===K&&O.projectPath===q);if(J){J.installPath=Y,J.version=z,J.lastUpdated=new Date().toISOString();let O=O$A();b8(O,QA(w,null,2),{encoding:"utf-8",flush:!0}),mx=null,h(`Updated ${A} on disk to version ${z} at ${Y}`)}else h(`Cannot update ${A} on disk: no installation for scope ${K}`)}async function d96(){oN9();try{await l96()}catch(K){KA(K instanceof Error?K:Error(String(K)))}let A=p96();h(`Initialized versioned plugins system with ${Object.keys(A.plugins).length} plugins`)}function aN9(A){let q=kD().plugins[A];if(!q||q.length===0)return;let Y=q[0];if(!Y)return;return{version:Y.version||"unknown",installedAt:Y.installedAt||new Date().toISOString(),lastUpdated:Y.lastUpdated,installPath:Y.installPath,gitCommitSha:Y.gitCommitSha}}function bS4(A){if(!A)return[];let K=kD(),q=`@${A}`,Y=new Set,z=!1;for(let w of Object.keys(K.plugins)){if(!w.endsWith(q))continue;for(let H of K.plugins[w]??[])if(H.installPath)Y.add(H.installPath);delete K.plugins[w],z=!0,h(`Removed installed plugin for marketplace removal: ${w}`)}if(z)t91(K);return Array.from(Y)}function xG(A){return aN9(A)!==void 0}function c96(A,K,q="user",Y){let z=kD(),w={scope:q,installPath:K.installPath,version:K.version,installedAt:K.installedAt,lastUpdated:K.lastUpdated,gitCommitSha:K.gitCommitSha,...Y&&{projectPath:Y}},H=z.plugins[A]||[],J=H.findIndex((X)=>X.scope===q&&X.projectPath===Y),O=J>=0;if(O)H[J]=w;else H.push(w);z.plugins[A]=H,t91(z),h(`${O?"Updated":"Added"} installed plugin: ${A} (scope: ${q})`)}async function s91(A){try{let K=await L6("git",["-C",A,"rev-parse","HEAD"]);if(K.code===0&&K.stdout)return K.stdout.trim();return}catch(K){h(`Failed to get git commit SHA from ${A}: ${K}`);return}}function IS4(A,K){let q=xA(),Y=q7A(A,".claude-plugin","plugin.json");if(!q.existsSync(Y))return"unknown";try{let z=q.readFileSync(Y,{encoding:"utf-8"});return X6(z).version||"unknown"}catch{return h(`Could not read version from manifest for ${K}`),"unknown"}}async function l96(){let K=O8().enabledPlugins||{};if(Object.keys(K).length===0)return;let q=Q96(),Y=q!==null;if(Y&&q?.version===2&&q){let G=pIA.safeParse(q.data);if(G?.success){let W=G.data.plugins;if(Object.keys(K).filter((j)=>j.includes("@")).every((j)=>{let M=W[j];return M&&M.length>0})){h("All plugins already exist, skipping migration");return}}}h(Y?"Syncing installed_plugins.json with enabledPlugins from all settings.json files":"Creating installed_plugins.json from settings.json files");let w=xA(),H=new Date().toISOString(),J=b1(),O=new Map,X=["userSettings","projectSettings","localSettings"];for(let G of X){let D=N4(G)?.enabledPlugins||{};for(let j of Object.keys(D)){if(!j.includes("@"))continue;let M=RS4(G);O.set(j,{scope:M,projectPath:M==="user"?void 0:J})}}let $={};if(Y)$={...kD().plugins};let _=0,Z=0;for(let[G,W]of O){let D=$[G];if(D&&D.length>0){let j=D[0];if(j&&(j.scope!==W.scope||j.projectPath!==W.projectPath)){if(j.scope=W.scope,W.projectPath)j.projectPath=W.projectPath;else delete j.projectPath;j.lastUpdated=H,_++,h(`Updated ${G} scope to ${W.scope} (settings.json is source of truth)`)}}else{let j=G.split("@"),M=j[0];if(!M||j.length!==2)continue;try{let P=await $Z(G);if(!P){h(`Plugin ${G} not found in any marketplace, skipping`);continue}let{entry:V,marketplaceInstallLocation:N}=P,T,E="unknown",R=void 0;if(typeof V.source==="string")T=q7A(N,V.source),E=IS4(T,G),R=await s91(T);else{let b=Br(),S=M.replace(/[^a-zA-Z0-9-_]/g,"-"),B=q7A(b,S);if(!w.existsSync(B)){h(`External plugin ${G} not in cache, skipping`);continue}T=B,E=IS4(B,G),R=await s91(B)}if(E==="unknown"&&V.version)E=V.version;if(E==="unknown"&&R)E=R.substring(0,12);$[G]=[{scope:W.scope,installPath:gx(G,E),version:E,installedAt:H,lastUpdated:H,gitCommitSha:R,...W.projectPath&&{projectPath:W.projectPath}}],Z++,h(`Added ${G} with scope ${W.scope}`)}catch(P){h(`Failed to add plugin ${G}: ${P}`)}}}if(!Y||_>0||Z>0)t91({version:2,plugins:$}),h(`Sync completed: ${Z} added, ${_} updated in installed_plugins.json`)}var g96=!1,mx=null,F96=null;var uG=C(()=>{s6();h1();W1();v1();dIA();ED();h1();B8();K7A();u4();d0();vK();kJ()});function JM(A){switch(A.type){case"generic-error":return A.error;case"path-not-found":return`Path not found: ${A.path} (${A.component})`;case"git-auth-failed":return`Git authentication failed (${A.authType}): ${A.gitUrl}`;case"git-timeout":return`Git ${A.operation} timeout: ${A.gitUrl}`;case"network-error":return`Network error: ${A.url}${A.details?` - ${A.details}`:""}`;case"manifest-parse-error":return`Manifest parse error: ${A.parseError}`;case"manifest-validation-error":return`Manifest validation failed: ${A.validationErrors.join(", ")}`;case"plugin-not-found":return`Plugin ${A.pluginId} not found in marketplace ${A.marketplace}`;case"marketplace-not-found":return`Marketplace ${A.marketplace} not found`;case"marketplace-load-failed":return`Marketplace ${A.marketplace} failed to load: ${A.reason}`;case"repository-scan-failed":return`Repository scan failed: ${A.reason}`;case"mcp-config-invalid":return`MCP server ${A.serverName} invalid: ${A.validationError}`;case"hook-load-failed":return`Hook load failed: ${A.reason}`;case"component-load-failed":return`${A.component} load failed from ${A.path}: ${A.reason}`;case"mcpb-download-failed":return`Failed to download MCPB from ${A.url}: ${A.reason}`;case"mcpb-extract-failed":return`Failed to extract MCPB ${A.mcpbPath}: ${A.reason}`;case"mcpb-invalid-manifest":return`MCPB manifest invalid at ${A.mcpbPath}: ${A.validationError}`;case"lsp-config-invalid":return`Plugin "${A.plugin}" has invalid LSP server config for "${A.serverName}": ${A.validationError}`;case"lsp-server-start-failed":return`Plugin "${A.plugin}" failed to start LSP server "${A.serverName}": ${A.reason}`;case"lsp-server-crashed":if(A.signal)return`Plugin "${A.plugin}" LSP server "${A.serverName}" crashed with signal ${A.signal}`;return`Plugin "${A.plugin}" LSP server "${A.serverName}" crashed with exit code ${A.exitCode??"unknown"}`;case"lsp-request-timeout":return`Plugin "${A.plugin}" LSP server "${A.serverName}" timed out on ${A.method} request after ${A.timeoutMs}ms`;case"lsp-request-failed":return`Plugin "${A.plugin}" LSP server "${A.serverName}" ${A.method} request failed: ${A.error}`;case"marketplace-blocked-by-policy":if(A.blockedByBlocklist)return`Marketplace '${A.marketplace}' is blocked by enterprise policy`;return`Marketplace '${A.marketplace}' is not in the allowed marketplace list`}}var uS4={};Aq(uS4,{sharp:()=>xS4,default:()=>sN9});function xS4(A){let K=null,q=[],Y=0;async function z(){if(!K)K=(async()=>{if(!e91)throw Error("Native image processor module not available");let{processImage:J}=e91;return J(A)})();return K}function w(J){for(let O=Y;O<q.length;O++){let X=q[O];if(X)X(J)}Y=q.length}let H={async metadata(){return(await z()).metadata()},resize(J,O,X){return q.push(($)=>{$.resize(J,O,X)}),H},jpeg(J){return q.push((O)=>{O.jpeg(J?.quality)}),H},png(J){return q.push((O)=>{O.png(J)}),H},webp(J){return q.push((O)=>{O.webp(J?.quality)}),H},async toBuffer(){let J=await z();return w(J),J.toBuffer()}};return H}var e91,sN9;var BS4=C(()=>{try{e91=(()=>{throw new Error("Cannot require module "+"../../image-processor.node");})()}catch(A){e91=null}sN9=xS4});var Fx=v((UGw,gS4)=>{var mS4=function(A){return typeof A<"u"&&A!==null},tN9=function(A){return typeof A==="object"},eN9=function(A){return Object.prototype.toString.call(A)==="[object Object]"},AT9=function(A){return typeof A==="function"},KT9=function(A){return typeof A==="boolean"},qT9=function(A){return A instanceof Buffer},YT9=function(A){if(mS4(A))switch(A.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},zT9=function(A){return A instanceof ArrayBuffer},wT9=function(A){return typeof A==="string"&&A.length>0},HT9=function(A){return typeof A==="number"&&!Number.isNaN(A)},JT9=function(A){return Number.isInteger(A)},OT9=function(A,K,q){return A>=K&&A<=q},XT9=function(A,K){return K.includes(A)},$T9=function(A,K,q){return Error(`Expected ${K} for ${A} but received ${q} of type ${typeof q}`)},_T9=function(A,K){return K.message=A.message,K};gS4.exports={defined:mS4,object:tN9,plainObject:eN9,fn:AT9,bool:KT9,buffer:qT9,typedArray:YT9,arrayBuffer:zT9,string:wT9,number:HT9,integer:JT9,inRange:OT9,inArray:XT9,invalidParameterError:$T9,nativeError:_T9}});var US4=v((pGw,QS4)=>{var FS4=()=>process.platform==="linux",AY1=null,ZT9=()=>{if(!AY1)if(FS4()&&process.report){let A=process.report.excludeNetwork;process.report.excludeNetwork=!0,AY1=process.report.getReport(),process.report.excludeNetwork=A}else AY1={};return AY1};QS4.exports={isLinux:FS4,getReport:ZT9}});var cS4=v((dGw,dS4)=>{var pS4=yA("fs"),GT9=(A)=>pS4.readFileSync(A,"utf-8"),WT9=(A)=>new Promise((K,q)=>{pS4.readFile(A,"utf-8",(Y,z)=>{if(Y)q(Y);else K(z)})});dS4.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:GT9,readFile:WT9}});var qY1=v((cGw,Hh4)=>{var iS4=yA("child_process"),{isLinux:$$A,getReport:nS4}=US4(),{LDD_PATH:KY1,readFile:rS4,readFileSync:oS4}=cS4(),Qx,Ux,mr="",aS4=()=>{if(!mr)return new Promise((A)=>{iS4.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",(K,q)=>{mr=K?" ":q,A(mr)})});return mr},sS4=()=>{if(!mr)try{mr=iS4.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(A){mr=" "}return mr},gr="glibc",tS4=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,X$A="musl",DT9=(A)=>A.includes("libc.musl-")||A.includes("ld-musl-"),eS4=()=>{let A=nS4();if(A.header&&A.header.glibcVersionRuntime)return gr;if(Array.isArray(A.sharedObjects)){if(A.sharedObjects.some(DT9))return X$A}return null},Ah4=(A)=>{let[K,q]=A.split(/[\r\n]+/);if(K&&K.includes(gr))return gr;if(q&&q.includes(X$A))return X$A;return null},Kh4=(A)=>{if(A.includes("musl"))return X$A;if(A.includes("GNU C Library"))return gr;return null},jT9=async()=>{if(Qx!==void 0)return Qx;Qx=null;try{let A=await rS4(KY1);Qx=Kh4(A)}catch(A){}return Qx},MT9=()=>{if(Qx!==void 0)return Qx;Qx=null;try{let A=oS4(KY1);Qx=Kh4(A)}catch(A){}return Qx},qh4=async()=>{let A=null;if($$A()){if(A=await jT9(),!A)A=eS4();if(!A){let K=await aS4();A=Ah4(K)}}return A},Yh4=()=>{let A=null;if($$A()){if(A=MT9(),!A)A=eS4();if(!A){let K=sS4();A=Ah4(K)}}return A},PT9=async()=>$$A()&&await qh4()!==gr,VT9=()=>$$A()&&Yh4()!==gr,fT9=async()=>{if(Ux!==void 0)return Ux;Ux=null;try{let K=(await rS4(KY1)).match(tS4);if(K)Ux=K[1]}catch(A){}return Ux},NT9=()=>{if(Ux!==void 0)return Ux;Ux=null;try{let K=oS4(KY1).match(tS4);if(K)Ux=K[1]}catch(A){}return Ux},zh4=()=>{let A=nS4();if(A.header&&A.header.glibcVersionRuntime)return A.header.glibcVersionRuntime;return null},lS4=(A)=>A.trim().split(/\s+/)[1],wh4=(A)=>{let[K,q,Y]=A.split(/[\r\n]+/);if(K&&K.includes(gr))return lS4(K);if(q&&Y&&q.includes(X$A))return lS4(Y);return null},TT9=async()=>{let A=null;if($$A()){if(A=await fT9(),!A)A=zh4();if(!A){let K=await aS4();A=wh4(K)}}return A},vT9=()=>{let A=null;if($$A()){if(A=NT9(),!A)A=zh4();if(!A){let K=sS4();A=wh4(K)}}return A};Hh4.exports={GLIBC:gr,MUSL:X$A,family:qh4,familySync:Yh4,isNonGlibcLinux:PT9,isNonGlibcLinuxSync:VT9,version:TT9,versionSync:vT9}});var iIA=v((lGw,Jh4)=>{var ET9=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...A)=>console.error("SEMVER",...A):()=>{};Jh4.exports=ET9});var YY1=v((iGw,Oh4)=>{var kT9=Number.MAX_SAFE_INTEGER||9007199254740991,CT9=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Oh4.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:kT9,RELEASE_TYPES:CT9,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var nIA=v((px,Xh4)=>{var{MAX_SAFE_COMPONENT_LENGTH:i96,MAX_SAFE_BUILD_LENGTH:LT9,MAX_LENGTH:RT9}=YY1(),yT9=iIA();px=Xh4.exports={};var IT9=px.re=[],ST9=px.safeRe=[],y7=px.src=[],hT9=px.safeSrc=[],I7=px.t={},bT9=0,n96="[a-zA-Z0-9-]",xT9=[["\\s",1],["\\d",RT9],[n96,LT9]],uT9=(A)=>{for(let[K,q]of xT9)A=A.split(`${K}*`).join(`${K}{0,${q}}`).split(`${K}+`).join(`${K}{1,${q}}`);return A},r5=(A,K,q)=>{let Y=uT9(K),z=bT9++;yT9(A,z,K),I7[A]=z,y7[z]=K,hT9[z]=Y,IT9[z]=new RegExp(K,q?"g":void 0),ST9[z]=new RegExp(Y,q?"g":void 0)};r5("NUMERICIDENTIFIER","0|[1-9]\\d*");r5("NUMERICIDENTIFIERLOOSE","\\d+");r5("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${n96}*`);r5("MAINVERSION",`(${y7[I7.NUMERICIDENTIFIER]})\\.(${y7[I7.NUMERICIDENTIFIER]})\\.(${y7[I7.NUMERICIDENTIFIER]})`);r5("MAINVERSIONLOOSE",`(${y7[I7.NUMERICIDENTIFIERLOOSE]})\\.(${y7[I7.NUMERICIDENTIFIERLOOSE]})\\.(${y7[I7.NUMERICIDENTIFIERLOOSE]})`);r5("PRERELEASEIDENTIFIER",`(?:${y7[I7.NUMERICIDENTIFIER]}|${y7[I7.NONNUMERICIDENTIFIER]})`);r5("PRERELEASEIDENTIFIERLOOSE",`(?:${y7[I7.NUMERICIDENTIFIERLOOSE]}|${y7[I7.NONNUMERICIDENTIFIER]})`);r5("PRERELEASE",`(?:-(${y7[I7.PRERELEASEIDENTIFIER]}(?:\\.${y7[I7.PRERELEASEIDENTIFIER]})*))`);r5("PRERELEASELOOSE",`(?:-?(${y7[I7.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${y7[I7.PRERELEASEIDENTIFIERLOOSE]})*))`);r5("BUILDIDENTIFIER",`${n96}+`);r5("BUILD",`(?:\\+(${y7[I7.BUILDIDENTIFIER]}(?:\\.${y7[I7.BUILDIDENTIFIER]})*))`);r5("FULLPLAIN",`v?${y7[I7.MAINVERSION]}${y7[I7.PRERELEASE]}?${y7[I7.BUILD]}?`);r5("FULL",`^${y7[I7.FULLPLAIN]}$`);r5("LOOSEPLAIN",`[v=\\s]*${y7[I7.MAINVERSIONLOOSE]}${y7[I7.PRERELEASELOOSE]}?${y7[I7.BUILD]}?`);r5("LOOSE",`^${y7[I7.LOOSEPLAIN]}$`);r5("GTLT","((?:<|>)?=?)");r5("XRANGEIDENTIFIERLOOSE",`${y7[I7.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);r5("XRANGEIDENTIFIER",`${y7[I7.NUMERICIDENTIFIER]}|x|X|\\*`);r5("XRANGEPLAIN",`[v=\\s]*(${y7[I7.XRANGEIDENTIFIER]})(?:\\.(${y7[I7.XRANGEIDENTIFIER]})(?:\\.(${y7[I7.XRANGEIDENTIFIER]})(?:${y7[I7.PRERELEASE]})?${y7[I7.BUILD]}?)?)?`);r5("XRANGEPLAINLOOSE",`[v=\\s]*(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:\\.(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:\\.(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:${y7[I7.PRERELEASELOOSE]})?${y7[I7.BUILD]}?)?)?`);r5("XRANGE",`^${y7[I7.GTLT]}\\s*${y7[I7.XRANGEPLAIN]}$`);r5("XRANGELOOSE",`^${y7[I7.GTLT]}\\s*${y7[I7.XRANGEPLAINLOOSE]}$`);r5("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i96}})(?:\\.(\\d{1,${i96}}))?(?:\\.(\\d{1,${i96}}))?`);r5("COERCE",`${y7[I7.COERCEPLAIN]}(?:$|[^\\d])`);r5("COERCEFULL",y7[I7.COERCEPLAIN]+`(?:${y7[I7.PRERELEASE]})?(?:${y7[I7.BUILD]})?(?:$|[^\\d])`);r5("COERCERTL",y7[I7.COERCE],!0);r5("COERCERTLFULL",y7[I7.COERCEFULL],!0);r5("LONETILDE","(?:~>?)");r5("TILDETRIM",`(\\s*)${y7[I7.LONETILDE]}\\s+`,!0);px.tildeTrimReplace="$1~";r5("TILDE",`^${y7[I7.LONETILDE]}${y7[I7.XRANGEPLAIN]}$`);r5("TILDELOOSE",`^${y7[I7.LONETILDE]}${y7[I7.XRANGEPLAINLOOSE]}$`);r5("LONECARET","(?:\\^)");r5("CARETTRIM",`(\\s*)${y7[I7.LONECARET]}\\s+`,!0);px.caretTrimReplace="$1^";r5("CARET",`^${y7[I7.LONECARET]}${y7[I7.XRANGEPLAIN]}$`);r5("CARETLOOSE",`^${y7[I7.LONECARET]}${y7[I7.XRANGEPLAINLOOSE]}$`);r5("COMPARATORLOOSE",`^${y7[I7.GTLT]}\\s*(${y7[I7.LOOSEPLAIN]})$|^$`);r5("COMPARATOR",`^${y7[I7.GTLT]}\\s*(${y7[I7.FULLPLAIN]})$|^$`);r5("COMPARATORTRIM",`(\\s*)${y7[I7.GTLT]}\\s*(${y7[I7.LOOSEPLAIN]}|${y7[I7.XRANGEPLAIN]})`,!0);px.comparatorTrimReplace="$1$2$3";r5("HYPHENRANGE",`^\\s*(${y7[I7.XRANGEPLAIN]})\\s+-\\s+(${y7[I7.XRANGEPLAIN]})\\s*$`);r5("HYPHENRANGELOOSE",`^\\s*(${y7[I7.XRANGEPLAINLOOSE]})\\s+-\\s+(${y7[I7.XRANGEPLAINLOOSE]})\\s*$`);r5("STAR","(<|>)?=?\\s*\\*");r5("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");r5("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var zY1=v((nGw,$h4)=>{var BT9=Object.freeze({loose:!0}),mT9=Object.freeze({}),gT9=(A)=>{if(!A)return mT9;if(typeof A!=="object")return BT9;return A};$h4.exports=gT9});var Wh4=v((rGw,Gh4)=>{var _h4=/^[0-9]+$/,Zh4=(A,K)=>{let q=_h4.test(A),Y=_h4.test(K);if(q&&Y)A=+A,K=+K;return A===K?0:q&&!Y?-1:Y&&!q?1:A<K?-1:1},FT9=(A,K)=>Zh4(K,A);Gh4.exports={compareIdentifiers:Zh4,rcompareIdentifiers:FT9}});var Z$A=v((oGw,Ph4)=>{var wY1=iIA(),{MAX_LENGTH:Dh4,MAX_SAFE_INTEGER:HY1}=YY1(),{safeRe:jh4,safeSrc:Mh4,t:JY1}=nIA(),QT9=zY1(),{compareIdentifiers:_$A}=Wh4();class hy{constructor(A,K){if(K=QT9(K),A instanceof hy)if(A.loose===!!K.loose&&A.includePrerelease===!!K.includePrerelease)return A;else A=A.version;else if(typeof A!=="string")throw TypeError(`Invalid version. Must be a string. Got type "${typeof A}".`);if(A.length>Dh4)throw TypeError(`version is longer than ${Dh4} characters`);wY1("SemVer",A,K),this.options=K,this.loose=!!K.loose,this.includePrerelease=!!K.includePrerelease;let q=A.trim().match(K.loose?jh4[JY1.LOOSE]:jh4[JY1.FULL]);if(!q)throw TypeError(`Invalid Version: ${A}`);if(this.raw=A,this.major=+q[1],this.minor=+q[2],this.patch=+q[3],this.major>HY1||this.major<0)throw TypeError("Invalid major version");if(this.minor>HY1||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>HY1||this.patch<0)throw TypeError("Invalid patch version");if(!q[4])this.prerelease=[];else this.prerelease=q[4].split(".").map((Y)=>{if(/^[0-9]+$/.test(Y)){let z=+Y;if(z>=0&&z<HY1)return z}return Y});this.build=q[5]?q[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare(A){if(wY1("SemVer.compare",this.version,this.options,A),!(A instanceof hy)){if(typeof A==="string"&&A===this.version)return 0;A=new hy(A,this.options)}if(A.version===this.version)return 0;return this.compareMain(A)||this.comparePre(A)}compareMain(A){if(!(A instanceof hy))A=new hy(A,this.options);return _$A(this.major,A.major)||_$A(this.minor,A.minor)||_$A(this.patch,A.patch)}comparePre(A){if(!(A instanceof hy))A=new hy(A,this.options);if(this.prerelease.length&&!A.prerelease.length)return-1;else if(!this.prerelease.length&&A.prerelease.length)return 1;else if(!this.prerelease.length&&!A.prerelease.length)return 0;let K=0;do{let q=this.prerelease[K],Y=A.prerelease[K];if(wY1("prerelease compare",K,q,Y),q===void 0&&Y===void 0)return 0;else if(Y===void 0)return 1;else if(q===void 0)return-1;else if(q===Y)continue;else return _$A(q,Y)}while(++K)}compareBuild(A){if(!(A instanceof hy))A=new hy(A,this.options);let K=0;do{let q=this.build[K],Y=A.build[K];if(wY1("build compare",K,q,Y),q===void 0&&Y===void 0)return 0;else if(Y===void 0)return 1;else if(q===void 0)return-1;else if(q===Y)continue;else return _$A(q,Y)}while(++K)}inc(A,K,q){if(A.startsWith("pre")){if(!K&&q===!1)throw Error("invalid increment argument: identifier is empty");if(K){let Y=new RegExp(`^${this.options.loose?Mh4[JY1.PRERELEASELOOSE]:Mh4[JY1.PRERELEASE]}$`),z=`-${K}`.match(Y);if(!z||z[1]!==K)throw Error(`invalid identifier: ${K}`)}}switch(A){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",K,q);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",K,q);break;case"prepatch":this.prerelease.length=0,this.inc("patch",K,q),this.inc("pre",K,q);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",K,q);this.inc("pre",K,q);break;case"release":if(this.prerelease.length===0)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{let Y=Number(q)?1:0;if(this.prerelease.length===0)this.prerelease=[Y];else{let z=this.prerelease.length;while(--z>=0)if(typeof this.prerelease[z]==="number")this.prerelease[z]++,z=-2;if(z===-1){if(K===this.prerelease.join(".")&&q===!1)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(Y)}}if(K){let z=[K,Y];if(q===!1)z=[K];if(_$A(this.prerelease[0],K)===0){if(isNaN(this.prerelease[1]))this.prerelease=z}else this.prerelease=z}break}default:throw Error(`invalid increment argument: ${A}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}Ph4.exports=hy});var Nh4=v((aGw,fh4)=>{var Vh4=Z$A(),UT9=(A,K,q=!1)=>{if(A instanceof Vh4)return A;try{return new Vh4(A,K)}catch(Y){if(!q)return null;throw Y}};fh4.exports=UT9});var vh4=v((sGw,Th4)=>{var pT9=Z$A(),dT9=Nh4(),{safeRe:OY1,t:XY1}=nIA(),cT9=(A,K)=>{if(A instanceof pT9)return A;if(typeof A==="number")A=String(A);if(typeof A!=="string")return null;K=K||{};let q=null;if(!K.rtl)q=A.match(K.includePrerelease?OY1[XY1.COERCEFULL]:OY1[XY1.COERCE]);else{let O=K.includePrerelease?OY1[XY1.COERCERTLFULL]:OY1[XY1.COERCERTL],X;while((X=O.exec(A))&&(!q||q.index+q[0].length!==A.length)){if(!q||X.index+X[0].length!==q.index+q[0].length)q=X;O.lastIndex=X.index+X[1].length+X[2].length}O.lastIndex=-1}if(q===null)return null;let Y=q[2],z=q[3]||"0",w=q[4]||"0",H=K.includePrerelease&&q[5]?`-${q[5]}`:"",J=K.includePrerelease&&q[6]?`+${q[6]}`:"";return dT9(`${Y}.${z}.${w}${H}${J}`,K)};Th4.exports=cT9});var Y7A=v((tGw,kh4)=>{var Eh4=Z$A(),lT9=(A,K,q)=>new Eh4(A,q).compare(new Eh4(K,q));kh4.exports=lT9});var r96=v((eGw,Ch4)=>{var iT9=Y7A(),nT9=(A,K,q)=>iT9(A,K,q)>=0;Ch4.exports=nT9});var yh4=v((AWw,Rh4)=>{class Lh4{constructor(){this.max=1000,this.map=new Map}get(A){let K=this.map.get(A);if(K===void 0)return;else return this.map.delete(A),this.map.set(A,K),K}delete(A){return this.map.delete(A)}set(A,K){if(!this.delete(A)&&K!==void 0){if(this.map.size>=this.max){let Y=this.map.keys().next().value;this.delete(Y)}this.map.set(A,K)}return this}}Rh4.exports=Lh4});var Sh4=v((KWw,Ih4)=>{var rT9=Y7A(),oT9=(A,K,q)=>rT9(A,K,q)===0;Ih4.exports=oT9});var bh4=v((qWw,hh4)=>{var aT9=Y7A(),sT9=(A,K,q)=>aT9(A,K,q)!==0;hh4.exports=sT9});var uh4=v((YWw,xh4)=>{var tT9=Y7A(),eT9=(A,K,q)=>tT9(A,K,q)>0;xh4.exports=eT9});var mh4=v((zWw,Bh4)=>{var Av9=Y7A(),Kv9=(A,K,q)=>Av9(A,K,q)<0;Bh4.exports=Kv9});var Fh4=v((wWw,gh4)=>{var qv9=Y7A(),Yv9=(A,K,q)=>qv9(A,K,q)<=0;gh4.exports=Yv9});var Uh4=v((HWw,Qh4)=>{var zv9=Sh4(),wv9=bh4(),Hv9=uh4(),Jv9=r96(),Ov9=mh4(),Xv9=Fh4(),$v9=(A,K,q,Y)=>{switch(K){case"===":if(typeof A==="object")A=A.version;if(typeof q==="object")q=q.version;return A===q;case"!==":if(typeof A==="object")A=A.version;if(typeof q==="object")q=q.version;return A!==q;case"":case"=":case"==":return zv9(A,q,Y);case"!=":return wv9(A,q,Y);case">":return Hv9(A,q,Y);case">=":return Jv9(A,q,Y);case"<":return Ov9(A,q,Y);case"<=":return Xv9(A,q,Y);default:throw TypeError(`Invalid operator: ${K}`)}};Qh4.exports=$v9});var rh4=v((JWw,nh4)=>{var rIA=Symbol("SemVer ANY");class $Y1{static get ANY(){return rIA}constructor(A,K){if(K=ph4(K),A instanceof $Y1)if(A.loose===!!K.loose)return A;else A=A.value;if(A=A.trim().split(/\s+/).join(" "),a96("comparator",A,K),this.options=K,this.loose=!!K.loose,this.parse(A),this.semver===rIA)this.value="";else this.value=this.operator+this.semver.version;a96("comp",this)}parse(A){let K=this.options.loose?dh4[ch4.COMPARATORLOOSE]:dh4[ch4.COMPARATOR],q=A.match(K);if(!q)throw TypeError(`Invalid comparator: ${A}`);if(this.operator=q[1]!==void 0?q[1]:"",this.operator==="=")this.operator="";if(!q[2])this.semver=rIA;else this.semver=new lh4(q[2],this.options.loose)}toString(){return this.value}test(A){if(a96("Comparator.test",A,this.options.loose),this.semver===rIA||A===rIA)return!0;if(typeof A==="string")try{A=new lh4(A,this.options)}catch(K){return!1}return o96(A,this.operator,this.semver,this.options)}intersects(A,K){if(!(A instanceof $Y1))throw TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new ih4(A.value,K).test(this.value)}else if(A.operator===""){if(A.value==="")return!0;return new ih4(this.value,K).test(A.semver)}if(K=ph4(K),K.includePrerelease&&(this.value==="<0.0.0-0"||A.value==="<0.0.0-0"))return!1;if(!K.includePrerelease&&(this.value.startsWith("<0.0.0")||A.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&A.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&A.operator.startsWith("<"))return!0;if(this.semver.version===A.semver.version&&this.operator.includes("=")&&A.operator.includes("="))return!0;if(o96(this.semver,"<",A.semver,K)&&this.operator.startsWith(">")&&A.operator.startsWith("<"))return!0;if(o96(this.semver,">",A.semver,K)&&this.operator.startsWith("<")&&A.operator.startsWith(">"))return!0;return!1}}nh4.exports=$Y1;var ph4=zY1(),{safeRe:dh4,t:ch4}=nIA(),o96=Uh4(),a96=iIA(),lh4=Z$A(),ih4=s96()});var s96=v((OWw,th4)=>{var _v9=/\s+/g;class oIA{constructor(A,K){if(K=Gv9(K),A instanceof oIA)if(A.loose===!!K.loose&&A.includePrerelease===!!K.includePrerelease)return A;else return new oIA(A.raw,K);if(A instanceof t96)return this.raw=A.value,this.set=[[A]],this.formatted=void 0,this;if(this.options=K,this.loose=!!K.loose,this.includePrerelease=!!K.includePrerelease,this.raw=A.trim().replace(_v9," "),this.set=this.raw.split("||").map((q)=>this.parseRange(q.trim())).filter((q)=>q.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let q=this.set[0];if(this.set=this.set.filter((Y)=>!ah4(Y[0])),this.set.length===0)this.set=[q];else if(this.set.length>1){for(let Y of this.set)if(Y.length===1&&fv9(Y[0])){this.set=[Y];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let A=0;A<this.set.length;A++){if(A>0)this.formatted+="||";let K=this.set[A];for(let q=0;q<K.length;q++){if(q>0)this.formatted+=" ";this.formatted+=K[q].toString().trim()}}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(A){let q=((this.options.includePrerelease&&Pv9)|(this.options.loose&&Vv9))+":"+A,Y=oh4.get(q);if(Y)return Y;let z=this.options.loose,w=z?QV[OM.HYPHENRANGELOOSE]:QV[OM.HYPHENRANGE];A=A.replace(w,Iv9(this.options.includePrerelease)),FH("hyphen replace",A),A=A.replace(QV[OM.COMPARATORTRIM],Dv9),FH("comparator trim",A),A=A.replace(QV[OM.TILDETRIM],jv9),FH("tilde trim",A),A=A.replace(QV[OM.CARETTRIM],Mv9),FH("caret trim",A);let H=A.split(" ").map(($)=>Nv9($,this.options)).join(" ").split(/\s+/).map(($)=>yv9($,this.options));if(z)H=H.filter(($)=>{return FH("loose invalid filter",$,this.options),!!$.match(QV[OM.COMPARATORLOOSE])});FH("range list",H);let J=new Map,O=H.map(($)=>new t96($,this.options));for(let $ of O){if(ah4($))return[$];J.set($.value,$)}if(J.size>1&&J.has(""))J.delete("");let X=[...J.values()];return oh4.set(q,X),X}intersects(A,K){if(!(A instanceof oIA))throw TypeError("a Range is required");return this.set.some((q)=>{return sh4(q,K)&&A.set.some((Y)=>{return sh4(Y,K)&&q.every((z)=>{return Y.every((w)=>{return z.intersects(w,K)})})})})}test(A){if(!A)return!1;if(typeof A==="string")try{A=new Wv9(A,this.options)}catch(K){return!1}for(let K=0;K<this.set.length;K++)if(Sv9(this.set[K],A,this.options))return!0;return!1}}th4.exports=oIA;var Zv9=yh4(),oh4=new Zv9,Gv9=zY1(),t96=rh4(),FH=iIA(),Wv9=Z$A(),{safeRe:QV,t:OM,comparatorTrimReplace:Dv9,tildeTrimReplace:jv9,caretTrimReplace:Mv9}=nIA(),{FLAG_INCLUDE_PRERELEASE:Pv9,FLAG_LOOSE:Vv9}=YY1(),ah4=(A)=>A.value==="<0.0.0-0",fv9=(A)=>A.value==="",sh4=(A,K)=>{let q=!0,Y=A.slice(),z=Y.pop();while(q&&Y.length)q=Y.every((w)=>{return z.intersects(w,K)}),z=Y.pop();return q},Nv9=(A,K)=>{return FH("comp",A,K),A=Ev9(A,K),FH("caret",A),A=Tv9(A,K),FH("tildes",A),A=Cv9(A,K),FH("xrange",A),A=Rv9(A,K),FH("stars",A),A},XM=(A)=>!A||A.toLowerCase()==="x"||A==="*",Tv9=(A,K)=>{return A.trim().split(/\s+/).map((q)=>vv9(q,K)).join(" ")},vv9=(A,K)=>{let q=K.loose?QV[OM.TILDELOOSE]:QV[OM.TILDE];return A.replace(q,(Y,z,w,H,J)=>{FH("tilde",A,Y,z,w,H,J);let O;if(XM(z))O="";else if(XM(w))O=`>=${z}.0.0 <${+z+1}.0.0-0`;else if(XM(H))O=`>=${z}.${w}.0 <${z}.${+w+1}.0-0`;else if(J)FH("replaceTilde pr",J),O=`>=${z}.${w}.${H}-${J} <${z}.${+w+1}.0-0`;else O=`>=${z}.${w}.${H} <${z}.${+w+1}.0-0`;return FH("tilde return",O),O})},Ev9=(A,K)=>{return A.trim().split(/\s+/).map((q)=>kv9(q,K)).join(" ")},kv9=(A,K)=>{FH("caret",A,K);let q=K.loose?QV[OM.CARETLOOSE]:QV[OM.CARET],Y=K.includePrerelease?"-0":"";return A.replace(q,(z,w,H,J,O)=>{FH("caret",A,z,w,H,J,O);let X;if(XM(w))X="";else if(XM(H))X=`>=${w}.0.0${Y} <${+w+1}.0.0-0`;else if(XM(J))if(w==="0")X=`>=${w}.${H}.0${Y} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.0${Y} <${+w+1}.0.0-0`;else if(O)if(FH("replaceCaret pr",O),w==="0")if(H==="0")X=`>=${w}.${H}.${J}-${O} <${w}.${H}.${+J+1}-0`;else X=`>=${w}.${H}.${J}-${O} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.${J}-${O} <${+w+1}.0.0-0`;else if(FH("no pr"),w==="0")if(H==="0")X=`>=${w}.${H}.${J}${Y} <${w}.${H}.${+J+1}-0`;else X=`>=${w}.${H}.${J}${Y} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.${J} <${+w+1}.0.0-0`;return FH("caret return",X),X})},Cv9=(A,K)=>{return FH("replaceXRanges",A,K),A.split(/\s+/).map((q)=>Lv9(q,K)).join(" ")},Lv9=(A,K)=>{A=A.trim();let q=K.loose?QV[OM.XRANGELOOSE]:QV[OM.XRANGE];return A.replace(q,(Y,z,w,H,J,O)=>{FH("xRange",A,Y,z,w,H,J,O);let X=XM(w),$=X||XM(H),_=$||XM(J),Z=_;if(z==="="&&Z)z="";if(O=K.includePrerelease?"-0":"",X)if(z===">"||z==="<")Y="<0.0.0-0";else Y="*";else if(z&&Z){if($)H=0;if(J=0,z===">")if(z=">=",$)w=+w+1,H=0,J=0;else H=+H+1,J=0;else if(z==="<=")if(z="<",$)w=+w+1;else H=+H+1;if(z==="<")O="-0";Y=`${z+w}.${H}.${J}${O}`}else if($)Y=`>=${w}.0.0${O} <${+w+1}.0.0-0`;else if(_)Y=`>=${w}.${H}.0${O} <${w}.${+H+1}.0-0`;return FH("xRange return",Y),Y})},Rv9=(A,K)=>{return FH("replaceStars",A,K),A.trim().replace(QV[OM.STAR],"")},yv9=(A,K)=>{return FH("replaceGTE0",A,K),A.trim().replace(QV[K.includePrerelease?OM.GTE0PRE:OM.GTE0],"")},Iv9=(A)=>(K,q,Y,z,w,H,J,O,X,$,_,Z)=>{if(XM(Y))q="";else if(XM(z))q=`>=${Y}.0.0${A?"-0":""}`;else if(XM(w))q=`>=${Y}.${z}.0${A?"-0":""}`;else if(H)q=`>=${q}`;else q=`>=${q}${A?"-0":""}`;if(XM(X))O="";else if(XM($))O=`<${+X+1}.0.0-0`;else if(XM(_))O=`<${X}.${+$+1}.0-0`;else if(Z)O=`<=${X}.${$}.${_}-${Z}`;else if(A)O=`<${X}.${$}.${+_+1}-0`;else O=`<=${O}`;return`${q} ${O}`.trim()},Sv9=(A,K,q)=>{for(let Y=0;Y<A.length;Y++)if(!A[Y].test(K))return!1;if(K.prerelease.length&&!q.includePrerelease){for(let Y=0;Y<A.length;Y++){if(FH(A[Y].semver),A[Y].semver===t96.ANY)continue;if(A[Y].semver.prerelease.length>0){let z=A[Y].semver;if(z.major===K.major&&z.minor===K.minor&&z.patch===K.patch)return!0}}return!1}return!0}});var Ab4=v((XWw,eh4)=>{var hv9=s96(),bv9=(A,K,q)=>{try{K=new hv9(K,q)}catch(Y){return!1}return K.test(A)};eh4.exports=bv9});var e96=v(($Ww,xv9)=>{xv9.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.33.5",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unnebäck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix Bünemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","Jérémy Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kotěšovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouciño <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugué <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{install:"node install/check",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;LGPL-3.0-or-later;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","package-from-local-build":"node npm/from-local-build","package-from-github-release":"node npm/from-github-release","docs-build":"node docs/build && node docs/search-index/build","docs-serve":"cd docs && npx serve","docs-publish":"cd docs && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{color:"^4.2.3","detect-libc":"^2.0.3",semver:"^7.6.3"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.33.5","@img/sharp-darwin-x64":"0.33.5","@img/sharp-libvips-darwin-arm64":"1.0.4","@img/sharp-libvips-darwin-x64":"1.0.4","@img/sharp-libvips-linux-arm":"1.0.5","@img/sharp-libvips-linux-arm64":"1.0.4","@img/sharp-libvips-linux-s390x":"1.0.4","@img/sharp-libvips-linux-x64":"1.0.4","@img/sharp-libvips-linuxmusl-arm64":"1.0.4","@img/sharp-libvips-linuxmusl-x64":"1.0.4","@img/sharp-linux-arm":"0.33.5","@img/sharp-linux-arm64":"0.33.5","@img/sharp-linux-s390x":"0.33.5","@img/sharp-linux-x64":"0.33.5","@img/sharp-linuxmusl-arm64":"0.33.5","@img/sharp-linuxmusl-x64":"0.33.5","@img/sharp-wasm32":"0.33.5","@img/sharp-win32-ia32":"0.33.5","@img/sharp-win32-x64":"0.33.5"},devDependencies:{"@emnapi/runtime":"^1.2.0","@img/sharp-libvips-dev":"1.0.4","@img/sharp-libvips-dev-wasm32":"1.0.5","@img/sharp-libvips-win32-ia32":"1.0.4","@img/sharp-libvips-win32-x64":"1.0.4","@types/node":"*",async:"^3.2.5",cc:"^3.0.1",emnapi:"^1.2.0","exif-reader":"^2.0.1","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^8.0.3","license-checker":"^25.0.1",mocha:"^10.7.3","node-addon-api":"^8.1.0",nyc:"^17.0.0",prebuild:"^13.0.1",semistandard:"^17.0.0","tar-fs":"^3.0.6",tsd:"^0.31.1"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.15.3"},funding:{url:"https://opencollective.com/libvips"},binary:{napi_versions:[9]},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},nyc:{include:["lib"]},tsd:{directory:"test/types/"}}});var KY6=v((_Ww,$b4)=>{var{spawnSync:_Y1}=yA("node:child_process"),{createHash:uv9}=yA("node:crypto"),zb4=vh4(),Bv9=r96(),mv9=Ab4(),Kb4=qY1(),{config:gv9,engines:qb4,optionalDependencies:Fv9}=e96(),Qv9=process.env.npm_package_config_libvips||gv9.libvips,wb4=zb4(Qv9).version,Uv9=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-ia32","win32-x64"],ZY1={encoding:"utf8",shell:!0},pv9=(A)=>{if(A instanceof Error)console.error(`sharp: Installation error: ${A.message}`);else console.log(`sharp: ${A}`)},Hb4=()=>Kb4.isNonGlibcLinuxSync()?Kb4.familySync():"",dv9=()=>`${process.platform}${Hb4()}-${process.arch}`,G$A=()=>{if(Jb4())return"wasm32";let{npm_config_arch:A,npm_config_platform:K,npm_config_libc:q}=process.env,Y=typeof q==="string"?q:Hb4();return`${K||process.platform}${Y}-${A||process.arch}`},cv9=()=>{try{return yA(`@img/sharp-libvips-dev-${G$A()}/include`)}catch{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/include");})()}catch{}}return""},lv9=()=>{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/cplusplus");})()}catch{}return""},iv9=()=>{try{return yA(`@img/sharp-libvips-dev-${G$A()}/lib`)}catch{try{return yA(`@img/sharp-libvips-${G$A()}/lib`)}catch{}}return""},nv9=()=>{if(process.release?.name==="node"&&process.versions){if(!mv9(process.versions.node,qb4.node))return{found:process.versions.node,expected:qb4.node}}},Jb4=()=>{let{CC:A}=process.env;return Boolean(A&&A.endsWith("/emcc"))},rv9=()=>{if(process.platform==="darwin"&&process.arch==="x64")return(_Y1("sysctl sysctl.proc_translated",ZY1).stdout||"").trim()==="sysctl.proc_translated: 1";return!1},Yb4=(A)=>uv9("sha512").update(A).digest("hex"),ov9=()=>{try{let A=Yb4(`imgsharp-libvips-${G$A()}`),K=zb4(Fv9[`@img/sharp-libvips-${G$A()}`]).version;return Yb4(`${A}npm:${K}`).slice(0,10)}catch{}return""},av9=()=>_Y1(`node-gyp rebuild --directory=src ${Jb4()?"--nodedir=emscripten":""}`,{...ZY1,stdio:"inherit"}).status,Ob4=()=>{if(process.platform!=="win32")return(_Y1("pkg-config --modversion vips-cpp",{...ZY1,env:{...process.env,PKG_CONFIG_PATH:Xb4()}}).stdout||"").trim();else return""},Xb4=()=>{if(process.platform!=="win32")return[(_Y1('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',ZY1).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":");else return""},AY6=(A,K,q)=>{if(q)q(`Detected ${K}, skipping search for globally-installed libvips`);return A},sv9=(A)=>{if(Boolean(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)===!0)return AY6(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",A);if(Boolean(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)===!0)return AY6(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",A);if(rv9())return AY6(!1,"Rosetta",A);let K=Ob4();return!!K&&Bv9(K,wb4)};$b4.exports={minimumLibvipsVersion:wb4,prebuiltPlatforms:Uv9,buildPlatformArch:G$A,buildSharpLibvipsIncludeDir:cv9,buildSharpLibvipsCPlusPlusDir:lv9,buildSharpLibvipsLibDir:iv9,isUnsupportedNodeRuntime:nv9,runtimePlatformArch:dv9,log:pv9,yarnLocator:ov9,spawnRebuild:av9,globalLibvipsVersion:Ob4,pkgConfigPath:Xb4,useGlobalLibvips:sv9}});var aIA=v((GWw,Zb4)=>{var{familySync:tv9,versionSync:ev9}=qY1(),{runtimePlatformArch:AE9,isUnsupportedNodeRuntime:_b4,prebuiltPlatforms:KE9,minimumLibvipsVersion:qE9}=KY6(),z7A=AE9(),YE9=[`../src/build/Release/sharp-${z7A}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${z7A}/sharp.node`,"@img/sharp-wasm32/sharp.node"],qY6,GY1=[];for(let A of YE9)try{qY6=yA(A);break}catch(K){GY1.push(K)}if(qY6)Zb4.exports=qY6;else{let[A,K,q]=["linux","darwin","win32"].map((w)=>z7A.startsWith(w)),Y=[`Could not load the "sharp" module using the ${z7A} runtime`];GY1.forEach((w)=>{if(w.code!=="MODULE_NOT_FOUND")Y.push(`${w.code}: ${w.message}`)});let z=GY1.map((w)=>w.message).join(" ");if(Y.push("Possible solutions:"),_b4()){let{found:w,expected:H}=_b4();Y.push("- Please upgrade Node.js:",`    Found ${w}`,`    Requires ${H}`)}else if(KE9.includes(z7A)){let[w,H]=z7A.split("-"),J=w.endsWith("musl")?" --libc=musl":"";Y.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${w.replace("musl","")}${J} --cpu=${H} sharp`)}else Y.push(`- Manually install libvips >= ${qE9}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if(A&&/(symbol not found|CXXABI_)/i.test(z))try{let{config:w}=yA(`@img/sharp-libvips-${z7A}/package`),H=`${tv9()} ${ev9()}`,J=`${w.musl?"musl":"glibc"} ${w.musl||w.glibc}`;Y.push("- Update your OS:",`    Found ${H}`,`    Requires ${J}`)}catch(w){}if(A&&/\/snap\/core[0-9]{2}/.test(z))Y.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node");if(K&&/Incompatible library version/.test(z))Y.push("- Update Homebrew:","    brew update && brew upgrade vips");if(GY1.some((w)=>w.code==="ERR_DLOPEN_DISABLED"))Y.push("- Run Node.js without using the --no-addons flag");if(q&&/The specified procedure could not be found/.test(z))Y.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp");throw Y.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),Error(Y.join(`
+`);for(let Y of q){let z=Y.trim();if(z){let H=z.match(/^#+\s+(.+)$/)?.[1]??z;return H.length>100?H.substring(0,97)+"...":H}}return K}function $S4(A){if(A===void 0||A===null)return null;if(!A)return[];let K=[];if(typeof A==="string")K=[A];else if(Array.isArray(A))K=A.filter((Y)=>typeof Y==="string");if(K.length===0)return[];let q=UQ(K);if(q.includes("*"))return["*"];return q}function r4A(A){let K=$S4(A);if(K===null)return A===void 0?void 0:[];if(K.includes("*"))return;return K}function Sy(A){let K=$S4(A);if(K===null)return[];return K}async function HN9(A){try{let K=await YN9(A,{bigint:!0});return`${K.dev}:${K.ino}`}catch{return null}}function I96(A,K){let q=JS4(wN9()),Y=fl(K),z=JS4(K),w=[];if(!y96(z))return w;while(!0){if(z===q)break;let H=n91(z,".claude",A);if(y96(H))w.push(H);if(Y&&z===Y)break;let J=AN9(z);if(J===z)break;z=J}return w}async function JN9(A,K){let q=[],Y=new Set;async function z(w){if(K.aborted)return;try{let H=await OS4(w,{bigint:!0});if(H.isDirectory()){let J=H.dev!==void 0&&H.ino!==void 0?`${H.dev}:${H.ino}`:await zN9(w);if(Y.has(J)){h(`Skipping already visited directory (circular symlink): ${w}`);return}Y.add(J)}}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to stat directory ${w}: ${J}`);return}try{let H=await KN9(w,{withFileTypes:!0});for(let J of H){if(K.aborted)break;let O=n91(w,J.name);try{if(J.isSymbolicLink())try{let X=await OS4(O);if(X.isDirectory())await z(O);else if(X.isFile()&&J.name.endsWith(".md"))q.push(O)}catch(X){let $=X instanceof Error?X.message:String(X);h(`Failed to follow symlink ${O}: ${$}`)}else if(J.isDirectory())await z(O);else if(J.isFile()&&J.name.endsWith(".md"))q.push(O)}catch(X){let $=X instanceof Error?X.message:String(X);h(`Failed to access ${O}: ${$}`)}}}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to read directory ${w}: ${J}`)}}return await z(A),q}async function R96(A){let K=s7(),q=setTimeout(()=>K.abort(),3000);try{if(!y96(A))return[];let z=j1(process.env.CLAUDE_CODE_USE_NATIVE_FILE_SEARCH)?await JN9(A,K.signal):await rh(["--files","--hidden","--follow","--no-ignore","--glob","*.md"],A,K.signal);return(await Promise.all(z.map(async(H)=>{try{let J=await qN9(H,{encoding:"utf-8"}),{frontmatter:O,content:X}=z_(J);return{filePath:H,frontmatter:O,content:X}}catch(J){let O=J instanceof Error?J.message:String(J);return h(`Failed to read/parse markdown file:  ${H}: ${O}`),null}}))).filter((H)=>H!==null)}finally{clearTimeout(q)}}var XS4,FQ;var QQ=C(()=>{oh();mQ();hr();W1();Gz();l6();B8();i1();KO();d7();Ow();XS4=["commands","agents","output-styles","skills"];FQ=a1(async function(A,K){let q=Date.now(),Y=n91(H8(),A),z=n91(kT(),".claude",A),w=I96(A,K),Hs=o$("userSettings"),Js=o$("projectSettings"),Fs=xA(),Cs=n91(H8(),"cache","dir-search"),ks=osK("sha256").update(`${A}:${K||""}:${Hs?Y:""}:${Js?w.join("|"):""}:${z}`).digest("hex").slice(0,16),cp=n91(Cs,`${ks}.json`),dm={},cached=null,cacheOk=!1;try{Fs.mkdirSync(Cs,{recursive:!0})}catch{}try{let dirs=[z,...(Hs?[Y]:[]),...(Js?w:[])];for(let D of dirs)try{dm[D]=Fs.statSync(D).mtimeMs}catch{dm[D]=null}let raw=Fs.readFileSync(cp,{encoding:"utf-8"}),data=JSON.parse(raw);if(data&&data.v===1&&data.dirMtimes&&Array.isArray(data.entries)){let same=Object.keys(dm).length===Object.keys(data.dirMtimes).length;if(same)for(let D in dm)if(data.dirMtimes[D]!==dm[D]){same=!1;break}if(same){let fm=data.fileMtimes||{},dirty=!1;for(let D in fm){try{if(Fs.statSync(D).mtimeMs!==fm[D]){dirty=!0;break}}catch{dirty=!0;break}}if(!dirty){cacheOk=!0;cached=data}}}}catch{}if(cacheOk){return n("tengu_dir_search",{durationMs:Date.now()-q,managedFilesFound:cached.managedFilesFound??0,userFilesFound:cached.userFilesFound??0,projectFilesFound:cached.projectFilesFound??0,projectDirsSearched:cached.projectDirsSearched??0,subdir:A}),cached.entries}let[H,J,O]=await Promise.all([R96(z).then((D)=>D.map((j)=>({...j,baseDir:z,source:"policySettings"}))),Hs?R96(Y).then((D)=>D.map((j)=>({...j,baseDir:Y,source:"userSettings"}))):Promise.resolve([]),Js?Promise.all(w.map((D)=>R96(D).then((j)=>j.map((M)=>({...M,baseDir:D,source:"projectSettings"}))))):Promise.resolve([])]),X=O.flat(),$=[...H,...J,...X],_=await Promise.all($.map((D)=>HN9(D.filePath))),Z=new Map,G=[];for(let[D,j]of $.entries()){let M=_[D]??null;if(M===null){G.push(j);continue}let P=Z.get(M);if(P!==void 0){h(`Skipping duplicate file '${j.filePath}' from ${j.source} (same inode already loaded from ${P})`);continue}Z.set(M,j.source),G.push(j)}let W=$.length-G.length;if(W>0)h(`Deduplicated ${W} files in ${A} (same inode via symlinks or hard links)`);try{let fm={};for(let D of G)try{fm[D.filePath]=Fs.statSync(D.filePath).mtimeMs}catch{}Fs.writeFileSync(cp,JSON.stringify({v:1,dirMtimes:dm,fileMtimes:fm,entries:G,managedFilesFound:H.length,userFilesFound:J.length,projectFilesFound:X.length,projectDirsSearched:w.length}),{encoding:"utf-8"})}catch{}return n("tengu_dir_search",{durationMs:Date.now()-q,managedFilesFound:H.length,userFilesFound:J.length,projectFilesFound:X.length,projectDirsSearched:w.length,subdir:A}),G},(A,K)=>`${A}:${K}`)});var hx;var _S4=C(()=>{hx=["PreToolUse","PostToolUse","PostToolUseFailure","Notification","UserPromptSubmit","SessionStart","SessionEnd","Stop","SubagentStart","SubagentStop","PreCompact","PermissionRequest","Setup"]});var ZS4=()=>{};var A$A=C(()=>{_S4();ZS4()});var ON9,XN9,$N9,GS4,WS4,rk;var r91=C(()=>{J7();A$A();ON9=U.object({type:U.literal("command").describe("Bash command hook type"),command:U.string().describe("Shell command to execute"),timeout:U.number().positive().optional().describe("Timeout in seconds for this specific command"),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution"),async:U.boolean().optional().describe("If true, hook runs in background without blocking")}),XN9=U.object({type:U.literal("prompt").describe("LLM prompt hook type"),prompt:U.string().describe("Prompt to evaluate with LLM. Use $ARGUMENTS placeholder for hook input JSON."),timeout:U.number().positive().optional().describe("Timeout in seconds for this specific prompt evaluation"),model:U.string().optional().describe('Model to use for this prompt hook (e.g., "claude-sonnet-4-5-20250929"). If not specified, uses the default small fast model.'),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution")}),$N9=U.object({type:U.literal("agent").describe("Agentic verifier hook type"),prompt:U.string().transform((A)=>(K)=>A).describe('Prompt describing what to verify (e.g. "Verify that unit tests ran and passed."). Use $ARGUMENTS placeholder for hook input JSON.'),timeout:U.number().positive().optional().describe("Timeout in seconds for agent execution (default 60)"),model:U.string().optional().describe('Model to use for this agent hook (e.g., "claude-sonnet-4-5-20250929"). If not specified, uses Haiku.'),statusMessage:U.string().optional().describe("Custom status message to display in spinner while hook runs"),once:U.boolean().optional().describe("If true, hook runs once and is removed after execution")}),GS4=U.discriminatedUnion("type",[ON9,XN9,$N9]),WS4=U.object({matcher:U.string().optional().describe('String pattern to match (e.g. tool names like "Write")'),hooks:U.array(GS4).describe("List of hooks to execute when the matcher matches")}),rk=U.partialRecord(U.enum(hx),U.array(WS4))});var S96,YGw,h96,_N9,ZN9,GN9,WN9,DN9,jN9,MN9,bx,DS4;var o4A=C(()=>{J7();S96=U.enum(["local","user","project","dynamic","enterprise","claudeai","managed"]),YGw=U.enum(["stdio","sse","sse-ide","http","ws","sdk"]),h96=U.object({type:U.literal("stdio").optional(),command:U.string().min(1,"Command cannot be empty"),args:U.array(U.string()).default([]),env:U.record(U.string(),U.string()).optional()}),_N9=U.object({type:U.literal("sse"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),ZN9=U.object({type:U.literal("sse-ide"),url:U.string(),ideName:U.string(),ideRunningInWindows:U.boolean().optional()}),GN9=U.object({type:U.literal("ws-ide"),url:U.string(),ideName:U.string(),authToken:U.string().optional(),ideRunningInWindows:U.boolean().optional()}),WN9=U.object({type:U.literal("http"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),DN9=U.object({type:U.literal("ws"),url:U.string(),headers:U.record(U.string(),U.string()).optional(),headersHelper:U.string().optional()}),jN9=U.object({type:U.literal("sdk"),name:U.string()}),MN9=U.object({type:U.literal("claudeai-proxy"),url:U.string(),id:U.string()}),bx=U.union([h96,_N9,ZN9,GN9,WN9,DN9,jN9,MN9]),DS4=U.object({mcpServers:U.record(U.string(),bx)})});function FIA(A,K){return K.autoUpdate??s4A.has(A.toLowerCase())}function fN9(A){if(s4A.has(A.toLowerCase()))return!1;if(VN9.test(A))return!0;return PN9.test(A)}function VS4(A,K){let q=A.toLowerCase();if(!s4A.has(q))return null;if(K.source==="github"){if(!(K.repo||"").toLowerCase().startsWith(`${o91}/`))return`The name '${A}' is reserved for official Anthropic marketplaces. Only repositories from 'github.com/${o91}/' can use this name.`;return null}if(K.source==="git"&&K.url){let Y=K.url.toLowerCase(),z=Y.includes("github.com/anthropics/"),w=Y.includes("git@github.com:anthropics/");if(z||w)return null;return`The name '${A}' is reserved for official Anthropic marketplaces. Only repositories from 'github.com/${o91}/' can use this name.`}return`The name '${A}' is reserved for official Anthropic marketplaces and can only be used with GitHub sources from the '${o91}' organization.`}function xx(A){return typeof A==="string"&&A.startsWith("./")}var s4A,PN9,VN9,o91="anthropics",pQ,K$A,jS4,b96,x96,fS4,NN9,NS4,TN9,vN9,EN9,kN9,CN9,LN9,RN9,MS4,yN9,q$A,IN9,t4A,TS4,QIA,PS4,SN9,hN9,Y$A,a4A,OGw,bN9,UIA,xN9,uN9,pIA,XGw,BN9,u96;var ED=C(()=>{J7();r91();o4A();s4A=new Set(["claude-code-marketplace","claude-code-plugins","claude-plugins-official","anthropic-marketplace","anthropic-plugins","agent-skills","life-sciences"]);PN9=/(?:official[^a-z0-9]*(anthropic|claude)|(?:anthropic|claude)[^a-z0-9]*official|^(?:anthropic|claude)[^a-z0-9]*(marketplace|plugins|official))/i,VN9=/[^\u0020-\u007E]/;pQ=U.string().startsWith("./"),K$A=pQ.endsWith(".json"),jS4=U.union([pQ.refine((A)=>A.endsWith(".mcpb")||A.endsWith(".dxt"),{message:"MCPB file path must end with .mcpb or .dxt"}).describe("Path to MCPB file relative to plugin root"),U.string().url().refine((A)=>A.endsWith(".mcpb")||A.endsWith(".dxt"),{message:"MCPB URL must end with .mcpb or .dxt"}).describe("URL to MCPB file")]),b96=pQ.endsWith(".md"),x96=U.union([b96,pQ]),fS4=U.object({name:U.string().min(1,"Author name cannot be empty").describe("Display name of the plugin author or organization"),email:U.string().optional().describe("Contact email for support or feedback"),url:U.string().optional().describe("Website, GitHub profile, or organization URL")}),NN9=U.object({name:U.string().min(1,"Plugin name cannot be empty").refine((A)=>!A.includes(" "),{message:'Plugin name cannot contain spaces. Use kebab-case (e.g., "my-plugin")'}).describe("Unique identifier for the plugin, used for namespacing (prefer kebab-case)"),version:U.string().optional().describe("Semantic version (e.g., 1.2.3) following semver.org specification"),description:U.string().optional().describe("Brief, user-facing explanation of what the plugin provides"),author:fS4.optional().describe("Information about the plugin creator or maintainer"),homepage:U.string().url().optional().describe("Plugin homepage or documentation URL"),repository:U.string().optional().describe("Source code repository URL"),license:U.string().optional().describe("SPDX license identifier (e.g., MIT, Apache-2.0)"),keywords:U.array(U.string()).optional().describe("Tags for plugin discovery and categorization")}),NS4=U.object({description:U.string().optional().describe("Brief, user-facing explanation of what these hooks provide"),hooks:U.lazy(()=>rk).describe("The hooks provided by the plugin, in the same format as the one used for settings")}),TN9=U.object({hooks:U.union([K$A.describe("Path to file with additional hooks (in addition to those in hooks/hooks.json, if it exists), relative to the plugin root"),U.lazy(()=>rk).describe("Additional hooks (in addition to those in hooks/hooks.json, if it exists)"),U.array(U.union([K$A.describe("Path to file with additional hooks (in addition to those in hooks/hooks.json, if it exists), relative to the plugin root"),U.lazy(()=>rk).describe("Additional hooks (in addition to those in hooks/hooks.json, if it exists)")]))])}),vN9=U.object({source:x96.optional().describe("Path to command markdown file, relative to plugin root"),content:U.string().optional().describe("Inline markdown content for the command"),description:U.string().optional().describe("Command description override"),argumentHint:U.string().optional().describe('Hint for command arguments (e.g., "[file]")'),model:U.string().optional().describe("Default model for this command"),allowedTools:U.array(U.string()).optional().describe("Tools allowed when command runs")}).refine((A)=>A.source&&!A.content||!A.source&&A.content,{message:'Command must have either "source" (file path) or "content" (inline markdown), but not both'}),EN9=U.object({commands:U.union([x96.describe("Path to additional command file or skill directory (in addition to those in the commands/ directory, if it exists), relative to the plugin root"),U.array(x96.describe("Path to additional command file or skill directory (in addition to those in the commands/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional command files or skill directories"),U.record(U.string(),vN9).describe('Object mapping of command names to their metadata and source files. Command name becomes the slash command name (e.g., "about" → "/plugin:about")')])}),kN9=U.object({agents:U.union([b96.describe("Path to additional agent file (in addition to those in the agents/ directory, if it exists), relative to the plugin root"),U.array(b96.describe("Path to additional agent file (in addition to those in the agents/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional agent files")])}),CN9=U.object({skills:U.union([pQ.describe("Path to additional skill directory (in addition to those in the skills/ directory, if it exists), relative to the plugin root"),U.array(pQ.describe("Path to additional skill directory (in addition to those in the skills/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional skill directories")])}),LN9=U.object({outputStyles:U.union([pQ.describe("Path to additional output styles directory or file (in addition to those in the output-styles/ directory, if it exists), relative to the plugin root"),U.array(pQ.describe("Path to additional output styles directory or file (in addition to those in the output-styles/ directory, if it exists), relative to the plugin root")).describe("List of paths to additional output styles directories or files")])}),RN9=U.object({mcpServers:U.union([K$A.describe("MCP servers to include in the plugin (in addition to those in the .mcp.json file, if it exists)"),jS4.describe("Path or URL to MCPB file containing MCP server configuration"),U.record(U.string(),bx).describe("MCP server configurations keyed by server name"),U.array(U.union([K$A.describe("Path to MCP servers configuration file"),jS4.describe("Path or URL to MCPB file"),U.record(U.string(),bx).describe("Inline MCP server configurations")])).describe("Array of MCP server configurations (paths, MCPB files, or inline definitions)")])}),MS4=U.string().min(1),yN9=U.string().min(2).refine((A)=>A.startsWith("."),{message:'File extensions must start with dot (e.g., ".ts", not "ts")'}),q$A=U.strictObject({command:U.string().min(1).refine((A)=>{if(A.includes(" ")&&!A.startsWith("/"))return!1;return!0},{message:"Command should not contain spaces. Use args array for arguments."}).describe('Command to execute the LSP server (e.g., "typescript-language-server")'),args:U.array(MS4).optional().describe("Command-line arguments to pass to the server"),extensionToLanguage:U.record(yN9,MS4).refine((A)=>Object.keys(A).length>0,{message:"extensionToLanguage must have at least one mapping"}).describe("Mapping from file extension to LSP language ID. File extensions and languages are derived from this mapping."),transport:U.enum(["stdio","socket"]).default("stdio").describe("Communication transport mechanism"),env:U.record(U.string(),U.string()).optional().describe("Environment variables to set when starting the server"),initializationOptions:U.unknown().optional().describe("Initialization options passed to the server during initialization"),settings:U.unknown().optional().describe("Settings passed to the server via workspace/didChangeConfiguration"),workspaceFolder:U.string().optional().describe("Workspace folder path to use for the server"),startupTimeout:U.number().int().positive().optional().describe("Maximum time to wait for server startup (milliseconds)"),shutdownTimeout:U.number().int().positive().optional().describe("Maximum time to wait for graceful shutdown (milliseconds)"),restartOnCrash:U.boolean().optional().describe("Whether to restart the server if it crashes"),maxRestarts:U.number().int().nonnegative().optional().describe("Maximum number of restart attempts before giving up")}),IN9=U.object({lspServers:U.union([K$A.describe("Path to .lsp.json configuration file relative to plugin root"),U.record(U.string(),q$A).describe("LSP server configurations keyed by server name"),U.array(U.union([K$A.describe("Path to LSP configuration file"),U.record(U.string(),q$A).describe("Inline LSP server configurations")])).describe("Array of LSP server configurations (paths or inline definitions)")])}),t4A=U.object({...NN9.shape,...TN9.partial().shape,...EN9.partial().shape,...kN9.partial().shape,...CN9.partial().shape,...LN9.partial().shape,...RN9.partial().shape,...IN9.partial().shape}).strict(),TS4=U.string().refine((A)=>!A.includes("..")&&!A.includes("//"),"Package name cannot contain path traversal patterns").refine((A)=>{let K=/^@[a-z0-9][a-z0-9-._]*\/[a-z0-9][a-z0-9-._]*$/,q=/^[a-z0-9][a-z0-9-._]*$/;return K.test(A)||q.test(A)},"Invalid npm package name format"),QIA=U.discriminatedUnion("source",[U.object({source:U.literal("url"),url:U.string().url().describe("Direct URL to marketplace.json file"),headers:U.record(U.string(),U.string()).optional().describe("Custom HTTP headers (e.g., for authentication)")}),U.object({source:U.literal("github"),repo:U.string().describe("GitHub repository in owner/repo format"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),path:U.string().optional().describe("Path to marketplace.json within repo (defaults to .claude-plugin/marketplace.json)")}),U.object({source:U.literal("git"),url:U.string().endsWith(".git").describe("Full git repository URL"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),path:U.string().optional().describe("Path to marketplace.json within repo (defaults to .claude-plugin/marketplace.json)")}),U.object({source:U.literal("npm"),package:TS4.describe("NPM package containing marketplace.json")}),U.object({source:U.literal("file"),path:U.string().describe("Local file path to marketplace.json")}),U.object({source:U.literal("directory"),path:U.string().describe("Local directory containing .claude-plugin/marketplace.json")}),U.object({source:U.literal("hostPattern"),hostPattern:U.string().describe('Regex pattern to match the host/domain extracted from any marketplace source type. For github sources, matches against "github.com". For git sources (SSH or HTTPS), extracts the hostname from the URL. Use in strictKnownMarketplaces to allow all marketplaces from a specific host (e.g., "^github\\.mycompany\\.com$").')})]),PS4=U.string().length(40).regex(/^[a-f0-9]{40}$/,"Must be a full 40-character lowercase git commit SHA"),SN9=U.union([pQ.describe("Path to the plugin root, relative to the marketplace directory"),U.object({source:U.literal("npm"),package:TS4.or(U.string()).describe("Package name (or url, or local path, or anything else that can be passed to `npm` as a package)"),version:U.string().optional().describe("Specific version or version range (e.g., ^1.0.0, ~2.1.0)"),registry:U.string().url().optional().describe("Custom NPM registry URL (defaults to using system default, likely npmjs.org)")}).describe("NPM package as plugin source"),U.object({source:U.literal("pip"),package:U.string().describe("Python package name as it appears on PyPI"),version:U.string().optional().describe("Version specifier (e.g., ==1.0.0, >=2.0.0, <3.0.0)"),registry:U.string().url().optional().describe("Custom PyPI registry URL (defaults to using system default, likely pypi.org)")}).describe("Python package as plugin source"),U.object({source:U.literal("url"),url:U.string().endsWith(".git").describe("Full git repository URL (https:// or git@)"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),sha:PS4.optional().describe("Specific commit SHA to use")}),U.object({source:U.literal("github"),repo:U.string().describe("GitHub repository in owner/repo format"),ref:U.string().optional().describe('Git branch or tag to use (e.g., "main", "v1.0.0"). Defaults to repository default branch.'),sha:PS4.optional().describe("Specific commit SHA to use")})]);hN9=t4A.partial().extend({name:U.string().min(1,"Plugin name cannot be empty").refine((A)=>!A.includes(" "),{message:'Plugin name cannot contain spaces. Use kebab-case (e.g., "my-plugin")'}).describe("Unique identifier matching the plugin name"),source:SN9.describe("Where to fetch the plugin from"),category:U.string().optional().describe('Category for organizing plugins (e.g., "productivity", "development")'),tags:U.array(U.string()).optional().describe("Tags for searchability and discovery"),strict:U.boolean().optional().default(!0).describe("Require the plugin manifest to be present in the plugin folder. If false, the marketplace entry provides the manifest.")}).strict(),Y$A=U.object({name:U.string().min(1,"Marketplace must have a name").refine((A)=>!A.includes(" "),{message:'Marketplace name cannot contain spaces. Use kebab-case (e.g., "my-marketplace")'}).refine((A)=>!fN9(A),{message:'Marketplace name cannot impersonate official Anthropic/Claude marketplaces. Names containing "official", "anthropic", or "claude" in official-sounding combinations are reserved.'}),owner:fS4.describe("Marketplace maintainer or curator information"),plugins:U.array(hN9).describe("Collection of available plugins in this marketplace"),metadata:U.object({pluginRoot:U.string().optional().describe("Base path for relative plugin sources"),version:U.string().optional().describe("Marketplace version"),description:U.string().optional().describe("Marketplace description")}).optional().describe("Optional marketplace metadata")}),a4A=U.string().regex(/^[a-z0-9][-a-z0-9._]*@[a-z0-9][-a-z0-9._]*$/i,"Plugin ID must be in format: plugin@marketplace"),OGw=U.union([a4A,U.object({id:a4A.describe('Plugin identifier (e.g., "formatter@tools")'),version:U.string().optional().describe('Version constraint (e.g., "^2.0.0")'),required:U.boolean().optional().describe("If true, cannot be disabled"),config:U.record(U.string(),U.unknown()).optional().describe("Plugin-specific configuration")})]),bN9=U.object({version:U.string().describe("Currently installed version"),installedAt:U.string().describe("ISO 8601 timestamp of installation"),lastUpdated:U.string().optional().describe("ISO 8601 timestamp of last update"),installPath:U.string().describe("Absolute path to the installed plugin directory"),gitCommitSha:U.string().optional().describe("Git commit SHA for git-based plugins (for version tracking)")}),UIA=U.object({version:U.literal(1).describe("Schema version 1"),plugins:U.record(a4A,bN9).describe("Map of plugin IDs to their installation metadata")}),xN9=U.enum(["managed","user","project","local"]),uN9=U.object({scope:xN9.describe("Installation scope"),projectPath:U.string().optional().describe("Project path (required for project/local scopes)"),installPath:U.string().describe("Absolute path to the versioned plugin directory"),version:U.string().optional().describe("Currently installed version"),installedAt:U.string().optional().describe("ISO 8601 timestamp of installation"),lastUpdated:U.string().optional().describe("ISO 8601 timestamp of last update"),gitCommitSha:U.string().optional().describe("Git commit SHA for git-based plugins")}),pIA=U.object({version:U.literal(2).describe("Schema version 2"),plugins:U.record(a4A,U.array(uN9)).describe("Map of plugin IDs to arrays of installation entries")}),XGw=U.union([UIA,pIA]),BN9=U.object({source:QIA.describe("Where to fetch the marketplace from"),installLocation:U.string().describe("Local cache path where marketplace manifest is stored"),lastUpdated:U.string().describe("ISO 8601 timestamp of last marketplace refresh"),autoUpdate:U.boolean().optional().describe("Whether to automatically update this marketplace and its installed plugins on startup")}),u96=U.record(U.string(),BN9)});import{join as mN9}from"path";function FN9(){if(VnA())return vS4;if(j1(process.env.CLAUDE_CODE_USE_COWORK_PLUGINS))return vS4;return gN9}function CT(){return mN9(H8(),FN9())}var gN9="plugins",vS4="cowork_plugins";var dIA=C(()=>{l6();s1()});async function QN9(A){try{return!!await AV(A)}catch{return!1}}var a91;var B96=C(()=>{d7();nl();a91=a1(async()=>{return QN9("git")})});function z$A(A,K){let Y=A.slice(0,2).map((H)=>{let J=H.reason||H.error||"unknown error";return K?`${H.name} (${J})`:H.name}).join(K?"; ":", "),z=A.length-2,w=z>0?` and ${z} more`:"";return`${Y}${w}`}function cIA(A){switch(A.source){case"github":return A.repo;case"url":return A.url;case"git":return A.url;case"directory":return A.path;case"file":return A.path;default:return"Unknown source"}}function ux(A,K){return`${A}@${K}`}async function dQ(A){let K=[],q=[];for(let[Y,z]of Object.entries(A)){if(!A7A(z.source))continue;let w=null;try{w=await HM(Y)}catch(H){let J=H instanceof Error?H.message:String(H);q.push({name:Y,error:J}),KA(H instanceof Error?H:Error(`Failed to load marketplace ${Y}: ${H}`))}K.push({name:Y,config:z,data:w})}return{marketplaces:K,failures:q}}function w$A(A,K){if(A.length===0)return null;if(K>0)return{type:"warning",message:A.length===1?`Warning: Failed to load marketplace '${A[0].name}': ${A[0].error}`:`Warning: Failed to load ${A.length} marketplaces: ${UN9(A)}`};return{type:"error",message:`Failed to load all marketplaces. Errors: ${pN9(A)}`}}function UN9(A){return A.map((K)=>K.name).join(", ")}function pN9(A){return A.map((K)=>`${K.name}: ${K.error}`).join("; ")}function e4A(){let A=N4("policySettings");if(!A?.strictKnownMarketplaces)return null;return A.strictKnownMarketplaces}function dN9(){let A=N4("policySettings");if(!A?.blockedMarketplaces)return null;return A.blockedMarketplaces}function cN9(A,K){if(A.source!==K.source)return!1;switch(A.source){case"url":return A.url===K.url;case"github":return A.repo===K.repo&&(A.ref||void 0)===(K.ref||void 0)&&(A.path||void 0)===(K.path||void 0);case"git":return A.url===K.url&&(A.ref||void 0)===(K.ref||void 0)&&(A.path||void 0)===(K.path||void 0);case"npm":return A.package===K.package;case"file":return A.path===K.path;case"directory":return A.path===K.path;default:return!1}}function m96(A){switch(A.source){case"github":return"github.com";case"git":{let K=A.url.match(/^[^@]+@([^:]+):/);if(K?.[1])return K[1];try{return new URL(A.url).hostname}catch{return null}}case"url":try{return new URL(A.url).hostname}catch{return null}default:return null}}function lN9(A,K){let q=m96(A);if(!q)return!1;try{return new RegExp(K.hostPattern).test(q)}catch{return KA(Error(`Invalid hostPattern regex: ${K.hostPattern}`)),!1}}function kS4(){let A=e4A();if(!A)return[];return A.filter((K)=>K.source==="hostPattern").map((K)=>K.hostPattern)}function ES4(A){let K=A.match(/^git@github\.com:([^/]+\/[^/]+?)(?:\.git)?$/);if(K&&K[1])return K[1];let q=A.match(/^https?:\/\/github\.com\/([^/]+\/[^/]+?)(?:\.git)?$/);if(q&&q[1])return q[1];return null}function br(A,K){if(!A)return!0;return(A||void 0)===(K||void 0)}function iN9(A,K){if(A.source===K.source)switch(A.source){case"github":{let q=K;if(A.repo!==q.repo)return!1;return br(q.ref,A.ref)&&br(q.path,A.path)}case"git":{let q=K;if(A.url!==q.url)return!1;return br(q.ref,A.ref)&&br(q.path,A.path)}case"url":return A.url===K.url;case"npm":return A.package===K.package;case"file":return A.path===K.path;case"directory":return A.path===K.path;default:return!1}if(A.source==="git"&&K.source==="github"){if(ES4(A.url)===K.repo)return br(K.ref,A.ref)&&br(K.path,A.path)}if(A.source==="github"&&K.source==="git"){if(ES4(K.url)===A.repo)return br(K.ref,A.ref)&&br(K.path,A.path)}return!1}function lIA(A){let K=dN9();if(K===null)return!1;return K.some((q)=>iN9(A,q))}function A7A(A){if(lIA(A))return!1;let K=e4A();if(K===null)return!0;return K.some((q)=>{if(q.source==="hostPattern")return lN9(A,q);return cN9(A,q)})}function H$A(A){switch(A.source){case"github":return`github:${A.repo}${A.ref?`@${A.ref}`:""}`;case"url":return A.url;case"git":return`git:${A.url}${A.ref?`@${A.ref}`:""}`;case"npm":return`npm:${A.package}`;case"file":return`file:${A.path}`;case"directory":return`dir:${A.path}`;case"hostPattern":return`hostPattern:${A.hostPattern}`;default:return"unknown source"}}async function CS4({configuredMarketplaceCount:A,failedMarketplaceCount:K}){if(!await a91())return"git-not-installed";let Y=e4A();if(Y!==null){if(Y.length===0)return"all-blocked-by-policy";if(A===0)return"policy-restricts-sources"}if(A===0)return"no-marketplaces-configured";if(K>0&&K===A)return"all-marketplaces-failed";return"all-plugins-installed"}var xr=C(()=>{kJ();v1();B8();B96()});function J$A(A){if(A.includes("@")){let K=A.split("@");return{name:K[0]||"",marketplace:K[1]}}return{name:A}}function Bx(A){if(A==="managed")throw Error("Cannot install plugins to managed scope");return nN9[A]}function RS4(A){return LS4[A]}var LS4,nN9;var K7A=C(()=>{LS4={policySettings:"managed",userSettings:"user",projectSettings:"project",localSettings:"local",flagSettings:"flag"};nN9={user:"userSettings",project:"projectSettings",local:"localSettings"}});import{dirname as kGw,join as q7A}from"path";function O$A(){return q7A(CT(),"installed_plugins.json")}function rN9(){return q7A(CT(),"installed_plugins_v2.json")}function oN9(){if(g96)return;let A=xA(),K=O$A(),q=rN9();try{let Y=A.existsSync(q),z=A.existsSync(K);if(Y){A.renameSync(q,K),h("Renamed installed_plugins_v2.json to installed_plugins.json");let w=kD();yS4(w)}else if(z){let w=A.readFileSync(K,{encoding:"utf-8"}),H=X6(w);if((typeof H?.version==="number"?H.version:1)===1){let O=UIA.parse(H),X=U96(O);b8(K,QA(X,null,2),{encoding:"utf-8",flush:!0}),h(`Converted installed_plugins.json from V1 to V2 format (${Object.keys(O.plugins).length} plugins)`),yS4(X)}}g96=!0}catch(Y){let z=Y instanceof Error?Y.message:String(Y);h(`Failed to migrate plugin files: ${z}`,{level:"error"}),KA(Y instanceof Error?Y:Error(`Failed to migrate plugin files: ${z}`)),g96=!0}}function yS4(A){let K=xA(),q=Br();if(!K.existsSync(q))return;try{let Y=new Set;for(let w of Object.values(A.plugins))for(let H of w)Y.add(H.installPath);let z=K.readdirSync(q);for(let w of z){if(!w.isDirectory())continue;let H=w.name,J=q7A(q,H);if(K.readdirSync(J).some(($)=>{if(!$.isDirectory())return!1;let _=q7A(J,$.name);return K.readdirSync(_).some((G)=>G.isDirectory())}))continue;if(!Y.has(J))K.rmSync(J,{recursive:!0,force:!0}),h(`Cleaned up legacy cache directory: ${H}`)}}catch(Y){let z=Y instanceof Error?Y.message:String(Y);h(`Failed to clean up legacy cache: ${z}`,{level:"warn"})}}function Q96(){let A=xA(),K=O$A();if(!A.existsSync(K))return null;let q=A.readFileSync(K,{encoding:"utf-8"}),Y=X6(q);return{version:typeof Y?.version==="number"?Y.version:1,data:Y}}function U96(A){let K={};for(let[q,Y]of Object.entries(A.plugins)){let z=gx(q,Y.version);K[q]=[{scope:"user",installPath:z,version:Y.version,installedAt:Y.installedAt,lastUpdated:Y.lastUpdated,gitCommitSha:Y.gitCommitSha}]}return{version:2,plugins:K}}function kD(){if(mx!==null)return mx;let A=O$A();try{let K=Q96();if(K){if(K.version===2){let z=pIA.parse(K.data);return mx=z,h(`Loaded ${Object.keys(z.plugins).length} installed plugins from ${A}`),z}let q=UIA.parse(K.data),Y=U96(q);return mx=Y,h(`Loaded and converted ${Object.keys(q.plugins).length} plugins from V1 format`),Y}return h("installed_plugins.json doesn't exist, returning empty V2 object"),mx={version:2,plugins:{}},mx}catch(K){let q=K instanceof Error?K.message:String(K);return h(`Failed to load installed_plugins.json: ${q}. Starting with empty state.`,{level:"error"}),KA(K instanceof Error?K:Error(`Failed to load installed_plugins.json: ${q}`)),mx={version:2,plugins:{}},mx}}function t91(A){let K=xA(),q=O$A();try{let Y=CT();if(!K.existsSync(Y))K.mkdirSync(Y);let z=QA(A,null,2);b8(q,z,{encoding:"utf-8",flush:!0}),mx=A,h(`Saved ${Object.keys(A.plugins).length} installed plugins to ${q}`)}catch(Y){let z=Y instanceof Error?Y.message:String(Y);throw KA(Y instanceof Error?Y:Error(`Failed to save installed_plugins.json: ${z}`)),Y}}function SS4(A,K,q){let Y=kD(),z=Y.plugins[A];if(!z)return;if(Y.plugins[A]=z.filter((w)=>!(w.scope===K&&w.projectPath===q)),Y.plugins[A].length===0)delete Y.plugins[A];t91(Y),h(`Removed installation for ${A} at scope ${K}`)}function p96(){if(F96===null)F96=kD();return F96}function ur(){try{let A=Q96();if(A){if(A.version===2)return pIA.parse(A.data);let K=UIA.parse(A.data);return U96(K)}return{version:2,plugins:{}}}catch(A){let K=A instanceof Error?A.message:String(A);return h(`Failed to load installed plugins from disk: ${K}`,{level:"error"}),{version:2,plugins:{}}}}function hS4(A,K,q,Y,z){let w=ur(),H=w.plugins[A];if(!H){h(`Cannot update ${A} on disk: plugin not found in installed plugins`);return}let J=H.find((O)=>O.scope===K&&O.projectPath===q);if(J){J.installPath=Y,J.version=z,J.lastUpdated=new Date().toISOString();let O=O$A();b8(O,QA(w,null,2),{encoding:"utf-8",flush:!0}),mx=null,h(`Updated ${A} on disk to version ${z} at ${Y}`)}else h(`Cannot update ${A} on disk: no installation for scope ${K}`)}async function d96(){oN9();try{await l96()}catch(K){KA(K instanceof Error?K:Error(String(K)))}let A=p96();h(`Initialized versioned plugins system with ${Object.keys(A.plugins).length} plugins`)}function aN9(A){let q=kD().plugins[A];if(!q||q.length===0)return;let Y=q[0];if(!Y)return;return{version:Y.version||"unknown",installedAt:Y.installedAt||new Date().toISOString(),lastUpdated:Y.lastUpdated,installPath:Y.installPath,gitCommitSha:Y.gitCommitSha}}function bS4(A){if(!A)return[];let K=kD(),q=`@${A}`,Y=new Set,z=!1;for(let w of Object.keys(K.plugins)){if(!w.endsWith(q))continue;for(let H of K.plugins[w]??[])if(H.installPath)Y.add(H.installPath);delete K.plugins[w],z=!0,h(`Removed installed plugin for marketplace removal: ${w}`)}if(z)t91(K);return Array.from(Y)}function xG(A){return aN9(A)!==void 0}function c96(A,K,q="user",Y){let z=kD(),w={scope:q,installPath:K.installPath,version:K.version,installedAt:K.installedAt,lastUpdated:K.lastUpdated,gitCommitSha:K.gitCommitSha,...Y&&{projectPath:Y}},H=z.plugins[A]||[],J=H.findIndex((X)=>X.scope===q&&X.projectPath===Y),O=J>=0;if(O)H[J]=w;else H.push(w);z.plugins[A]=H,t91(z),h(`${O?"Updated":"Added"} installed plugin: ${A} (scope: ${q})`)}async function s91(A){try{let K=await L6("git",["-C",A,"rev-parse","HEAD"]);if(K.code===0&&K.stdout)return K.stdout.trim();return}catch(K){h(`Failed to get git commit SHA from ${A}: ${K}`);return}}function IS4(A,K){let q=xA(),Y=q7A(A,".claude-plugin","plugin.json");if(!q.existsSync(Y))return"unknown";try{let z=q.readFileSync(Y,{encoding:"utf-8"});return X6(z).version||"unknown"}catch{return h(`Could not read version from manifest for ${K}`),"unknown"}}async function l96(){let K=O8().enabledPlugins||{};if(Object.keys(K).length===0)return;let q=Q96(),Y=q!==null;if(Y&&q?.version===2&&q){let G=pIA.safeParse(q.data);if(G?.success){let W=G.data.plugins;if(Object.keys(K).filter((j)=>j.includes("@")).every((j)=>{let M=W[j];return M&&M.length>0})){h("All plugins already exist, skipping migration");return}}}h(Y?"Syncing installed_plugins.json with enabledPlugins from all settings.json files":"Creating installed_plugins.json from settings.json files");let w=xA(),H=new Date().toISOString(),J=b1(),O=new Map,X=["userSettings","projectSettings","localSettings"];for(let G of X){let D=N4(G)?.enabledPlugins||{};for(let j of Object.keys(D)){if(!j.includes("@"))continue;let M=RS4(G);O.set(j,{scope:M,projectPath:M==="user"?void 0:J})}}let $={};if(Y)$={...kD().plugins};let _=0,Z=0;for(let[G,W]of O){let D=$[G];if(D&&D.length>0){let j=D[0];if(j&&(j.scope!==W.scope||j.projectPath!==W.projectPath)){if(j.scope=W.scope,W.projectPath)j.projectPath=W.projectPath;else delete j.projectPath;j.lastUpdated=H,_++,h(`Updated ${G} scope to ${W.scope} (settings.json is source of truth)`)}}else{let j=G.split("@"),M=j[0];if(!M||j.length!==2)continue;try{let P=await $Z(G);if(!P){h(`Plugin ${G} not found in any marketplace, skipping`);continue}let{entry:V,marketplaceInstallLocation:N}=P,T,E="unknown",R=void 0;if(typeof V.source==="string")T=q7A(N,V.source),E=IS4(T,G),R=await s91(T);else{let b=Br(),S=M.replace(/[^a-zA-Z0-9-_]/g,"-"),B=q7A(b,S);if(!w.existsSync(B)){h(`External plugin ${G} not in cache, skipping`);continue}T=B,E=IS4(B,G),R=await s91(B)}if(E==="unknown"&&V.version)E=V.version;if(E==="unknown"&&R)E=R.substring(0,12);$[G]=[{scope:W.scope,installPath:gx(G,E),version:E,installedAt:H,lastUpdated:H,gitCommitSha:R,...W.projectPath&&{projectPath:W.projectPath}}],Z++,h(`Added ${G} with scope ${W.scope}`)}catch(P){h(`Failed to add plugin ${G}: ${P}`)}}}if(!Y||_>0||Z>0)t91({version:2,plugins:$}),h(`Sync completed: ${Z} added, ${_} updated in installed_plugins.json`)}var g96=!1,mx=null,F96=null;var uG=C(()=>{s6();h1();W1();v1();dIA();ED();h1();B8();K7A();u4();d0();vK();kJ()});function JM(A){switch(A.type){case"generic-error":return A.error;case"path-not-found":return`Path not found: ${A.path} (${A.component})`;case"git-auth-failed":return`Git authentication failed (${A.authType}): ${A.gitUrl}`;case"git-timeout":return`Git ${A.operation} timeout: ${A.gitUrl}`;case"network-error":return`Network error: ${A.url}${A.details?` - ${A.details}`:""}`;case"manifest-parse-error":return`Manifest parse error: ${A.parseError}`;case"manifest-validation-error":return`Manifest validation failed: ${A.validationErrors.join(", ")}`;case"plugin-not-found":return`Plugin ${A.pluginId} not found in marketplace ${A.marketplace}`;case"marketplace-not-found":return`Marketplace ${A.marketplace} not found`;case"marketplace-load-failed":return`Marketplace ${A.marketplace} failed to load: ${A.reason}`;case"repository-scan-failed":return`Repository scan failed: ${A.reason}`;case"mcp-config-invalid":return`MCP server ${A.serverName} invalid: ${A.validationError}`;case"hook-load-failed":return`Hook load failed: ${A.reason}`;case"component-load-failed":return`${A.component} load failed from ${A.path}: ${A.reason}`;case"mcpb-download-failed":return`Failed to download MCPB from ${A.url}: ${A.reason}`;case"mcpb-extract-failed":return`Failed to extract MCPB ${A.mcpbPath}: ${A.reason}`;case"mcpb-invalid-manifest":return`MCPB manifest invalid at ${A.mcpbPath}: ${A.validationError}`;case"lsp-config-invalid":return`Plugin "${A.plugin}" has invalid LSP server config for "${A.serverName}": ${A.validationError}`;case"lsp-server-start-failed":return`Plugin "${A.plugin}" failed to start LSP server "${A.serverName}": ${A.reason}`;case"lsp-server-crashed":if(A.signal)return`Plugin "${A.plugin}" LSP server "${A.serverName}" crashed with signal ${A.signal}`;return`Plugin "${A.plugin}" LSP server "${A.serverName}" crashed with exit code ${A.exitCode??"unknown"}`;case"lsp-request-timeout":return`Plugin "${A.plugin}" LSP server "${A.serverName}" timed out on ${A.method} request after ${A.timeoutMs}ms`;case"lsp-request-failed":return`Plugin "${A.plugin}" LSP server "${A.serverName}" ${A.method} request failed: ${A.error}`;case"marketplace-blocked-by-policy":if(A.blockedByBlocklist)return`Marketplace '${A.marketplace}' is blocked by enterprise policy`;return`Marketplace '${A.marketplace}' is not in the allowed marketplace list`}}var uS4={};Aq(uS4,{sharp:()=>xS4,default:()=>sN9});function xS4(A){let K=null,q=[],Y=0;async function z(){if(!K)K=(async()=>{if(!e91)throw Error("Native image processor module not available");let{processImage:J}=e91;return J(A)})();return K}function w(J){for(let O=Y;O<q.length;O++){let X=q[O];if(X)X(J)}Y=q.length}let H={async metadata(){return(await z()).metadata()},resize(J,O,X){return q.push(($)=>{$.resize(J,O,X)}),H},jpeg(J){return q.push((O)=>{O.jpeg(J?.quality)}),H},png(J){return q.push((O)=>{O.png(J)}),H},webp(J){return q.push((O)=>{O.webp(J?.quality)}),H},async toBuffer(){let J=await z();return w(J),J.toBuffer()}};return H}var e91,sN9;var BS4=C(()=>{try{e91=(()=>{throw new Error("Cannot require module "+"../../image-processor.node");})()}catch(A){e91=null}sN9=xS4});var Fx=v((UGw,gS4)=>{var mS4=function(A){return typeof A<"u"&&A!==null},tN9=function(A){return typeof A==="object"},eN9=function(A){return Object.prototype.toString.call(A)==="[object Object]"},AT9=function(A){return typeof A==="function"},KT9=function(A){return typeof A==="boolean"},qT9=function(A){return A instanceof Buffer},YT9=function(A){if(mS4(A))switch(A.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},zT9=function(A){return A instanceof ArrayBuffer},wT9=function(A){return typeof A==="string"&&A.length>0},HT9=function(A){return typeof A==="number"&&!Number.isNaN(A)},JT9=function(A){return Number.isInteger(A)},OT9=function(A,K,q){return A>=K&&A<=q},XT9=function(A,K){return K.includes(A)},$T9=function(A,K,q){return Error(`Expected ${K} for ${A} but received ${q} of type ${typeof q}`)},_T9=function(A,K){return K.message=A.message,K};gS4.exports={defined:mS4,object:tN9,plainObject:eN9,fn:AT9,bool:KT9,buffer:qT9,typedArray:YT9,arrayBuffer:zT9,string:wT9,number:HT9,integer:JT9,inRange:OT9,inArray:XT9,invalidParameterError:$T9,nativeError:_T9}});var US4=v((pGw,QS4)=>{var FS4=()=>process.platform==="linux",AY1=null,ZT9=()=>{if(!AY1)if(FS4()&&process.report){let A=process.report.excludeNetwork;process.report.excludeNetwork=!0,AY1=process.report.getReport(),process.report.excludeNetwork=A}else AY1={};return AY1};QS4.exports={isLinux:FS4,getReport:ZT9}});var cS4=v((dGw,dS4)=>{var pS4=yA("fs"),GT9=(A)=>pS4.readFileSync(A,"utf-8"),WT9=(A)=>new Promise((K,q)=>{pS4.readFile(A,"utf-8",(Y,z)=>{if(Y)q(Y);else K(z)})});dS4.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:GT9,readFile:WT9}});var qY1=v((cGw,Hh4)=>{var iS4=yA("child_process"),{isLinux:$$A,getReport:nS4}=US4(),{LDD_PATH:KY1,readFile:rS4,readFileSync:oS4}=cS4(),Qx,Ux,mr="",aS4=()=>{if(!mr)return new Promise((A)=>{iS4.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",(K,q)=>{mr=K?" ":q,A(mr)})});return mr},sS4=()=>{if(!mr)try{mr=iS4.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(A){mr=" "}return mr},gr="glibc",tS4=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,X$A="musl",DT9=(A)=>A.includes("libc.musl-")||A.includes("ld-musl-"),eS4=()=>{let A=nS4();if(A.header&&A.header.glibcVersionRuntime)return gr;if(Array.isArray(A.sharedObjects)){if(A.sharedObjects.some(DT9))return X$A}return null},Ah4=(A)=>{let[K,q]=A.split(/[\r\n]+/);if(K&&K.includes(gr))return gr;if(q&&q.includes(X$A))return X$A;return null},Kh4=(A)=>{if(A.includes("musl"))return X$A;if(A.includes("GNU C Library"))return gr;return null},jT9=async()=>{if(Qx!==void 0)return Qx;Qx=null;try{let A=await rS4(KY1);Qx=Kh4(A)}catch(A){}return Qx},MT9=()=>{if(Qx!==void 0)return Qx;Qx=null;try{let A=oS4(KY1);Qx=Kh4(A)}catch(A){}return Qx},qh4=async()=>{let A=null;if($$A()){if(A=await jT9(),!A)A=eS4();if(!A){let K=await aS4();A=Ah4(K)}}return A},Yh4=()=>{let A=null;if($$A()){if(A=MT9(),!A)A=eS4();if(!A){let K=sS4();A=Ah4(K)}}return A},PT9=async()=>$$A()&&await qh4()!==gr,VT9=()=>$$A()&&Yh4()!==gr,fT9=async()=>{if(Ux!==void 0)return Ux;Ux=null;try{let K=(await rS4(KY1)).match(tS4);if(K)Ux=K[1]}catch(A){}return Ux},NT9=()=>{if(Ux!==void 0)return Ux;Ux=null;try{let K=oS4(KY1).match(tS4);if(K)Ux=K[1]}catch(A){}return Ux},zh4=()=>{let A=nS4();if(A.header&&A.header.glibcVersionRuntime)return A.header.glibcVersionRuntime;return null},lS4=(A)=>A.trim().split(/\s+/)[1],wh4=(A)=>{let[K,q,Y]=A.split(/[\r\n]+/);if(K&&K.includes(gr))return lS4(K);if(q&&Y&&q.includes(X$A))return lS4(Y);return null},TT9=async()=>{let A=null;if($$A()){if(A=await fT9(),!A)A=zh4();if(!A){let K=await aS4();A=wh4(K)}}return A},vT9=()=>{let A=null;if($$A()){if(A=NT9(),!A)A=zh4();if(!A){let K=sS4();A=wh4(K)}}return A};Hh4.exports={GLIBC:gr,MUSL:X$A,family:qh4,familySync:Yh4,isNonGlibcLinux:PT9,isNonGlibcLinuxSync:VT9,version:TT9,versionSync:vT9}});var iIA=v((lGw,Jh4)=>{var ET9=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...A)=>console.error("SEMVER",...A):()=>{};Jh4.exports=ET9});var YY1=v((iGw,Oh4)=>{var kT9=Number.MAX_SAFE_INTEGER||9007199254740991,CT9=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Oh4.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:kT9,RELEASE_TYPES:CT9,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var nIA=v((px,Xh4)=>{var{MAX_SAFE_COMPONENT_LENGTH:i96,MAX_SAFE_BUILD_LENGTH:LT9,MAX_LENGTH:RT9}=YY1(),yT9=iIA();px=Xh4.exports={};var IT9=px.re=[],ST9=px.safeRe=[],y7=px.src=[],hT9=px.safeSrc=[],I7=px.t={},bT9=0,n96="[a-zA-Z0-9-]",xT9=[["\\s",1],["\\d",RT9],[n96,LT9]],uT9=(A)=>{for(let[K,q]of xT9)A=A.split(`${K}*`).join(`${K}{0,${q}}`).split(`${K}+`).join(`${K}{1,${q}}`);return A},r5=(A,K,q)=>{let Y=uT9(K),z=bT9++;yT9(A,z,K),I7[A]=z,y7[z]=K,hT9[z]=Y,IT9[z]=new RegExp(K,q?"g":void 0),ST9[z]=new RegExp(Y,q?"g":void 0)};r5("NUMERICIDENTIFIER","0|[1-9]\\d*");r5("NUMERICIDENTIFIERLOOSE","\\d+");r5("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${n96}*`);r5("MAINVERSION",`(${y7[I7.NUMERICIDENTIFIER]})\\.(${y7[I7.NUMERICIDENTIFIER]})\\.(${y7[I7.NUMERICIDENTIFIER]})`);r5("MAINVERSIONLOOSE",`(${y7[I7.NUMERICIDENTIFIERLOOSE]})\\.(${y7[I7.NUMERICIDENTIFIERLOOSE]})\\.(${y7[I7.NUMERICIDENTIFIERLOOSE]})`);r5("PRERELEASEIDENTIFIER",`(?:${y7[I7.NUMERICIDENTIFIER]}|${y7[I7.NONNUMERICIDENTIFIER]})`);r5("PRERELEASEIDENTIFIERLOOSE",`(?:${y7[I7.NUMERICIDENTIFIERLOOSE]}|${y7[I7.NONNUMERICIDENTIFIER]})`);r5("PRERELEASE",`(?:-(${y7[I7.PRERELEASEIDENTIFIER]}(?:\\.${y7[I7.PRERELEASEIDENTIFIER]})*))`);r5("PRERELEASELOOSE",`(?:-?(${y7[I7.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${y7[I7.PRERELEASEIDENTIFIERLOOSE]})*))`);r5("BUILDIDENTIFIER",`${n96}+`);r5("BUILD",`(?:\\+(${y7[I7.BUILDIDENTIFIER]}(?:\\.${y7[I7.BUILDIDENTIFIER]})*))`);r5("FULLPLAIN",`v?${y7[I7.MAINVERSION]}${y7[I7.PRERELEASE]}?${y7[I7.BUILD]}?`);r5("FULL",`^${y7[I7.FULLPLAIN]}$`);r5("LOOSEPLAIN",`[v=\\s]*${y7[I7.MAINVERSIONLOOSE]}${y7[I7.PRERELEASELOOSE]}?${y7[I7.BUILD]}?`);r5("LOOSE",`^${y7[I7.LOOSEPLAIN]}$`);r5("GTLT","((?:<|>)?=?)");r5("XRANGEIDENTIFIERLOOSE",`${y7[I7.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);r5("XRANGEIDENTIFIER",`${y7[I7.NUMERICIDENTIFIER]}|x|X|\\*`);r5("XRANGEPLAIN",`[v=\\s]*(${y7[I7.XRANGEIDENTIFIER]})(?:\\.(${y7[I7.XRANGEIDENTIFIER]})(?:\\.(${y7[I7.XRANGEIDENTIFIER]})(?:${y7[I7.PRERELEASE]})?${y7[I7.BUILD]}?)?)?`);r5("XRANGEPLAINLOOSE",`[v=\\s]*(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:\\.(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:\\.(${y7[I7.XRANGEIDENTIFIERLOOSE]})(?:${y7[I7.PRERELEASELOOSE]})?${y7[I7.BUILD]}?)?)?`);r5("XRANGE",`^${y7[I7.GTLT]}\\s*${y7[I7.XRANGEPLAIN]}$`);r5("XRANGELOOSE",`^${y7[I7.GTLT]}\\s*${y7[I7.XRANGEPLAINLOOSE]}$`);r5("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i96}})(?:\\.(\\d{1,${i96}}))?(?:\\.(\\d{1,${i96}}))?`);r5("COERCE",`${y7[I7.COERCEPLAIN]}(?:$|[^\\d])`);r5("COERCEFULL",y7[I7.COERCEPLAIN]+`(?:${y7[I7.PRERELEASE]})?(?:${y7[I7.BUILD]})?(?:$|[^\\d])`);r5("COERCERTL",y7[I7.COERCE],!0);r5("COERCERTLFULL",y7[I7.COERCEFULL],!0);r5("LONETILDE","(?:~>?)");r5("TILDETRIM",`(\\s*)${y7[I7.LONETILDE]}\\s+`,!0);px.tildeTrimReplace="$1~";r5("TILDE",`^${y7[I7.LONETILDE]}${y7[I7.XRANGEPLAIN]}$`);r5("TILDELOOSE",`^${y7[I7.LONETILDE]}${y7[I7.XRANGEPLAINLOOSE]}$`);r5("LONECARET","(?:\\^)");r5("CARETTRIM",`(\\s*)${y7[I7.LONECARET]}\\s+`,!0);px.caretTrimReplace="$1^";r5("CARET",`^${y7[I7.LONECARET]}${y7[I7.XRANGEPLAIN]}$`);r5("CARETLOOSE",`^${y7[I7.LONECARET]}${y7[I7.XRANGEPLAINLOOSE]}$`);r5("COMPARATORLOOSE",`^${y7[I7.GTLT]}\\s*(${y7[I7.LOOSEPLAIN]})$|^$`);r5("COMPARATOR",`^${y7[I7.GTLT]}\\s*(${y7[I7.FULLPLAIN]})$|^$`);r5("COMPARATORTRIM",`(\\s*)${y7[I7.GTLT]}\\s*(${y7[I7.LOOSEPLAIN]}|${y7[I7.XRANGEPLAIN]})`,!0);px.comparatorTrimReplace="$1$2$3";r5("HYPHENRANGE",`^\\s*(${y7[I7.XRANGEPLAIN]})\\s+-\\s+(${y7[I7.XRANGEPLAIN]})\\s*$`);r5("HYPHENRANGELOOSE",`^\\s*(${y7[I7.XRANGEPLAINLOOSE]})\\s+-\\s+(${y7[I7.XRANGEPLAINLOOSE]})\\s*$`);r5("STAR","(<|>)?=?\\s*\\*");r5("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");r5("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var zY1=v((nGw,$h4)=>{var BT9=Object.freeze({loose:!0}),mT9=Object.freeze({}),gT9=(A)=>{if(!A)return mT9;if(typeof A!=="object")return BT9;return A};$h4.exports=gT9});var Wh4=v((rGw,Gh4)=>{var _h4=/^[0-9]+$/,Zh4=(A,K)=>{let q=_h4.test(A),Y=_h4.test(K);if(q&&Y)A=+A,K=+K;return A===K?0:q&&!Y?-1:Y&&!q?1:A<K?-1:1},FT9=(A,K)=>Zh4(K,A);Gh4.exports={compareIdentifiers:Zh4,rcompareIdentifiers:FT9}});var Z$A=v((oGw,Ph4)=>{var wY1=iIA(),{MAX_LENGTH:Dh4,MAX_SAFE_INTEGER:HY1}=YY1(),{safeRe:jh4,safeSrc:Mh4,t:JY1}=nIA(),QT9=zY1(),{compareIdentifiers:_$A}=Wh4();class hy{constructor(A,K){if(K=QT9(K),A instanceof hy)if(A.loose===!!K.loose&&A.includePrerelease===!!K.includePrerelease)return A;else A=A.version;else if(typeof A!=="string")throw TypeError(`Invalid version. Must be a string. Got type "${typeof A}".`);if(A.length>Dh4)throw TypeError(`version is longer than ${Dh4} characters`);wY1("SemVer",A,K),this.options=K,this.loose=!!K.loose,this.includePrerelease=!!K.includePrerelease;let q=A.trim().match(K.loose?jh4[JY1.LOOSE]:jh4[JY1.FULL]);if(!q)throw TypeError(`Invalid Version: ${A}`);if(this.raw=A,this.major=+q[1],this.minor=+q[2],this.patch=+q[3],this.major>HY1||this.major<0)throw TypeError("Invalid major version");if(this.minor>HY1||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>HY1||this.patch<0)throw TypeError("Invalid patch version");if(!q[4])this.prerelease=[];else this.prerelease=q[4].split(".").map((Y)=>{if(/^[0-9]+$/.test(Y)){let z=+Y;if(z>=0&&z<HY1)return z}return Y});this.build=q[5]?q[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare(A){if(wY1("SemVer.compare",this.version,this.options,A),!(A instanceof hy)){if(typeof A==="string"&&A===this.version)return 0;A=new hy(A,this.options)}if(A.version===this.version)return 0;return this.compareMain(A)||this.comparePre(A)}compareMain(A){if(!(A instanceof hy))A=new hy(A,this.options);return _$A(this.major,A.major)||_$A(this.minor,A.minor)||_$A(this.patch,A.patch)}comparePre(A){if(!(A instanceof hy))A=new hy(A,this.options);if(this.prerelease.length&&!A.prerelease.length)return-1;else if(!this.prerelease.length&&A.prerelease.length)return 1;else if(!this.prerelease.length&&!A.prerelease.length)return 0;let K=0;do{let q=this.prerelease[K],Y=A.prerelease[K];if(wY1("prerelease compare",K,q,Y),q===void 0&&Y===void 0)return 0;else if(Y===void 0)return 1;else if(q===void 0)return-1;else if(q===Y)continue;else return _$A(q,Y)}while(++K)}compareBuild(A){if(!(A instanceof hy))A=new hy(A,this.options);let K=0;do{let q=this.build[K],Y=A.build[K];if(wY1("build compare",K,q,Y),q===void 0&&Y===void 0)return 0;else if(Y===void 0)return 1;else if(q===void 0)return-1;else if(q===Y)continue;else return _$A(q,Y)}while(++K)}inc(A,K,q){if(A.startsWith("pre")){if(!K&&q===!1)throw Error("invalid increment argument: identifier is empty");if(K){let Y=new RegExp(`^${this.options.loose?Mh4[JY1.PRERELEASELOOSE]:Mh4[JY1.PRERELEASE]}$`),z=`-${K}`.match(Y);if(!z||z[1]!==K)throw Error(`invalid identifier: ${K}`)}}switch(A){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",K,q);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",K,q);break;case"prepatch":this.prerelease.length=0,this.inc("patch",K,q),this.inc("pre",K,q);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",K,q);this.inc("pre",K,q);break;case"release":if(this.prerelease.length===0)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{let Y=Number(q)?1:0;if(this.prerelease.length===0)this.prerelease=[Y];else{let z=this.prerelease.length;while(--z>=0)if(typeof this.prerelease[z]==="number")this.prerelease[z]++,z=-2;if(z===-1){if(K===this.prerelease.join(".")&&q===!1)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(Y)}}if(K){let z=[K,Y];if(q===!1)z=[K];if(_$A(this.prerelease[0],K)===0){if(isNaN(this.prerelease[1]))this.prerelease=z}else this.prerelease=z}break}default:throw Error(`invalid increment argument: ${A}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}Ph4.exports=hy});var Nh4=v((aGw,fh4)=>{var Vh4=Z$A(),UT9=(A,K,q=!1)=>{if(A instanceof Vh4)return A;try{return new Vh4(A,K)}catch(Y){if(!q)return null;throw Y}};fh4.exports=UT9});var vh4=v((sGw,Th4)=>{var pT9=Z$A(),dT9=Nh4(),{safeRe:OY1,t:XY1}=nIA(),cT9=(A,K)=>{if(A instanceof pT9)return A;if(typeof A==="number")A=String(A);if(typeof A!=="string")return null;K=K||{};let q=null;if(!K.rtl)q=A.match(K.includePrerelease?OY1[XY1.COERCEFULL]:OY1[XY1.COERCE]);else{let O=K.includePrerelease?OY1[XY1.COERCERTLFULL]:OY1[XY1.COERCERTL],X;while((X=O.exec(A))&&(!q||q.index+q[0].length!==A.length)){if(!q||X.index+X[0].length!==q.index+q[0].length)q=X;O.lastIndex=X.index+X[1].length+X[2].length}O.lastIndex=-1}if(q===null)return null;let Y=q[2],z=q[3]||"0",w=q[4]||"0",H=K.includePrerelease&&q[5]?`-${q[5]}`:"",J=K.includePrerelease&&q[6]?`+${q[6]}`:"";return dT9(`${Y}.${z}.${w}${H}${J}`,K)};Th4.exports=cT9});var Y7A=v((tGw,kh4)=>{var Eh4=Z$A(),lT9=(A,K,q)=>new Eh4(A,q).compare(new Eh4(K,q));kh4.exports=lT9});var r96=v((eGw,Ch4)=>{var iT9=Y7A(),nT9=(A,K,q)=>iT9(A,K,q)>=0;Ch4.exports=nT9});var yh4=v((AWw,Rh4)=>{class Lh4{constructor(){this.max=1000,this.map=new Map}get(A){let K=this.map.get(A);if(K===void 0)return;else return this.map.delete(A),this.map.set(A,K),K}delete(A){return this.map.delete(A)}set(A,K){if(!this.delete(A)&&K!==void 0){if(this.map.size>=this.max){let Y=this.map.keys().next().value;this.delete(Y)}this.map.set(A,K)}return this}}Rh4.exports=Lh4});var Sh4=v((KWw,Ih4)=>{var rT9=Y7A(),oT9=(A,K,q)=>rT9(A,K,q)===0;Ih4.exports=oT9});var bh4=v((qWw,hh4)=>{var aT9=Y7A(),sT9=(A,K,q)=>aT9(A,K,q)!==0;hh4.exports=sT9});var uh4=v((YWw,xh4)=>{var tT9=Y7A(),eT9=(A,K,q)=>tT9(A,K,q)>0;xh4.exports=eT9});var mh4=v((zWw,Bh4)=>{var Av9=Y7A(),Kv9=(A,K,q)=>Av9(A,K,q)<0;Bh4.exports=Kv9});var Fh4=v((wWw,gh4)=>{var qv9=Y7A(),Yv9=(A,K,q)=>qv9(A,K,q)<=0;gh4.exports=Yv9});var Uh4=v((HWw,Qh4)=>{var zv9=Sh4(),wv9=bh4(),Hv9=uh4(),Jv9=r96(),Ov9=mh4(),Xv9=Fh4(),$v9=(A,K,q,Y)=>{switch(K){case"===":if(typeof A==="object")A=A.version;if(typeof q==="object")q=q.version;return A===q;case"!==":if(typeof A==="object")A=A.version;if(typeof q==="object")q=q.version;return A!==q;case"":case"=":case"==":return zv9(A,q,Y);case"!=":return wv9(A,q,Y);case">":return Hv9(A,q,Y);case">=":return Jv9(A,q,Y);case"<":return Ov9(A,q,Y);case"<=":return Xv9(A,q,Y);default:throw TypeError(`Invalid operator: ${K}`)}};Qh4.exports=$v9});var rh4=v((JWw,nh4)=>{var rIA=Symbol("SemVer ANY");class $Y1{static get ANY(){return rIA}constructor(A,K){if(K=ph4(K),A instanceof $Y1)if(A.loose===!!K.loose)return A;else A=A.value;if(A=A.trim().split(/\s+/).join(" "),a96("comparator",A,K),this.options=K,this.loose=!!K.loose,this.parse(A),this.semver===rIA)this.value="";else this.value=this.operator+this.semver.version;a96("comp",this)}parse(A){let K=this.options.loose?dh4[ch4.COMPARATORLOOSE]:dh4[ch4.COMPARATOR],q=A.match(K);if(!q)throw TypeError(`Invalid comparator: ${A}`);if(this.operator=q[1]!==void 0?q[1]:"",this.operator==="=")this.operator="";if(!q[2])this.semver=rIA;else this.semver=new lh4(q[2],this.options.loose)}toString(){return this.value}test(A){if(a96("Comparator.test",A,this.options.loose),this.semver===rIA||A===rIA)return!0;if(typeof A==="string")try{A=new lh4(A,this.options)}catch(K){return!1}return o96(A,this.operator,this.semver,this.options)}intersects(A,K){if(!(A instanceof $Y1))throw TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new ih4(A.value,K).test(this.value)}else if(A.operator===""){if(A.value==="")return!0;return new ih4(this.value,K).test(A.semver)}if(K=ph4(K),K.includePrerelease&&(this.value==="<0.0.0-0"||A.value==="<0.0.0-0"))return!1;if(!K.includePrerelease&&(this.value.startsWith("<0.0.0")||A.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&A.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&A.operator.startsWith("<"))return!0;if(this.semver.version===A.semver.version&&this.operator.includes("=")&&A.operator.includes("="))return!0;if(o96(this.semver,"<",A.semver,K)&&this.operator.startsWith(">")&&A.operator.startsWith("<"))return!0;if(o96(this.semver,">",A.semver,K)&&this.operator.startsWith("<")&&A.operator.startsWith(">"))return!0;return!1}}nh4.exports=$Y1;var ph4=zY1(),{safeRe:dh4,t:ch4}=nIA(),o96=Uh4(),a96=iIA(),lh4=Z$A(),ih4=s96()});var s96=v((OWw,th4)=>{var _v9=/\s+/g;class oIA{constructor(A,K){if(K=Gv9(K),A instanceof oIA)if(A.loose===!!K.loose&&A.includePrerelease===!!K.includePrerelease)return A;else return new oIA(A.raw,K);if(A instanceof t96)return this.raw=A.value,this.set=[[A]],this.formatted=void 0,this;if(this.options=K,this.loose=!!K.loose,this.includePrerelease=!!K.includePrerelease,this.raw=A.trim().replace(_v9," "),this.set=this.raw.split("||").map((q)=>this.parseRange(q.trim())).filter((q)=>q.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let q=this.set[0];if(this.set=this.set.filter((Y)=>!ah4(Y[0])),this.set.length===0)this.set=[q];else if(this.set.length>1){for(let Y of this.set)if(Y.length===1&&fv9(Y[0])){this.set=[Y];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let A=0;A<this.set.length;A++){if(A>0)this.formatted+="||";let K=this.set[A];for(let q=0;q<K.length;q++){if(q>0)this.formatted+=" ";this.formatted+=K[q].toString().trim()}}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(A){let q=((this.options.includePrerelease&&Pv9)|(this.options.loose&&Vv9))+":"+A,Y=oh4.get(q);if(Y)return Y;let z=this.options.loose,w=z?QV[OM.HYPHENRANGELOOSE]:QV[OM.HYPHENRANGE];A=A.replace(w,Iv9(this.options.includePrerelease)),FH("hyphen replace",A),A=A.replace(QV[OM.COMPARATORTRIM],Dv9),FH("comparator trim",A),A=A.replace(QV[OM.TILDETRIM],jv9),FH("tilde trim",A),A=A.replace(QV[OM.CARETTRIM],Mv9),FH("caret trim",A);let H=A.split(" ").map(($)=>Nv9($,this.options)).join(" ").split(/\s+/).map(($)=>yv9($,this.options));if(z)H=H.filter(($)=>{return FH("loose invalid filter",$,this.options),!!$.match(QV[OM.COMPARATORLOOSE])});FH("range list",H);let J=new Map,O=H.map(($)=>new t96($,this.options));for(let $ of O){if(ah4($))return[$];J.set($.value,$)}if(J.size>1&&J.has(""))J.delete("");let X=[...J.values()];return oh4.set(q,X),X}intersects(A,K){if(!(A instanceof oIA))throw TypeError("a Range is required");return this.set.some((q)=>{return sh4(q,K)&&A.set.some((Y)=>{return sh4(Y,K)&&q.every((z)=>{return Y.every((w)=>{return z.intersects(w,K)})})})})}test(A){if(!A)return!1;if(typeof A==="string")try{A=new Wv9(A,this.options)}catch(K){return!1}for(let K=0;K<this.set.length;K++)if(Sv9(this.set[K],A,this.options))return!0;return!1}}th4.exports=oIA;var Zv9=yh4(),oh4=new Zv9,Gv9=zY1(),t96=rh4(),FH=iIA(),Wv9=Z$A(),{safeRe:QV,t:OM,comparatorTrimReplace:Dv9,tildeTrimReplace:jv9,caretTrimReplace:Mv9}=nIA(),{FLAG_INCLUDE_PRERELEASE:Pv9,FLAG_LOOSE:Vv9}=YY1(),ah4=(A)=>A.value==="<0.0.0-0",fv9=(A)=>A.value==="",sh4=(A,K)=>{let q=!0,Y=A.slice(),z=Y.pop();while(q&&Y.length)q=Y.every((w)=>{return z.intersects(w,K)}),z=Y.pop();return q},Nv9=(A,K)=>{return FH("comp",A,K),A=Ev9(A,K),FH("caret",A),A=Tv9(A,K),FH("tildes",A),A=Cv9(A,K),FH("xrange",A),A=Rv9(A,K),FH("stars",A),A},XM=(A)=>!A||A.toLowerCase()==="x"||A==="*",Tv9=(A,K)=>{return A.trim().split(/\s+/).map((q)=>vv9(q,K)).join(" ")},vv9=(A,K)=>{let q=K.loose?QV[OM.TILDELOOSE]:QV[OM.TILDE];return A.replace(q,(Y,z,w,H,J)=>{FH("tilde",A,Y,z,w,H,J);let O;if(XM(z))O="";else if(XM(w))O=`>=${z}.0.0 <${+z+1}.0.0-0`;else if(XM(H))O=`>=${z}.${w}.0 <${z}.${+w+1}.0-0`;else if(J)FH("replaceTilde pr",J),O=`>=${z}.${w}.${H}-${J} <${z}.${+w+1}.0-0`;else O=`>=${z}.${w}.${H} <${z}.${+w+1}.0-0`;return FH("tilde return",O),O})},Ev9=(A,K)=>{return A.trim().split(/\s+/).map((q)=>kv9(q,K)).join(" ")},kv9=(A,K)=>{FH("caret",A,K);let q=K.loose?QV[OM.CARETLOOSE]:QV[OM.CARET],Y=K.includePrerelease?"-0":"";return A.replace(q,(z,w,H,J,O)=>{FH("caret",A,z,w,H,J,O);let X;if(XM(w))X="";else if(XM(H))X=`>=${w}.0.0${Y} <${+w+1}.0.0-0`;else if(XM(J))if(w==="0")X=`>=${w}.${H}.0${Y} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.0${Y} <${+w+1}.0.0-0`;else if(O)if(FH("replaceCaret pr",O),w==="0")if(H==="0")X=`>=${w}.${H}.${J}-${O} <${w}.${H}.${+J+1}-0`;else X=`>=${w}.${H}.${J}-${O} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.${J}-${O} <${+w+1}.0.0-0`;else if(FH("no pr"),w==="0")if(H==="0")X=`>=${w}.${H}.${J}${Y} <${w}.${H}.${+J+1}-0`;else X=`>=${w}.${H}.${J}${Y} <${w}.${+H+1}.0-0`;else X=`>=${w}.${H}.${J} <${+w+1}.0.0-0`;return FH("caret return",X),X})},Cv9=(A,K)=>{return FH("replaceXRanges",A,K),A.split(/\s+/).map((q)=>Lv9(q,K)).join(" ")},Lv9=(A,K)=>{A=A.trim();let q=K.loose?QV[OM.XRANGELOOSE]:QV[OM.XRANGE];return A.replace(q,(Y,z,w,H,J,O)=>{FH("xRange",A,Y,z,w,H,J,O);let X=XM(w),$=X||XM(H),_=$||XM(J),Z=_;if(z==="="&&Z)z="";if(O=K.includePrerelease?"-0":"",X)if(z===">"||z==="<")Y="<0.0.0-0";else Y="*";else if(z&&Z){if($)H=0;if(J=0,z===">")if(z=">=",$)w=+w+1,H=0,J=0;else H=+H+1,J=0;else if(z==="<=")if(z="<",$)w=+w+1;else H=+H+1;if(z==="<")O="-0";Y=`${z+w}.${H}.${J}${O}`}else if($)Y=`>=${w}.0.0${O} <${+w+1}.0.0-0`;else if(_)Y=`>=${w}.${H}.0${O} <${w}.${+H+1}.0-0`;return FH("xRange return",Y),Y})},Rv9=(A,K)=>{return FH("replaceStars",A,K),A.trim().replace(QV[OM.STAR],"")},yv9=(A,K)=>{return FH("replaceGTE0",A,K),A.trim().replace(QV[K.includePrerelease?OM.GTE0PRE:OM.GTE0],"")},Iv9=(A)=>(K,q,Y,z,w,H,J,O,X,$,_,Z)=>{if(XM(Y))q="";else if(XM(z))q=`>=${Y}.0.0${A?"-0":""}`;else if(XM(w))q=`>=${Y}.${z}.0${A?"-0":""}`;else if(H)q=`>=${q}`;else q=`>=${q}${A?"-0":""}`;if(XM(X))O="";else if(XM($))O=`<${+X+1}.0.0-0`;else if(XM(_))O=`<${X}.${+$+1}.0-0`;else if(Z)O=`<=${X}.${$}.${_}-${Z}`;else if(A)O=`<${X}.${$}.${+_+1}-0`;else O=`<=${O}`;return`${q} ${O}`.trim()},Sv9=(A,K,q)=>{for(let Y=0;Y<A.length;Y++)if(!A[Y].test(K))return!1;if(K.prerelease.length&&!q.includePrerelease){for(let Y=0;Y<A.length;Y++){if(FH(A[Y].semver),A[Y].semver===t96.ANY)continue;if(A[Y].semver.prerelease.length>0){let z=A[Y].semver;if(z.major===K.major&&z.minor===K.minor&&z.patch===K.patch)return!0}}return!1}return!0}});var Ab4=v((XWw,eh4)=>{var hv9=s96(),bv9=(A,K,q)=>{try{K=new hv9(K,q)}catch(Y){return!1}return K.test(A)};eh4.exports=bv9});var e96=v(($Ww,xv9)=>{xv9.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.33.5",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unnebäck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix Bünemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","Jérémy Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kotěšovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouciño <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugué <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{install:"node install/check",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;LGPL-3.0-or-later;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","package-from-local-build":"node npm/from-local-build","package-from-github-release":"node npm/from-github-release","docs-build":"node docs/build && node docs/search-index/build","docs-serve":"cd docs && npx serve","docs-publish":"cd docs && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{color:"^4.2.3","detect-libc":"^2.0.3",semver:"^7.6.3"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.33.5","@img/sharp-darwin-x64":"0.33.5","@img/sharp-libvips-darwin-arm64":"1.0.4","@img/sharp-libvips-darwin-x64":"1.0.4","@img/sharp-libvips-linux-arm":"1.0.5","@img/sharp-libvips-linux-arm64":"1.0.4","@img/sharp-libvips-linux-s390x":"1.0.4","@img/sharp-libvips-linux-x64":"1.0.4","@img/sharp-libvips-linuxmusl-arm64":"1.0.4","@img/sharp-libvips-linuxmusl-x64":"1.0.4","@img/sharp-linux-arm":"0.33.5","@img/sharp-linux-arm64":"0.33.5","@img/sharp-linux-s390x":"0.33.5","@img/sharp-linux-x64":"0.33.5","@img/sharp-linuxmusl-arm64":"0.33.5","@img/sharp-linuxmusl-x64":"0.33.5","@img/sharp-wasm32":"0.33.5","@img/sharp-win32-ia32":"0.33.5","@img/sharp-win32-x64":"0.33.5"},devDependencies:{"@emnapi/runtime":"^1.2.0","@img/sharp-libvips-dev":"1.0.4","@img/sharp-libvips-dev-wasm32":"1.0.5","@img/sharp-libvips-win32-ia32":"1.0.4","@img/sharp-libvips-win32-x64":"1.0.4","@types/node":"*",async:"^3.2.5",cc:"^3.0.1",emnapi:"^1.2.0","exif-reader":"^2.0.1","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^8.0.3","license-checker":"^25.0.1",mocha:"^10.7.3","node-addon-api":"^8.1.0",nyc:"^17.0.0",prebuild:"^13.0.1",semistandard:"^17.0.0","tar-fs":"^3.0.6",tsd:"^0.31.1"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.15.3"},funding:{url:"https://opencollective.com/libvips"},binary:{napi_versions:[9]},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},nyc:{include:["lib"]},tsd:{directory:"test/types/"}}});var KY6=v((_Ww,$b4)=>{var{spawnSync:_Y1}=yA("node:child_process"),{createHash:uv9}=yA("node:crypto"),zb4=vh4(),Bv9=r96(),mv9=Ab4(),Kb4=qY1(),{config:gv9,engines:qb4,optionalDependencies:Fv9}=e96(),Qv9=process.env.npm_package_config_libvips||gv9.libvips,wb4=zb4(Qv9).version,Uv9=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-ia32","win32-x64"],ZY1={encoding:"utf8",shell:!0},pv9=(A)=>{if(A instanceof Error)console.error(`sharp: Installation error: ${A.message}`);else console.log(`sharp: ${A}`)},Hb4=()=>Kb4.isNonGlibcLinuxSync()?Kb4.familySync():"",dv9=()=>`${process.platform}${Hb4()}-${process.arch}`,G$A=()=>{if(Jb4())return"wasm32";let{npm_config_arch:A,npm_config_platform:K,npm_config_libc:q}=process.env,Y=typeof q==="string"?q:Hb4();return`${K||process.platform}${Y}-${A||process.arch}`},cv9=()=>{try{return yA(`@img/sharp-libvips-dev-${G$A()}/include`)}catch{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/include");})()}catch{}}return""},lv9=()=>{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/cplusplus");})()}catch{}return""},iv9=()=>{try{return yA(`@img/sharp-libvips-dev-${G$A()}/lib`)}catch{try{return yA(`@img/sharp-libvips-${G$A()}/lib`)}catch{}}return""},nv9=()=>{if(process.release?.name==="node"&&process.versions){if(!mv9(process.versions.node,qb4.node))return{found:process.versions.node,expected:qb4.node}}},Jb4=()=>{let{CC:A}=process.env;return Boolean(A&&A.endsWith("/emcc"))},rv9=()=>{if(process.platform==="darwin"&&process.arch==="x64")return(_Y1("sysctl sysctl.proc_translated",ZY1).stdout||"").trim()==="sysctl.proc_translated: 1";return!1},Yb4=(A)=>uv9("sha512").update(A).digest("hex"),ov9=()=>{try{let A=Yb4(`imgsharp-libvips-${G$A()}`),K=zb4(Fv9[`@img/sharp-libvips-${G$A()}`]).version;return Yb4(`${A}npm:${K}`).slice(0,10)}catch{}return""},av9=()=>_Y1(`node-gyp rebuild --directory=src ${Jb4()?"--nodedir=emscripten":""}`,{...ZY1,stdio:"inherit"}).status,Ob4=()=>{if(process.platform!=="win32")return(_Y1("pkg-config --modversion vips-cpp",{...ZY1,env:{...process.env,PKG_CONFIG_PATH:Xb4()}}).stdout||"").trim();else return""},Xb4=()=>{if(process.platform!=="win32")return[(_Y1('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',ZY1).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":");else return""},AY6=(A,K,q)=>{if(q)q(`Detected ${K}, skipping search for globally-installed libvips`);return A},sv9=(A)=>{if(Boolean(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)===!0)return AY6(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",A);if(Boolean(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)===!0)return AY6(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",A);if(rv9())return AY6(!1,"Rosetta",A);let K=Ob4();return!!K&&Bv9(K,wb4)};$b4.exports={minimumLibvipsVersion:wb4,prebuiltPlatforms:Uv9,buildPlatformArch:G$A,buildSharpLibvipsIncludeDir:cv9,buildSharpLibvipsCPlusPlusDir:lv9,buildSharpLibvipsLibDir:iv9,isUnsupportedNodeRuntime:nv9,runtimePlatformArch:dv9,log:pv9,yarnLocator:ov9,spawnRebuild:av9,globalLibvipsVersion:Ob4,pkgConfigPath:Xb4,useGlobalLibvips:sv9}});var aIA=v((GWw,Zb4)=>{var{familySync:tv9,versionSync:ev9}=qY1(),{runtimePlatformArch:AE9,isUnsupportedNodeRuntime:_b4,prebuiltPlatforms:KE9,minimumLibvipsVersion:qE9}=KY6(),z7A=AE9(),YE9=[`../src/build/Release/sharp-${z7A}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${z7A}/sharp.node`,"@img/sharp-wasm32/sharp.node"],qY6,GY1=[];for(let A of YE9)try{qY6=yA(A);break}catch(K){GY1.push(K)}if(qY6)Zb4.exports=qY6;else{let[A,K,q]=["linux","darwin","win32"].map((w)=>z7A.startsWith(w)),Y=[`Could not load the "sharp" module using the ${z7A} runtime`];GY1.forEach((w)=>{if(w.code!=="MODULE_NOT_FOUND")Y.push(`${w.code}: ${w.message}`)});let z=GY1.map((w)=>w.message).join(" ");if(Y.push("Possible solutions:"),_b4()){let{found:w,expected:H}=_b4();Y.push("- Please upgrade Node.js:",`    Found ${w}`,`    Requires ${H}`)}else if(KE9.includes(z7A)){let[w,H]=z7A.split("-"),J=w.endsWith("musl")?" --libc=musl":"";Y.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${w.replace("musl","")}${J} --cpu=${H} sharp`)}else Y.push(`- Manually install libvips >= ${qE9}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if(A&&/(symbol not found|CXXABI_)/i.test(z))try{let{config:w}=yA(`@img/sharp-libvips-${z7A}/package`),H=`${tv9()} ${ev9()}`,J=`${w.musl?"musl":"glibc"} ${w.musl||w.glibc}`;Y.push("- Update your OS:",`    Found ${H}`,`    Requires ${J}`)}catch(w){}if(A&&/\/snap\/core[0-9]{2}/.test(z))Y.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node");if(K&&/Incompatible library version/.test(z))Y.push("- Update Homebrew:","    brew update && brew upgrade vips");if(GY1.some((w)=>w.code==="ERR_DLOPEN_DISABLED"))Y.push("- Run Node.js without using the --no-addons flag");if(q&&/The specified procedure could not be found/.test(z))Y.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp");throw Y.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),Error(Y.join(`
 `))}});var Wb4=v((DWw,Gb4)=>{var zE9=yA("node:util"),YY6=yA("node:stream"),wE9=Fx();aIA();var HE9=zE9.debuglog("sharp"),w7A=function(A,K){if(arguments.length===1&&!wE9.defined(A))throw Error("Invalid input");if(!(this instanceof w7A))return new w7A(A,K);return YY6.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],useExifOrientation:!1,angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBeforePreExtract:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tint:[-1,0,0,0],flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,precision:"integer",minAmpl:0.2,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:-1,trimLineArt:!1,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspacePipeline:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,keepMetadata:0,withMetadataOrientation:-1,withMetadataDensity:0,withIccProfile:"",withExif:{},withExifMerge:!0,resolveWithObject:!1,jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpPreset:"default",webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffPredictor:"horizontal",tiffPyramid:!1,tiffMiniswhite:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",heifBitdepth:8,jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],debuglog:(q)=>{this.emit("warning",q),HE9(q)},queueListener:function(q){w7A.queue.emit("change",q)}},this.options.input=this._createInputDescriptor(A,K,{allowStream:!0}),this};Object.setPrototypeOf(w7A.prototype,YY6.Duplex.prototype);Object.setPrototypeOf(w7A,YY6.Duplex);function JE9(){let A=this.constructor.call(),{debuglog:K,queueListener:q,...Y}=this.options;if(A.options=structuredClone(Y),A.options.debuglog=K,A.options.queueListener=q,this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),A.options.input.buffer=this.options.input.buffer,A.emit("finish")});return A}Object.assign(w7A.prototype,{clone:JE9});Gb4.exports=w7A});var zY6=v((jWw,Db4)=>{Db4.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}});var Mb4=v((MWw,jb4)=>{jb4.exports=function(K){if(!K||typeof K==="string")return!1;return K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&K.constructor.name!=="String")}});var fb4=v((PWw,Vb4)=>{var OE9=Mb4(),XE9=Array.prototype.concat,$E9=Array.prototype.slice,Pb4=Vb4.exports=function(K){var q=[];for(var Y=0,z=K.length;Y<z;Y++){var w=K[Y];if(OE9(w))q=XE9.call(q,$E9.call(w));else q.push(w)}return q};Pb4.wrap=function(A){return function(){return A(Pb4(arguments))}}});var Eb4=v((VWw,vb4)=>{var tIA=zY6(),eIA=fb4(),Nb4=Object.hasOwnProperty,Tb4=Object.create(null);for(sIA in tIA)if(Nb4.call(tIA,sIA))Tb4[tIA[sIA]]=sIA;var sIA,LT=vb4.exports={to:{},get:{}};LT.get=function(A){var K=A.substring(0,3).toLowerCase(),q,Y;switch(K){case"hsl":q=LT.get.hsl(A),Y="hsl";break;case"hwb":q=LT.get.hwb(A),Y="hwb";break;default:q=LT.get.rgb(A),Y="rgb";break}if(!q)return null;return{model:Y,value:q}};LT.get.rgb=function(A){if(!A)return null;var K=/^#([a-f0-9]{3,4})$/i,q=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,Y=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,z=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,w=/^(\w+)$/,H=[0,0,0,1],J,O,X;if(J=A.match(q)){X=J[2],J=J[1];for(O=0;O<3;O++){var $=O*2;H[O]=parseInt(J.slice($,$+2),16)}if(X)H[3]=parseInt(X,16)/255}else if(J=A.match(K)){J=J[1],X=J[3];for(O=0;O<3;O++)H[O]=parseInt(J[O]+J[O],16);if(X)H[3]=parseInt(X+X,16)/255}else if(J=A.match(Y)){for(O=0;O<3;O++)H[O]=parseInt(J[O+1],0);if(J[4])if(J[5])H[3]=parseFloat(J[4])*0.01;else H[3]=parseFloat(J[4])}else if(J=A.match(z)){for(O=0;O<3;O++)H[O]=Math.round(parseFloat(J[O+1])*2.55);if(J[4])if(J[5])H[3]=parseFloat(J[4])*0.01;else H[3]=parseFloat(J[4])}else if(J=A.match(w)){if(J[1]==="transparent")return[0,0,0,0];if(!Nb4.call(tIA,J[1]))return null;return H=tIA[J[1]],H[3]=1,H}else return null;for(O=0;O<3;O++)H[O]=Fr(H[O],0,255);return H[3]=Fr(H[3],0,1),H};LT.get.hsl=function(A){if(!A)return null;var K=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,q=A.match(K);if(q){var Y=parseFloat(q[4]),z=(parseFloat(q[1])%360+360)%360,w=Fr(parseFloat(q[2]),0,100),H=Fr(parseFloat(q[3]),0,100),J=Fr(isNaN(Y)?1:Y,0,1);return[z,w,H,J]}return null};LT.get.hwb=function(A){if(!A)return null;var K=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,q=A.match(K);if(q){var Y=parseFloat(q[4]),z=(parseFloat(q[1])%360+360)%360,w=Fr(parseFloat(q[2]),0,100),H=Fr(parseFloat(q[3]),0,100),J=Fr(isNaN(Y)?1:Y,0,1);return[z,w,H,J]}return null};LT.to.hex=function(){var A=eIA(arguments);return"#"+WY1(A[0])+WY1(A[1])+WY1(A[2])+(A[3]<1?WY1(Math.round(A[3]*255)):"")};LT.to.rgb=function(){var A=eIA(arguments);return A.length<4||A[3]===1?"rgb("+Math.round(A[0])+", "+Math.round(A[1])+", "+Math.round(A[2])+")":"rgba("+Math.round(A[0])+", "+Math.round(A[1])+", "+Math.round(A[2])+", "+A[3]+")"};LT.to.rgb.percent=function(){var A=eIA(arguments),K=Math.round(A[0]/255*100),q=Math.round(A[1]/255*100),Y=Math.round(A[2]/255*100);return A.length<4||A[3]===1?"rgb("+K+"%, "+q+"%, "+Y+"%)":"rgba("+K+"%, "+q+"%, "+Y+"%, "+A[3]+")"};LT.to.hsl=function(){var A=eIA(arguments);return A.length<4||A[3]===1?"hsl("+A[0]+", "+A[1]+"%, "+A[2]+"%)":"hsla("+A[0]+", "+A[1]+"%, "+A[2]+"%, "+A[3]+")"};LT.to.hwb=function(){var A=eIA(arguments),K="";if(A.length>=4&&A[3]!==1)K=", "+A[3];return"hwb("+A[0]+", "+A[1]+"%, "+A[2]+"%"+K+")"};LT.to.keyword=function(A){return Tb4[A.slice(0,3)]};function Fr(A,K,q){return Math.min(Math.max(K,A),q)}function WY1(A){var K=Math.round(A).toString(16).toUpperCase();return K.length<2?"0"+K:K}});var wY6=v((fWw,Cb4)=>{var ASA=zY6(),kb4={};for(let A of Object.keys(ASA))kb4[ASA[A]]=A;var YK={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Cb4.exports=YK;for(let A of Object.keys(YK)){if(!("channels"in YK[A]))throw Error("missing channels property: "+A);if(!("labels"in YK[A]))throw Error("missing channel labels property: "+A);if(YK[A].labels.length!==YK[A].channels)throw Error("channel and label counts mismatch: "+A);let{channels:K,labels:q}=YK[A];delete YK[A].channels,delete YK[A].labels,Object.defineProperty(YK[A],"channels",{value:K}),Object.defineProperty(YK[A],"labels",{value:q})}YK.rgb.hsl=function(A){let K=A[0]/255,q=A[1]/255,Y=A[2]/255,z=Math.min(K,q,Y),w=Math.max(K,q,Y),H=w-z,J,O;if(w===z)J=0;else if(K===w)J=(q-Y)/H;else if(q===w)J=2+(Y-K)/H;else if(Y===w)J=4+(K-q)/H;if(J=Math.min(J*60,360),J<0)J+=360;let X=(z+w)/2;if(w===z)O=0;else if(X<=0.5)O=H/(w+z);else O=H/(2-w-z);return[J,O*100,X*100]};YK.rgb.hsv=function(A){let K,q,Y,z,w,H=A[0]/255,J=A[1]/255,O=A[2]/255,X=Math.max(H,J,O),$=X-Math.min(H,J,O),_=function(Z){return(X-Z)/6/$+0.5};if($===0)z=0,w=0;else{if(w=$/X,K=_(H),q=_(J),Y=_(O),H===X)z=Y-q;else if(J===X)z=0.3333333333333333+K-Y;else if(O===X)z=0.6666666666666666+q-K;if(z<0)z+=1;else if(z>1)z-=1}return[z*360,w*100,X*100]};YK.rgb.hwb=function(A){let K=A[0],q=A[1],Y=A[2],z=YK.rgb.hsl(A)[0],w=0.00392156862745098*Math.min(K,Math.min(q,Y));return Y=1-0.00392156862745098*Math.max(K,Math.max(q,Y)),[z,w*100,Y*100]};YK.rgb.cmyk=function(A){let K=A[0]/255,q=A[1]/255,Y=A[2]/255,z=Math.min(1-K,1-q,1-Y),w=(1-K-z)/(1-z)||0,H=(1-q-z)/(1-z)||0,J=(1-Y-z)/(1-z)||0;return[w*100,H*100,J*100,z*100]};function _E9(A,K){return(A[0]-K[0])**2+(A[1]-K[1])**2+(A[2]-K[2])**2}YK.rgb.keyword=function(A){let K=kb4[A];if(K)return K;let q=1/0,Y;for(let z of Object.keys(ASA)){let w=ASA[z],H=_E9(A,w);if(H<q)q=H,Y=z}return Y};YK.keyword.rgb=function(A){return ASA[A]};YK.rgb.xyz=function(A){let K=A[0]/255,q=A[1]/255,Y=A[2]/255;K=K>0.04045?((K+0.055)/1.055)**2.4:K/12.92,q=q>0.04045?((q+0.055)/1.055)**2.4:q/12.92,Y=Y>0.04045?((Y+0.055)/1.055)**2.4:Y/12.92;let z=K*0.4124+q*0.3576+Y*0.1805,w=K*0.2126+q*0.7152+Y*0.0722,H=K*0.0193+q*0.1192+Y*0.9505;return[z*100,w*100,H*100]};YK.rgb.lab=function(A){let K=YK.rgb.xyz(A),q=K[0],Y=K[1],z=K[2];q/=95.047,Y/=100,z/=108.883,q=q>0.008856?q**0.3333333333333333:7.787*q+0.13793103448275862,Y=Y>0.008856?Y**0.3333333333333333:7.787*Y+0.13793103448275862,z=z>0.008856?z**0.3333333333333333:7.787*z+0.13793103448275862;let w=116*Y-16,H=500*(q-Y),J=200*(Y-z);return[w,H,J]};YK.hsl.rgb=function(A){let K=A[0]/360,q=A[1]/100,Y=A[2]/100,z,w,H;if(q===0)return H=Y*255,[H,H,H];if(Y<0.5)z=Y*(1+q);else z=Y+q-Y*q;let J=2*Y-z,O=[0,0,0];for(let X=0;X<3;X++){if(w=K+0.3333333333333333*-(X-1),w<0)w++;if(w>1)w--;if(6*w<1)H=J+(z-J)*6*w;else if(2*w<1)H=z;else if(3*w<2)H=J+(z-J)*(0.6666666666666666-w)*6;else H=J;O[X]=H*255}return O};YK.hsl.hsv=function(A){let K=A[0],q=A[1]/100,Y=A[2]/100,z=q,w=Math.max(Y,0.01);Y*=2,q*=Y<=1?Y:2-Y,z*=w<=1?w:2-w;let H=(Y+q)/2,J=Y===0?2*z/(w+z):2*q/(Y+q);return[K,J*100,H*100]};YK.hsv.rgb=function(A){let K=A[0]/60,q=A[1]/100,Y=A[2]/100,z=Math.floor(K)%6,w=K-Math.floor(K),H=255*Y*(1-q),J=255*Y*(1-q*w),O=255*Y*(1-q*(1-w));switch(Y*=255,z){case 0:return[Y,O,H];case 1:return[J,Y,H];case 2:return[H,Y,O];case 3:return[H,J,Y];case 4:return[O,H,Y];case 5:return[Y,H,J]}};YK.hsv.hsl=function(A){let K=A[0],q=A[1]/100,Y=A[2]/100,z=Math.max(Y,0.01),w,H;H=(2-q)*Y;let J=(2-q)*z;return w=q*z,w/=J<=1?J:2-J,w=w||0,H/=2,[K,w*100,H*100]};YK.hwb.rgb=function(A){let K=A[0]/360,q=A[1]/100,Y=A[2]/100,z=q+Y,w;if(z>1)q/=z,Y/=z;let H=Math.floor(6*K),J=1-Y;if(w=6*K-H,(H&1)!==0)w=1-w;let O=q+w*(J-q),X,$,_;switch(H){default:case 6:case 0:X=J,$=O,_=q;break;case 1:X=O,$=J,_=q;break;case 2:X=q,$=J,_=O;break;case 3:X=q,$=O,_=J;break;case 4:X=O,$=q,_=J;break;case 5:X=J,$=q,_=O;break}return[X*255,$*255,_*255]};YK.cmyk.rgb=function(A){let K=A[0]/100,q=A[1]/100,Y=A[2]/100,z=A[3]/100,w=1-Math.min(1,K*(1-z)+z),H=1-Math.min(1,q*(1-z)+z),J=1-Math.min(1,Y*(1-z)+z);return[w*255,H*255,J*255]};YK.xyz.rgb=function(A){let K=A[0]/100,q=A[1]/100,Y=A[2]/100,z,w,H;return z=K*3.2406+q*-1.5372+Y*-0.4986,w=K*-0.9689+q*1.8758+Y*0.0415,H=K*0.0557+q*-0.204+Y*1.057,z=z>0.0031308?1.055*z**0.4166666666666667-0.055:z*12.92,w=w>0.0031308?1.055*w**0.4166666666666667-0.055:w*12.92,H=H>0.0031308?1.055*H**0.4166666666666667-0.055:H*12.92,z=Math.min(Math.max(0,z),1),w=Math.min(Math.max(0,w),1),H=Math.min(Math.max(0,H),1),[z*255,w*255,H*255]};YK.xyz.lab=function(A){let K=A[0],q=A[1],Y=A[2];K/=95.047,q/=100,Y/=108.883,K=K>0.008856?K**0.3333333333333333:7.787*K+0.13793103448275862,q=q>0.008856?q**0.3333333333333333:7.787*q+0.13793103448275862,Y=Y>0.008856?Y**0.3333333333333333:7.787*Y+0.13793103448275862;let z=116*q-16,w=500*(K-q),H=200*(q-Y);return[z,w,H]};YK.lab.xyz=function(A){let K=A[0],q=A[1],Y=A[2],z,w,H;w=(K+16)/116,z=q/500+w,H=w-Y/200;let J=w**3,O=z**3,X=H**3;return w=J>0.008856?J:(w-0.13793103448275862)/7.787,z=O>0.008856?O:(z-0.13793103448275862)/7.787,H=X>0.008856?X:(H-0.13793103448275862)/7.787,z*=95.047,w*=100,H*=108.883,[z,w,H]};YK.lab.lch=function(A){let K=A[0],q=A[1],Y=A[2],z;if(z=Math.atan2(Y,q)*360/2/Math.PI,z<0)z+=360;let H=Math.sqrt(q*q+Y*Y);return[K,H,z]};YK.lch.lab=function(A){let K=A[0],q=A[1],z=A[2]/360*2*Math.PI,w=q*Math.cos(z),H=q*Math.sin(z);return[K,w,H]};YK.rgb.ansi16=function(A,K=null){let[q,Y,z]=A,w=K===null?YK.rgb.hsv(A)[2]:K;if(w=Math.round(w/50),w===0)return 30;let H=30+(Math.round(z/255)<<2|Math.round(Y/255)<<1|Math.round(q/255));if(w===2)H+=60;return H};YK.hsv.ansi16=function(A){return YK.rgb.ansi16(YK.hsv.rgb(A),A[2])};YK.rgb.ansi256=function(A){let K=A[0],q=A[1],Y=A[2];if(K===q&&q===Y){if(K<8)return 16;if(K>248)return 231;return Math.round((K-8)/247*24)+232}return 16+36*Math.round(K/255*5)+6*Math.round(q/255*5)+Math.round(Y/255*5)};YK.ansi16.rgb=function(A){let K=A%10;if(K===0||K===7){if(A>50)K+=3.5;return K=K/10.5*255,[K,K,K]}let q=(~~(A>50)+1)*0.5,Y=(K&1)*q*255,z=(K>>1&1)*q*255,w=(K>>2&1)*q*255;return[Y,z,w]};YK.ansi256.rgb=function(A){if(A>=232){let w=(A-232)*10+8;return[w,w,w]}A-=16;let K,q=Math.floor(A/36)/5*255,Y=Math.floor((K=A%36)/6)/5*255,z=K%6/5*255;return[q,Y,z]};YK.rgb.hex=function(A){let q=(((Math.round(A[0])&255)<<16)+((Math.round(A[1])&255)<<8)+(Math.round(A[2])&255)).toString(16).toUpperCase();return"000000".substring(q.length)+q};YK.hex.rgb=function(A){let K=A.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!K)return[0,0,0];let q=K[0];if(K[0].length===3)q=q.split("").map((J)=>{return J+J}).join("");let Y=parseInt(q,16),z=Y>>16&255,w=Y>>8&255,H=Y&255;return[z,w,H]};YK.rgb.hcg=function(A){let K=A[0]/255,q=A[1]/255,Y=A[2]/255,z=Math.max(Math.max(K,q),Y),w=Math.min(Math.min(K,q),Y),H=z-w,J,O;if(H<1)J=w/(1-H);else J=0;if(H<=0)O=0;else if(z===K)O=(q-Y)/H%6;else if(z===q)O=2+(Y-K)/H;else O=4+(K-q)/H;return O/=6,O%=1,[O*360,H*100,J*100]};YK.hsl.hcg=function(A){let K=A[1]/100,q=A[2]/100,Y=q<0.5?2*K*q:2*K*(1-q),z=0;if(Y<1)z=(q-0.5*Y)/(1-Y);return[A[0],Y*100,z*100]};YK.hsv.hcg=function(A){let K=A[1]/100,q=A[2]/100,Y=K*q,z=0;if(Y<1)z=(q-Y)/(1-Y);return[A[0],Y*100,z*100]};YK.hcg.rgb=function(A){let K=A[0]/360,q=A[1]/100,Y=A[2]/100;if(q===0)return[Y*255,Y*255,Y*255];let z=[0,0,0],w=K%1*6,H=w%1,J=1-H,O=0;switch(Math.floor(w)){case 0:z[0]=1,z[1]=H,z[2]=0;break;case 1:z[0]=J,z[1]=1,z[2]=0;break;case 2:z[0]=0,z[1]=1,z[2]=H;break;case 3:z[0]=0,z[1]=J,z[2]=1;break;case 4:z[0]=H,z[1]=0,z[2]=1;break;default:z[0]=1,z[1]=0,z[2]=J}return O=(1-q)*Y,[(q*z[0]+O)*255,(q*z[1]+O)*255,(q*z[2]+O)*255]};YK.hcg.hsv=function(A){let K=A[1]/100,q=A[2]/100,Y=K+q*(1-K),z=0;if(Y>0)z=K/Y;return[A[0],z*100,Y*100]};YK.hcg.hsl=function(A){let K=A[1]/100,Y=A[2]/100*(1-K)+0.5*K,z=0;if(Y>0&&Y<0.5)z=K/(2*Y);else if(Y>=0.5&&Y<1)z=K/(2*(1-Y));return[A[0],z*100,Y*100]};YK.hcg.hwb=function(A){let K=A[1]/100,q=A[2]/100,Y=K+q*(1-K);return[A[0],(Y-K)*100,(1-Y)*100]};YK.hwb.hcg=function(A){let K=A[1]/100,Y=1-A[2]/100,z=Y-K,w=0;if(z<1)w=(Y-z)/(1-z);return[A[0],z*100,w*100]};YK.apple.rgb=function(A){return[A[0]/65535*255,A[1]/65535*255,A[2]/65535*255]};YK.rgb.apple=function(A){return[A[0]/255*65535,A[1]/255*65535,A[2]/255*65535]};YK.gray.rgb=function(A){return[A[0]/100*255,A[0]/100*255,A[0]/100*255]};YK.gray.hsl=function(A){return[0,0,A[0]]};YK.gray.hsv=YK.gray.hsl;YK.gray.hwb=function(A){return[0,100,A[0]]};YK.gray.cmyk=function(A){return[0,0,0,A[0]]};YK.gray.lab=function(A){return[A[0],0,0]};YK.gray.hex=function(A){let K=Math.round(A[0]/100*255)&255,Y=((K<<16)+(K<<8)+K).toString(16).toUpperCase();return"000000".substring(Y.length)+Y};YK.rgb.gray=function(A){return[(A[0]+A[1]+A[2])/3/255*100]}});var Rb4=v((NWw,Lb4)=>{var DY1=wY6();function ZE9(){let A={},K=Object.keys(DY1);for(let q=K.length,Y=0;Y<q;Y++)A[K[Y]]={distance:-1,parent:null};return A}function GE9(A){let K=ZE9(),q=[A];K[A].distance=0;while(q.length){let Y=q.pop(),z=Object.keys(DY1[Y]);for(let w=z.length,H=0;H<w;H++){let J=z[H],O=K[J];if(O.distance===-1)O.distance=K[Y].distance+1,O.parent=Y,q.unshift(J)}}return K}function WE9(A,K){return function(q){return K(A(q))}}function DE9(A,K){let q=[K[A].parent,A],Y=DY1[K[A].parent][A],z=K[A].parent;while(K[z].parent)q.unshift(K[z].parent),Y=WE9(DY1[K[z].parent][z],Y),z=K[z].parent;return Y.conversion=q,Y}Lb4.exports=function(A){let K=GE9(A),q={},Y=Object.keys(K);for(let z=Y.length,w=0;w<z;w++){let H=Y[w];if(K[H].parent===null)continue;q[H]=DE9(H,K)}return q}});var JY6=v((TWw,yb4)=>{var HY6=wY6(),jE9=Rb4(),W$A={},ME9=Object.keys(HY6);function PE9(A){let K=function(...q){let Y=q[0];if(Y===void 0||Y===null)return Y;if(Y.length>1)q=Y;return A(q)};if("conversion"in A)K.conversion=A.conversion;return K}function VE9(A){let K=function(...q){let Y=q[0];if(Y===void 0||Y===null)return Y;if(Y.length>1)q=Y;let z=A(q);if(typeof z==="object")for(let w=z.length,H=0;H<w;H++)z[H]=Math.round(z[H]);return z};if("conversion"in A)K.conversion=A.conversion;return K}ME9.forEach((A)=>{W$A[A]={},Object.defineProperty(W$A[A],"channels",{value:HY6[A].channels}),Object.defineProperty(W$A[A],"labels",{value:HY6[A].labels});let K=jE9(A);Object.keys(K).forEach((Y)=>{let z=K[Y];W$A[A][Y]=VE9(z),W$A[A][Y].raw=PE9(z)})});yb4.exports=W$A});var MY1=v((vWw,Sb4)=>{var D$A=Eb4(),RT=JY6(),Ib4=["keyword","gray","hex"],OY6={};for(let A of Object.keys(RT))OY6[[...RT[A].labels].sort().join("")]=A;var jY1={};function _Z(A,K){if(!(this instanceof _Z))return new _Z(A,K);if(K&&K in Ib4)K=null;if(K&&!(K in RT))throw Error("Unknown model: "+K);let q,Y;if(A==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(A instanceof _Z)this.model=A.model,this.color=[...A.color],this.valpha=A.valpha;else if(typeof A==="string"){let z=D$A.get(A);if(z===null)throw Error("Unable to parse color from string: "+A);this.model=z.model,Y=RT[this.model].channels,this.color=z.value.slice(0,Y),this.valpha=typeof z.value[Y]==="number"?z.value[Y]:1}else if(A.length>0){this.model=K||"rgb",Y=RT[this.model].channels;let z=Array.prototype.slice.call(A,0,Y);this.color=XY6(z,Y),this.valpha=typeof A[Y]==="number"?A[Y]:1}else if(typeof A==="number")this.model="rgb",this.color=[A>>16&255,A>>8&255,A&255],this.valpha=1;else{this.valpha=1;let z=Object.keys(A);if("alpha"in A)z.splice(z.indexOf("alpha"),1),this.valpha=typeof A.alpha==="number"?A.alpha:0;let w=z.sort().join("");if(!(w in OY6))throw Error("Unable to parse color from object: "+JSON.stringify(A));this.model=OY6[w];let{labels:H}=RT[this.model],J=[];for(q=0;q<H.length;q++)J.push(A[H[q]]);this.color=XY6(J)}if(jY1[this.model]){Y=RT[this.model].channels;for(q=0;q<Y;q++){let z=jY1[this.model][q];if(z)this.color[q]=z(this.color[q])}}if(this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze)Object.freeze(this)}_Z.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(A){let K=this.model in D$A.to?this:this.rgb();K=K.round(typeof A==="number"?A:1);let q=K.valpha===1?K.color:[...K.color,this.valpha];return D$A.to[K.model](q)},percentString(A){let K=this.rgb().round(typeof A==="number"?A:1),q=K.valpha===1?K.color:[...K.color,this.valpha];return D$A.to.rgb.percent(q)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let A={},{channels:K}=RT[this.model],{labels:q}=RT[this.model];for(let Y=0;Y<K;Y++)A[q[Y]]=this.color[Y];if(this.valpha!==1)A.alpha=this.valpha;return A},unitArray(){let A=this.rgb().color;if(A[0]/=255,A[1]/=255,A[2]/=255,this.valpha!==1)A.push(this.valpha);return A},unitObject(){let A=this.rgb().object();if(A.r/=255,A.g/=255,A.b/=255,this.valpha!==1)A.alpha=this.valpha;return A},round(A){return A=Math.max(A||0,0),new _Z([...this.color.map(NE9(A)),this.valpha],this.model)},alpha(A){if(A!==void 0)return new _Z([...this.color,Math.max(0,Math.min(1,A))],this.model);return this.valpha},red:sO("rgb",0,w_(255)),green:sO("rgb",1,w_(255)),blue:sO("rgb",2,w_(255)),hue:sO(["hsl","hsv","hsl","hwb","hcg"],0,(A)=>(A%360+360)%360),saturationl:sO("hsl",1,w_(100)),lightness:sO("hsl",2,w_(100)),saturationv:sO("hsv",1,w_(100)),value:sO("hsv",2,w_(100)),chroma:sO("hcg",1,w_(100)),gray:sO("hcg",2,w_(100)),white:sO("hwb",1,w_(100)),wblack:sO("hwb",2,w_(100)),cyan:sO("cmyk",0,w_(100)),magenta:sO("cmyk",1,w_(100)),yellow:sO("cmyk",2,w_(100)),black:sO("cmyk",3,w_(100)),x:sO("xyz",0,w_(95.047)),y:sO("xyz",1,w_(100)),z:sO("xyz",2,w_(108.833)),l:sO("lab",0,w_(100)),a:sO("lab",1),b:sO("lab",2),keyword(A){if(A!==void 0)return new _Z(A);return RT[this.model].keyword(this.color)},hex(A){if(A!==void 0)return new _Z(A);return D$A.to.hex(this.rgb().round().color)},hexa(A){if(A!==void 0)return new _Z(A);let K=this.rgb().round().color,q=Math.round(this.valpha*255).toString(16).toUpperCase();if(q.length===1)q="0"+q;return D$A.to.hex(K)+q},rgbNumber(){let A=this.rgb().color;return(A[0]&255)<<16|(A[1]&255)<<8|A[2]&255},luminosity(){let A=this.rgb().color,K=[];for(let[q,Y]of A.entries()){let z=Y/255;K[q]=z<=0.04045?z/12.92:((z+0.055)/1.055)**2.4}return 0.2126*K[0]+0.7152*K[1]+0.0722*K[2]},contrast(A){let K=this.luminosity(),q=A.luminosity();if(K>q)return(K+0.05)/(q+0.05);return(q+0.05)/(K+0.05)},level(A){let K=this.contrast(A);if(K>=7)return"AAA";return K>=4.5?"AA":""},isDark(){let A=this.rgb().color;return(A[0]*2126+A[1]*7152+A[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let A=this.rgb();for(let K=0;K<3;K++)A.color[K]=255-A.color[K];return A},lighten(A){let K=this.hsl();return K.color[2]+=K.color[2]*A,K},darken(A){let K=this.hsl();return K.color[2]-=K.color[2]*A,K},saturate(A){let K=this.hsl();return K.color[1]+=K.color[1]*A,K},desaturate(A){let K=this.hsl();return K.color[1]-=K.color[1]*A,K},whiten(A){let K=this.hwb();return K.color[1]+=K.color[1]*A,K},blacken(A){let K=this.hwb();return K.color[2]+=K.color[2]*A,K},grayscale(){let A=this.rgb().color,K=A[0]*0.3+A[1]*0.59+A[2]*0.11;return _Z.rgb(K,K,K)},fade(A){return this.alpha(this.valpha-this.valpha*A)},opaquer(A){return this.alpha(this.valpha+this.valpha*A)},rotate(A){let K=this.hsl(),q=K.color[0];return q=(q+A)%360,q=q<0?360+q:q,K.color[0]=q,K},mix(A,K){if(!A||!A.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof A);let q=A.rgb(),Y=this.rgb(),z=K===void 0?0.5:K,w=2*z-1,H=q.alpha()-Y.alpha(),J=((w*H===-1?w:(w+H)/(1+w*H))+1)/2,O=1-J;return _Z.rgb(J*q.red()+O*Y.red(),J*q.green()+O*Y.green(),J*q.blue()+O*Y.blue(),q.alpha()*z+Y.alpha()*(1-z))}};for(let A of Object.keys(RT)){if(Ib4.includes(A))continue;let{channels:K}=RT[A];_Z.prototype[A]=function(...q){if(this.model===A)return new _Z(this);if(q.length>0)return new _Z(q,A);return new _Z([...TE9(RT[this.model][A].raw(this.color)),this.valpha],A)},_Z[A]=function(...q){let Y=q[0];if(typeof Y==="number")Y=XY6(q,K);return new _Z(Y,A)}}function fE9(A,K){return Number(A.toFixed(K))}function NE9(A){return function(K){return fE9(K,A)}}function sO(A,K,q){A=Array.isArray(A)?A:[A];for(let Y of A)(jY1[Y]||(jY1[Y]=[]))[K]=q;return A=A[0],function(Y){let z;if(Y!==void 0){if(q)Y=q(Y);return z=this[A](),z.color[K]=Y,z}if(z=this[A]().color[K],q)z=q(z);return z}}function w_(A){return function(K){return Math.max(0,Math.min(A,K))}}function TE9(A){return Array.isArray(A)?A:[A]}function XY6(A,K){for(let q=0;q<K;q++)if(typeof A[q]!=="number")A[q]=0;return A}Sb4.exports=_Z});var xb4=v((EWw,bb4)=>{var vE9=MY1(),i6=Fx(),Qr=aIA(),EE9={left:"low",center:"centre",centre:"centre",right:"high"};function hb4(A){let{raw:K,density:q,limitInputPixels:Y,ignoreIcc:z,unlimited:w,sequentialRead:H,failOn:J,failOnError:O,animated:X,page:$,pages:_,subifd:Z}=A;return[K,q,Y,z,w,H,J,O,X,$,_,Z].some(i6.defined)?{raw:K,density:q,limitInputPixels:Y,ignoreIcc:z,unlimited:w,sequentialRead:H,failOn:J,failOnError:O,animated:X,page:$,pages:_,subifd:Z}:void 0}function kE9(A,K,q){let Y={failOn:"warning",limitInputPixels:Math.pow(16383,2),ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(i6.string(A))Y.file=A;else if(i6.buffer(A)){if(A.length===0)throw Error("Input Buffer is empty");Y.buffer=A}else if(i6.arrayBuffer(A)){if(A.byteLength===0)throw Error("Input bit Array is empty");Y.buffer=Buffer.from(A,0,A.byteLength)}else if(i6.typedArray(A)){if(A.length===0)throw Error("Input Bit Array is empty");Y.buffer=Buffer.from(A.buffer,A.byteOffset,A.byteLength)}else if(i6.plainObject(A)&&!i6.defined(K)){if(K=A,hb4(K))Y.buffer=[]}else if(!i6.defined(A)&&!i6.defined(K)&&i6.object(q)&&q.allowStream)Y.buffer=[];else throw Error(`Unsupported input '${A}' of type ${typeof A}${i6.defined(K)?` when also providing options of type ${typeof K}`:""}`);if(i6.object(K)){if(i6.defined(K.failOnError))if(i6.bool(K.failOnError))Y.failOn=K.failOnError?"warning":"none";else throw i6.invalidParameterError("failOnError","boolean",K.failOnError);if(i6.defined(K.failOn))if(i6.string(K.failOn)&&i6.inArray(K.failOn,["none","truncated","error","warning"]))Y.failOn=K.failOn;else throw i6.invalidParameterError("failOn","one of: none, truncated, error, warning",K.failOn);if(i6.defined(K.density))if(i6.inRange(K.density,1,1e5))Y.density=K.density;else throw i6.invalidParameterError("density","number between 1 and 100000",K.density);if(i6.defined(K.ignoreIcc))if(i6.bool(K.ignoreIcc))Y.ignoreIcc=K.ignoreIcc;else throw i6.invalidParameterError("ignoreIcc","boolean",K.ignoreIcc);if(i6.defined(K.limitInputPixels))if(i6.bool(K.limitInputPixels))Y.limitInputPixels=K.limitInputPixels?Math.pow(16383,2):0;else if(i6.integer(K.limitInputPixels)&&i6.inRange(K.limitInputPixels,0,Number.MAX_SAFE_INTEGER))Y.limitInputPixels=K.limitInputPixels;else throw i6.invalidParameterError("limitInputPixels","positive integer",K.limitInputPixels);if(i6.defined(K.unlimited))if(i6.bool(K.unlimited))Y.unlimited=K.unlimited;else throw i6.invalidParameterError("unlimited","boolean",K.unlimited);if(i6.defined(K.sequentialRead))if(i6.bool(K.sequentialRead))Y.sequentialRead=K.sequentialRead;else throw i6.invalidParameterError("sequentialRead","boolean",K.sequentialRead);if(i6.defined(K.raw))if(i6.object(K.raw)&&i6.integer(K.raw.width)&&K.raw.width>0&&i6.integer(K.raw.height)&&K.raw.height>0&&i6.integer(K.raw.channels)&&i6.inRange(K.raw.channels,1,4))switch(Y.rawWidth=K.raw.width,Y.rawHeight=K.raw.height,Y.rawChannels=K.raw.channels,Y.rawPremultiplied=!!K.raw.premultiplied,A.constructor){case Uint8Array:case Uint8ClampedArray:Y.rawDepth="uchar";break;case Int8Array:Y.rawDepth="char";break;case Uint16Array:Y.rawDepth="ushort";break;case Int16Array:Y.rawDepth="short";break;case Uint32Array:Y.rawDepth="uint";break;case Int32Array:Y.rawDepth="int";break;case Float32Array:Y.rawDepth="float";break;case Float64Array:Y.rawDepth="double";break;default:Y.rawDepth="uchar";break}else throw Error("Expected width, height and channels for raw pixel input");if(i6.defined(K.animated))if(i6.bool(K.animated))Y.pages=K.animated?-1:1;else throw i6.invalidParameterError("animated","boolean",K.animated);if(i6.defined(K.pages))if(i6.integer(K.pages)&&i6.inRange(K.pages,-1,1e5))Y.pages=K.pages;else throw i6.invalidParameterError("pages","integer between -1 and 100000",K.pages);if(i6.defined(K.page))if(i6.integer(K.page)&&i6.inRange(K.page,0,1e5))Y.page=K.page;else throw i6.invalidParameterError("page","integer between 0 and 100000",K.page);if(i6.defined(K.level))if(i6.integer(K.level)&&i6.inRange(K.level,0,256))Y.level=K.level;else throw i6.invalidParameterError("level","integer between 0 and 256",K.level);if(i6.defined(K.subifd))if(i6.integer(K.subifd)&&i6.inRange(K.subifd,-1,1e5))Y.subifd=K.subifd;else throw i6.invalidParameterError("subifd","integer between -1 and 100000",K.subifd);if(i6.defined(K.create))if(i6.object(K.create)&&i6.integer(K.create.width)&&K.create.width>0&&i6.integer(K.create.height)&&K.create.height>0&&i6.integer(K.create.channels)){if(Y.createWidth=K.create.width,Y.createHeight=K.create.height,Y.createChannels=K.create.channels,i6.defined(K.create.noise)){if(!i6.object(K.create.noise))throw Error("Expected noise to be an object");if(!i6.inArray(K.create.noise.type,["gaussian"]))throw Error("Only gaussian noise is supported at the moment");if(!i6.inRange(K.create.channels,1,4))throw i6.invalidParameterError("create.channels","number between 1 and 4",K.create.channels);if(Y.createNoiseType=K.create.noise.type,i6.number(K.create.noise.mean)&&i6.inRange(K.create.noise.mean,0,1e4))Y.createNoiseMean=K.create.noise.mean;else throw i6.invalidParameterError("create.noise.mean","number between 0 and 10000",K.create.noise.mean);if(i6.number(K.create.noise.sigma)&&i6.inRange(K.create.noise.sigma,0,1e4))Y.createNoiseSigma=K.create.noise.sigma;else throw i6.invalidParameterError("create.noise.sigma","number between 0 and 10000",K.create.noise.sigma)}else if(i6.defined(K.create.background)){if(!i6.inRange(K.create.channels,3,4))throw i6.invalidParameterError("create.channels","number between 3 and 4",K.create.channels);let z=vE9(K.create.background);Y.createBackground=[z.red(),z.green(),z.blue(),Math.round(z.alpha()*255)]}else throw Error("Expected valid noise or background to create a new input image");delete Y.buffer}else throw Error("Expected valid width, height and channels to create a new input image");if(i6.defined(K.text))if(i6.object(K.text)&&i6.string(K.text.text)){if(Y.textValue=K.text.text,i6.defined(K.text.height)&&i6.defined(K.text.dpi))throw Error("Expected only one of dpi or height");if(i6.defined(K.text.font))if(i6.string(K.text.font))Y.textFont=K.text.font;else throw i6.invalidParameterError("text.font","string",K.text.font);if(i6.defined(K.text.fontfile))if(i6.string(K.text.fontfile))Y.textFontfile=K.text.fontfile;else throw i6.invalidParameterError("text.fontfile","string",K.text.fontfile);if(i6.defined(K.text.width))if(i6.integer(K.text.width)&&K.text.width>0)Y.textWidth=K.text.width;else throw i6.invalidParameterError("text.width","positive integer",K.text.width);if(i6.defined(K.text.height))if(i6.integer(K.text.height)&&K.text.height>0)Y.textHeight=K.text.height;else throw i6.invalidParameterError("text.height","positive integer",K.text.height);if(i6.defined(K.text.align))if(i6.string(K.text.align)&&i6.string(this.constructor.align[K.text.align]))Y.textAlign=this.constructor.align[K.text.align];else throw i6.invalidParameterError("text.align","valid alignment",K.text.align);if(i6.defined(K.text.justify))if(i6.bool(K.text.justify))Y.textJustify=K.text.justify;else throw i6.invalidParameterError("text.justify","boolean",K.text.justify);if(i6.defined(K.text.dpi))if(i6.integer(K.text.dpi)&&i6.inRange(K.text.dpi,1,1e6))Y.textDpi=K.text.dpi;else throw i6.invalidParameterError("text.dpi","integer between 1 and 1000000",K.text.dpi);if(i6.defined(K.text.rgba))if(i6.bool(K.text.rgba))Y.textRgba=K.text.rgba;else throw i6.invalidParameterError("text.rgba","bool",K.text.rgba);if(i6.defined(K.text.spacing))if(i6.integer(K.text.spacing)&&i6.inRange(K.text.spacing,-1e6,1e6))Y.textSpacing=K.text.spacing;else throw i6.invalidParameterError("text.spacing","integer between -1000000 and 1000000",K.text.spacing);if(i6.defined(K.text.wrap))if(i6.string(K.text.wrap)&&i6.inArray(K.text.wrap,["word","char","word-char","none"]))Y.textWrap=K.text.wrap;else throw i6.invalidParameterError("text.wrap","one of: word, char, word-char, none",K.text.wrap);delete Y.buffer}else throw Error("Expected a valid string to create an image with text.")}else if(i6.defined(K))throw Error("Invalid input options "+K);return Y}function CE9(A,K,q){if(Array.isArray(this.options.input.buffer))if(i6.buffer(A)){if(this.options.input.buffer.length===0)this.on("finish",()=>{this.streamInFinished=!0});this.options.input.buffer.push(A),q()}else q(Error("Non-Buffer data on Writable Stream"));else q(Error("Unexpected data on Writable Stream"))}function LE9(){if(this._isStreamInput())this.options.input.buffer=Buffer.concat(this.options.input.buffer)}function RE9(){return Array.isArray(this.options.input.buffer)}function yE9(A){let K=Error();if(i6.fn(A)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),Qr.metadata(this.options,(q,Y)=>{if(q)A(i6.nativeError(q,K));else A(null,Y)})});else Qr.metadata(this.options,(q,Y)=>{if(q)A(i6.nativeError(q,K));else A(null,Y)});return this}else if(this._isStreamInput())return new Promise((q,Y)=>{let z=()=>{this._flattenBufferIn(),Qr.metadata(this.options,(w,H)=>{if(w)Y(i6.nativeError(w,K));else q(H)})};if(this.writableFinished)z();else this.once("finish",z)});else return new Promise((q,Y)=>{Qr.metadata(this.options,(z,w)=>{if(z)Y(i6.nativeError(z,K));else q(w)})})}function IE9(A){let K=Error();if(i6.fn(A)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),Qr.stats(this.options,(q,Y)=>{if(q)A(i6.nativeError(q,K));else A(null,Y)})});else Qr.stats(this.options,(q,Y)=>{if(q)A(i6.nativeError(q,K));else A(null,Y)});return this}else if(this._isStreamInput())return new Promise((q,Y)=>{this.on("finish",function(){this._flattenBufferIn(),Qr.stats(this.options,(z,w)=>{if(z)Y(i6.nativeError(z,K));else q(w)})})});else return new Promise((q,Y)=>{Qr.stats(this.options,(z,w)=>{if(z)Y(i6.nativeError(z,K));else q(w)})})}bb4.exports=function(A){Object.assign(A.prototype,{_inputOptionsFromObject:hb4,_createInputDescriptor:kE9,_write:CE9,_flattenBufferIn:LE9,_isStreamInput:RE9,metadata:yE9,stats:IE9}),A.align=EE9}});var Qb4=v((kWw,Fb4)=>{var fK=Fx(),Bb4={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},mb4={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},ub4={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},gb4={entropy:16,attention:17},$Y6={nearest:"nearest",linear:"linear",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3"},SE9={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},hE9={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function _Y6(A){return A.angle%360!==0||A.useExifOrientation===!0||A.rotationAngle!==0}function PY1(A){return A.width!==-1||A.height!==-1}function bE9(A,K,q){if(PY1(this.options))this.options.debuglog("ignoring previous resize options");if(this.options.widthPost!==-1)this.options.debuglog("operation order will be: extract, resize, extract");if(fK.defined(A))if(fK.object(A)&&!fK.defined(q))q=A;else if(fK.integer(A)&&A>0)this.options.width=A;else throw fK.invalidParameterError("width","positive integer",A);else this.options.width=-1;if(fK.defined(K))if(fK.integer(K)&&K>0)this.options.height=K;else throw fK.invalidParameterError("height","positive integer",K);else this.options.height=-1;if(fK.object(q)){if(fK.defined(q.width))if(fK.integer(q.width)&&q.width>0)this.options.width=q.width;else throw fK.invalidParameterError("width","positive integer",q.width);if(fK.defined(q.height))if(fK.integer(q.height)&&q.height>0)this.options.height=q.height;else throw fK.invalidParameterError("height","positive integer",q.height);if(fK.defined(q.fit)){let Y=hE9[q.fit];if(fK.string(Y))this.options.canvas=Y;else throw fK.invalidParameterError("fit","valid fit",q.fit)}if(fK.defined(q.position)){let Y=fK.integer(q.position)?q.position:gb4[q.position]||mb4[q.position]||Bb4[q.position];if(fK.integer(Y)&&(fK.inRange(Y,0,8)||fK.inRange(Y,16,17)))this.options.position=Y;else throw fK.invalidParameterError("position","valid position/gravity/strategy",q.position)}if(this._setBackgroundColourOption("resizeBackground",q.background),fK.defined(q.kernel))if(fK.string($Y6[q.kernel]))this.options.kernel=$Y6[q.kernel];else throw fK.invalidParameterError("kernel","valid kernel name",q.kernel);if(fK.defined(q.withoutEnlargement))this._setBooleanOption("withoutEnlargement",q.withoutEnlargement);if(fK.defined(q.withoutReduction))this._setBooleanOption("withoutReduction",q.withoutReduction);if(fK.defined(q.fastShrinkOnLoad))this._setBooleanOption("fastShrinkOnLoad",q.fastShrinkOnLoad)}if(_Y6(this.options)&&PY1(this.options))this.options.rotateBeforePreExtract=!0;return this}function xE9(A){if(fK.integer(A)&&A>0)this.options.extendTop=A,this.options.extendBottom=A,this.options.extendLeft=A,this.options.extendRight=A;else if(fK.object(A)){if(fK.defined(A.top))if(fK.integer(A.top)&&A.top>=0)this.options.extendTop=A.top;else throw fK.invalidParameterError("top","positive integer",A.top);if(fK.defined(A.bottom))if(fK.integer(A.bottom)&&A.bottom>=0)this.options.extendBottom=A.bottom;else throw fK.invalidParameterError("bottom","positive integer",A.bottom);if(fK.defined(A.left))if(fK.integer(A.left)&&A.left>=0)this.options.extendLeft=A.left;else throw fK.invalidParameterError("left","positive integer",A.left);if(fK.defined(A.right))if(fK.integer(A.right)&&A.right>=0)this.options.extendRight=A.right;else throw fK.invalidParameterError("right","positive integer",A.right);if(this._setBackgroundColourOption("extendBackground",A.background),fK.defined(A.extendWith))if(fK.string(ub4[A.extendWith]))this.options.extendWith=ub4[A.extendWith];else throw fK.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",A.extendWith)}else throw fK.invalidParameterError("extend","integer or object",A);return this}function uE9(A){let K=PY1(this.options)||this.options.widthPre!==-1?"Post":"Pre";if(this.options[`width${K}`]!==-1)this.options.debuglog("ignoring previous extract options");if(["left","top","width","height"].forEach(function(q){let Y=A[q];if(fK.integer(Y)&&Y>=0)this.options[q+(q==="left"||q==="top"?"Offset":"")+K]=Y;else throw fK.invalidParameterError(q,"integer",Y)},this),_Y6(this.options)&&!PY1(this.options)){if(this.options.widthPre===-1||this.options.widthPost===-1)this.options.rotateBeforePreExtract=!0}return this}function BE9(A){if(this.options.trimThreshold=10,fK.defined(A))if(fK.object(A)){if(fK.defined(A.background))this._setBackgroundColourOption("trimBackground",A.background);if(fK.defined(A.threshold))if(fK.number(A.threshold)&&A.threshold>=0)this.options.trimThreshold=A.threshold;else throw fK.invalidParameterError("threshold","positive number",A.threshold);if(fK.defined(A.lineArt))this._setBooleanOption("trimLineArt",A.lineArt)}else throw fK.invalidParameterError("trim","object",A);if(_Y6(this.options))this.options.rotateBeforePreExtract=!0;return this}Fb4.exports=function(A){Object.assign(A.prototype,{resize:bE9,extend:xE9,extract:uE9,trim:BE9}),A.gravity=Bb4,A.strategy=gb4,A.kernel=$Y6,A.fit=SE9,A.position=mb4}});var pb4=v((CWw,Ub4)=>{var oz=Fx(),ZY6={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function mE9(A){if(!Array.isArray(A))throw oz.invalidParameterError("images to composite","array",A);return this.options.composite=A.map((K)=>{if(!oz.object(K))throw oz.invalidParameterError("image to composite","object",K);let q=this._inputOptionsFromObject(K),Y={input:this._createInputDescriptor(K.input,q,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(oz.defined(K.blend))if(oz.string(ZY6[K.blend]))Y.blend=ZY6[K.blend];else throw oz.invalidParameterError("blend","valid blend name",K.blend);if(oz.defined(K.tile))if(oz.bool(K.tile))Y.tile=K.tile;else throw oz.invalidParameterError("tile","boolean",K.tile);if(oz.defined(K.left))if(oz.integer(K.left))Y.left=K.left;else throw oz.invalidParameterError("left","integer",K.left);if(oz.defined(K.top))if(oz.integer(K.top))Y.top=K.top;else throw oz.invalidParameterError("top","integer",K.top);if(oz.defined(K.top)!==oz.defined(K.left))throw Error("Expected both left and top to be set");else Y.hasOffset=oz.integer(K.top)&&oz.integer(K.left);if(oz.defined(K.gravity))if(oz.integer(K.gravity)&&oz.inRange(K.gravity,0,8))Y.gravity=K.gravity;else if(oz.string(K.gravity)&&oz.integer(this.constructor.gravity[K.gravity]))Y.gravity=this.constructor.gravity[K.gravity];else throw oz.invalidParameterError("gravity","valid gravity",K.gravity);if(oz.defined(K.premultiplied))if(oz.bool(K.premultiplied))Y.premultiplied=K.premultiplied;else throw oz.invalidParameterError("premultiplied","boolean",K.premultiplied);return Y}),this}Ub4.exports=function(A){A.prototype.composite=mE9,A.blend=ZY6}});var lb4=v((LWw,cb4)=>{var gE9=MY1(),T6=Fx(),db4={integer:"integer",float:"float",approximate:"approximate"};function FE9(A,K){if(this.options.useExifOrientation||this.options.angle||this.options.rotationAngle)this.options.debuglog("ignoring previous rotate options");if(!T6.defined(A))this.options.useExifOrientation=!0;else if(T6.integer(A)&&!(A%90))this.options.angle=A;else if(T6.number(A)){if(this.options.rotationAngle=A,T6.object(K)&&K.background){let q=gE9(K.background);this.options.rotationBackground=[q.red(),q.green(),q.blue(),Math.round(q.alpha()*255)]}}else throw T6.invalidParameterError("angle","numeric",A);return this}function QE9(A){return this.options.flip=T6.bool(A)?A:!0,this}function UE9(A){return this.options.flop=T6.bool(A)?A:!0,this}function pE9(A,K){let q=[].concat(...A);if(q.length===4&&q.every(T6.number))this.options.affineMatrix=q;else throw T6.invalidParameterError("matrix","1x4 or 2x2 array",A);if(T6.defined(K))if(T6.object(K)){if(this._setBackgroundColourOption("affineBackground",K.background),T6.defined(K.idx))if(T6.number(K.idx))this.options.affineIdx=K.idx;else throw T6.invalidParameterError("options.idx","number",K.idx);if(T6.defined(K.idy))if(T6.number(K.idy))this.options.affineIdy=K.idy;else throw T6.invalidParameterError("options.idy","number",K.idy);if(T6.defined(K.odx))if(T6.number(K.odx))this.options.affineOdx=K.odx;else throw T6.invalidParameterError("options.odx","number",K.odx);if(T6.defined(K.ody))if(T6.number(K.ody))this.options.affineOdy=K.ody;else throw T6.invalidParameterError("options.ody","number",K.ody);if(T6.defined(K.interpolator))if(T6.inArray(K.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=K.interpolator;else throw T6.invalidParameterError("options.interpolator","valid interpolator name",K.interpolator)}else throw T6.invalidParameterError("options","object",K);return this}function dE9(A,K,q){if(!T6.defined(A))this.options.sharpenSigma=-1;else if(T6.bool(A))this.options.sharpenSigma=A?-1:0;else if(T6.number(A)&&T6.inRange(A,0.01,1e4)){if(this.options.sharpenSigma=A,T6.defined(K))if(T6.number(K)&&T6.inRange(K,0,1e4))this.options.sharpenM1=K;else throw T6.invalidParameterError("flat","number between 0 and 10000",K);if(T6.defined(q))if(T6.number(q)&&T6.inRange(q,0,1e4))this.options.sharpenM2=q;else throw T6.invalidParameterError("jagged","number between 0 and 10000",q)}else if(T6.plainObject(A)){if(T6.number(A.sigma)&&T6.inRange(A.sigma,0.000001,10))this.options.sharpenSigma=A.sigma;else throw T6.invalidParameterError("options.sigma","number between 0.000001 and 10",A.sigma);if(T6.defined(A.m1))if(T6.number(A.m1)&&T6.inRange(A.m1,0,1e6))this.options.sharpenM1=A.m1;else throw T6.invalidParameterError("options.m1","number between 0 and 1000000",A.m1);if(T6.defined(A.m2))if(T6.number(A.m2)&&T6.inRange(A.m2,0,1e6))this.options.sharpenM2=A.m2;else throw T6.invalidParameterError("options.m2","number between 0 and 1000000",A.m2);if(T6.defined(A.x1))if(T6.number(A.x1)&&T6.inRange(A.x1,0,1e6))this.options.sharpenX1=A.x1;else throw T6.invalidParameterError("options.x1","number between 0 and 1000000",A.x1);if(T6.defined(A.y2))if(T6.number(A.y2)&&T6.inRange(A.y2,0,1e6))this.options.sharpenY2=A.y2;else throw T6.invalidParameterError("options.y2","number between 0 and 1000000",A.y2);if(T6.defined(A.y3))if(T6.number(A.y3)&&T6.inRange(A.y3,0,1e6))this.options.sharpenY3=A.y3;else throw T6.invalidParameterError("options.y3","number between 0 and 1000000",A.y3)}else throw T6.invalidParameterError("sigma","number between 0.01 and 10000",A);return this}function cE9(A){if(!T6.defined(A))this.options.medianSize=3;else if(T6.integer(A)&&T6.inRange(A,1,1000))this.options.medianSize=A;else throw T6.invalidParameterError("size","integer between 1 and 1000",A);return this}function lE9(A){let K;if(T6.number(A))K=A;else if(T6.plainObject(A)){if(!T6.number(A.sigma))throw T6.invalidParameterError("options.sigma","number between 0.3 and 1000",K);if(K=A.sigma,"precision"in A)if(T6.string(db4[A.precision]))this.options.precision=db4[A.precision];else throw T6.invalidParameterError("precision","one of: integer, float, approximate",A.precision);if("minAmplitude"in A)if(T6.number(A.minAmplitude)&&T6.inRange(A.minAmplitude,0.001,1))this.options.minAmpl=A.minAmplitude;else throw T6.invalidParameterError("minAmplitude","number between 0.001 and 1",A.minAmplitude)}if(!T6.defined(A))this.options.blurSigma=-1;else if(T6.bool(A))this.options.blurSigma=A?-1:0;else if(T6.number(K)&&T6.inRange(K,0.3,1000))this.options.blurSigma=K;else throw T6.invalidParameterError("sigma","number between 0.3 and 1000",K);return this}function iE9(A){if(this.options.flatten=T6.bool(A)?A:!0,T6.object(A))this._setBackgroundColourOption("flattenBackground",A.background);return this}function nE9(){return this.options.unflatten=!0,this}function rE9(A,K){if(!T6.defined(A))this.options.gamma=2.2;else if(T6.number(A)&&T6.inRange(A,1,3))this.options.gamma=A;else throw T6.invalidParameterError("gamma","number between 1.0 and 3.0",A);if(!T6.defined(K))this.options.gammaOut=this.options.gamma;else if(T6.number(K)&&T6.inRange(K,1,3))this.options.gammaOut=K;else throw T6.invalidParameterError("gammaOut","number between 1.0 and 3.0",K);return this}function oE9(A){if(this.options.negate=T6.bool(A)?A:!0,T6.plainObject(A)&&"alpha"in A)if(!T6.bool(A.alpha))throw T6.invalidParameterError("alpha","should be boolean value",A.alpha);else this.options.negateAlpha=A.alpha;return this}function aE9(A){if(T6.plainObject(A)){if(T6.defined(A.lower))if(T6.number(A.lower)&&T6.inRange(A.lower,0,99))this.options.normaliseLower=A.lower;else throw T6.invalidParameterError("lower","number between 0 and 99",A.lower);if(T6.defined(A.upper))if(T6.number(A.upper)&&T6.inRange(A.upper,1,100))this.options.normaliseUpper=A.upper;else throw T6.invalidParameterError("upper","number between 1 and 100",A.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw T6.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function sE9(A){return this.normalise(A)}function tE9(A){if(T6.plainObject(A)){if(T6.integer(A.width)&&A.width>0)this.options.claheWidth=A.width;else throw T6.invalidParameterError("width","integer greater than zero",A.width);if(T6.integer(A.height)&&A.height>0)this.options.claheHeight=A.height;else throw T6.invalidParameterError("height","integer greater than zero",A.height);if(T6.defined(A.maxSlope))if(T6.integer(A.maxSlope)&&T6.inRange(A.maxSlope,0,100))this.options.claheMaxSlope=A.maxSlope;else throw T6.invalidParameterError("maxSlope","integer between 0 and 100",A.maxSlope)}else throw T6.invalidParameterError("options","plain object",A);return this}function eE9(A){if(!T6.object(A)||!Array.isArray(A.kernel)||!T6.integer(A.width)||!T6.integer(A.height)||!T6.inRange(A.width,3,1001)||!T6.inRange(A.height,3,1001)||A.height*A.width!==A.kernel.length)throw Error("Invalid convolution kernel");if(!T6.integer(A.scale))A.scale=A.kernel.reduce(function(K,q){return K+q},0);if(A.scale<1)A.scale=1;if(!T6.integer(A.offset))A.offset=0;return this.options.convKernel=A,this}function Ak9(A,K){if(!T6.defined(A))this.options.threshold=128;else if(T6.bool(A))this.options.threshold=A?128:0;else if(T6.integer(A)&&T6.inRange(A,0,255))this.options.threshold=A;else throw T6.invalidParameterError("threshold","integer between 0 and 255",A);if(!T6.object(K)||K.greyscale===!0||K.grayscale===!0)this.options.thresholdGrayscale=!0;else this.options.thresholdGrayscale=!1;return this}function Kk9(A,K,q){if(this.options.boolean=this._createInputDescriptor(A,q),T6.string(K)&&T6.inArray(K,["and","or","eor"]))this.options.booleanOp=K;else throw T6.invalidParameterError("operator","one of: and, or, eor",K);return this}function qk9(A,K){if(!T6.defined(A)&&T6.number(K))A=1;else if(T6.number(A)&&!T6.defined(K))K=0;if(!T6.defined(A))this.options.linearA=[];else if(T6.number(A))this.options.linearA=[A];else if(Array.isArray(A)&&A.length&&A.every(T6.number))this.options.linearA=A;else throw T6.invalidParameterError("a","number or array of numbers",A);if(!T6.defined(K))this.options.linearB=[];else if(T6.number(K))this.options.linearB=[K];else if(Array.isArray(K)&&K.length&&K.every(T6.number))this.options.linearB=K;else throw T6.invalidParameterError("b","number or array of numbers",K);if(this.options.linearA.length!==this.options.linearB.length)throw Error("Expected a and b to be arrays of the same length");return this}function Yk9(A){if(!Array.isArray(A))throw T6.invalidParameterError("inputMatrix","array",A);if(A.length!==3&&A.length!==4)throw T6.invalidParameterError("inputMatrix","3x3 or 4x4 array",A.length);let K=A.flat().map(Number);if(K.length!==9&&K.length!==16)throw T6.invalidParameterError("inputMatrix","cardinality of 9 or 16",K.length);return this.options.recombMatrix=K,this}function zk9(A){if(!T6.plainObject(A))throw T6.invalidParameterError("options","plain object",A);if("brightness"in A)if(T6.number(A.brightness)&&A.brightness>=0)this.options.brightness=A.brightness;else throw T6.invalidParameterError("brightness","number above zero",A.brightness);if("saturation"in A)if(T6.number(A.saturation)&&A.saturation>=0)this.options.saturation=A.saturation;else throw T6.invalidParameterError("saturation","number above zero",A.saturation);if("hue"in A)if(T6.integer(A.hue))this.options.hue=A.hue%360;else throw T6.invalidParameterError("hue","number",A.hue);if("lightness"in A)if(T6.number(A.lightness))this.options.lightness=A.lightness;else throw T6.invalidParameterError("lightness","number",A.lightness);return this}cb4.exports=function(A){Object.assign(A.prototype,{rotate:FE9,flip:QE9,flop:UE9,affine:pE9,sharpen:dE9,median:cE9,blur:lE9,flatten:iE9,unflatten:nE9,gamma:rE9,negate:oE9,normalise:aE9,normalize:sE9,clahe:tE9,convolve:eE9,threshold:Ak9,boolean:Kk9,linear:qk9,recomb:Yk9,modulate:zk9})}});var rb4=v((RWw,nb4)=>{var wk9=MY1(),cQ=Fx(),ib4={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function Hk9(A){return this._setBackgroundColourOption("tint",A),this}function Jk9(A){return this.options.greyscale=cQ.bool(A)?A:!0,this}function Ok9(A){return this.greyscale(A)}function Xk9(A){if(!cQ.string(A))throw cQ.invalidParameterError("colourspace","string",A);return this.options.colourspacePipeline=A,this}function $k9(A){return this.pipelineColourspace(A)}function _k9(A){if(!cQ.string(A))throw cQ.invalidParameterError("colourspace","string",A);return this.options.colourspace=A,this}function Zk9(A){return this.toColourspace(A)}function Gk9(A,K){if(cQ.defined(K))if(cQ.object(K)||cQ.string(K)){let q=wk9(K);this.options[A]=[q.red(),q.green(),q.blue(),Math.round(q.alpha()*255)]}else throw cQ.invalidParameterError("background","object or string",K)}nb4.exports=function(A){Object.assign(A.prototype,{tint:Hk9,greyscale:Jk9,grayscale:Ok9,pipelineColourspace:Xk9,pipelineColorspace:$k9,toColourspace:_k9,toColorspace:Zk9,_setBackgroundColourOption:Gk9}),A.colourspace=ib4,A.colorspace=ib4}});var ab4=v((yWw,ob4)=>{var dx=Fx(),Wk9={and:"and",or:"or",eor:"eor"};function Dk9(){return this.options.removeAlpha=!0,this}function jk9(A){if(dx.defined(A))if(dx.number(A)&&dx.inRange(A,0,1))this.options.ensureAlpha=A;else throw dx.invalidParameterError("alpha","number between 0 and 1",A);else this.options.ensureAlpha=1;return this}function Mk9(A){let K={red:0,green:1,blue:2,alpha:3};if(Object.keys(K).includes(A))A=K[A];if(dx.integer(A)&&dx.inRange(A,0,4))this.options.extractChannel=A;else throw dx.invalidParameterError("channel","integer or one of: red, green, blue, alpha",A);return this}function Pk9(A,K){if(Array.isArray(A))A.forEach(function(q){this.options.joinChannelIn.push(this._createInputDescriptor(q,K))},this);else this.options.joinChannelIn.push(this._createInputDescriptor(A,K));return this}function Vk9(A){if(dx.string(A)&&dx.inArray(A,["and","or","eor"]))this.options.bandBoolOp=A;else throw dx.invalidParameterError("boolOp","one of: and, or, eor",A);return this}ob4.exports=function(A){Object.assign(A.prototype,{removeAlpha:Dk9,ensureAlpha:jk9,extractChannel:Mk9,joinChannel:Pk9,bandbool:Vk9}),A.bool=Wk9}});var qx4=v((IWw,Kx4)=>{var GY6=yA("node:path"),X1=Fx(),j$A=aIA(),sb4=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),fk9=/\.(jp[2x]|j2[kc])$/i,tb4=()=>Error("JP2 output requires libvips with support for OpenJPEG"),eb4=(A)=>1<<31-Math.clz32(Math.ceil(Math.log2(A)));function Nk9(A,K){let q;if(!X1.string(A))q=Error("Missing output file path");else if(X1.string(this.options.input.file)&&GY6.resolve(this.options.input.file)===GY6.resolve(A))q=Error("Cannot use same file for input and output");else if(fk9.test(GY6.extname(A))&&!this.constructor.format.jp2k.output.file)q=tb4();if(q)if(X1.fn(K))K(q);else return Promise.reject(q);else{this.options.fileOut=A;let Y=Error();return this._pipeline(K,Y)}return this}function Tk9(A,K){if(X1.object(A))this._setBooleanOption("resolveWithObject",A.resolveWithObject);else if(this.options.resolveWithObject)this.options.resolveWithObject=!1;this.options.fileOut="";let q=Error();return this._pipeline(X1.fn(A)?A:K,q)}function vk9(){return this.options.keepMetadata|=1,this}function Ek9(A){if(X1.object(A))for(let[K,q]of Object.entries(A))if(X1.object(q))for(let[Y,z]of Object.entries(q))if(X1.string(z))this.options.withExif[`exif-${K.toLowerCase()}-${Y}`]=z;else throw X1.invalidParameterError(`${K}.${Y}`,"string",z);else throw X1.invalidParameterError(K,"object",q);else throw X1.invalidParameterError("exif","object",A);return this.options.withExifMerge=!1,this.keepExif()}function kk9(A){return this.withExif(A),this.options.withExifMerge=!0,this}function Ck9(){return this.options.keepMetadata|=8,this}function Lk9(A,K){if(X1.string(A))this.options.withIccProfile=A;else throw X1.invalidParameterError("icc","string",A);if(this.keepIccProfile(),X1.object(K)){if(X1.defined(K.attach))if(X1.bool(K.attach)){if(!K.attach)this.options.keepMetadata&=-9}else throw X1.invalidParameterError("attach","boolean",K.attach)}return this}function Rk9(){return this.options.keepMetadata=31,this}function yk9(A){if(this.keepMetadata(),this.withIccProfile("srgb"),X1.object(A)){if(X1.defined(A.orientation))if(X1.integer(A.orientation)&&X1.inRange(A.orientation,1,8))this.options.withMetadataOrientation=A.orientation;else throw X1.invalidParameterError("orientation","integer between 1 and 8",A.orientation);if(X1.defined(A.density))if(X1.number(A.density)&&A.density>0)this.options.withMetadataDensity=A.density;else throw X1.invalidParameterError("density","positive number",A.density);if(X1.defined(A.icc))this.withIccProfile(A.icc);if(X1.defined(A.exif))this.withExifMerge(A.exif)}return this}function Ik9(A,K){let q=sb4.get((X1.object(A)&&X1.string(A.id)?A.id:A).toLowerCase());if(!q)throw X1.invalidParameterError("format",`one of: ${[...sb4.keys()].join(", ")}`,A);return this[q](K)}function Sk9(A){if(X1.object(A)){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.jpegQuality=A.quality;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);if(X1.defined(A.progressive))this._setBooleanOption("jpegProgressive",A.progressive);if(X1.defined(A.chromaSubsampling))if(X1.string(A.chromaSubsampling)&&X1.inArray(A.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=A.chromaSubsampling;else throw X1.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",A.chromaSubsampling);let K=X1.bool(A.optimizeCoding)?A.optimizeCoding:A.optimiseCoding;if(X1.defined(K))this._setBooleanOption("jpegOptimiseCoding",K);if(X1.defined(A.mozjpeg))if(X1.bool(A.mozjpeg)){if(A.mozjpeg)this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3}else throw X1.invalidParameterError("mozjpeg","boolean",A.mozjpeg);let q=X1.bool(A.trellisQuantization)?A.trellisQuantization:A.trellisQuantisation;if(X1.defined(q))this._setBooleanOption("jpegTrellisQuantisation",q);if(X1.defined(A.overshootDeringing))this._setBooleanOption("jpegOvershootDeringing",A.overshootDeringing);let Y=X1.bool(A.optimizeScans)?A.optimizeScans:A.optimiseScans;if(X1.defined(Y)){if(this._setBooleanOption("jpegOptimiseScans",Y),Y)this.options.jpegProgressive=!0}let z=X1.number(A.quantizationTable)?A.quantizationTable:A.quantisationTable;if(X1.defined(z))if(X1.integer(z)&&X1.inRange(z,0,8))this.options.jpegQuantisationTable=z;else throw X1.invalidParameterError("quantisationTable","integer between 0 and 8",z)}return this._updateFormatOut("jpeg",A)}function hk9(A){if(X1.object(A)){if(X1.defined(A.progressive))this._setBooleanOption("pngProgressive",A.progressive);if(X1.defined(A.compressionLevel))if(X1.integer(A.compressionLevel)&&X1.inRange(A.compressionLevel,0,9))this.options.pngCompressionLevel=A.compressionLevel;else throw X1.invalidParameterError("compressionLevel","integer between 0 and 9",A.compressionLevel);if(X1.defined(A.adaptiveFiltering))this._setBooleanOption("pngAdaptiveFiltering",A.adaptiveFiltering);let K=A.colours||A.colors;if(X1.defined(K))if(X1.integer(K)&&X1.inRange(K,2,256))this.options.pngBitdepth=eb4(K);else throw X1.invalidParameterError("colours","integer between 2 and 256",K);if(X1.defined(A.palette))this._setBooleanOption("pngPalette",A.palette);else if([A.quality,A.effort,A.colours,A.colors,A.dither].some(X1.defined))this._setBooleanOption("pngPalette",!0);if(this.options.pngPalette){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,0,100))this.options.pngQuality=A.quality;else throw X1.invalidParameterError("quality","integer between 0 and 100",A.quality);if(X1.defined(A.effort))if(X1.integer(A.effort)&&X1.inRange(A.effort,1,10))this.options.pngEffort=A.effort;else throw X1.invalidParameterError("effort","integer between 1 and 10",A.effort);if(X1.defined(A.dither))if(X1.number(A.dither)&&X1.inRange(A.dither,0,1))this.options.pngDither=A.dither;else throw X1.invalidParameterError("dither","number between 0.0 and 1.0",A.dither)}}return this._updateFormatOut("png",A)}function bk9(A){if(X1.object(A)){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.webpQuality=A.quality;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);if(X1.defined(A.alphaQuality))if(X1.integer(A.alphaQuality)&&X1.inRange(A.alphaQuality,0,100))this.options.webpAlphaQuality=A.alphaQuality;else throw X1.invalidParameterError("alphaQuality","integer between 0 and 100",A.alphaQuality);if(X1.defined(A.lossless))this._setBooleanOption("webpLossless",A.lossless);if(X1.defined(A.nearLossless))this._setBooleanOption("webpNearLossless",A.nearLossless);if(X1.defined(A.smartSubsample))this._setBooleanOption("webpSmartSubsample",A.smartSubsample);if(X1.defined(A.preset))if(X1.string(A.preset)&&X1.inArray(A.preset,["default","photo","picture","drawing","icon","text"]))this.options.webpPreset=A.preset;else throw X1.invalidParameterError("preset","one of: default, photo, picture, drawing, icon, text",A.preset);if(X1.defined(A.effort))if(X1.integer(A.effort)&&X1.inRange(A.effort,0,6))this.options.webpEffort=A.effort;else throw X1.invalidParameterError("effort","integer between 0 and 6",A.effort);if(X1.defined(A.minSize))this._setBooleanOption("webpMinSize",A.minSize);if(X1.defined(A.mixed))this._setBooleanOption("webpMixed",A.mixed)}return Ax4(A,this.options),this._updateFormatOut("webp",A)}function xk9(A){if(X1.object(A)){if(X1.defined(A.reuse))this._setBooleanOption("gifReuse",A.reuse);if(X1.defined(A.progressive))this._setBooleanOption("gifProgressive",A.progressive);let K=A.colours||A.colors;if(X1.defined(K))if(X1.integer(K)&&X1.inRange(K,2,256))this.options.gifBitdepth=eb4(K);else throw X1.invalidParameterError("colours","integer between 2 and 256",K);if(X1.defined(A.effort))if(X1.number(A.effort)&&X1.inRange(A.effort,1,10))this.options.gifEffort=A.effort;else throw X1.invalidParameterError("effort","integer between 1 and 10",A.effort);if(X1.defined(A.dither))if(X1.number(A.dither)&&X1.inRange(A.dither,0,1))this.options.gifDither=A.dither;else throw X1.invalidParameterError("dither","number between 0.0 and 1.0",A.dither);if(X1.defined(A.interFrameMaxError))if(X1.number(A.interFrameMaxError)&&X1.inRange(A.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=A.interFrameMaxError;else throw X1.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",A.interFrameMaxError);if(X1.defined(A.interPaletteMaxError))if(X1.number(A.interPaletteMaxError)&&X1.inRange(A.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=A.interPaletteMaxError;else throw X1.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",A.interPaletteMaxError)}return Ax4(A,this.options),this._updateFormatOut("gif",A)}function uk9(A){if(!this.constructor.format.jp2k.output.buffer)throw tb4();if(X1.object(A)){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.jp2Quality=A.quality;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);if(X1.defined(A.lossless))if(X1.bool(A.lossless))this.options.jp2Lossless=A.lossless;else throw X1.invalidParameterError("lossless","boolean",A.lossless);if(X1.defined(A.tileWidth))if(X1.integer(A.tileWidth)&&X1.inRange(A.tileWidth,1,32768))this.options.jp2TileWidth=A.tileWidth;else throw X1.invalidParameterError("tileWidth","integer between 1 and 32768",A.tileWidth);if(X1.defined(A.tileHeight))if(X1.integer(A.tileHeight)&&X1.inRange(A.tileHeight,1,32768))this.options.jp2TileHeight=A.tileHeight;else throw X1.invalidParameterError("tileHeight","integer between 1 and 32768",A.tileHeight);if(X1.defined(A.chromaSubsampling))if(X1.string(A.chromaSubsampling)&&X1.inArray(A.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=A.chromaSubsampling;else throw X1.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",A.chromaSubsampling)}return this._updateFormatOut("jp2",A)}function Ax4(A,K){if(X1.object(A)&&X1.defined(A.loop))if(X1.integer(A.loop)&&X1.inRange(A.loop,0,65535))K.loop=A.loop;else throw X1.invalidParameterError("loop","integer between 0 and 65535",A.loop);if(X1.object(A)&&X1.defined(A.delay))if(X1.integer(A.delay)&&X1.inRange(A.delay,0,65535))K.delay=[A.delay];else if(Array.isArray(A.delay)&&A.delay.every(X1.integer)&&A.delay.every((q)=>X1.inRange(q,0,65535)))K.delay=A.delay;else throw X1.invalidParameterError("delay","integer or an array of integers between 0 and 65535",A.delay)}function Bk9(A){if(X1.object(A)){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.tiffQuality=A.quality;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);if(X1.defined(A.bitdepth))if(X1.integer(A.bitdepth)&&X1.inArray(A.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=A.bitdepth;else throw X1.invalidParameterError("bitdepth","1, 2, 4 or 8",A.bitdepth);if(X1.defined(A.tile))this._setBooleanOption("tiffTile",A.tile);if(X1.defined(A.tileWidth))if(X1.integer(A.tileWidth)&&A.tileWidth>0)this.options.tiffTileWidth=A.tileWidth;else throw X1.invalidParameterError("tileWidth","integer greater than zero",A.tileWidth);if(X1.defined(A.tileHeight))if(X1.integer(A.tileHeight)&&A.tileHeight>0)this.options.tiffTileHeight=A.tileHeight;else throw X1.invalidParameterError("tileHeight","integer greater than zero",A.tileHeight);if(X1.defined(A.miniswhite))this._setBooleanOption("tiffMiniswhite",A.miniswhite);if(X1.defined(A.pyramid))this._setBooleanOption("tiffPyramid",A.pyramid);if(X1.defined(A.xres))if(X1.number(A.xres)&&A.xres>0)this.options.tiffXres=A.xres;else throw X1.invalidParameterError("xres","number greater than zero",A.xres);if(X1.defined(A.yres))if(X1.number(A.yres)&&A.yres>0)this.options.tiffYres=A.yres;else throw X1.invalidParameterError("yres","number greater than zero",A.yres);if(X1.defined(A.compression))if(X1.string(A.compression)&&X1.inArray(A.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=A.compression;else throw X1.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",A.compression);if(X1.defined(A.predictor))if(X1.string(A.predictor)&&X1.inArray(A.predictor,["none","horizontal","float"]))this.options.tiffPredictor=A.predictor;else throw X1.invalidParameterError("predictor","one of: none, horizontal, float",A.predictor);if(X1.defined(A.resolutionUnit))if(X1.string(A.resolutionUnit)&&X1.inArray(A.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=A.resolutionUnit;else throw X1.invalidParameterError("resolutionUnit","one of: inch, cm",A.resolutionUnit)}return this._updateFormatOut("tiff",A)}function mk9(A){return this.heif({...A,compression:"av1"})}function gk9(A){if(X1.object(A)){if(X1.string(A.compression)&&X1.inArray(A.compression,["av1","hevc"]))this.options.heifCompression=A.compression;else throw X1.invalidParameterError("compression","one of: av1, hevc",A.compression);if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.heifQuality=A.quality;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);if(X1.defined(A.lossless))if(X1.bool(A.lossless))this.options.heifLossless=A.lossless;else throw X1.invalidParameterError("lossless","boolean",A.lossless);if(X1.defined(A.effort))if(X1.integer(A.effort)&&X1.inRange(A.effort,0,9))this.options.heifEffort=A.effort;else throw X1.invalidParameterError("effort","integer between 0 and 9",A.effort);if(X1.defined(A.chromaSubsampling))if(X1.string(A.chromaSubsampling)&&X1.inArray(A.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=A.chromaSubsampling;else throw X1.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",A.chromaSubsampling);if(X1.defined(A.bitdepth))if(X1.integer(A.bitdepth)&&X1.inArray(A.bitdepth,[8,10,12])){if(A.bitdepth!==8&&this.constructor.versions.heif)throw X1.invalidParameterError("bitdepth when using prebuilt binaries",8,A.bitdepth);this.options.heifBitdepth=A.bitdepth}else throw X1.invalidParameterError("bitdepth","8, 10 or 12",A.bitdepth)}else throw X1.invalidParameterError("options","Object",A);return this._updateFormatOut("heif",A)}function Fk9(A){if(X1.object(A)){if(X1.defined(A.quality))if(X1.integer(A.quality)&&X1.inRange(A.quality,1,100))this.options.jxlDistance=A.quality>=30?0.1+(100-A.quality)*0.09:0.017666666666666667*A.quality*A.quality-1.15*A.quality+25;else throw X1.invalidParameterError("quality","integer between 1 and 100",A.quality);else if(X1.defined(A.distance))if(X1.number(A.distance)&&X1.inRange(A.distance,0,15))this.options.jxlDistance=A.distance;else throw X1.invalidParameterError("distance","number between 0.0 and 15.0",A.distance);if(X1.defined(A.decodingTier))if(X1.integer(A.decodingTier)&&X1.inRange(A.decodingTier,0,4))this.options.jxlDecodingTier=A.decodingTier;else throw X1.invalidParameterError("decodingTier","integer between 0 and 4",A.decodingTier);if(X1.defined(A.lossless))if(X1.bool(A.lossless))this.options.jxlLossless=A.lossless;else throw X1.invalidParameterError("lossless","boolean",A.lossless);if(X1.defined(A.effort))if(X1.integer(A.effort)&&X1.inRange(A.effort,3,9))this.options.jxlEffort=A.effort;else throw X1.invalidParameterError("effort","integer between 3 and 9",A.effort)}return this._updateFormatOut("jxl",A)}function Qk9(A){if(X1.object(A)){if(X1.defined(A.depth))if(X1.string(A.depth)&&X1.inArray(A.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=A.depth;else throw X1.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",A.depth)}return this._updateFormatOut("raw")}function Uk9(A){if(X1.object(A)){if(X1.defined(A.size))if(X1.integer(A.size)&&X1.inRange(A.size,1,8192))this.options.tileSize=A.size;else throw X1.invalidParameterError("size","integer between 1 and 8192",A.size);if(X1.defined(A.overlap))if(X1.integer(A.overlap)&&X1.inRange(A.overlap,0,8192)){if(A.overlap>this.options.tileSize)throw X1.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,A.overlap);this.options.tileOverlap=A.overlap}else throw X1.invalidParameterError("overlap","integer between 0 and 8192",A.overlap);if(X1.defined(A.container))if(X1.string(A.container)&&X1.inArray(A.container,["fs","zip"]))this.options.tileContainer=A.container;else throw X1.invalidParameterError("container","one of: fs, zip",A.container);if(X1.defined(A.layout))if(X1.string(A.layout)&&X1.inArray(A.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=A.layout;else throw X1.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",A.layout);if(X1.defined(A.angle))if(X1.integer(A.angle)&&!(A.angle%90))this.options.tileAngle=A.angle;else throw X1.invalidParameterError("angle","positive/negative multiple of 90",A.angle);if(this._setBackgroundColourOption("tileBackground",A.background),X1.defined(A.depth))if(X1.string(A.depth)&&X1.inArray(A.depth,["onepixel","onetile","one"]))this.options.tileDepth=A.depth;else throw X1.invalidParameterError("depth","one of: onepixel, onetile, one",A.depth);if(X1.defined(A.skipBlanks))if(X1.integer(A.skipBlanks)&&X1.inRange(A.skipBlanks,-1,65535))this.options.tileSkipBlanks=A.skipBlanks;else throw X1.invalidParameterError("skipBlanks","integer between -1 and 255/65535",A.skipBlanks);else if(X1.defined(A.layout)&&A.layout==="google")this.options.tileSkipBlanks=5;let K=X1.bool(A.center)?A.center:A.centre;if(X1.defined(K))this._setBooleanOption("tileCentre",K);if(X1.defined(A.id))if(X1.string(A.id))this.options.tileId=A.id;else throw X1.invalidParameterError("id","string",A.id);if(X1.defined(A.basename))if(X1.string(A.basename))this.options.tileBasename=A.basename;else throw X1.invalidParameterError("basename","string",A.basename)}if(X1.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw X1.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function pk9(A){if(!X1.plainObject(A))throw X1.invalidParameterError("options","object",A);if(X1.integer(A.seconds)&&X1.inRange(A.seconds,0,3600))this.options.timeoutSeconds=A.seconds;else throw X1.invalidParameterError("seconds","integer between 0 and 3600",A.seconds);return this}function dk9(A,K){if(!(X1.object(K)&&K.force===!1))this.options.formatOut=A;return this}function ck9(A,K){if(X1.bool(K))this.options[A]=K;else throw X1.invalidParameterError(A,"boolean",K)}function lk9(){if(!this.options.streamOut){this.options.streamOut=!0;let A=Error();this._pipeline(void 0,A)}}function ik9(A,K){if(typeof A==="function"){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),j$A.pipeline(this.options,(q,Y,z)=>{if(q)A(X1.nativeError(q,K));else A(null,Y,z)})});else j$A.pipeline(this.options,(q,Y,z)=>{if(q)A(X1.nativeError(q,K));else A(null,Y,z)});return this}else if(this.options.streamOut){if(this._isStreamInput()){if(this.once("finish",()=>{this._flattenBufferIn(),j$A.pipeline(this.options,(q,Y,z)=>{if(q)this.emit("error",X1.nativeError(q,K));else this.emit("info",z),this.push(Y);this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished)this.emit("finish")}else j$A.pipeline(this.options,(q,Y,z)=>{if(q)this.emit("error",X1.nativeError(q,K));else this.emit("info",z),this.push(Y);this.push(null),this.on("end",()=>this.emit("close"))});return this}else if(this._isStreamInput())return new Promise((q,Y)=>{this.once("finish",()=>{this._flattenBufferIn(),j$A.pipeline(this.options,(z,w,H)=>{if(z)Y(X1.nativeError(z,K));else if(this.options.resolveWithObject)q({data:w,info:H});else q(w)})})});else return new Promise((q,Y)=>{j$A.pipeline(this.options,(z,w,H)=>{if(z)Y(X1.nativeError(z,K));else if(this.options.resolveWithObject)q({data:w,info:H});else q(w)})})}Kx4.exports=function(A){Object.assign(A.prototype,{toFile:Nk9,toBuffer:Tk9,keepExif:vk9,withExif:Ek9,withExifMerge:kk9,keepIccProfile:Ck9,withIccProfile:Lk9,keepMetadata:Rk9,withMetadata:yk9,toFormat:Ik9,jpeg:Sk9,jp2:uk9,png:hk9,webp:bk9,tiff:Bk9,avif:mk9,heif:gk9,jxl:Fk9,gif:xk9,raw:Qk9,tile:Uk9,timeout:pk9,_updateFormatOut:dk9,_setBooleanOption:ck9,_read:lk9,_pipeline:ik9})}});var Hx4=v((SWw,wx4)=>{var nk9=yA("node:events"),VY1=qY1(),ok=Fx(),{runtimePlatformArch:rk9}=KY6(),$M=aIA(),Yx4=rk9(),WY6=$M.libvipsVersion(),Ur=$M.format();Ur.heif.output.alias=["avif","heic"];Ur.jpeg.output.alias=["jpe","jpg"];Ur.tiff.output.alias=["tif"];Ur.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var ok9={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},M$A={vips:WY6.semver};if(!WY6.isGlobal)if(!WY6.isWasm)try{M$A=yA(`@img/sharp-${Yx4}/versions`)}catch(A){try{M$A=yA(`@img/sharp-libvips-${Yx4}/versions`)}catch(K){}}else try{M$A=(()=>{throw new Error("Cannot require module "+"@img/sharp-wasm32/versions");})()}catch(A){}M$A.sharp=e96().version;if(M$A.heif&&Ur.heif)Ur.heif.input.fileSuffix=[".avif"],Ur.heif.output.alias=["avif"];function zx4(A){if(ok.bool(A))if(A)return $M.cache(50,20,100);else return $M.cache(0,0,0);else if(ok.object(A))return $M.cache(A.memory,A.files,A.items);else return $M.cache()}zx4(!0);function ak9(A){return $M.concurrency(ok.integer(A)?A:null)}if(VY1.familySync()===VY1.GLIBC&&!$M._isUsingJemalloc())$M.concurrency(1);else if(VY1.familySync()===VY1.MUSL&&$M.concurrency()===1024)$M.concurrency(yA("node:os").availableParallelism());var sk9=new nk9.EventEmitter;function tk9(){return $M.counters()}function ek9(A){return $M.simd(ok.bool(A)?A:null)}function AC9(A){if(ok.object(A))if(Array.isArray(A.operation)&&A.operation.every(ok.string))$M.block(A.operation,!0);else throw ok.invalidParameterError("operation","Array<string>",A.operation);else throw ok.invalidParameterError("options","object",A)}function KC9(A){if(ok.object(A))if(Array.isArray(A.operation)&&A.operation.every(ok.string))$M.block(A.operation,!1);else throw ok.invalidParameterError("operation","Array<string>",A.operation);else throw ok.invalidParameterError("options","object",A)}wx4.exports=function(A){A.cache=zx4,A.concurrency=ak9,A.counters=tk9,A.simd=ek9,A.format=Ur,A.interpolators=ok9,A.versions=M$A,A.queue=sk9,A.block=AC9,A.unblock=KC9}});var DY6=v((bWw,Jx4)=>{var lQ=Wb4();xb4()(lQ);Qb4()(lQ);pb4()(lQ);lb4()(lQ);rb4()(lQ);ab4()(lQ);qx4()(lQ);Hx4()(lQ);Jx4.exports=lQ});async function jY6(){if(fY1)return fY1.default;if(i9())try{let q=await Promise.resolve().then(() => (BS4(),uS4)),Y=q.sharp||q.default;return fY1={default:Y},Y}catch{console.warn("Native image processor not available, falling back to sharp")}let A=await Promise.resolve().then(() => r(DY6(),1)),K=A?.default||A;return fY1={default:K},K}var fY1=null;var Ox4=()=>{};function zC9(A){if(A instanceof Error){let q=A;if(q.code==="MODULE_NOT_FOUND"||q.code==="ERR_MODULE_NOT_FOUND"||q.code==="ERR_DLOPEN_FAILED")return Xx4}let K=A instanceof Error?A.message:String(A);if(K.includes("Native image processor module not available"))return Xx4;if(K.includes("unsupported image format")||K.includes("Input buffer")||K.includes("Input file is missing")||K.includes("Input file has corrupt header"))return qC9;return YC9}function iQ(A){if(A<1024)return`${A} B`;if(A<1048576)return`${(A/1024).toFixed(1)} KB`;return`${(A/1048576).toFixed(1)} MB`}async function P$A(A,K,q){try{let Y=await jY6(),w=await Y(A).metadata(),H=w.format??q,J=H==="jpg"?"jpeg":H;if(!w.width||!w.height){if(K>lR)return{buffer:await Y(A).jpeg({quality:80}).toBuffer(),mediaType:"jpeg"};return{buffer:A,mediaType:J}}let{width:O,height:X}=w,$=O,_=X;if(K<=lR&&$<=yJA&&_<=IJA)return{buffer:A,mediaType:J,dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}};let Z=$>yJA||_>IJA,G=J==="png";if(!Z&&K>lR){if(G){let D=await Y(A).png({compressionLevel:9,palette:!0}).toBuffer();if(D.length<=lR)return{buffer:D,mediaType:"png",dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}}}for(let D of[80,60,40,20]){let j=await Y(A).jpeg({quality:D}).toBuffer();if(j.length<=lR)return{buffer:j,mediaType:"jpeg",dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}}}}if($>yJA)_=Math.round(_*yJA/$),$=yJA;if(_>IJA)$=Math.round($*IJA/_),_=IJA;h(`Resizing to ${$}x${_}`);let W=await Y(A).resize($,_,{fit:"inside",withoutEnlargement:!0}).toBuffer();if(W.length>lR){if(G){let P=await Y(A).resize($,_,{fit:"inside",withoutEnlargement:!0}).png({compressionLevel:9,palette:!0}).toBuffer();if(P.length<=lR)return{buffer:P,mediaType:"png",dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}}}for(let P of[80,60,40,20]){let V=await Y(A).resize($,_,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:P}).toBuffer();if(V.length<=lR)return{buffer:V,mediaType:"jpeg",dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}}}let D=Math.min($,1000),j=Math.round(_*D/Math.max($,1));h("Still too large, compressing with JPEG");let M=await Y(A).resize(D,j,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:20}).toBuffer();return h(`JPEG compressed buffer size: ${M.length}`),{buffer:M,mediaType:"jpeg",dimensions:{originalWidth:O,originalHeight:X,displayWidth:D,displayHeight:j}}}return{buffer:W,mediaType:J,dimensions:{originalWidth:O,originalHeight:X,displayWidth:$,displayHeight:_}}}catch(Y){KA(Y);let z=zC9(Y);n("tengu_image_resize_failed",{original_size_bytes:K,error_type:z});let H=V$A(A).slice(6),J=Math.ceil(K*4/3);if(J<=RJA)return n("tengu_image_resize_fallback",{original_size_bytes:K,base64_size_bytes:J,error_type:z}),{buffer:A,mediaType:H};throw new H7A(`Unable to resize image (${iQ(K)} raw, ${iQ(J)} base64). The image exceeds the 5MB API limit and compression failed. Please resize the image manually or use a smaller image.`)}}async function MY6(A){if(A.source.type!=="base64")return{block:A};let K=Buffer.from(A.source.data,"base64"),q=K.length,z=A.source.media_type?.split("/")[1]||"png",w=await P$A(K,q,z);return{block:{type:"image",source:{type:"base64",media_type:`image/${w.mediaType}`,data:w.buffer.toString("base64")}},dimensions:w.dimensions}}async function J7A(A,K=lR,q){let Y=q?.split("/")[1]||"jpeg",z=Y==="jpg"?"jpeg":Y;try{let w=await jY6(),H=await w(A).metadata(),J=H.format||z,O=A.length,X={imageBuffer:A,metadata:H,format:J,maxBytes:K,originalSize:O};if(O<=K)return KSA(A,J,O);let $=await wC9(X,w);if($)return $;if(J==="png"){let Z=await JC9(X,w);if(Z)return Z}let _=await OC9(X,50,w);if(_)return _;return await XC9(X,w)}catch(w){if(KA(w),n("tengu_image_compress_failed",{original_size_bytes:A.length,max_bytes:K}),A.length<=K){let H=V$A(A);return{base64:A.toString("base64"),mediaType:H,originalSize:A.length}}throw new H7A(`Unable to compress image (${iQ(A.length)}) to fit within ${iQ(K)}. Please use a smaller image.`)}}async function $x4(A,K,q){let Y=Math.floor(K/0.125),z=Math.floor(Y*0.75);return J7A(A,z,q)}async function _x4(A,K=lR){if(A.source.type!=="base64")return A;let q=Buffer.from(A.source.data,"base64");if(q.length<=K)return A;let Y=await J7A(q,K);return{type:"image",source:{type:"base64",media_type:Y.mediaType,data:Y.base64}}}function KSA(A,K,q){let Y=K==="jpg"?"jpeg":K;return{base64:A.toString("base64"),mediaType:`image/${Y}`,originalSize:q}}async function wC9(A,K){let q=[1,0.75,0.5,0.25];for(let Y of q){let z=Math.round((A.metadata.width||2000)*Y),w=Math.round((A.metadata.height||2000)*Y),H=K(A.imageBuffer).resize(z,w,{fit:"inside",withoutEnlargement:!0});H=HC9(H,A.format);let J=await H.toBuffer();if(J.length<=A.maxBytes)return KSA(J,A.format,A.originalSize)}return null}function HC9(A,K){switch(K){case"png":return A.png({compressionLevel:9,palette:!0});case"jpeg":case"jpg":return A.jpeg({quality:80});case"webp":return A.webp({quality:80});default:return A}}async function JC9(A,K){let q=await K(A.imageBuffer).resize(800,800,{fit:"inside",withoutEnlargement:!0}).png({compressionLevel:9,palette:!0,colors:64}).toBuffer();if(q.length<=A.maxBytes)return KSA(q,"png",A.originalSize);return null}async function OC9(A,K,q){let Y=await q(A.imageBuffer).resize(600,600,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:K}).toBuffer();if(Y.length<=A.maxBytes)return KSA(Y,"jpeg",A.originalSize);return null}async function XC9(A,K){let q=await K(A.imageBuffer).resize(400,400,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:20}).toBuffer();return KSA(q,"jpeg",A.originalSize)}function V$A(A){if(A.length<4)return"image/png";if(A[0]===137&&A[1]===80&&A[2]===78&&A[3]===71)return"image/png";if(A[0]===255&&A[1]===216&&A[2]===255)return"image/jpeg";if(A[0]===71&&A[1]===73&&A[2]===70)return"image/gif";if(A[0]===82&&A[1]===73&&A[2]===70&&A[3]===70){if(A.length>=12&&A[8]===87&&A[9]===69&&A[10]===66&&A[11]===80)return"image/webp"}return"image/png"}function PY6(A){try{let K=Buffer.from(A,"base64");return V$A(K)}catch{return"image/png"}}function f$A(A,K){let{originalWidth:q,originalHeight:Y,displayWidth:z,displayHeight:w}=A;if(!q||!Y||!z||!w||z<=0||w<=0){if(K)return`[Image source: ${K}]`;return null}let H=q!==z||Y!==w;if(!H&&!K)return null;let J=[];if(K)J.push(`source: ${K}`);if(H){let O=q/z;J.push(`original ${q}x${Y}, displayed at ${z}x${w}. Multiply coordinates by ${O.toFixed(2)} to map to original image.`)}return`[Image: ${J.join(", ")}]`}var Xx4=1,qC9=2,YC9=3,H7A;var cx=C(()=>{v1();W1();i1();Ox4();b11();H7A=class H7A extends Error{constructor(A){super(A);this.name="ImageResizeError"}}});function $C9(A,K){return A?.includes("_staging_")===!0||K?.includes("staging")===!0}function _C9(A,K){return $C9(A,K)?"https://staging.claude.ai":"https://claude.ai"}function NY1(A,K){return`${_C9(A,K)}/code/${A}`}var Zx4="https://claude.com/claude-code";var Gx4=()=>{};function WC9(){return process.env.CLAUDE_CODE_ENTRYPOINT??"cli"}function TY1(){return{fileStates:new Map,sessionBaselines:new Map,surface:WC9(),startingHeadSha:null,promptCount:0,promptCountAtLastCommit:0,permissionPromptCount:0,permissionPromptCountAtLastCommit:0,escapeCount:0,escapeCountAtLastCommit:0}}var ZC9,qSA=null,GC9;var O7A=C(()=>{s1();s6();W1();v1();Gx4();vK();z7();ZC9=["github.com:anthropics/claude-cli-internal","github.com/anthropics/claude-cli-internal","github.com:anthropics/anthropic","github.com/anthropics/anthropic","github.com:anthropics/apps","github.com/anthropics/apps","github.com:anthropics/terraform-config","github.com/anthropics/terraform-config","github.com:anthropics/hex-export","github.com/anthropics/hex-export","github.com:anthropics/feedback-v2","github.com/anthropics/feedback-v2"],GC9=Zx(async()=>{if(qSA!==null)return qSA;let A=f8(),K=await T7("git",["remote","get-url","origin"],{cwd:A,timeout:5000});if(K.code!==0)return qSA=!1,!1;let q=K.stdout.trim();return qSA=ZC9.some((Y)=>q.includes(Y)),qSA})});function vY1(){if(PnA()==="remote"){let z=process.env.CLAUDE_CODE_REMOTE_SESSION_ID;if(z){let w=process.env.SESSION_INGRESS_URL;if(!w?.includes("localhost")){let H=NY1(z,w);return{commit:H,pr:H}}}return{commit:"",pr:""}}let A=aw4(Z3()),K=`\uD83E\uDD16 Generated with [Claude Code](${Zx4})`,q=`Co-Authored-By: ${A} <noreply@anthropic.com>`,Y=oq();if(Y.attribution)return{commit:Y.attribution.commit??q,pr:Y.attribution.pr??K};if(Y.includeCoAuthoredBy===!1)return{commit:"",pr:""};return{commit:q,pr:K}}var EY1=C(()=>{s1();B8();z7();UK();$w();O7A();v1();W1();_z()});function kY1(A=process.env){let K=A.BASH_DEFAULT_TIMEOUT_MS;if(K){let q=parseInt(K,10);if(!isNaN(q)&&q>0)return q}return 120000}function Wx4(A=process.env){let K=A.BASH_MAX_TIMEOUT_MS;if(K){let q=parseInt(K,10);if(!isNaN(q)&&q>0)return Math.max(q,kY1(A))}return Math.max(600000,kY1(A))}function pr(A){return HF(A)}var YSA=C(()=>{J7()});var wSA=v((MDw,RY1)=>{function Mx4(A){return Array.isArray(A)?A:[A]}var DC9=void 0,fY6="",Dx4=" ",VY6="\\",jC9=/^\s+$/,MC9=/(?:[^\\]|^)\\$/,PC9=/^\\!/,VC9=/^\\#/,fC9=/\r?\n/g,NC9=/^\.{0,2}\/|^\.{1,2}$/,TC9=/\/$/,N$A="/",Px4="node-ignore";if(typeof Symbol<"u")Px4=Symbol.for("node-ignore");var Vx4=Px4,T$A=(A,K,q)=>{return Object.defineProperty(A,K,{value:q}),q},vC9=/([0-z])-([0-z])/g,fx4=()=>!1,EC9=(A)=>A.replace(vC9,(K,q,Y)=>q.charCodeAt(0)<=Y.charCodeAt(0)?K:fY6),kC9=(A)=>{let{length:K}=A;return A.slice(0,K-K%2)},CC9=[[/^\uFEFF/,()=>fY6],[/((?:\\\\)*?)(\\?\s+)$/,(A,K,q)=>K+(q.indexOf("\\")===0?Dx4:fY6)],[/(\\+?)\s/g,(A,K)=>{let{length:q}=K;return K.slice(0,q-q%2)+Dx4}],[/[\\$.|*+(){^]/g,(A)=>`\\${A}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(A,K,q)=>K+6<q.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(A,K,q)=>{let Y=q.replace(/\\\*/g,"[^\\/]*");return K+Y}],[/\\\\\\(?=[$.|*+(){^])/g,()=>VY6],[/\\\\/g,()=>VY6],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(A,K,q,Y,z)=>K===VY6?`\\[${q}${kC9(Y)}${z}`:z==="]"?Y.length%2===0?`[${EC9(q)}${Y}]`:"[]":"[]"],[/(?:[^*])$/,(A)=>/\/$/.test(A)?`${A}$`:`${A}(?=$|\\/$)`]],LC9=/(^|\\\/)?\\\*$/,zSA="regex",CY1="checkRegex",jx4="_",RC9={[zSA](A,K){return`${K?`${K}[^/]+`:"[^/]*"}(?=$|\\/$)`},[CY1](A,K){return`${K?`${K}[^/]*`:"[^/]*"}(?=$|\\/$)`}},yC9=(A)=>CC9.reduce((K,[q,Y])=>K.replace(q,Y.bind(A)),A),LY1=(A)=>typeof A==="string",IC9=(A)=>A&&LY1(A)&&!jC9.test(A)&&!MC9.test(A)&&A.indexOf("#")!==0,SC9=(A)=>A.split(fC9).filter(Boolean);class Nx4{constructor(A,K,q,Y,z,w){this.pattern=A,this.mark=K,this.negative=z,T$A(this,"body",q),T$A(this,"ignoreCase",Y),T$A(this,"regexPrefix",w)}get regex(){let A=jx4+zSA;if(this[A])return this[A];return this._make(zSA,A)}get checkRegex(){let A=jx4+CY1;if(this[A])return this[A];return this._make(CY1,A)}_make(A,K){let q=this.regexPrefix.replace(LC9,RC9[A]),Y=this.ignoreCase?new RegExp(q,"i"):new RegExp(q);return T$A(this,K,Y)}}var hC9=({pattern:A,mark:K},q)=>{let Y=!1,z=A;if(z.indexOf("!")===0)Y=!0,z=z.substr(1);z=z.replace(PC9,"!").replace(VC9,"#");let w=yC9(z);return new Nx4(A,K,z,q,Y,w)};class Tx4{constructor(A){this._ignoreCase=A,this._rules=[]}_add(A){if(A&&A[Vx4]){this._rules=this._rules.concat(A._rules._rules),this._added=!0;return}if(LY1(A))A={pattern:A};if(IC9(A.pattern)){let K=hC9(A,this._ignoreCase);this._added=!0,this._rules.push(K)}}add(A){return this._added=!1,Mx4(LY1(A)?SC9(A):A).forEach(this._add,this),this._added}test(A,K,q){let Y=!1,z=!1,w;this._rules.forEach((J)=>{let{negative:O}=J;if(z===O&&Y!==z||O&&!Y&&!z&&!K)return;if(!J[q].test(A))return;Y=!O,z=O,w=O?DC9:J});let H={ignored:Y,unignored:z};if(w)H.rule=w;return H}}var bC9=(A,K)=>{throw new K(A)},nQ=(A,K,q)=>{if(!LY1(A))return q(`path must be a string, but got \`${K}\``,TypeError);if(!A)return q("path must not be empty",TypeError);if(nQ.isNotRelative(A))return q(`path should be a \`path.relative()\`d string, but got "${K}"`,RangeError);return!0},vx4=(A)=>NC9.test(A);nQ.isNotRelative=vx4;nQ.convert=(A)=>A;class Ex4{constructor({ignorecase:A=!0,ignoreCase:K=A,allowRelativePaths:q=!1}={}){T$A(this,Vx4,!0),this._rules=new Tx4(K),this._strictPathCheck=!q,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(A){if(this._rules.add(A))this._initCache();return this}addPattern(A){return this.add(A)}_test(A,K,q,Y){let z=A&&nQ.convert(A);return nQ(z,A,this._strictPathCheck?bC9:fx4),this._t(z,K,q,Y)}checkIgnore(A){if(!TC9.test(A))return this.test(A);let K=A.split(N$A).filter(Boolean);if(K.pop(),K.length){let q=this._t(K.join(N$A)+N$A,this._testCache,!0,K);if(q.ignored)return q}return this._rules.test(A,!1,CY1)}_t(A,K,q,Y){if(A in K)return K[A];if(!Y)Y=A.split(N$A).filter(Boolean);if(Y.pop(),!Y.length)return K[A]=this._rules.test(A,q,zSA);let z=this._t(Y.join(N$A)+N$A,K,q,Y);return K[A]=z.ignored?z:this._rules.test(A,q,zSA)}ignores(A){return this._test(A,this._ignoreCache,!1).ignored}createFilter(){return(A)=>!this.ignores(A)}filter(A){return Mx4(A).filter(this.createFilter())}test(A){return this._test(A,this._testCache,!0)}}var NY6=(A)=>new Ex4(A),xC9=(A)=>nQ(A&&nQ.convert(A),A,fx4),kx4=()=>{let A=(q)=>/^\\\\\?\\/.test(q)||/["<>|\u0000-\u001F]+/u.test(q)?q:q.replace(/\\/g,"/");nQ.convert=A;let K=/^[a-z]:\//i;nQ.isNotRelative=(q)=>K.test(q)||vx4(q)};if(typeof process<"u"&&process.platform==="win32")kx4();RY1.exports=NY6;NY6.default=NY6;RY1.exports.isPathValid=xC9;T$A(RY1.exports,Symbol.for("setupWindows"),kx4)});function vY6(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}function Sx4(A){$7A=A}function kz(A,K=""){let q=typeof A==="string"?A:A.source,Y={replace:(z,w)=>{let H=typeof w==="string"?w:w.source;return H=H.replace(_M.caret,"$1"),q=q.replace(z,H),Y},getRegex:()=>{return new RegExp(q,K)}};return Y}function lx(A,K){if(K){if(_M.escapeTest.test(A))return A.replace(_M.escapeReplace,Lx4)}else if(_M.escapeTestNoEncode.test(A))return A.replace(_M.escapeReplaceNoEncode,Lx4);return A}function Rx4(A){try{A=encodeURI(A).replace(_M.percentDecode,"%")}catch{return null}return A}function yx4(A,K){let q=A.replace(_M.findPipe,(w,H,J)=>{let O=!1,X=H;while(--X>=0&&J[X]==="\\")O=!O;if(O)return"|";else return" |"}),Y=q.split(_M.splitPipe),z=0;if(!Y[0].trim())Y.shift();if(Y.length>0&&!Y.at(-1)?.trim())Y.pop();if(K)if(Y.length>K)Y.splice(K);else while(Y.length<K)Y.push("");for(;z<Y.length;z++)Y[z]=Y[z].trim().replace(_M.slashPipe,"|");return Y}function JSA(A,K,q){let Y=A.length;if(Y===0)return"";let z=0;while(z<Y)if(A.charAt(Y-z-1)===K)z++;else break;return A.slice(0,Y-z)}function GL9(A,K){if(A.indexOf(K[1])===-1)return-1;let q=0;for(let Y=0;Y<A.length;Y++)if(A[Y]==="\\")Y++;else if(A[Y]===K[0])q++;else if(A[Y]===K[1]){if(q--,q<0)return Y}return-1}function Ix4(A,K,q,Y,z){let w=K.href,H=K.title||null,J=A[1].replace(z.other.outputLinkReplace,"$1");if(A[0].charAt(0)!=="!"){Y.state.inLink=!0;let O={type:"link",raw:q,href:w,title:H,text:J,tokens:Y.inlineTokens(J)};return Y.state.inLink=!1,O}return{type:"image",raw:q,href:w,title:H,text:J}}function WL9(A,K,q){let Y=A.match(q.other.indentCodeCompensation);if(Y===null)return K;let z=Y[1];return K.split(`
 `).map((w)=>{let H=w.match(q.other.beginningSpace);if(H===null)return w;let[J]=H;if(J.length>=z.length)return w.slice(z.length);return w}).join(`
 `)}class $SA{options;rules;lexer;constructor(A){this.options=A||$7A}space(A){let K=this.rules.block.newline.exec(A);if(K&&K[0].length>0)return{type:"space",raw:K[0]}}code(A){let K=this.rules.block.code.exec(A);if(K){let q=K[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:K[0],codeBlockStyle:"indented",text:!this.options.pedantic?JSA(q,`
diff --git a/node_modules/@anthropic-ai/claude-agent-sdk/cli.js b/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
--- a/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
+++ b/node_modules/@anthropic-ai/claude-agent-sdk/cli.js
@@ -1421,7 +1421,7 @@
 Assistant: [Calls ToolSearch with query: "slack", gets back mcp__slack__read_channel]
 Assistant: [Calls ToolSearch with query: "select:mcp__slack__read_channel"]
 WRONG - The keyword search already loaded the tool. The select call is redundant.
-</bad-example>`;var Uo=C(()=>{l7();yJ1();i1()});var pdw;var mq7=C(()=>{Uo();PC();pdw=[rG,`${E7}(sleep:*)`,"mcp__slack__send_message","mcp__slack__read_thread","mcp__claude_ai_Slack__slack_send_message","mcp__claude_ai_Slack__slack_read_thread"]});function K_6(){let A=[Lq7,CJ1,yq7,fC,RJ1];if(process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-ts"&&process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-py"&&process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-cli")A.push(hq7);return A}var gq7=C(()=>{Rq7();e$6();Iq7();_xA();A_6();bq7();mq7()});import{join as Y2Y,basename as z2Y}from"path";function Fq7(A,K,q,Y){let z=[],w=xA();function H(J,O=[]){try{let X=w.readdirSync(J);for(let $ of X){let _=Y2Y(J,$.name);if($.isDirectory())H(_,[...O,$.name]);else if($.isFile()&&$.name.endsWith(".md")){let Z=Qq7(_,K,O,q,Y);if(Z)z.push(Z)}}}catch(X){h(`Failed to scan agents directory ${J}: ${X}`,{level:"error"})}}return H(A),z}function Qq7(A,K,q,Y,z){let w=xA();if(Sh(w,A,z))return null;try{let H=w.readFileSync(A,{encoding:"utf-8"}),{frontmatter:J,content:O}=z_(H),X=J.name||z2Y(A).replace(/\.md$/,""),_=[K,...q,X].join(":"),Z=J.description||J["when-to-use"]||`Agent from ${K} plugin`,G=r4A(J.tools),W=Sy(J.skills),D=J.color,j=J.model,M=J.forkContext,P=O.trim();return{agentType:_,whenToUse:Z,tools:G,...W!==void 0?{skills:W}:{},getSystemPrompt:()=>P,source:"plugin",color:D,model:j,filename:X,plugin:Y,...{}}}catch(H){return h(`Failed to load agent from ${A}: ${H}`,{level:"error"}),null}}function Uq7(){mKA.cache?.clear?.()}var mKA;var ZxA=C(()=>{d7();s6();d0();W1();mQ();QQ();mKA=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.agentsPath)try{let w=Fq7(Y.agentsPath,Y.name,Y.source,z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} agents from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load agents from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.agentsPaths)for(let w of Y.agentsPaths)try{let J=xA().statSync(w);if(J.isDirectory()){let O=Fq7(w,Y.name,Y.source,z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} agents from plugin ${Y.name} custom path: ${w}`)}else if(J.isFile()&&w.endsWith(".md")){let O=Qq7(w,Y.name,[],Y.source,z);if(O)q.push(O),h(`Loaded agent from plugin ${Y.name} custom file: ${w}`)}}catch(H){h(`Failed to load agents from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}return h(`Total plugin agents loaded: ${q.length}`),q})});import{join as q_6,sep as Y_6}from"path";import{homedir as w2Y}from"os";function z_6(A){let K=q_6(w2Y(),".claude","agent-memory")+Y_6,q=q_6(b1(),".claude","agent-memory")+Y_6,Y=q_6(b1(),".claude","agent-memory-local")+Y_6;return A.startsWith(K)||A.startsWith(q)||A.startsWith(Y)}var GxA=C(()=>{s6();u4()});import{basename as H2Y}from"path";function BD(A){return A.source==="built-in"}function SJ1(A){return A.source!=="built-in"&&A.source!=="plugin"}function hJ1(A){return A.source==="plugin"}function mU(A){let K=A.filter((X)=>X.source==="built-in"),q=A.filter((X)=>X.source==="plugin"),Y=A.filter((X)=>X.source==="userSettings"),z=A.filter((X)=>X.source==="projectSettings"),w=A.filter((X)=>X.source==="policySettings"),H=A.filter((X)=>X.source==="flagSettings"),J=[K,q,Y,z,H,w],O=new Map;for(let X of J)for(let $ of X)O.set($.agentType,$);return Array.from(O.values())}function H_6(A,K){if(!A.requiredMcpServers||A.requiredMcpServers.length===0)return!0;return A.requiredMcpServers.every((q)=>K.some((Y)=>Y.toLowerCase().includes(q.toLowerCase())))}function cq7(A,K){return A.filter((q)=>H_6(q,K))}function O2Y(A){let{name:K,description:q,model:Y}=A;if(!K||typeof K!=="string")return'Missing required "name" field in frontmatter';if(!q||typeof q!=="string")return'Missing required "description" field in frontmatter';if(Y&&typeof Y==="string"&&!p0A.includes(Y))return`Invalid model "${Y}". Valid options: ${p0A.join(", ")}`;return"Unknown parsing error"}function X2Y(A,K){if(!A.hooks)return;let q=rk.safeParse(A.hooks);if(!q.success){h(`Invalid hooks in agent '${K}': ${q.error.message}`);return}return q.data}function $2Y(A,K,q="flagSettings"){try{let Y=dq7.parse(K),z=r4A(Y.tools),w=Y.disallowedTools!==void 0?r4A(Y.disallowedTools):void 0,H=Y.prompt;return{agentType:A,whenToUse:Y.description,...z!==void 0?{tools:z}:{},...w!==void 0?{disallowedTools:w}:{},getSystemPrompt:()=>{return H},source:q,...Y.model?{model:Y.model}:{},...Y.permissionMode?{permissionMode:Y.permissionMode}:{},...Y.mcpServers&&Y.mcpServers.length>0?{mcpServers:Y.mcpServers}:{},...Y.hooks?{hooks:Y.hooks}:{},...Y.maxTurns!==void 0?{maxTurns:Y.maxTurns}:{},...Y.skills&&Y.skills.length>0?{skills:Y.skills}:{},...Y.memory?{memory:Y.memory}:{}}}catch(Y){let z=Y instanceof Error?Y.message:String(Y);return h(`Error parsing agent '${A}' from JSON: ${z}`),KA(Y instanceof Error?Y:Error(String(Y))),null}}function bJ1(A,K="flagSettings"){try{let q=J2Y.parse(A);return Object.entries(q).map(([Y,z])=>$2Y(Y,z,K)).filter((Y)=>Y!==null)}catch(q){let Y=q instanceof Error?q.message:String(q);return h(`Error parsing agents from JSON: ${Y}`),KA(q instanceof Error?q:Error(String(q))),[]}}function _2Y(A,K,q,Y,z){try{let{name:w,description:H}=q;if(!w||typeof w!=="string"||!H||typeof H!=="string"){let u=`Agent file ${A} is missing required '${!w||typeof w!=="string"?"name":"description"}' in frontmatter`;return h(u),null}H=H.replace(/\\n/g,`
+</bad-example>`;var Uo=C(()=>{l7();yJ1();i1()});var pdw;var mq7=C(()=>{Uo();PC();pdw=[rG,`${E7}(sleep:*)`,"mcp__slack__send_message","mcp__slack__read_thread","mcp__claude_ai_Slack__slack_send_message","mcp__claude_ai_Slack__slack_read_thread"]});function K_6(){let A=[Lq7,CJ1,yq7,fC,RJ1];if(process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-ts"&&process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-py"&&process.env.CLAUDE_CODE_ENTRYPOINT!=="sdk-cli")A.push(hq7);return A}var gq7=C(()=>{Rq7();e$6();Iq7();_xA();A_6();bq7();mq7()});import{join as Y2Y,basename as z2Y}from"path";function Fq7(A,K,q,Y){let z=[],w=xA(),H=__pluginDirCacheRead("plugin-agents",A,K,q);if(H){let J=H.entries||[],O=H.filePaths||[],X=[];for(let $=0;$<J.length;$++){let _=O[$];if(_&&Sh(w,_,Y))continue;X.push(J[$])}return X}let J=new Set,O=new Set;function X($,_,P=[]){try{J.add($);let Z=w.readdirSync($);for(let G of Z){let W=Y2Y($,G.name);if(G.isDirectory())X(W,0,[...P,G.name]);else if(G.isFile()&&G.name.endsWith(".md")){let D=Qq7(W,K,P,q,Y);if(D)z.push(D),O.add(W)}}}catch(Z){h(`Failed to scan agents directory ${$}: ${Z}`,{level:"error"})}}return X(A),__pluginDirCacheWrite("plugin-agents",A,K,q,Array.from(J),Array.from(O),z,Array.from(O)),z}function Qq7(A,K,q,Y,z){let w=xA();if(Sh(w,A,z))return null;try{let H=w.readFileSync(A,{encoding:"utf-8"}),{frontmatter:J,content:O}=z_(H),X=J.name||z2Y(A).replace(/\.md$/,""),_=[K,...q,X].join(":"),Z=J.description||J["when-to-use"]||`Agent from ${K} plugin`,G=r4A(J.tools),W=Sy(J.skills),D=J.color,j=J.model,M=J.forkContext,P=O.trim();return{agentType:_,whenToUse:Z,tools:G,...W!==void 0?{skills:W}:{},getSystemPrompt:()=>P,source:"plugin",color:D,model:j,filename:X,plugin:Y,...{}}}catch(H){return h(`Failed to load agent from ${A}: ${H}`,{level:"error"}),null}}function Uq7(){mKA.cache?.clear?.()}var mKA;var ZxA=C(()=>{d7();s6();d0();W1();mQ();QQ();mKA=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.agentsPath)try{let w=Fq7(Y.agentsPath,Y.name,Y.source,z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} agents from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load agents from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.agentsPaths)for(let w of Y.agentsPaths)try{let J=xA().statSync(w);if(J.isDirectory()){let O=Fq7(w,Y.name,Y.source,z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} agents from plugin ${Y.name} custom path: ${w}`)}else if(J.isFile()&&w.endsWith(".md")){let O=Qq7(w,Y.name,[],Y.source,z);if(O)q.push(O),h(`Loaded agent from plugin ${Y.name} custom file: ${w}`)}}catch(H){h(`Failed to load agents from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}return h(`Total plugin agents loaded: ${q.length}`),q})});import{join as q_6,sep as Y_6}from"path";import{homedir as w2Y}from"os";function z_6(A){let K=q_6(w2Y(),".claude","agent-memory")+Y_6,q=q_6(b1(),".claude","agent-memory")+Y_6,Y=q_6(b1(),".claude","agent-memory-local")+Y_6;return A.startsWith(K)||A.startsWith(q)||A.startsWith(Y)}var GxA=C(()=>{s6();u4()});import{basename as H2Y}from"path";function BD(A){return A.source==="built-in"}function SJ1(A){return A.source!=="built-in"&&A.source!=="plugin"}function hJ1(A){return A.source==="plugin"}function mU(A){let K=A.filter((X)=>X.source==="built-in"),q=A.filter((X)=>X.source==="plugin"),Y=A.filter((X)=>X.source==="userSettings"),z=A.filter((X)=>X.source==="projectSettings"),w=A.filter((X)=>X.source==="policySettings"),H=A.filter((X)=>X.source==="flagSettings"),J=[K,q,Y,z,H,w],O=new Map;for(let X of J)for(let $ of X)O.set($.agentType,$);return Array.from(O.values())}function H_6(A,K){if(!A.requiredMcpServers||A.requiredMcpServers.length===0)return!0;return A.requiredMcpServers.every((q)=>K.some((Y)=>Y.toLowerCase().includes(q.toLowerCase())))}function cq7(A,K){return A.filter((q)=>H_6(q,K))}function O2Y(A){let{name:K,description:q,model:Y}=A;if(!K||typeof K!=="string")return'Missing required "name" field in frontmatter';if(!q||typeof q!=="string")return'Missing required "description" field in frontmatter';if(Y&&typeof Y==="string"&&!p0A.includes(Y))return`Invalid model "${Y}". Valid options: ${p0A.join(", ")}`;return"Unknown parsing error"}function X2Y(A,K){if(!A.hooks)return;let q=rk.safeParse(A.hooks);if(!q.success){h(`Invalid hooks in agent '${K}': ${q.error.message}`);return}return q.data}function $2Y(A,K,q="flagSettings"){try{let Y=dq7.parse(K),z=r4A(Y.tools),w=Y.disallowedTools!==void 0?r4A(Y.disallowedTools):void 0,H=Y.prompt;return{agentType:A,whenToUse:Y.description,...z!==void 0?{tools:z}:{},...w!==void 0?{disallowedTools:w}:{},getSystemPrompt:()=>{return H},source:q,...Y.model?{model:Y.model}:{},...Y.permissionMode?{permissionMode:Y.permissionMode}:{},...Y.mcpServers&&Y.mcpServers.length>0?{mcpServers:Y.mcpServers}:{},...Y.hooks?{hooks:Y.hooks}:{},...Y.maxTurns!==void 0?{maxTurns:Y.maxTurns}:{},...Y.skills&&Y.skills.length>0?{skills:Y.skills}:{},...Y.memory?{memory:Y.memory}:{}}}catch(Y){let z=Y instanceof Error?Y.message:String(Y);return h(`Error parsing agent '${A}' from JSON: ${z}`),KA(Y instanceof Error?Y:Error(String(Y))),null}}function bJ1(A,K="flagSettings"){try{let q=J2Y.parse(A);return Object.entries(q).map(([Y,z])=>$2Y(Y,z,K)).filter((Y)=>Y!==null)}catch(q){let Y=q instanceof Error?q.message:String(q);return h(`Error parsing agents from JSON: ${Y}`),KA(q instanceof Error?q:Error(String(q))),[]}}function _2Y(A,K,q,Y,z){try{let{name:w,description:H}=q;if(!w||typeof w!=="string"||!H||typeof H!=="string"){let u=`Agent file ${A} is missing required '${!w||typeof w!=="string"?"name":"description"}' in frontmatter`;return h(u),null}H=H.replace(/\\n/g,`
 `);let{color:J,model:O,forkContext:X}=q;if(X!==void 0&&X!=="true"&&X!=="false"){let Q=`Agent file ${A} has invalid forkContext value '${X}'. Must be 'true', 'false', or omitted.`;h(Q)}let $=X==="true",_=["user","project","local"],Z=q.memory,G;if(Z!==void 0)if(_.includes(Z))G=Z;else h(`Agent file ${A} has invalid memory value '${Z}'. Valid options: ${_.join(", ")}`);if($&&O!=="inherit"){let Q=`Agent file ${A} has forkContext: true but model is not 'inherit'. Overriding to 'inherit'. Agents with forkContext must use model: inherit to avoid context length mismatch.`;h(Q),O="inherit"}let W=O&&typeof O==="string"&&p0A.includes(O);if(O&&typeof O==="string"&&!W){let Q=`Agent file ${A} has invalid model '${O}'. Valid options: ${p0A.join(", ")}`;h(Q)}let D=q.permissionMode,j=D&&Mi.includes(D);if(D&&!j){let Q=`Agent file ${A} has invalid permissionMode '${D}'. Valid options: ${Mi.join(", ")}`;h(Q)}let M=q.maxTurns,P=HS4(M);if(M!==void 0&&P===void 0)h(`Agent file ${A} has invalid maxTurns '${M}'. Must be a positive integer.`);let V=H2Y(A,".md"),N=r4A(q.tools),T=q.disallowedTools,E=T!==void 0?r4A(T):void 0,R=Sy(q.skills),b=q.mcpServers,S;if(Array.isArray(b))S=b.map((Q)=>{let u=pq7.safeParse(Q);if(u.success)return u.data;return h(`Agent file ${A} has invalid mcpServers item: ${QA(Q)}. Error: ${u.error.message}`),null}).filter((Q)=>Q!==null);let B=X2Y(q,w),x=Y.trim();return{baseDir:K,agentType:w,whenToUse:H,...N!==void 0?{tools:N}:{},...E!==void 0?{disallowedTools:E}:{},...R!==void 0?{skills:R}:{},...S!==void 0&&S.length>0?{mcpServers:S}:{},...B!==void 0?{hooks:B}:{},getSystemPrompt:()=>{return x},source:z,filename:V,...J&&typeof J==="string"&&H$.includes(J)?{color:J}:{},...W?{model:O}:{},...j?{permissionMode:D}:{},...$?{forkContext:$}:{},...P!==void 0?{maxTurns:P}:{},...G?{memory:G}:{}}}catch(w){let H=w instanceof Error?w.message:String(w);return h(`Error parsing agent from ${A}: ${H}`),KA(w instanceof Error?w:Error(String(w))),null}}var pq7,dq7,J2Y,lq7;var NC=C(()=>{d7();J7();i1();W1();mQ();v1();QQ();z7();uD();gq7();gU();ZxA();l_();o4A();h1();GxA();WV();dO();pq7=U.union([U.string(),U.record(U.string(),bx)]),dq7=U.object({description:U.string().min(1,"Description cannot be empty"),tools:U.array(U.string()).optional(),disallowedTools:U.array(U.string()).optional(),prompt:U.string().min(1,"Prompt cannot be empty"),model:U.enum(p0A).optional(),permissionMode:U.enum(Mi).optional(),mcpServers:U.array(pq7).optional(),hooks:U.lazy(()=>rk).optional(),maxTurns:U.number().int().positive().optional(),skills:U.array(U.string()).optional(),memory:U.enum(["user","project","local"]).optional()}),J2Y=U.record(U.string(),dq7);lq7=a1(async(A)=>{try{let K=await FQ("agents",A),q=[],Y=K.map(({filePath:O,baseDir:X,frontmatter:$,content:_,source:Z})=>{let G=_2Y(O,X,$,_,Z);if(!G){let W=O2Y($);return q.push({path:O,error:W}),h(`Failed to parse agent from ${O}: ${W}`),n("tengu_agent_parse_error",{error:W,location:Z}),null}return G}).filter((O)=>O!==null),z=await mKA(),H=[...K_6(),...z,...Y],J=mU(H);for(let O of J)if(O.color)OZA(O.agentType,O.color);return{activeAgents:J,allAgents:H,failedFiles:q.length>0?q:void 0}}catch(K){let q=K instanceof Error?K.message:String(K);h(`Error loading agent definitions: ${q}`),KA(K instanceof Error?K:Error(String(K)));let Y=K_6();return{activeAgents:Y,allAgents:Y,failedFiles:[{path:"unknown",error:q}]}}})});function XZA({mainThreadAgentDefinition:A,toolUseContext:K,customSystemPrompt:q,defaultSystemPrompt:Y,appendSystemPrompt:z,overrideSystemPrompt:w}){if(w)return[w];let H=A?BD(A)?A.getSystemPrompt({toolUseContext:{options:K.options}}):A.getSystemPrompt():void 0;return[...H?[H]:q?[q]:Y,...z?[z]:[]]}var xJ1=C(()=>{NC();i1()});function nq7(){return null}function rq7(A){let K=nq7();if(!K)return A;let q=new globalThis.Headers(A);return Object.entries(K).forEach(([Y,z])=>{if(z!==void 0)q.set(Y,z)}),q}function $ZA(){return uJ1&&!1}function oq7(){return null}function aq7(){return uJ1&&iq7!==null&&!1}var Z2Y,uJ1=!1,iq7=null,G2Y="max";var BJ1=C(()=>{c6();Z2Y={}});function J_6(A){if($ZA())return rq7(A);return A}function _ZA(A){return A||$ZA()}function sq7(A){return $ZA()&&A.status===429}var WxA=C(()=>{BJ1();nN();z7()});function tq7(A){return W2Y.some((K)=>A.startsWith(K))}function eq7(A,K){if(A.isUsingOverage){if(A.overageStatus==="allowed_warning")return{message:"You're close to your extra usage spending limit",severity:"warning"};return null}if(A.status==="rejected")return{message:D2Y(A,K),severity:"error"};if(A.status==="allowed_warning"){if(A.utilization!==void 0&&A.utilization<0.7)return null;if(HI()){let z=sq(),w=z==="team"||z==="enterprise",H=x5()?.hasExtraUsageEnabled===!0;if(w&&H&&!fu())return null}let Y=j2Y(A);if(Y)return{message:Y,severity:"warning"}}return null}function O_6(A,K){let q=eq7(A,K);if(q&&q.severity==="error")return q.message;return null}function X_6(A,K){let q=eq7(A,K);if(q&&q.severity==="warning")return q.message;return null}function D2Y(A,K){let q=A.resetsAt,Y=q?m0A(q,!0):void 0,z=A.overageResetsAt?m0A(A.overageResetsAt,!0):void 0,w=Y?` · resets ${Y}`:"";if(A.overageStatus==="rejected"){let H="";if(q&&A.overageResetsAt)if(q<A.overageResetsAt)H=` · resets ${Y}`;else H=` · resets ${z}`;else if(Y)H=` · resets ${Y}`;else if(z)H=` · resets ${z}`;if(A.overageDisabledReason==="out_of_credits")return`You're out of extra usage${H}`;return ZZA("limit",H,K)}if(A.rateLimitType==="seven_day_sonnet"){let H=sq();return ZZA(H==="pro"||H==="enterprise"?"weekly limit":"Sonnet limit",w,K)}if(A.rateLimitType==="seven_day_opus")return ZZA("Opus limit",w,K);if(A.rateLimitType==="seven_day")return ZZA("weekly limit",w,K);if(A.rateLimitType==="five_hour")return ZZA("session limit",w,K);return ZZA("usage limit",w,K)}function j2Y(A){let K=null;switch(A.rateLimitType){case"seven_day":K="weekly limit";break;case"five_hour":K="session limit";break;case"seven_day_opus":K="Opus limit";break;case"seven_day_sonnet":K="Sonnet limit";break;case"overage":K="extra usage";break;case void 0:return null}let q=A.utilization?Math.floor(A.utilization*100):void 0,Y=A.resetsAt?m0A(A.resetsAt,!0):void 0,z=M2Y(A.rateLimitType);if(q&&Y){let H=`You've used ${q}% of your ${K} · resets ${Y}`;return z?`${H} · ${z}`:H}if(q){let H=`You've used ${q}% of your ${K}`;return z?`${H} · ${z}`:H}if(A.rateLimitType==="overage")K+=" limit";if(Y){let H=`Approaching ${K} · resets ${Y}`;return z?`${H} · ${z}`:H}let w=`Approaching ${K}`;return z?`${w} · ${z}`:w}function M2Y(A){let K=sq(),q=x5()?.hasExtraUsageEnabled===!0;if(A==="five_hour"){if(K==="team"||K==="enterprise"){if(!q&&FU())return"/extra-usage to request more";return null}if(K==="pro"||K==="max")return"/upgrade to keep using Claude Code"}if(A==="overage"){if(K==="team"||K==="enterprise"){if(!q&&FU())return"/extra-usage to request more"}}return null}function $_6(A){let K=A.resetsAt?m0A(A.resetsAt,!0):"",q="";if(A.rateLimitType==="five_hour")q="session limit";else if(A.rateLimitType==="seven_day")q="weekly limit";else if(A.rateLimitType==="seven_day_opus")q="Opus limit";else if(A.rateLimitType==="seven_day_sonnet"){let z=sq();q=z==="pro"||z==="enterprise"?"weekly limit":"Sonnet limit"}if(!q)return"Now using extra usage";return`You're now using extra usage${K?` · Your ${q} resets ${K}`:""}`}function ZZA(A,K,q){return`You've hit your ${A}${K}`}var W2Y;var __6=C(()=>{L4();c6();W2Y=["You've hit your","You've used","You're now using extra usage","You're close to","You're out of extra usage"]});function f2Y(A,K){let q=Date.now()/1000,Y=A-K,z=q-Y;return Math.max(0,Math.min(1,z/K))}function mJ1(A){Kf=A,Z_6.forEach((q)=>q(A));let K=Math.round((A.resetsAt?A.resetsAt-Date.now()/1000:0)/3600);n("tengu_claudeai_limits_status_changed",{status:A.status,unifiedRateLimitFallbackAvailable:A.unifiedRateLimitFallbackAvailable,hoursTillReset:K})}async function N2Y(){let A=_O(),K=await zI({maxRetries:0,model:A}),q=[{role:"user",content:"quota"}],Y=ET(A);return K.beta.messages.create({model:A,max_tokens:1,messages:q,metadata:go(),...Y.length>0?{betas:Y}:{}}).asResponse()}async function A57(){if(!_ZA(O4()))return;try{let A=await N2Y();G_6(A.headers)}catch(A){if(A instanceof e7)W_6(A)}}function po(){let[A,K]=gJ1.useState({...Kf});return gJ1.useEffect(()=>{let q=(Y)=>{K({...Y})};return Z_6.add(q),()=>{Z_6.delete(q)}},[]),A}function T2Y(A,K){for(let[q,Y]of Object.entries(V2Y)){let z=A.get(`anthropic-ratelimit-unified-${q}-surpassed-threshold`);if(z!==null){let w=A.get(`anthropic-ratelimit-unified-${q}-utilization`),H=A.get(`anthropic-ratelimit-unified-${q}-reset`),J=w?Number(w):void 0;return{status:"allowed_warning",resetsAt:H?Number(H):void 0,rateLimitType:Y,utilization:J,unifiedRateLimitFallbackAvailable:K,isUsingOverage:!1,surpassedThreshold:Number(z)}}}return null}function v2Y(A,K,q){let{rateLimitType:Y,claimAbbrev:z,windowSeconds:w,thresholds:H}=K,J=A.get(`anthropic-ratelimit-unified-${z}-utilization`),O=A.get(`anthropic-ratelimit-unified-${z}-reset`);if(J===null||O===null)return null;let X=Number(J),$=Number(O),_=f2Y($,w);if(!H.some((G)=>X>=G.utilization&&_<=G.timePct))return null;return{status:"allowed_warning",resetsAt:$,rateLimitType:Y,utilization:X,unifiedRateLimitFallbackAvailable:q,isUsingOverage:!1}}function E2Y(A,K){let q=T2Y(A,K);if(q)return q;for(let Y of P2Y){let z=v2Y(A,Y,K);if(z)return z}return null}function K57(A){let K=A.get("anthropic-ratelimit-unified-status")||"allowed",q=A.get("anthropic-ratelimit-unified-reset"),Y=q?Number(q):void 0,z=A.get("anthropic-ratelimit-unified-fallback")==="available",w=A.get("anthropic-ratelimit-unified-representative-claim"),H=A.get("anthropic-ratelimit-unified-overage-status"),J=A.get("anthropic-ratelimit-unified-overage-reset"),O=J?Number(J):void 0,X=A.get("anthropic-ratelimit-unified-overage-disabled-reason"),$=K==="rejected"&&(H==="allowed"||H==="allowed_warning"),_=K;if(K==="allowed"||K==="allowed_warning"){let Z=E2Y(A,z);if(Z)return Z;_="allowed"}return{status:_,resetsAt:Y,unifiedRateLimitFallbackAvailable:z,...w&&{rateLimitType:w},...H&&{overageStatus:H},...O&&{overageResetsAt:O},...X&&{overageDisabledReason:X},isUsingOverage:$}}function G_6(A){let K=O4();if(!_ZA(K)){if(Kf.status!=="allowed"||Kf.resetsAt)mJ1({status:"allowed",unifiedRateLimitFallbackAvailable:!1,isUsingOverage:!1});return}let q=J_6(A),Y=K57(q);if(!I1A(Kf,Y))mJ1(Y)}function W_6(A){if(!_ZA(O4())||A.status!==429)return;try{let K={...Kf};if(A.headers){let q=J_6(A.headers);K=K57(q)}if(K.status="rejected",!I1A(Kf,K))mJ1(K)}catch(K){KA(K)}}var gJ1,P2Y,V2Y,Kf,Z_6;var JI=C(()=>{JxA();v1();z7();i1();L4();lk();nN();Kw();Ox1();WxA();__6();gJ1=r($A(),1),P2Y=[{rateLimitType:"five_hour",claimAbbrev:"5h",windowSeconds:18000,thresholds:[{utilization:0.9,timePct:0.72}]},{rateLimitType:"seven_day",claimAbbrev:"7d",windowSeconds:604800,thresholds:[{utilization:0.75,timePct:0.6},{utilization:0.5,timePct:0.35},{utilization:0.25,timePct:0.15}]}],V2Y={"5h":"five_hour","7d":"seven_day",overage:"overage"};Kf={status:"allowed",unifiedRateLimitFallbackAvailable:!1,isUsingOverage:!1},Z_6=new Set});function DxA(A){if(!A||typeof A!=="object")return null;let K=A,q=5,Y=0;while(K&&Y<q){if(K instanceof Error&&"code"in K&&typeof K.code==="string"){let z=K.code,w=k2Y.has(z);return{code:z,message:K.message,isSSLError:w}}if(K instanceof Error&&"cause"in K&&K.cause!==K)K=K.cause,Y++;else break}return null}function C2Y(A){let K=A.message;if(!K)return"";if(K.includes("<!DOCTYPE html")||K.includes("<html")){let q=K.match(/<title>([^<]+)<\/title>/);if(q&&q[1])return q[1].trim();return""}return A.message}function q57(A){let K=DxA(A);if(K){let{code:Y,isSSLError:z}=K;if(Y==="ETIMEDOUT")return"Request timed out. Check your internet connection and proxy settings";if(z)switch(Y){case"UNABLE_TO_VERIFY_LEAF_SIGNATURE":case"UNABLE_TO_GET_ISSUER_CERT":case"UNABLE_TO_GET_ISSUER_CERT_LOCALLY":return"Unable to connect to API: SSL certificate verification failed. Check your proxy or corporate SSL certificates";case"CERT_HAS_EXPIRED":return"Unable to connect to API: SSL certificate has expired";case"CERT_REVOKED":return"Unable to connect to API: SSL certificate has been revoked";case"DEPTH_ZERO_SELF_SIGNED_CERT":case"SELF_SIGNED_CERT_IN_CHAIN":return"Unable to connect to API: Self-signed certificate detected. Check your proxy or corporate SSL certificates";case"ERR_TLS_CERT_ALTNAME_INVALID":case"HOSTNAME_MISMATCH":return"Unable to connect to API: SSL certificate hostname mismatch";case"CERT_NOT_YET_VALID":return"Unable to connect to API: SSL certificate is not yet valid";default:return`Unable to connect to API: SSL error (${Y})`}}if(A.message==="Connection error."){if(K?.code)return`Unable to connect to API (${K.code})`;return"Unable to connect to API. Check your internet connection"}let q=C2Y(A);return q!==A.message&&q.length>0?q:A.message}async function Nu(A,K){await new Promise((q,Y)=>{let z=setTimeout(q,A);if(K){let w=()=>{clearTimeout(z),Y(new m2)};if(K.aborted){w();return}K.addEventListener("abort",w,{once:!0}),setTimeout(()=>{K?.removeEventListener("abort",w)},A)}})}var k2Y;var QU=C(()=>{nN();k2Y=new Set(["UNABLE_TO_VERIFY_LEAF_SIGNATURE","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","CERT_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CERT_REVOKED","CERT_REJECTED","CERT_UNTRUSTED","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","CERT_CHAIN_TOO_LONG","PATH_LENGTH_EXCEEDED","ERR_TLS_CERT_ALTNAME_INVALID","HOSTNAME_MISMATCH","ERR_TLS_HANDSHAKE_TIMEOUT","ERR_SSL_WRONG_VERSION_NUMBER","ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC"])});function L2Y(A){if(typeof A!=="object"||A===null)return!1;let K=A;if(K.type!=="image")return!1;if(typeof K.source!=="object"||K.source===null)return!1;let q=K.source;return q.type==="base64"&&typeof q.data==="string"}function Y57(A){let K=[],q=0;for(let Y of A){if(typeof Y!=="object"||Y===null)continue;let z=Y;if(z.type!=="user")continue;let w=z.message;if(!w)continue;let H=w.content;if(typeof H==="string"||!Array.isArray(H))continue;for(let J of H)if(L2Y(J)){q++;let O=J.source.data.length;if(O>RJA)n("tengu_image_api_validation_failed",{base64_size_bytes:O,max_bytes:RJA}),K.push({index:q,size:O})}}if(K.length>0)throw new GZA(K,RJA)}var GZA;var FJ1=C(()=>{i1();b11();cx();GZA=class GZA extends Error{constructor(A,K){let q,Y=A[0];if(A.length===1&&Y)q=`Image base64 size (${iQ(Y.size)}) exceeds API limit (${iQ(K)}). Please resize the image before sending.`;else q=`${A.length} images exceed the API limit (${iQ(K)}): `+A.map((z)=>`Image ${z.index}: ${iQ(z.size)}`).join(", ")+". Please resize these images before sending.";super(q);this.name="ImageSizeError"}}});function R2Y(){return B7()?"PDF too large. Try reading the file a different way (e.g., extract text with a CLI tool).":"PDF too large. Please double press esc to edit your message and try again."}function y2Y(){return B7()?"PDF is password protected. Try using a CLI tool to extract or convert the PDF.":"PDF is password protected. Please double press esc to edit your message and try again."}function z57(){return B7()?"Image was too large. Try resizing the image or using a different approach.":"Image was too large. Double press esc to go back and try again with a smaller image."}function I2Y(){return B7()?"Request too large. Try with a smaller file.":"Request too large. Double press esc to go back and try with a smaller file."}function h2Y(A,K,q){try{let Y=-1;for(let J=0;J<q.length;J++){let O=q[J];if(!O)continue;let X=O.message.content;if(Array.isArray(X)){for(let $ of X)if($.type==="tool_use"&&"id"in $&&$.id===A){Y=J;break}}if(Y!==-1)break}let z=-1;for(let J=0;J<K.length;J++){let O=K[J];if(!O)continue;if(O.type==="assistant"&&"message"in O){let X=O.message.content;if(Array.isArray(X)){for(let $ of X)if($.type==="tool_use"&&"id"in $&&$.id===A){z=J;break}}}if(z!==-1)break}let w=[];for(let J=Y+1;J<q.length;J++){let O=q[J];if(!O)continue;let X=O.message.content;if(Array.isArray(X))for(let $ of X){let _=O.message.role;if($.type==="tool_use"&&"id"in $)w.push(`${_}:tool_use:${$.id}`);else if($.type==="tool_result"&&"tool_use_id"in $)w.push(`${_}:tool_result:${$.tool_use_id}`);else if($.type==="text")w.push(`${_}:text`);else if($.type==="thinking")w.push(`${_}:thinking`);else if($.type==="image")w.push(`${_}:image`);else w.push(`${_}:${$.type}`)}else if(typeof X==="string")w.push(`${O.message.role}:string_content`)}let H=[];for(let J=z+1;J<K.length;J++){let O=K[J];if(!O)continue;switch(O.type){case"user":case"assistant":{if("message"in O){let X=O.message.content;if(Array.isArray(X))for(let $ of X){let _=O.message.role;if($.type==="tool_use"&&"id"in $)H.push(`${_}:tool_use:${$.id}`);else if($.type==="tool_result"&&"tool_use_id"in $)H.push(`${_}:tool_result:${$.tool_use_id}`);else if($.type==="text")H.push(`${_}:text`);else if($.type==="thinking")H.push(`${_}:thinking`);else if($.type==="image")H.push(`${_}:image`);else H.push(`${_}:${$.type}`)}else if(typeof X==="string")H.push(`${O.message.role}:string_content`)}break}case"attachment":if("attachment"in O)H.push(`attachment:${O.attachment.type}`);break;case"system":if("subtype"in O)H.push(`system:${O.subtype}`);break;case"progress":if("progress"in O&&O.progress&&typeof O.progress==="object"&&"type"in O.progress)H.push(`progress:${O.progress.type??"unknown"}`);else H.push("progress:unknown");break}}n("tengu_tool_use_tool_result_mismatch_error",{toolUseId:A,normalizedSequence:w.join(", "),preNormalizedSequence:H.join(", "),normalizedMessageCount:q.length,originalMessageCount:K.length,normalizedToolUseIndex:Y,originalToolUseIndex:z})}catch(Y){}}function j_6(A,K,q){if(A instanceof Mb||A instanceof dj&&A.message.toLowerCase().includes("timeout"))return V2({content:cJ1,error:"unknown"});if(A instanceof GZA||A instanceof H7A)return V2({content:z57()});if(A instanceof Error&&A.message.includes(gKA))return V2({content:gKA,error:"rate_limit"});if(A instanceof e7&&A.status===429&&_ZA(O4())){let Y=A.headers?.get?.("anthropic-ratelimit-unified-representative-claim"),z=A.headers?.get?.("anthropic-ratelimit-unified-overage-status");if(Y||z){let w={status:"rejected",unifiedRateLimitFallbackAvailable:!1,isUsingOverage:!1},H=A.headers?.get?.("anthropic-ratelimit-unified-reset");if(H)w.resetsAt=Number(H);if(Y)w.rateLimitType=Y;if(z)w.overageStatus=z;let J=A.headers?.get?.("anthropic-ratelimit-unified-overage-reset");if(J)w.overageResetsAt=Number(J);let O=A.headers?.get?.("anthropic-ratelimit-unified-overage-disabled-reason");if(O)w.overageDisabledReason=O;let X=O_6(w,K);if(X)return V2({content:X,error:"rate_limit"});return V2({content:FKA,error:"rate_limit"})}return V2({content:`${J$}: Rate limit reached`,error:"rate_limit"})}if(A instanceof Error&&A.message.toLowerCase().includes("prompt is too long"))return V2({content:co,error:"invalid_request"});if(A instanceof Error&&/maximum of \d+ PDF pages/.test(A.message))return V2({content:R2Y(),error:"invalid_request"});if(A instanceof Error&&A.message.includes("The PDF specified is password protected"))return V2({content:y2Y(),error:"invalid_request"});if(A instanceof e7&&A.status===400&&A.message.includes("image exceeds")&&A.message.includes("maximum"))return V2({content:z57()});if(A instanceof e7&&A.status===413)return V2({content:I2Y(),error:"invalid_request"});if(A instanceof e7&&A.status===400&&A.message.includes("`tool_use` ids were found without `tool_result` blocks immediately after")){if(q?.messages&&q?.messagesForAPI){let Y=A.message.match(/toolu_[a-zA-Z0-9]+/),z=Y?Y[0]:null;if(z)h2Y(z,q.messages,q.messagesForAPI)}{let z=B7()?"":" Run /rewind to recover the conversation.";return V2({content:"API Error: 400 due to tool use concurrency issues."+z,error:"invalid_request"})}}if(A instanceof e7&&A.status===400&&A.message.includes("unexpected `tool_use_id` found in `tool_result`"))n("tengu_unexpected_tool_result",{});if(O4()&&A instanceof e7&&A.status===400&&A.message.toLowerCase().includes("invalid model name")&&(d0A(K)||K==="opus"))return V2({content:"Claude Opus is not available with the Claude Pro plan. If you have updated your subscription plan recently, run /logout and /login for the plan to take effect.",error:"invalid_request"});if(A instanceof Error&&A.message.includes("Your credit balance is too low"))return V2({content:QJ1,error:"billing_error"});if(A instanceof Error&&A.message.toLowerCase().includes("x-api-key")){let{source:Y}=Y0();return V2({error:"authentication_failed",content:Y==="ANTHROPIC_API_KEY"||Y==="apiKeyHelper"?pJ1:UJ1})}if(A instanceof e7&&A.status===403&&A.message.includes("OAuth token has been revoked"))return V2({error:"authentication_failed",content:dJ1});if(A instanceof e7&&(A.status===401||A.status===403)&&A.message.includes("OAuth authentication is currently not allowed for this organization"))return V2({error:"authentication_failed",content:S2Y});if(A instanceof e7&&(A.status===401||A.status===403))return V2({error:"authentication_failed",content:`${J$}: ${A.message} · Please run /login`});if(j1(process.env.CLAUDE_CODE_USE_BEDROCK)&&A instanceof Error&&A.message.toLowerCase().includes("model id"))return V2({content:`${J$} (${K}): ${A.message}`,error:"invalid_request"});if(A instanceof Error)return V2({content:`${J$}: ${A.message}`,error:"unknown"});return V2({content:J$,error:"unknown"})}function w57(A){if(A instanceof Error&&A.message==="Request was aborted.")return"aborted";if(A instanceof Mb||A instanceof dj&&A.message.toLowerCase().includes("timeout"))return"api_timeout";if(A instanceof Error&&A.message.includes(D_6))return"repeated_529";if(A instanceof Error&&A.message.includes(gKA))return"capacity_off_switch";if(A instanceof e7&&A.status===429)return"rate_limit";if(A instanceof e7&&(A.status===529||A.message?.includes('"type":"overloaded_error"')))return"server_overload";if(A instanceof Error&&A.message.toLowerCase().includes(co.toLowerCase()))return"prompt_too_long";if(A instanceof Error&&/maximum of \d+ PDF pages/.test(A.message))return"pdf_too_large";if(A instanceof Error&&A.message.includes("The PDF specified is password protected"))return"pdf_password_protected";if(A instanceof e7&&A.status===400&&A.message.includes("image exceeds")&&A.message.includes("maximum"))return"image_too_large";if(A instanceof e7&&A.status===400&&A.message.includes("`tool_use` ids were found without `tool_result` blocks immediately after"))return"tool_use_mismatch";if(A instanceof e7&&A.status===400&&A.message.includes("unexpected `tool_use_id` found in `tool_result`"))return"unexpected_tool_result";if(A instanceof e7&&A.status===400&&A.message.toLowerCase().includes("invalid model name"))return"invalid_model";if(A instanceof Error&&A.message.toLowerCase().includes(QJ1.toLowerCase()))return"credit_balance_low";if(A instanceof Error&&A.message.toLowerCase().includes("x-api-key"))return"invalid_api_key";if(A instanceof e7&&A.status===403&&A.message.includes("OAuth token has been revoked"))return"token_revoked";if(A instanceof e7&&(A.status===401||A.status===403)&&A.message.includes("OAuth authentication is currently not allowed for this organization"))return"oauth_org_not_allowed";if(A instanceof e7&&(A.status===401||A.status===403))return"auth_error";if(j1(process.env.CLAUDE_CODE_USE_BEDROCK)&&A instanceof Error&&A.message.toLowerCase().includes("model id"))return"bedrock_model_access";if(A instanceof e7){let K=A.status;if(K>=500)return"server_error";if(K>=400)return"client_error"}if(A instanceof dj){if(DxA(A)?.isSSLError)return"ssl_cert_error";return"connection_error"}return"unknown"}function H57(A,K){if(A!=="refusal")return;n("tengu_refusal_api_response",{});let q=B7()?`${J$}: Claude Code is unable to respond to this request, which appears to violate our Usage Policy (https://www.anthropic.com/legal/aup). Try rephrasing the request or attempting a different approach.`:`${J$}: Claude Code is unable to respond to this request, which appears to violate our Usage Policy (https://www.anthropic.com/legal/aup). Please double press esc to edit your last message or start a new session for Claude Code to assist with a different task.`;return V2({content:q+(K!=="claude-sonnet-4-20250514"?" If you are seeing this refusal repeatedly, try running /model claude-sonnet-4-20250514 to switch models.":""),error:"invalid_request"})}var J$="API Error",co="Prompt is too long",QJ1="Credit balance is too low",UJ1="Invalid API key · Please run /login",pJ1="Invalid API key · Fix external API key",QT="(no content)",dJ1="OAuth token revoked · Please run /login",D_6="Repeated 529 Overloaded errors",gKA="Opus is experiencing high load, please use /model to switch to Sonnet",cJ1="Request timed out",S2Y="Your account does not have access to Claude Code. Please run /login.";var UT=C(()=>{nN();L4();j8();z7();i1();JI();WxA();l6();s1();QU();FJ1();cx()});function M_6(A){let K=`Your task is to create a detailed summary of the conversation so far, paying close attention to the user's explicit requests and your previous actions.
 This summary should be thorough in capturing technical details, code patterns, and architectural decisions that would be essential for continuing development work without losing context.
 
@@ -3620,9 +3620,9 @@
 `),is_error:A}},async call(A,K,q,Y,z){if(A._simulatedSedEdit)return await Oy2(A._simulatedSedEdit,K,Y);let{abortController:w,readFileState:H,getAppState:J,setAppState:O,setToolJSX:X}=K,$=new rGA,_=new rGA,Z,G=0,W=!1,D,M=!!K.agentId;try{let o=Xy2({input:A,abortController:w,setAppState:O,setToolJSX:X,preventCwdChanges:M}),l;do if(l=await o.next(),!l.done&&z){let wA=l.value;z({toolUseID:`bash-progress-${G++}`,data:{type:"bash_progress",output:wA.output,fullOutput:wA.fullOutput,elapsedTimeSeconds:wA.elapsedTimeSeconds,totalLines:wA.totalLines}})}while(!l.done);if(D=l.value,wy2(A.command,D.code),$.append((D.stdout||"").trimEnd()+tUA),Z=nJK(A.command,D.code,D.stdout||"",D.stderr||""),D.stderr&&D.stderr.includes(".git/index.lock': File exists"))n("tengu_git_index_lock_error",{});if(Z.isError){if(_.append(D.stderr.trimEnd()+tUA),D.code!==0)_.append(`Exit code ${D.code}`)}else if(u3A(A.command)!==null)_.append(D.stderr.trimEnd()+tUA);else $.append(D.stderr.trimEnd()+tUA);if(!M){let wA=await J();if(YN1(wA.toolPermissionContext)){let HA=_.toString();_.clear(),_.append(qN1(HA))}}let e=I8.annotateStderrWithSandboxFailures(A.command,D.stderr||"");if(Z.isError)throw new vR(D.stdout,e,D.code,D.interrupted);W=D.interrupted}finally{if(X)X(null)}let P=$.toString(),V=_.toString();if(V4("tengu_bash_haiku_prefetch",!0)){let o=s7();SJK(A.command,P,o.signal,K.options.isNonInteractiveSession).then(async(l)=>{for(let e of l){let wA=rR2(e)?oR2(e):aR2(b1(),e);try{if(!(await F9.validateInput({file_path:wA},K)).result){H.delete(wA);continue}await F9.call({file_path:wA},K)}catch(HA){H.delete(wA),KA(HA)}}n("tengu_bash_tool_haiku_file_paths_read",{filePathsExtracted:l.length,readFileStateSize:H.size,readFileStateValuesCharLength:by(H).reduce((e,wA)=>{let HA=H.get(wA);return e+(HA?.content.length||0)},0)})}).catch((l)=>{if(l instanceof Error&&l.message.includes("Request was aborted"))return;KA(l)})}let N=A.command.split(" ")[0];n("tengu_bash_tool_command_executed",{command_type:N,stdout_length:P.length,stderr_length:V.length,exit_code:D.code,interrupted:W});let T=hZ7(A.command);if(T)n("tengu_code_indexing_tool_used",{tool:T,source:"cli",success:D.code===0});let E=sx6(P),R=sx6(V),b=tx6(E),S=void 0,B=E,x=R,F=void 0,Q=u3A(A.command);if(Q!==null){let o=await $y2(P,A.command,Q);if(o!==null)B=o.stdout,F=o.structuredContent,S=o.rawOutputPath}let u=B;if(b){let o=B.trim().match(/^data:([^;]+);base64,(.+)$/);if(o&&o[1]&&o[2]){let l=o[1],e=o[2],wA=Buffer.from(e,"base64"),HA=await J7A(wA,void 0,l);u=`data:${HA.mediaType};base64,${HA.base64}`}}return{data:{stdout:u,stderr:x,rawOutputPath:S,interrupted:W,isImage:b,returnCodeInterpretation:Z?.message,backgroundTaskId:D.backgroundTaskId,backgroundedByUser:D.backgroundedByUser,structuredContent:F,dangerouslyDisableSandbox:"dangerouslyDisableSandbox"in A?A.dangerouslyDisableSandbox:void 0}}},renderToolUseErrorMessage:B4K}});import{randomUUID as _y2}from"crypto";async function Ns(A,K,q){let Y=A;return await Promise.all([...A.matchAll(Zy2),...A.matchAll(Gy2)].map(async(z)=>{let w=z[1]?.trim();if(w)try{let H=await j_(o7,{command:w},K,OL({content:[]}),"");if(H.behavior!=="allow")throw h(`Bash command permission check failed for command in ${q}: ${w}. Error: ${H.message}`),new ih(`Bash command permission check failed for pattern "${z[0]}": ${H.message||"Permission denied"}`);let{data:J}=await o7.call({command:w},K),O=await d01(o7,J,_y2()),X=typeof O.content==="string"?O.content:eJK(J.stdout,J.stderr);Y=Y.replace(z[0],X)}catch(H){if(H instanceof ih)throw H;Wy2(H,z[0])}})),Y}function eJK(A,K,q=!1){let Y=[];if(A.trim())Y.push(A.trim());if(K.trim())if(q)Y.push(`[stderr: ${K.trim()}]`);else Y.push(`[stderr]
 ${K.trim()}`);return Y.join(q?" ":`
 `)}function Wy2(A,K,q=!1){if(A instanceof vR){if(A.interrupted)throw new ih(`Bash command interrupted for pattern "${K}": [Command interrupted]`);let w=eJK(A.stdout,A.stderr,q);throw new ih(`Bash command failed for pattern "${K}": ${w}`)}let Y=A instanceof Error?A.message:String(A),z=q?`[Error: ${Y}]`:`[Error]
-${Y}`;throw new ih(z)}var Zy2,Gy2;var gWA=C(()=>{IZ();iw();W1();B2();j8();Xa();Zy2=/```!\s*\n?([\s\S]*?)\n?```/g,Gy2=/(?<!\w|\$)!`([^`]+)`/g});import{join as eMA,basename as APA,dirname as tt}from"path";function ON1(A){return/^skill\.md$/i.test(APA(A))}function Dy2(A,K,q){if(ON1(A)){let z=tt(A),w=tt(z),H=APA(z),J=w.startsWith(K)?w.slice(K.length).replace(/^\//,""):"",O=J?J.split("/").join(":"):"";return O?`${q}:${O}:${H}`:`${q}:${H}`}else{let z=tt(A),w=APA(A).replace(/\.md$/,""),H=z.startsWith(K)?z.slice(K.length).replace(/^\//,""):"",J=H?H.split("/").join(":"):"";return J?`${q}:${J}:${w}`:`${q}:${w}`}}function jy2(A,K,q){let Y=[],z=xA();function w(H){try{let J=z.readdirSync(H);if(J.some((X)=>X.isFile()&&ON1(X.name))){for(let X of J)if(X.isFile()&&X.name.toLowerCase().endsWith(".md")){let $=eMA(H,X.name);if(Sh(z,$,q))continue;let _=z.readFileSync($,{encoding:"utf-8"}),{frontmatter:Z,content:G}=z_(_);Y.push({filePath:$,baseDir:K,frontmatter:Z,content:G})}return}for(let X of J){let $=eMA(H,X.name);if(X.isDirectory())w($);else if(X.isFile()&&X.name.toLowerCase().endsWith(".md")){if(Sh(z,$,q))continue;let _=z.readFileSync($,{encoding:"utf-8"}),{frontmatter:Z,content:G}=z_(_);Y.push({filePath:$,baseDir:K,frontmatter:Z,content:G})}}}catch(J){h(`Failed to scan directory ${H}: ${J}`,{level:"error"})}}return w(A),Y}function My2(A){let K=new Map;for(let Y of A){let z=tt(Y.filePath),w=K.get(z)??[];w.push(Y),K.set(z,w)}let q=[];for(let[Y,z]of K){let w=z.filter((H)=>ON1(H.filePath));if(w.length>0){let H=w[0];if(w.length>1)h(`Multiple skill files found in ${Y}, using ${APA(H.filePath)}`);q.push(H)}else q.push(...z)}return q}async function AOK(A,K,q,Y,z,w={isSkillMode:!1},H=new Set){let J=jy2(A,A,H),O=My2(J),X=[];for(let $ of O){let _=Dy2($.filePath,$.baseDir,K),Z=eUA(_,$,q,Y,z,ON1($.filePath),w);if(Z)X.push(Z)}return X}function eUA(A,K,q,Y,z,w,H={isSkillMode:!1}){try{let{frontmatter:J,content:O}=K,X=J.description??gQ(O,w?"Plugin skill":"Plugin command"),$=J["allowed-tools"],_=typeof $==="string"?OBA($,z):Array.isArray($)?$.map((E)=>typeof E==="string"?OBA(E,z):E):$,Z=Sy(_),G=J["argument-hint"],W=rBA(J.arguments),D=J.when_to_use,j=J.version,M=J.name,P=J.model==="inherit"?void 0:J.model?jw(J.model):void 0,V=J["disable-model-invocation"],N;if(H.isSkillMode)N=V===void 0?!1:j1(V);else N=j1(V);let T=H.isSkillMode?!0:!1;return{type:"prompt",name:A,description:X,hasUserSpecifiedDescription:!!J.description,allowedTools:Z,argumentHint:G,argNames:W.length>0?W:void 0,whenToUse:D,version:j,model:P,disableModelInvocation:N,contentLength:O.length,source:"plugin",loadedFrom:w||H.isSkillMode?"plugin":void 0,pluginInfo:{pluginManifest:Y,repository:q},isEnabled:()=>!0,isHidden:T,progressMessage:w||H.isSkillMode?"loading":"running",userFacingName(){return M||A},async getPromptForCommand(E,R){let b=H.isSkillMode?`Base directory for this skill: ${tt(K.filePath)}
+${Y}`;throw new ih(z)}var Zy2,Gy2;var gWA=C(()=>{IZ();iw();W1();B2();j8();Xa();Zy2=/```!\s*\n?([\s\S]*?)\n?```/g,Gy2=/(?<!\w|\$)!`([^`]+)`/g});import{join as eMA,basename as APA,dirname as tt}from"path";function ON1(A){return/^skill\.md$/i.test(APA(A))}function Dy2(A,K,q){if(ON1(A)){let z=tt(A),w=tt(z),H=APA(z),J=w.startsWith(K)?w.slice(K.length).replace(/^\//,""):"",O=J?J.split("/").join(":"):"";return O?`${q}:${O}:${H}`:`${q}:${H}`}else{let z=tt(A),w=APA(A).replace(/\.md$/,""),H=z.startsWith(K)?z.slice(K.length).replace(/^\//,""):"",J=H?H.split("/").join(":"):"";return J?`${q}:${J}:${w}`:`${q}:${w}`}}function __pluginDirCacheKey(A,K,q,Y){return osK("sha256").update(`${A}:${K}:${q||""}:${Y||""}`).digest("hex").slice(0,16)}function __pluginDirCacheRead(A,K,q,Y){let z=xA(),w=n91(H8(),"cache","plugin-dir-search"),H=__pluginDirCacheKey(A,K,q,Y),J=n91(w,`${H}.json`);try{let O=z.readFileSync(J,{encoding:"utf-8"}),X=JSON.parse(O);if(!X||X.v!==1||!X.dirMtimes||!X.fileMtimes||!Array.isArray(X.entries))return null;for(let $ in X.dirMtimes){try{if(z.statSync($).mtimeMs!==X.dirMtimes[$])return null}catch{return null}}for(let $ in X.fileMtimes){try{if(z.statSync($).mtimeMs!==X.fileMtimes[$])return null}catch{return null}}return X}catch{return null}}function __pluginDirCacheWrite(A,K,q,Y,z,w,H,J){let O=xA(),X=n91(H8(),"cache","plugin-dir-search"),$=__pluginDirCacheKey(A,K,q,Y),_=n91(X,`${$}.json`);try{O.mkdirSync(X,{recursive:!0})}catch{}try{let Z={},G={};for(let W of z)try{Z[W]=O.statSync(W).mtimeMs}catch{Z[W]=null}for(let W of w)try{G[W]=O.statSync(W).mtimeMs}catch{}O.writeFileSync(_,JSON.stringify({v:1,dirMtimes:Z,fileMtimes:G,entries:H,filePaths:J}),{encoding:"utf-8"})}catch{}}function jy2(A,K,q){let Y=[],z=xA(),w=__pluginDirCacheRead("plugin-commands",A,"","");if(w){let J=w.entries||[],O=w.filePaths||[],X=[];for(let $=0;$<J.length;$++){let _=O[$]||J[$]?.filePath;if(_&&Sh(z,_,q))continue;X.push(J[$])}return X}let H=new Set,J=new Set;function O(X){try{H.add(X);let $=z.readdirSync(X);if($.some((G)=>G.isFile()&&ON1(G.name))){for(let G of $)if(G.isFile()&&G.name.toLowerCase().endsWith(".md")){let W=eMA(X,G.name);if(Sh(z,W,q))continue;let D=z.readFileSync(W,{encoding:"utf-8"}),{frontmatter:j,content:M}=z_(D);Y.push({filePath:W,baseDir:K,frontmatter:j,content:M}),J.add(W)}return}for(let G of $){let W=eMA(X,G.name);if(G.isDirectory())O(W);else if(G.isFile()&&G.name.toLowerCase().endsWith(".md")){if(Sh(z,W,q))continue;let D=z.readFileSync(W,{encoding:"utf-8"}),{frontmatter:j,content:M}=z_(D);Y.push({filePath:W,baseDir:K,frontmatter:j,content:M}),J.add(W)}}}catch($){h(`Failed to scan directory ${X}: ${$}`,{level:"error"})}}return O(A),__pluginDirCacheWrite("plugin-commands",A,"","",Array.from(H),Array.from(J),Y,Array.from(J)),Y}function My2(A){let K=new Map;for(let Y of A){let z=tt(Y.filePath),w=K.get(z)??[];w.push(Y),K.set(z,w)}let q=[];for(let[Y,z]of K){let w=z.filter((H)=>ON1(H.filePath));if(w.length>0){let H=w[0];if(w.length>1)h(`Multiple skill files found in ${Y}, using ${APA(H.filePath)}`);q.push(H)}else q.push(...z)}return q}async function AOK(A,K,q,Y,z,w={isSkillMode:!1},H=new Set){let J=jy2(A,A,H),O=My2(J),X=[];for(let $ of O){let _=Dy2($.filePath,$.baseDir,K),Z=eUA(_,$,q,Y,z,ON1($.filePath),w);if(Z)X.push(Z)}return X}function eUA(A,K,q,Y,z,w,H={isSkillMode:!1}){try{let{frontmatter:J,content:O}=K,X=J.description??gQ(O,w?"Plugin skill":"Plugin command"),$=J["allowed-tools"],_=typeof $==="string"?OBA($,z):Array.isArray($)?$.map((E)=>typeof E==="string"?OBA(E,z):E):$,Z=Sy(_),G=J["argument-hint"],W=rBA(J.arguments),D=J.when_to_use,j=J.version,M=J.name,P=J.model==="inherit"?void 0:J.model?jw(J.model):void 0,V=J["disable-model-invocation"],N;if(H.isSkillMode)N=V===void 0?!1:j1(V);else N=j1(V);let T=H.isSkillMode?!0:!1;return{type:"prompt",name:A,description:X,hasUserSpecifiedDescription:!!J.description,allowedTools:Z,argumentHint:G,argNames:W.length>0?W:void 0,whenToUse:D,version:j,model:P,disableModelInvocation:N,contentLength:O.length,source:"plugin",loadedFrom:w||H.isSkillMode?"plugin":void 0,pluginInfo:{pluginManifest:Y,repository:q},isEnabled:()=>!0,isHidden:T,progressMessage:w||H.isSkillMode?"loading":"running",userFacingName(){return M||A},async getPromptForCommand(E,R){let b=H.isSkillMode?`Base directory for this skill: ${tt(K.filePath)}
 
-${O}`:O;return b=OWA(b,E,!0,W),b=OBA(b,z),b=b.replace(/\$\{CLAUDE_SESSION_ID\}/g,F1()),b=await Ns(b,{...R,async getAppState(){let S=await R.getAppState();return{...S,toolPermissionContext:{...S.toolPermissionContext,alwaysAllowRules:{...S.toolPermissionContext.alwaysAllowRules,command:Z}}}}},`/${A}`),[{type:"text",text:b}]}}}catch(J){return h(`Failed to create command from ${K.filePath}: ${J}`,{level:"error"}),null}}function XN1(){w9A.cache?.clear?.()}async function KOK(A,K,q,Y,z,w){let H=xA(),J=[];try{if(!H.existsSync(A))return[];let O=eMA(A,"SKILL.md");if(H.existsSync(O)){if(Sh(H,O,w))return J;try{let $=H.readFileSync(O,{encoding:"utf-8"}),{frontmatter:_,content:Z}=z_($),G=`${K}:${APA(A)}`,W={filePath:O,baseDir:tt(O),frontmatter:_,content:Z},D=eUA(G,W,q,Y,z,!0,{isSkillMode:!0});if(D)J.push(D)}catch($){h(`Failed to load skill from ${O}: ${$}`,{level:"error"})}return J}let X=H.readdirSync(A);for(let $ of X){if(!$.isDirectory()&&!$.isSymbolicLink())continue;let _=eMA(A,$.name),Z=eMA(_,"SKILL.md");if(H.existsSync(Z)){if(Sh(H,Z,w))continue;try{let G=H.readFileSync(Z,{encoding:"utf-8"}),{frontmatter:W,content:D}=z_(G),j=`${K}:${$.name}`,M={filePath:Z,baseDir:tt(Z),frontmatter:W,content:D},P=eUA(j,M,q,Y,z,!0,{isSkillMode:!0});if(P)J.push(P)}catch(G){h(`Failed to load skill from ${Z}: ${G}`,{level:"error"})}}}}catch(O){h(`Failed to load skills from directory ${A}: ${O}`,{level:"error"})}return J}function qOK(){wu6.cache?.clear?.()}var w9A,wu6;var ApA=C(()=>{d7();s6();d0();W1();gWA();QQ();mQ();l6();aX1();z7();s1();oBA();w9A=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.commandsPath)try{let w=await AOK(Y.commandsPath,Y.name,Y.source,Y.manifest,Y.path,{isSkillMode:!1},z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} commands from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load commands from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.commandsPaths){h(`Plugin ${Y.name} has commandsPaths: ${Y.commandsPaths.join(", ")}`);for(let w of Y.commandsPaths)try{let H=xA(),J=H.statSync(w);if(h(`Checking commandPath ${w} - isDirectory: ${J.isDirectory()}, isFile: ${J.isFile()}`),J.isDirectory()){let O=await AOK(w,Y.name,Y.source,Y.manifest,Y.path,{isSkillMode:!1},z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} commands from plugin ${Y.name} custom path: ${w}`);else h(`Warning: No commands found in plugin ${Y.name} custom directory: ${w}. Expected .md files or SKILL.md in subdirectories.`,{level:"warn"})}else if(J.isFile()&&w.endsWith(".md")){if(Sh(H,w,z))continue;let O=H.readFileSync(w,{encoding:"utf-8"}),{frontmatter:X,content:$}=z_(O),_,Z;if(Y.commandsMetadata){for(let[j,M]of Object.entries(Y.commandsMetadata))if(M.source){let P=eMA(Y.path,M.source);if(w===P){_=`${Y.name}:${j}`,Z=M;break}}}if(!_)_=`${Y.name}:${APA(w).replace(/\.md$/,"")}`;let G=Z?{...X,...Z.description&&{description:Z.description},...Z.argumentHint&&{"argument-hint":Z.argumentHint},...Z.model&&{model:Z.model},...Z.allowedTools&&{"allowed-tools":Z.allowedTools.join(",")}}:X,W={filePath:w,baseDir:tt(w),frontmatter:G,content:$},D=eUA(_,W,Y.source,Y.manifest,Y.path,!1);if(D)q.push(D),h(`Loaded command from plugin ${Y.name} custom file: ${w}${Z?" (with metadata override)":""}`)}}catch(H){h(`Failed to load commands from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}if(Y.commandsMetadata){for(let[w,H]of Object.entries(Y.commandsMetadata))if(H.content&&!H.source)try{let{frontmatter:J,content:O}=z_(H.content),X={...J,...H.description&&{description:H.description},...H.argumentHint&&{"argument-hint":H.argumentHint},...H.model&&{model:H.model},...H.allowedTools&&{"allowed-tools":H.allowedTools.join(",")}},$=`${Y.name}:${w}`,_={filePath:`<inline:${$}>`,baseDir:Y.path,frontmatter:X,content:O},Z=eUA($,_,Y.source,Y.manifest,Y.path,!1);if(Z)q.push(Z),h(`Loaded inline content command from plugin ${Y.name}: ${$}`)}catch(J){h(`Failed to load inline content command ${w} from plugin ${Y.name}: ${J}`,{level:"error"})}}}return h(`Total plugin commands loaded: ${q.length}`),q});wu6=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);h(`getPluginSkills: Processing ${A.length} enabled plugins`);for(let Y of A){let z=new Set;if(h(`Checking plugin ${Y.name}: skillsPath=${Y.skillsPath?"exists":"none"}, skillsPaths=${Y.skillsPaths?Y.skillsPaths.length:0} paths`),Y.skillsPath){h(`Attempting to load skills from plugin ${Y.name} default skillsPath: ${Y.skillsPath}`);try{let w=await KOK(Y.skillsPath,Y.name,Y.source,Y.manifest,Y.path,z);q.push(...w),h(`Loaded ${w.length} skills from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load skills from plugin ${Y.name} default directory: ${w}`,{level:"error"})}}if(Y.skillsPaths){h(`Attempting to load skills from plugin ${Y.name} skillsPaths: ${Y.skillsPaths.join(", ")}`);for(let w of Y.skillsPaths)try{h(`Loading from skillPath: ${w} for plugin ${Y.name}`);let H=await KOK(w,Y.name,Y.source,Y.manifest,Y.path,z);q.push(...H),h(`Loaded ${H.length} skills from plugin ${Y.name} custom path: ${w}`)}catch(H){h(`Failed to load skills from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}}return h(`Total plugin skills loaded: ${q.length}`),q})});import{existsSync as Hu6,readdirSync as Py2,rmSync as zOK,statSync as Vy2,unlinkSync as fy2}from"fs";import{join as $N1}from"path";function vy2(){US(),XN1(),Uq7(),Zx6(),Xu6()}function xw(){vy2(),$m(),UQA()}function KPA(A){try{b8(Ou6(A),`${Date.now()}`,{encoding:"utf-8"})}catch(K){h(`Failed to write .orphaned_at: ${A}: ${K}`)}}async function Ju6(){try{let A=ky2();if(!A)return;let K=Br();if(!Hu6(K))return;let q=Date.now();for(let Y of A)Ey2(Y);for(let Y of _N1(K)){let z=$N1(K,Y);for(let w of _N1(z)){let H=$N1(z,w);for(let J of _N1(H)){let O=$N1(H,J);if(A.has(O))continue;Cy2(O,q)}YOK(H)}YOK(z)}}catch(A){h(`Plugin cache cleanup failed: ${A}`)}}function Ou6(A){return $N1(A,Ny2)}function Ey2(A){let K=Ou6(A);if(Hu6(K))try{fy2(K)}catch(q){h(`Failed to remove .orphaned_at: ${A}: ${q}`)}}function ky2(){try{let A=new Set,K=ur();for(let q of Object.values(K.plugins))for(let Y of q)A.add(Y.installPath);return A}catch(A){return h(`Failed to load installed plugins: ${A}`),null}}function Cy2(A,K){let q=Ou6(A);if(!Hu6(q)){KPA(A);return}try{let Y=Vy2(q).mtimeMs;if(K-Y>Ty2)zOK(A,{recursive:!0,force:!0})}catch(Y){h(`Failed to delete orphaned version: ${A}: ${Y}`)}}function YOK(A){if(_N1(A).length===0)try{zOK(A,{recursive:!0,force:!0})}catch(K){h(`Failed to remove empty dir: ${A}: ${K}`)}}function _N1(A){try{return Py2(A,{withFileTypes:!0}).filter((K)=>K.isDirectory()).map((K)=>K.name)}catch{return[]}}var Ny2=".orphaned_at",Ty2=604800000;var ML=C(()=>{h1();d0();ApA();ZxA();mUA();ZN1();OX();uG();W1();pQA()});import{join as XP,basename as wOK,dirname as HOK}from"path";function DN1(){return XP(CT(),"known_marketplaces.json")}function JOK(){return XP(CT(),"marketplaces")}function YPA(){HM.cache?.clear?.()}async function U3(){let A=xA(),K=DN1();if(!A.existsSync(K))return{};try{let q=A.readFileSync(K,{encoding:"utf-8"}),Y=X6(q),z=u96.safeParse(Y);if(!z.success){let w=`Marketplace configuration file is corrupted: ${z.error.issues.map((H)=>`${H.path.join(".")}: ${H.message}`).join(", ")}`;throw h(w,{level:"error"}),new KV(w,K,Y)}return z.data}catch(q){if(q instanceof KV)throw q;let Y=`Failed to load marketplace configuration: ${q instanceof Error?q.message:String(q)}`;throw h(Y,{level:"error"}),Error(Y)}}async function zPA(A){let K=u96.safeParse(A),q=DN1();if(!K.success)throw new KV(`Invalid marketplace config: ${K.error.message}`,q,A);let Y=xA(),z=XP(q,"..");Y.mkdirSync(z),b8(q,QA(K.data,null,2),{encoding:"utf-8",flush:!0})}async function Ly2(A,K,q){let Y={...process.env,...OOK},z=q?.disableCredentialHelper?["-c","credential.helper="]:[];if(K){let H=await T7("git",[...z,"fetch","origin",K],{cwd:A,timeout:30000,stdin:"ignore",env:Y});if(H.code!==0)return GN1(H);let J=await T7("git",[...z,"checkout",K],{cwd:A,timeout:30000,stdin:"ignore",env:Y});if(J.code!==0)return GN1(J);let O=await T7("git",[...z,"pull","origin","HEAD"],{cwd:A,timeout:30000,stdin:"ignore",env:Y});return GN1(O)}let w=await T7("git",[...z,"pull","origin","HEAD"],{cwd:A,timeout:30000,stdin:"ignore",env:Y});return GN1(w)}function GN1(A){if(A.code!==0&&A.stderr){if(A.stderr.includes("Permission denied (publickey)")||A.stderr.includes("Could not read from remote repository"))return{...A,stderr:`SSH authentication failed while updating marketplace. Please ensure your SSH keys are configured.
+${O}`:O;return b=OWA(b,E,!0,W),b=OBA(b,z),b=b.replace(/\$\{CLAUDE_SESSION_ID\}/g,F1()),b=await Ns(b,{...R,async getAppState(){let S=await R.getAppState();return{...S,toolPermissionContext:{...S.toolPermissionContext,alwaysAllowRules:{...S.toolPermissionContext.alwaysAllowRules,command:Z}}}}},`/${A}`),[{type:"text",text:b}]}}}catch(J){return h(`Failed to create command from ${K.filePath}: ${J}`,{level:"error"}),null}}function XN1(){w9A.cache?.clear?.()}async function KOK(A,K,q,Y,z,w){let H=xA(),J=[],O=__pluginDirCacheRead("plugin-skills",A,K,q);if(O){let X=O.entries||[],$=O.filePaths||[],_=[],Z=0;for(;Z<X.length;Z++){let G=$[Z];if(G&&Sh(H,G,w))continue;_.push(X[Z])}return _}let X=new Set,$=new Set;try{if(!H.existsSync(A))return[];X.add(A);let _=eMA(A,"SKILL.md");if(H.existsSync(_)){if(Sh(H,_,w))return J;try{let G=H.readFileSync(_,{encoding:"utf-8"}),{frontmatter:W,content:D}=z_(G),j=`${K}:${APA(A)}`,M={filePath:_,baseDir:tt(_),frontmatter:W,content:D},P=eUA(j,M,q,Y,z,!0,{isSkillMode:!0});if(P)J.push(P),$.add(_)}catch(G){h(`Failed to load skill from ${_}: ${G}`,{level:"error"})}return __pluginDirCacheWrite("plugin-skills",A,K,q,Array.from(X),Array.from($),J,Array.from($)),J}let Z=H.readdirSync(A);for(let G of Z){if(!G.isDirectory()&&!G.isSymbolicLink())continue;let W=eMA(A,G.name);X.add(W);let D=eMA(W,"SKILL.md");if(H.existsSync(D)){if(Sh(H,D,w))continue;try{let j=H.readFileSync(D,{encoding:"utf-8"}),{frontmatter:M,content:P}=z_(j),V=`${K}:${G.name}`,N={filePath:D,baseDir:tt(D),frontmatter:M,content:P},T=eUA(V,N,q,Y,z,!0,{isSkillMode:!0});if(T)J.push(T),$.add(D)}catch(j){h(`Failed to load skill from ${D}: ${j}`,{level:"error"})}}}}catch(O){h(`Failed to load skills from directory ${A}: ${O}`,{level:"error"})}return __pluginDirCacheWrite("plugin-skills",A,K,q,Array.from(X),Array.from($),J,Array.from($)),J}function qOK(){wu6.cache?.clear?.()}var w9A,wu6;var ApA=C(()=>{d7();s6();d0();W1();gWA();QQ();mQ();l6();aX1();z7();s1();oBA();w9A=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.commandsPath)try{let w=await AOK(Y.commandsPath,Y.name,Y.source,Y.manifest,Y.path,{isSkillMode:!1},z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} commands from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load commands from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.commandsPaths){h(`Plugin ${Y.name} has commandsPaths: ${Y.commandsPaths.join(", ")}`);for(let w of Y.commandsPaths)try{let H=xA(),J=H.statSync(w);if(h(`Checking commandPath ${w} - isDirectory: ${J.isDirectory()}, isFile: ${J.isFile()}`),J.isDirectory()){let O=await AOK(w,Y.name,Y.source,Y.manifest,Y.path,{isSkillMode:!1},z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} commands from plugin ${Y.name} custom path: ${w}`);else h(`Warning: No commands found in plugin ${Y.name} custom directory: ${w}. Expected .md files or SKILL.md in subdirectories.`,{level:"warn"})}else if(J.isFile()&&w.endsWith(".md")){if(Sh(H,w,z))continue;let O=H.readFileSync(w,{encoding:"utf-8"}),{frontmatter:X,content:$}=z_(O),_,Z;if(Y.commandsMetadata){for(let[j,M]of Object.entries(Y.commandsMetadata))if(M.source){let P=eMA(Y.path,M.source);if(w===P){_=`${Y.name}:${j}`,Z=M;break}}}if(!_)_=`${Y.name}:${APA(w).replace(/\.md$/,"")}`;let G=Z?{...X,...Z.description&&{description:Z.description},...Z.argumentHint&&{"argument-hint":Z.argumentHint},...Z.model&&{model:Z.model},...Z.allowedTools&&{"allowed-tools":Z.allowedTools.join(",")}}:X,W={filePath:w,baseDir:tt(w),frontmatter:G,content:$},D=eUA(_,W,Y.source,Y.manifest,Y.path,!1);if(D)q.push(D),h(`Loaded command from plugin ${Y.name} custom file: ${w}${Z?" (with metadata override)":""}`)}}catch(H){h(`Failed to load commands from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}if(Y.commandsMetadata){for(let[w,H]of Object.entries(Y.commandsMetadata))if(H.content&&!H.source)try{let{frontmatter:J,content:O}=z_(H.content),X={...J,...H.description&&{description:H.description},...H.argumentHint&&{"argument-hint":H.argumentHint},...H.model&&{model:H.model},...H.allowedTools&&{"allowed-tools":H.allowedTools.join(",")}},$=`${Y.name}:${w}`,_={filePath:`<inline:${$}>`,baseDir:Y.path,frontmatter:X,content:O},Z=eUA($,_,Y.source,Y.manifest,Y.path,!1);if(Z)q.push(Z),h(`Loaded inline content command from plugin ${Y.name}: ${$}`)}catch(J){h(`Failed to load inline content command ${w} from plugin ${Y.name}: ${J}`,{level:"error"})}}}return h(`Total plugin commands loaded: ${q.length}`),q});wu6=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);h(`getPluginSkills: Processing ${A.length} enabled plugins`);for(let Y of A){let z=new Set;if(h(`Checking plugin ${Y.name}: skillsPath=${Y.skillsPath?"exists":"none"}, skillsPaths=${Y.skillsPaths?Y.skillsPaths.length:0} paths`),Y.skillsPath){h(`Attempting to load skills from plugin ${Y.name} default skillsPath: ${Y.skillsPath}`);try{let w=await KOK(Y.skillsPath,Y.name,Y.source,Y.manifest,Y.path,z);q.push(...w),h(`Loaded ${w.length} skills from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load skills from plugin ${Y.name} default directory: ${w}`,{level:"error"})}}if(Y.skillsPaths){h(`Attempting to load skills from plugin ${Y.name} skillsPaths: ${Y.skillsPaths.join(", ")}`);for(let w of Y.skillsPaths)try{h(`Loading from skillPath: ${w} for plugin ${Y.name}`);let H=await KOK(w,Y.name,Y.source,Y.manifest,Y.path,z);q.push(...H),h(`Loaded ${H.length} skills from plugin ${Y.name} custom path: ${w}`)}catch(H){h(`Failed to load skills from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}}return h(`Total plugin skills loaded: ${q.length}`),q})});import{existsSync as Hu6,readdirSync as Py2,rmSync as zOK,statSync as Vy2,unlinkSync as fy2}from"fs";import{join as $N1}from"path";function vy2(){US(),XN1(),Uq7(),Zx6(),Xu6()}function xw(){vy2(),$m(),UQA()}function KPA(A){try{b8(Ou6(A),`${Date.now()}`,{encoding:"utf-8"})}catch(K){h(`Failed to write .orphaned_at: ${A}: ${K}`)}}async function Ju6(){try{let A=ky2();if(!A)return;let K=Br();if(!Hu6(K))return;let q=Date.now();for(let Y of A)Ey2(Y);for(let Y of _N1(K)){let z=$N1(K,Y);for(let w of _N1(z)){let H=$N1(z,w);for(let J of _N1(H)){let O=$N1(H,J);if(A.has(O))continue;Cy2(O,q)}YOK(H)}YOK(z)}}catch(A){h(`Plugin cache cleanup failed: ${A}`)}}function Ou6(A){return $N1(A,Ny2)}function Ey2(A){let K=Ou6(A);if(Hu6(K))try{fy2(K)}catch(q){h(`Failed to remove .orphaned_at: ${A}: ${q}`)}}function ky2(){try{let A=new Set,K=ur();for(let q of Object.values(K.plugins))for(let Y of q)A.add(Y.installPath);return A}catch(A){return h(`Failed to load installed plugins: ${A}`),null}}function Cy2(A,K){let q=Ou6(A);if(!Hu6(q)){KPA(A);return}try{let Y=Vy2(q).mtimeMs;if(K-Y>Ty2)zOK(A,{recursive:!0,force:!0})}catch(Y){h(`Failed to delete orphaned version: ${A}: ${Y}`)}}function YOK(A){if(_N1(A).length===0)try{zOK(A,{recursive:!0,force:!0})}catch(K){h(`Failed to remove empty dir: ${A}: ${K}`)}}function _N1(A){try{return Py2(A,{withFileTypes:!0}).filter((K)=>K.isDirectory()).map((K)=>K.name)}catch{return[]}}var Ny2=".orphaned_at",Ty2=604800000;var ML=C(()=>{h1();d0();ApA();ZxA();mUA();ZN1();OX();uG();W1();pQA()});import{join as XP,basename as wOK,dirname as HOK}from"path";function DN1(){return XP(CT(),"known_marketplaces.json")}function JOK(){return XP(CT(),"marketplaces")}function YPA(){HM.cache?.clear?.()}async function U3(){let A=xA(),K=DN1();if(!A.existsSync(K))return{};try{let q=A.readFileSync(K,{encoding:"utf-8"}),Y=X6(q),z=u96.safeParse(Y);if(!z.success){let w=`Marketplace configuration file is corrupted: ${z.error.issues.map((H)=>`${H.path.join(".")}: ${H.message}`).join(", ")}`;throw h(w,{level:"error"}),new KV(w,K,Y)}return z.data}catch(q){if(q instanceof KV)throw q;let Y=`Failed to load marketplace configuration: ${q instanceof Error?q.message:String(q)}`;throw h(Y,{level:"error"}),Error(Y)}}async function zPA(A){let K=u96.safeParse(A),q=DN1();if(!K.success)throw new KV(`Invalid marketplace config: ${K.error.message}`,q,A);let Y=xA(),z=XP(q,"..");Y.mkdirSync(z),b8(q,QA(K.data,null,2),{encoding:"utf-8",flush:!0})}async function Ly2(A,K,q){let Y={...process.env,...OOK},z=q?.disableCredentialHelper?["-c","credential.helper="]:[];if(K){let H=await T7("git",[...z,"fetch","origin",K],{cwd:A,timeout:30000,stdin:"ignore",env:Y});if(H.code!==0)return GN1(H);let J=await T7("git",[...z,"checkout",K],{cwd:A,timeout:30000,stdin:"ignore",env:Y});if(J.code!==0)return GN1(J);let O=await T7("git",[...z,"pull","origin","HEAD"],{cwd:A,timeout:30000,stdin:"ignore",env:Y});return GN1(O)}let w=await T7("git",[...z,"pull","origin","HEAD"],{cwd:A,timeout:30000,stdin:"ignore",env:Y});return GN1(w)}function GN1(A){if(A.code!==0&&A.stderr){if(A.stderr.includes("Permission denied (publickey)")||A.stderr.includes("Could not read from remote repository"))return{...A,stderr:`SSH authentication failed while updating marketplace. Please ensure your SSH keys are configured.
 
 Original error: ${A.stderr}`};if(A.stderr.includes("timed out")||A.stderr.includes("Could not resolve host"))return{...A,stderr:`Network error while updating marketplace. Please check your internet connection.
 
@@ -3658,7 +3658,7 @@
 
 JSON parse error: ${w}
 
-Please check the file for syntax errors.`)}}function VOK(A,K){let q=xA();if(!q.existsSync(A))throw Error(`Hooks file not found at ${A} for plugin ${K}. If the manifest declares hooks, the file must exist.`);let Y=q.readFileSync(A,{encoding:"utf-8"}),z=X6(Y);return NS4.parse(z).hooks}function vOK(A,K,q,Y,z=!0){let w=xA(),H=[],J=z9(A,".claude-plugin","plugin.json"),O=VN1(J,Y,K),X={name:O.name,manifest:O,path:A,source:K,repository:K,enabled:q},$=z9(A,"commands");if(!O.commands&&w.existsSync($))X.commandsPath=$;if(O.commands){let M=Object.values(O.commands)[0];if(typeof O.commands==="object"&&!Array.isArray(O.commands)&&M&&typeof M==="object"&&(("source"in M)||("content"in M))){let P={},V=[];for(let[N,T]of Object.entries(O.commands)){if(!T||typeof T!=="object")continue;if(T.source){let E=z9(A,T.source);if(w.existsSync(E))V.push(E),P[N]=T;else h(`Command ${N} path ${T.source} specified in manifest but not found at ${E} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${E} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:E,component:"commands"})}else if(T.content)P[N]=T}if(V.length>0)X.commandsPaths=V;if(Object.keys(P).length>0)X.commandsMetadata=P}else{let P=Array.isArray(O.commands)?O.commands:[O.commands],V=[];for(let N of P){if(typeof N!=="string"){h(`Unexpected command format in manifest for ${O.name}`,{level:"error"});continue}let T=z9(A,N);if(w.existsSync(T))V.push(T);else h(`Command path ${N} specified in manifest but not found at ${T} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${T} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:T,component:"commands"})}if(V.length>0)X.commandsPaths=V}}let _=z9(A,"agents");if(!O.agents&&w.existsSync(_))X.agentsPath=_;if(O.agents){let M=Array.isArray(O.agents)?O.agents:[O.agents],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Agent path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"agents"})}if(P.length>0)X.agentsPaths=P}let Z=z9(A,"skills");if(!O.skills&&w.existsSync(Z))X.skillsPath=Z;if(O.skills){let M=Array.isArray(O.skills)?O.skills:[O.skills],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Skill path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"skills"})}if(P.length>0)X.skillsPaths=P}let G=z9(A,"output-styles");if(!O.outputStyles&&w.existsSync(G))X.outputStylesPath=G;if(O.outputStyles){let M=Array.isArray(O.outputStyles)?O.outputStyles:[O.outputStyles],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Output style path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"output-styles"})}if(P.length>0)X.outputStylesPaths=P}let W,D=new Set,j=z9(A,"hooks","hooks.json");if(w.existsSync(j))try{W=VOK(j,O.name);try{D.add(w.realpathSync(j))}catch{D.add(j)}h(`Loaded hooks from standard location for plugin ${O.name}: ${j}`)}catch(M){let P=M instanceof Error?M.message:String(M);h(`Failed to load hooks for ${O.name}: ${P}`,{level:"error"}),KA(M instanceof Error?M:Error(P)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:j,reason:P})}if(O.hooks){let M=Array.isArray(O.hooks)?O.hooks:[O.hooks];for(let P of M)if(typeof P==="string"){let V=z9(A,P);if(!w.existsSync(V)){h(`Hooks file ${P} specified in manifest but not found at ${V} for ${O.name}`,{level:"error"}),KA(Error(`Plugin component file not found: ${V} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:V,component:"hooks"});continue}let N;try{N=w.realpathSync(V)}catch{N=V}if(D.has(N)){if(h(`Skipping duplicate hooks file for plugin ${O.name}: ${P} (resolves to already-loaded file: ${N})`),z){let T=`Duplicate hooks file detected: ${P} resolves to already-loaded file ${N}. The standard hooks/hooks.json is loaded automatically, so manifest.hooks should only reference additional hook files.`;KA(Error(T)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:T})}continue}try{let T=VOK(V,O.name);try{W=fOK(W,T),D.add(N),h(`Loaded and merged hooks from manifest for plugin ${O.name}: ${P}`)}catch(E){let R=E instanceof Error?E.message:String(E);h(`Failed to merge hooks from ${P} for ${O.name}: ${R}`,{level:"error"}),KA(E instanceof Error?E:Error(R)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:`Failed to merge: ${R}`})}}catch(T){let E=T instanceof Error?T.message:String(T);h(`Failed to load hooks from ${P} for ${O.name}: ${E}`,{level:"error"}),KA(T instanceof Error?T:Error(E)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:E})}}else if(typeof P==="object")W=fOK(W,P)}if(W)X.hooksConfig=W;return{plugin:X,errors:H}}function fOK(A,K){if(!A)return K;let q={...A};for(let[Y,z]of Object.entries(K))if(!q[Y])q[Y]=z;else q[Y]=[...q[Y]||[],...z];return q}async function ny2(){let K=O8().enabledPlugins||{},q=[],Y=[],z=Object.entries(K).filter(([H,J])=>{return a4A.safeParse(H).success&&J!==void 0}),w=await U3();for(let[H,J]of z)try{let[O,X]=H.split("@"),$=w[X];if($&&!A7A($.source)){let G=lIA($.source),W=e4A()||[];Y.push({type:"marketplace-blocked-by-policy",source:H,plugin:O,marketplace:X,blockedByBlocklist:G,allowedSources:G?[]:W.map((D)=>H$A(D))});continue}let _=_u6(H);if(!_){Y.push({type:"plugin-not-found",source:H,pluginId:O,marketplace:X});continue}let Z=await ry2(_.entry,_.marketplaceInstallLocation,H,J===!0,Y);if(Z)q.push(Z)}catch(O){let X=O instanceof Error?O:Error(String(O));KA(X),Y.push({type:"generic-error",source:H,error:X.message})}return{plugins:q,errors:Y}}async function ry2(A,K,q,Y,z){h(`Loading plugin ${A.name} from source: ${QA(A.source)}`);let w=xA(),H=[],J;if(typeof A.source==="string"){let Z=w.statSync(K).isDirectory()?K:z9(K,".."),G=z9(Z,A.source);if(!w.existsSync(G)){let W=Error(`Plugin path not found: ${G}`);return h(`Plugin path not found: ${G}`,{level:"error"}),KA(W),z.push({type:"generic-error",source:q,error:`Plugin directory not found at path: ${G}. Check that the marketplace entry has the correct path.`}),null}try{let W=z9(G,".claude-plugin","plugin.json"),D;try{D=VN1(W,A.name,A.source)}catch{}let j=await Fd(q,A.source,D,Z,A.version);J=await PN1(G,q,j,A,Z),h(`Copied local plugin ${A.name} to versioned cache: ${J}`)}catch(W){let D=W instanceof Error?W.message:String(W);h(`Failed to copy plugin ${A.name} to versioned cache: ${D}. Using marketplace path.`,{level:"warn"}),J=G}}else try{let Z=await Fd(q,A.source,void 0,void 0,A.version),G=gx(q,Z);if(w.existsSync(G))h(`Using versioned cached plugin ${A.name} from ${G}`),J=G;else{let W=await H9A(A.source,{manifest:{name:A.name}}),D=await Fd(q,A.source,W.manifest,W.path,A.version);if(J=await PN1(W.path,q,D,A,void 0),W.path!==J)w.rmSync(W.path,{recursive:!0,force:!0})}}catch(Z){let G=Z instanceof Error?Z.message:String(Z);return h(`Failed to cache plugin ${A.name}: ${G}`,{level:"error"}),KA(Z instanceof Error?Z:Error(G)),z.push({type:"generic-error",source:q,error:`Failed to download/cache plugin ${A.name}: ${G}`}),null}let O=z9(J,".claude-plugin","plugin.json"),X=w.existsSync(O),{plugin:$,errors:_}=vOK(J,q,Y,A.name,A.strict??!0);if(H.push(..._),typeof A.source==="object"&&"sha"in A.source&&A.source.sha)$.sha=A.source.sha;if(!X){if($.manifest={...A,id:void 0,source:void 0,strict:void 0},$.name=$.manifest.name,A.commands){let Z=Object.values(A.commands)[0];if(typeof A.commands==="object"&&!Array.isArray(A.commands)&&Z&&typeof Z==="object"&&(("source"in Z)||("content"in Z))){let G={},W=[];for(let[D,j]of Object.entries(A.commands)){if(!j||typeof j!=="object"||!j.source)continue;let M=z9(J,j.source);if(w.existsSync(M))W.push(M),G[D]=j;else h(`Command ${D} path ${j.source} from marketplace entry not found at ${M} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${M} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:M,component:"commands"})}if(W.length>0)$.commandsPaths=W,$.commandsMetadata=G}else{let G=Array.isArray(A.commands)?A.commands:[A.commands],W=[];for(let D of G){if(typeof D!=="string"){h(`Unexpected command format in marketplace entry for ${A.name}`,{level:"error"});continue}let j=z9(J,D);if(w.existsSync(j))W.push(j);else h(`Command path ${D} from marketplace entry not found at ${j} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${j} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:j,component:"commands"})}if(W.length>0)$.commandsPaths=W}}if(A.agents){let Z=Array.isArray(A.agents)?A.agents:[A.agents],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Agent path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"agents"})}if(G.length>0)$.agentsPaths=G}if(A.skills){h(`Processing ${Array.isArray(A.skills)?A.skills.length:1} skill paths for plugin ${A.name}`);let Z=Array.isArray(A.skills)?A.skills:[A.skills],G=[];for(let W of Z){let D=z9(J,W);if(h(`Checking skill path: ${W} -> ${D} (exists: ${w.existsSync(D)})`),w.existsSync(D))G.push(D);else h(`Skill path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"skills"})}if(h(`Found ${G.length} valid skill paths for plugin ${A.name}, setting skillsPaths`),G.length>0)$.skillsPaths=G}else h(`Plugin ${A.name} has no entry.skills defined`);if(A.outputStyles){let Z=Array.isArray(A.outputStyles)?A.outputStyles:[A.outputStyles],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Output style path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"output-styles"})}if(G.length>0)$.outputStylesPaths=G}if(A.hooks)$.hooksConfig=A.hooks}else if(!A.strict&&X&&(A.commands||A.agents||A.skills||A.hooks||A.outputStyles)){let Z=Error(`Plugin ${A.name} has both plugin.json and marketplace manifest entries for commands/agents/skills/hooks/outputStyles. This is a conflict.`);return h(`Plugin ${A.name} has both plugin.json and marketplace manifest entries for commands/agents/skills/hooks/outputStyles. This is a conflict.`,{level:"error"}),KA(Z),z.push({type:"generic-error",source:q,error:`Plugin ${A.name} has conflicting manifests: both plugin.json and marketplace entry specify components. Set strict: true in marketplace entry or remove component specs from one location.`}),null}else if(X){if(A.commands){let Z=Object.values(A.commands)[0];if(typeof A.commands==="object"&&!Array.isArray(A.commands)&&Z&&typeof Z==="object"&&(("source"in Z)||("content"in Z))){let G={...$.commandsMetadata||{}},W=[];for(let[D,j]of Object.entries(A.commands)){if(!j||typeof j!=="object"||!j.source)continue;let M=z9(J,j.source);if(w.existsSync(M))W.push(M),G[D]=j;else h(`Command ${D} path ${j.source} from marketplace entry not found at ${M} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${M} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:M,component:"commands"})}if(W.length>0)$.commandsPaths=[...$.commandsPaths||[],...W],$.commandsMetadata=G}else{let G=Array.isArray(A.commands)?A.commands:[A.commands],W=[];for(let D of G){if(typeof D!=="string"){h(`Unexpected command format in marketplace entry for ${A.name}`,{level:"error"});continue}let j=z9(J,D);if(w.existsSync(j))W.push(j);else h(`Command path ${D} from marketplace entry not found at ${j} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${j} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:j,component:"commands"})}if(W.length>0)$.commandsPaths=[...$.commandsPaths||[],...W]}}if(A.agents){let Z=Array.isArray(A.agents)?A.agents:[A.agents],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Agent path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"agents"})}if(G.length>0)$.agentsPaths=[...$.agentsPaths||[],...G]}if(A.skills){let Z=Array.isArray(A.skills)?A.skills:[A.skills],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Skill path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"skills"})}if(G.length>0)$.skillsPaths=[...$.skillsPaths||[],...G]}if(A.outputStyles){let Z=Array.isArray(A.outputStyles)?A.outputStyles:[A.outputStyles],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Output style path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"output-styles"})}if(G.length>0)$.outputStylesPaths=[...$.outputStylesPaths||[],...G]}if(A.hooks)$.hooksConfig={...$.hooksConfig||{},...A.hooks}}return z.push(...H),$}async function oy2(A){if(A.length===0)return{plugins:[],errors:[]};let K=[],q=[],Y=xA();for(let[z,w]of A.entries())try{let H=Fy2(w);if(!Y.existsSync(H)){h(`Plugin path does not exist: ${H}, skipping`,{level:"warn"}),q.push({type:"path-not-found",source:`inline[${z}]`,path:H,component:"commands"});continue}let J=Qy2(H),{plugin:O,errors:X}=vOK(H,`${J}@inline`,!0,J);O.source=`${O.name}@inline`,O.repository=`${O.name}@inline`,K.push(O),q.push(...X),h(`Loaded inline plugin from path: ${O.name}`)}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to load session plugin from ${w}: ${J}`,{level:"warn"}),q.push({type:"generic-error",source:`inline[${z}]`,error:`Failed to load plugin: ${J}`})}if(K.length>0)h(`Loaded ${K.length} session-only plugins from --plugin-dir`);return{plugins:K,errors:q}}function US(){bY.cache?.clear?.()}var bY;var d0=C(()=>{d7();s6();s1();ED();W1();v1();B8();kJ();xr();vK();l6();dIA();MN1();c2();Qd();h1();bY=a1(async()=>{let A=await ny2(),K=[...A.plugins],q=[...A.errors],Y=s2A();if(Y.length>0){let w=await oy2(Y);K.push(...w.plugins),q.push(...w.errors)}h(`Found ${K.length} plugins (${K.filter((w)=>w.enabled).length} enabled, ${K.filter((w)=>!w.enabled).length} disabled)`);let z=K.filter((w)=>w.enabled);if(z.length>0)i7("plugins");return{enabled:z,disabled:K.filter((w)=>!w.enabled),errors:q}})});import{join as ay2,basename as sy2}from"path";function EOK(A,K,q){let Y=[],z=xA();function w(H){try{let J=z.readdirSync(H);for(let O of J){let X=ay2(H,O.name);if(O.isDirectory())w(X);else if(O.isFile()&&O.name.endsWith(".md")){let $=kOK(X,K,q);if($)Y.push($)}}}catch(J){h(`Failed to scan output-styles directory ${H}: ${J}`,{level:"error"})}}return w(A),Y}function kOK(A,K,q){let Y=xA();if(Sh(Y,A,q))return null;try{let z=Y.readFileSync(A,{encoding:"utf-8"}),{frontmatter:w,content:H}=z_(z),J=sy2(A,".md"),O=w.name||J,X=`${K}:${O}`,$=w.description||gQ(H,`Output style from ${K} plugin`),_=w["force-for-plugin"],Z=_===!0||_==="true"?!0:_===!1||_==="false"?!1:void 0;return{name:X,description:$,prompt:H.trim(),source:"plugin",forceForPlugin:Z}}catch(z){return h(`Failed to load output style from ${A}: ${z}`,{level:"error"}),null}}function Xu6(){ju6.cache?.clear?.()}var ju6;var ZN1=C(()=>{d7();s6();d0();W1();mQ();QQ();ju6=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.outputStylesPath)try{let w=EOK(Y.outputStylesPath,Y.name,z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} output styles from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load output styles from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.outputStylesPaths)for(let w of Y.outputStylesPaths)try{let J=xA().statSync(w);if(J.isDirectory()){let O=EOK(w,Y.name,z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} output styles from plugin ${Y.name} custom path: ${w}`)}else if(J.isFile()&&w.endsWith(".md")){let O=kOK(w,Y.name,z);if(O)q.push(O),h(`Loaded output style from plugin ${Y.name} custom file: ${w}`)}}catch(H){h(`Failed to load output styles from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}return h(`Total plugin output styles loaded: ${q.length}`),q})});import{basename as ty2}from"path";var COK;var LOK=C(()=>{d7();v1();QQ();ZN1();W1();COK=a1(async(A)=>{try{return(await FQ("output-styles",A)).map(({filePath:Y,frontmatter:z,content:w,source:H})=>{try{let O=ty2(Y).replace(/\.md$/,""),X=z.name||O,$=z.description||gQ(w,`Custom ${O} output style`),_=z["keep-coding-instructions"],Z=_===!0||_==="true"?!0:_===!1||_==="false"?!1:void 0;if(z["force-for-plugin"]!==void 0)h(`Output style "${X}" has force-for-plugin set, but this option only applies to plugin output styles. Ignoring.`,{level:"warn"});return{name:X,description:$,prompt:w.trim(),source:H,keepCodingInstructions:Z}}catch(J){return KA(J instanceof Error?J:Error(String(J))),null}}).filter((Y)=>Y!==null)}catch(K){return KA(K instanceof Error?K:Error(String(K))),[]}})});async function J9A(A){let K=await COK(A),q=await ju6(),Y={...R3A},z=K.filter((O)=>O.source==="policySettings"),w=K.filter((O)=>O.source==="userSettings"),H=K.filter((O)=>O.source==="projectSettings"),J=[q,w,H,z];for(let O of J)for(let X of O)Y[X.name]={name:X.name,description:X.description,prompt:X.prompt,source:X.source,keepCodingInstructions:X.keepCodingInstructions,forceForPlugin:X.forceForPlugin};return Y}async function yOK(){let A=await J9A(b1()),K=Object.values(A).filter((w)=>w!==null&&w.source==="plugin"&&w.forceForPlugin===!0),q=K[0];if(q){if(K.length>1)h(`Multiple plugins have forced output styles: ${K.map((w)=>w.name).join(", ")}. Using: ${q.name}`,{level:"warn"});return h(`Using forced plugin output style: ${q.name}`),q}let z=O8()?.outputStyle||pZ;return A[z]??null}var ROK,pZ="default",R3A;var cB=C(()=>{l4();B8();LOK();ZN1();u4();W1();ROK=`
+Please check the file for syntax errors.`)}}function VOK(A,K){let q=xA();if(!q.existsSync(A))throw Error(`Hooks file not found at ${A} for plugin ${K}. If the manifest declares hooks, the file must exist.`);let Y=q.readFileSync(A,{encoding:"utf-8"}),z=X6(Y);return NS4.parse(z).hooks}function vOK(A,K,q,Y,z=!0){let w=xA(),H=[],J=z9(A,".claude-plugin","plugin.json"),O=VN1(J,Y,K),X={name:O.name,manifest:O,path:A,source:K,repository:K,enabled:q},$=z9(A,"commands");if(!O.commands&&w.existsSync($))X.commandsPath=$;if(O.commands){let M=Object.values(O.commands)[0];if(typeof O.commands==="object"&&!Array.isArray(O.commands)&&M&&typeof M==="object"&&(("source"in M)||("content"in M))){let P={},V=[];for(let[N,T]of Object.entries(O.commands)){if(!T||typeof T!=="object")continue;if(T.source){let E=z9(A,T.source);if(w.existsSync(E))V.push(E),P[N]=T;else h(`Command ${N} path ${T.source} specified in manifest but not found at ${E} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${E} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:E,component:"commands"})}else if(T.content)P[N]=T}if(V.length>0)X.commandsPaths=V;if(Object.keys(P).length>0)X.commandsMetadata=P}else{let P=Array.isArray(O.commands)?O.commands:[O.commands],V=[];for(let N of P){if(typeof N!=="string"){h(`Unexpected command format in manifest for ${O.name}`,{level:"error"});continue}let T=z9(A,N);if(w.existsSync(T))V.push(T);else h(`Command path ${N} specified in manifest but not found at ${T} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${T} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:T,component:"commands"})}if(V.length>0)X.commandsPaths=V}}let _=z9(A,"agents");if(!O.agents&&w.existsSync(_))X.agentsPath=_;if(O.agents){let M=Array.isArray(O.agents)?O.agents:[O.agents],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Agent path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"agents"})}if(P.length>0)X.agentsPaths=P}let Z=z9(A,"skills");if(!O.skills&&w.existsSync(Z))X.skillsPath=Z;if(O.skills){let M=Array.isArray(O.skills)?O.skills:[O.skills],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Skill path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"skills"})}if(P.length>0)X.skillsPaths=P}let G=z9(A,"output-styles");if(!O.outputStyles&&w.existsSync(G))X.outputStylesPath=G;if(O.outputStyles){let M=Array.isArray(O.outputStyles)?O.outputStyles:[O.outputStyles],P=[];for(let V of M){let N=z9(A,V);if(w.existsSync(N))P.push(N);else h(`Output style path ${V} specified in manifest but not found at ${N} for ${O.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${N} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:N,component:"output-styles"})}if(P.length>0)X.outputStylesPaths=P}let W,D=new Set,j=z9(A,"hooks","hooks.json");if(w.existsSync(j))try{W=VOK(j,O.name);try{D.add(w.realpathSync(j))}catch{D.add(j)}h(`Loaded hooks from standard location for plugin ${O.name}: ${j}`)}catch(M){let P=M instanceof Error?M.message:String(M);h(`Failed to load hooks for ${O.name}: ${P}`,{level:"error"}),KA(M instanceof Error?M:Error(P)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:j,reason:P})}if(O.hooks){let M=Array.isArray(O.hooks)?O.hooks:[O.hooks];for(let P of M)if(typeof P==="string"){let V=z9(A,P);if(!w.existsSync(V)){h(`Hooks file ${P} specified in manifest but not found at ${V} for ${O.name}`,{level:"error"}),KA(Error(`Plugin component file not found: ${V} for ${O.name}`)),H.push({type:"path-not-found",source:K,plugin:O.name,path:V,component:"hooks"});continue}let N;try{N=w.realpathSync(V)}catch{N=V}if(D.has(N)){if(h(`Skipping duplicate hooks file for plugin ${O.name}: ${P} (resolves to already-loaded file: ${N})`),z){let T=`Duplicate hooks file detected: ${P} resolves to already-loaded file ${N}. The standard hooks/hooks.json is loaded automatically, so manifest.hooks should only reference additional hook files.`;KA(Error(T)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:T})}continue}try{let T=VOK(V,O.name);try{W=fOK(W,T),D.add(N),h(`Loaded and merged hooks from manifest for plugin ${O.name}: ${P}`)}catch(E){let R=E instanceof Error?E.message:String(E);h(`Failed to merge hooks from ${P} for ${O.name}: ${R}`,{level:"error"}),KA(E instanceof Error?E:Error(R)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:`Failed to merge: ${R}`})}}catch(T){let E=T instanceof Error?T.message:String(T);h(`Failed to load hooks from ${P} for ${O.name}: ${E}`,{level:"error"}),KA(T instanceof Error?T:Error(E)),H.push({type:"hook-load-failed",source:K,plugin:O.name,hookPath:V,reason:E})}}else if(typeof P==="object")W=fOK(W,P)}if(W)X.hooksConfig=W;return{plugin:X,errors:H}}function fOK(A,K){if(!A)return K;let q={...A};for(let[Y,z]of Object.entries(K))if(!q[Y])q[Y]=z;else q[Y]=[...q[Y]||[],...z];return q}async function ny2(){let K=O8().enabledPlugins||{},q=[],Y=[],z=Object.entries(K).filter(([H,J])=>{return a4A.safeParse(H).success&&J!==void 0}),w=await U3();for(let[H,J]of z)try{let[O,X]=H.split("@"),$=w[X];if($&&!A7A($.source)){let G=lIA($.source),W=e4A()||[];Y.push({type:"marketplace-blocked-by-policy",source:H,plugin:O,marketplace:X,blockedByBlocklist:G,allowedSources:G?[]:W.map((D)=>H$A(D))});continue}let _=_u6(H);if(!_){Y.push({type:"plugin-not-found",source:H,pluginId:O,marketplace:X});continue}let Z=await ry2(_.entry,_.marketplaceInstallLocation,H,J===!0,Y);if(Z)q.push(Z)}catch(O){let X=O instanceof Error?O:Error(String(O));KA(X),Y.push({type:"generic-error",source:H,error:X.message})}return{plugins:q,errors:Y}}async function ry2(A,K,q,Y,z){h(`Loading plugin ${A.name} from source: ${QA(A.source)}`);let w=xA(),H=[],J;if(typeof A.source==="string"){let Z=w.statSync(K).isDirectory()?K:z9(K,".."),G=z9(Z,A.source);if(!w.existsSync(G)){let W=Error(`Plugin path not found: ${G}`);return h(`Plugin path not found: ${G}`,{level:"error"}),KA(W),z.push({type:"generic-error",source:q,error:`Plugin directory not found at path: ${G}. Check that the marketplace entry has the correct path.`}),null}try{let W=z9(G,".claude-plugin","plugin.json"),D;try{D=VN1(W,A.name,A.source)}catch{}let j=await Fd(q,A.source,D,Z,A.version);J=await PN1(G,q,j,A,Z),h(`Copied local plugin ${A.name} to versioned cache: ${J}`)}catch(W){let D=W instanceof Error?W.message:String(W);h(`Failed to copy plugin ${A.name} to versioned cache: ${D}. Using marketplace path.`,{level:"warn"}),J=G}}else try{let Z=await Fd(q,A.source,void 0,void 0,A.version),G=gx(q,Z);if(w.existsSync(G))h(`Using versioned cached plugin ${A.name} from ${G}`),J=G;else{let W=await H9A(A.source,{manifest:{name:A.name}}),D=await Fd(q,A.source,W.manifest,W.path,A.version);if(J=await PN1(W.path,q,D,A,void 0),W.path!==J)w.rmSync(W.path,{recursive:!0,force:!0})}}catch(Z){let G=Z instanceof Error?Z.message:String(Z);return h(`Failed to cache plugin ${A.name}: ${G}`,{level:"error"}),KA(Z instanceof Error?Z:Error(G)),z.push({type:"generic-error",source:q,error:`Failed to download/cache plugin ${A.name}: ${G}`}),null}let O=z9(J,".claude-plugin","plugin.json"),X=w.existsSync(O),{plugin:$,errors:_}=vOK(J,q,Y,A.name,A.strict??!0);if(H.push(..._),typeof A.source==="object"&&"sha"in A.source&&A.source.sha)$.sha=A.source.sha;if(!X){if($.manifest={...A,id:void 0,source:void 0,strict:void 0},$.name=$.manifest.name,A.commands){let Z=Object.values(A.commands)[0];if(typeof A.commands==="object"&&!Array.isArray(A.commands)&&Z&&typeof Z==="object"&&(("source"in Z)||("content"in Z))){let G={},W=[];for(let[D,j]of Object.entries(A.commands)){if(!j||typeof j!=="object"||!j.source)continue;let M=z9(J,j.source);if(w.existsSync(M))W.push(M),G[D]=j;else h(`Command ${D} path ${j.source} from marketplace entry not found at ${M} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${M} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:M,component:"commands"})}if(W.length>0)$.commandsPaths=W,$.commandsMetadata=G}else{let G=Array.isArray(A.commands)?A.commands:[A.commands],W=[];for(let D of G){if(typeof D!=="string"){h(`Unexpected command format in marketplace entry for ${A.name}`,{level:"error"});continue}let j=z9(J,D);if(w.existsSync(j))W.push(j);else h(`Command path ${D} from marketplace entry not found at ${j} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${j} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:j,component:"commands"})}if(W.length>0)$.commandsPaths=W}}if(A.agents){let Z=Array.isArray(A.agents)?A.agents:[A.agents],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Agent path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"agents"})}if(G.length>0)$.agentsPaths=G}if(A.skills){h(`Processing ${Array.isArray(A.skills)?A.skills.length:1} skill paths for plugin ${A.name}`);let Z=Array.isArray(A.skills)?A.skills:[A.skills],G=[];for(let W of Z){let D=z9(J,W);if(h(`Checking skill path: ${W} -> ${D} (exists: ${w.existsSync(D)})`),w.existsSync(D))G.push(D);else h(`Skill path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"skills"})}if(h(`Found ${G.length} valid skill paths for plugin ${A.name}, setting skillsPaths`),G.length>0)$.skillsPaths=G}else h(`Plugin ${A.name} has no entry.skills defined`);if(A.outputStyles){let Z=Array.isArray(A.outputStyles)?A.outputStyles:[A.outputStyles],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Output style path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"output-styles"})}if(G.length>0)$.outputStylesPaths=G}if(A.hooks)$.hooksConfig=A.hooks}else if(!A.strict&&X&&(A.commands||A.agents||A.skills||A.hooks||A.outputStyles)){let Z=Error(`Plugin ${A.name} has both plugin.json and marketplace manifest entries for commands/agents/skills/hooks/outputStyles. This is a conflict.`);return h(`Plugin ${A.name} has both plugin.json and marketplace manifest entries for commands/agents/skills/hooks/outputStyles. This is a conflict.`,{level:"error"}),KA(Z),z.push({type:"generic-error",source:q,error:`Plugin ${A.name} has conflicting manifests: both plugin.json and marketplace entry specify components. Set strict: true in marketplace entry or remove component specs from one location.`}),null}else if(X){if(A.commands){let Z=Object.values(A.commands)[0];if(typeof A.commands==="object"&&!Array.isArray(A.commands)&&Z&&typeof Z==="object"&&(("source"in Z)||("content"in Z))){let G={...$.commandsMetadata||{}},W=[];for(let[D,j]of Object.entries(A.commands)){if(!j||typeof j!=="object"||!j.source)continue;let M=z9(J,j.source);if(w.existsSync(M))W.push(M),G[D]=j;else h(`Command ${D} path ${j.source} from marketplace entry not found at ${M} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${M} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:M,component:"commands"})}if(W.length>0)$.commandsPaths=[...$.commandsPaths||[],...W],$.commandsMetadata=G}else{let G=Array.isArray(A.commands)?A.commands:[A.commands],W=[];for(let D of G){if(typeof D!=="string"){h(`Unexpected command format in marketplace entry for ${A.name}`,{level:"error"});continue}let j=z9(J,D);if(w.existsSync(j))W.push(j);else h(`Command path ${D} from marketplace entry not found at ${j} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${j} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:j,component:"commands"})}if(W.length>0)$.commandsPaths=[...$.commandsPaths||[],...W]}}if(A.agents){let Z=Array.isArray(A.agents)?A.agents:[A.agents],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Agent path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"agents"})}if(G.length>0)$.agentsPaths=[...$.agentsPaths||[],...G]}if(A.skills){let Z=Array.isArray(A.skills)?A.skills:[A.skills],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Skill path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"skills"})}if(G.length>0)$.skillsPaths=[...$.skillsPaths||[],...G]}if(A.outputStyles){let Z=Array.isArray(A.outputStyles)?A.outputStyles:[A.outputStyles],G=[];for(let W of Z){let D=z9(J,W);if(w.existsSync(D))G.push(D);else h(`Output style path ${W} from marketplace entry not found at ${D} for ${A.name}`,{level:"warn"}),KA(Error(`Plugin component file not found: ${D} for ${A.name}`)),H.push({type:"path-not-found",source:q,plugin:A.name,path:D,component:"output-styles"})}if(G.length>0)$.outputStylesPaths=[...$.outputStylesPaths||[],...G]}if(A.hooks)$.hooksConfig={...$.hooksConfig||{},...A.hooks}}return z.push(...H),$}async function oy2(A){if(A.length===0)return{plugins:[],errors:[]};let K=[],q=[],Y=xA();for(let[z,w]of A.entries())try{let H=Fy2(w);if(!Y.existsSync(H)){h(`Plugin path does not exist: ${H}, skipping`,{level:"warn"}),q.push({type:"path-not-found",source:`inline[${z}]`,path:H,component:"commands"});continue}let J=Qy2(H),{plugin:O,errors:X}=vOK(H,`${J}@inline`,!0,J);O.source=`${O.name}@inline`,O.repository=`${O.name}@inline`,K.push(O),q.push(...X),h(`Loaded inline plugin from path: ${O.name}`)}catch(H){let J=H instanceof Error?H.message:String(H);h(`Failed to load session plugin from ${w}: ${J}`,{level:"warn"}),q.push({type:"generic-error",source:`inline[${z}]`,error:`Failed to load plugin: ${J}`})}if(K.length>0)h(`Loaded ${K.length} session-only plugins from --plugin-dir`);return{plugins:K,errors:q}}function US(){bY.cache?.clear?.()}var bY;var d0=C(()=>{d7();s6();s1();ED();W1();v1();B8();kJ();xr();vK();l6();dIA();MN1();c2();Qd();h1();bY=a1(async()=>{let A=await ny2(),K=[...A.plugins],q=[...A.errors],Y=s2A();if(Y.length>0){let w=await oy2(Y);K.push(...w.plugins),q.push(...w.errors)}h(`Found ${K.length} plugins (${K.filter((w)=>w.enabled).length} enabled, ${K.filter((w)=>!w.enabled).length} disabled)`);let z=K.filter((w)=>w.enabled);if(z.length>0)i7("plugins");return{enabled:z,disabled:K.filter((w)=>!w.enabled),errors:q}})});import{join as ay2,basename as sy2}from"path";function EOK(A,K,q){let Y=[],z=xA(),w=__pluginDirCacheRead("plugin-output-styles",A,K,"");if(w){let H=w.entries||[],J=w.filePaths||[],O=[];for(let X=0;X<H.length;X++){let $=J[X];if($&&Sh(z,$,q))continue;O.push(H[X])}return O}let H=new Set,J=new Set;function O(X){try{H.add(X);let $=z.readdirSync(X);for(let _ of $){let Z=ay2(X,_.name);if(_.isDirectory())O(Z);else if(_.isFile()&&_.name.endsWith(".md")){let G=kOK(Z,K,q);if(G)Y.push(G),J.add(Z)}}}catch($){h(`Failed to scan output-styles directory ${X}: ${$}`,{level:"error"})}}return O(A),__pluginDirCacheWrite("plugin-output-styles",A,K,"",Array.from(H),Array.from(J),Y,Array.from(J)),Y}function kOK(A,K,q){let Y=xA();if(Sh(Y,A,q))return null;try{let z=Y.readFileSync(A,{encoding:"utf-8"}),{frontmatter:w,content:H}=z_(z),J=sy2(A,".md"),O=w.name||J,X=`${K}:${O}`,$=w.description||gQ(H,`Output style from ${K} plugin`),_=w["force-for-plugin"],Z=_===!0||_==="true"?!0:_===!1||_==="false"?!1:void 0;return{name:X,description:$,prompt:H.trim(),source:"plugin",forceForPlugin:Z}}catch(z){return h(`Failed to load output style from ${A}: ${z}`,{level:"error"}),null}}function Xu6(){ju6.cache?.clear?.()}var ju6;var ZN1=C(()=>{d7();s6();d0();W1();mQ();QQ();ju6=a1(async()=>{let{enabled:A,errors:K}=await bY(),q=[];if(K.length>0)h(`Plugin loading errors: ${K.map((Y)=>JM(Y)).join(", ")}`);for(let Y of A){let z=new Set;if(Y.outputStylesPath)try{let w=EOK(Y.outputStylesPath,Y.name,z);if(q.push(...w),w.length>0)h(`Loaded ${w.length} output styles from plugin ${Y.name} default directory`)}catch(w){h(`Failed to load output styles from plugin ${Y.name} default directory: ${w}`,{level:"error"})}if(Y.outputStylesPaths)for(let w of Y.outputStylesPaths)try{let J=xA().statSync(w);if(J.isDirectory()){let O=EOK(w,Y.name,z);if(q.push(...O),O.length>0)h(`Loaded ${O.length} output styles from plugin ${Y.name} custom path: ${w}`)}else if(J.isFile()&&w.endsWith(".md")){let O=kOK(w,Y.name,z);if(O)q.push(O),h(`Loaded output style from plugin ${Y.name} custom file: ${w}`)}}catch(H){h(`Failed to load output styles from plugin ${Y.name} custom path ${w}: ${H}`,{level:"error"})}}return h(`Total plugin output styles loaded: ${q.length}`),q})});import{basename as ty2}from"path";var COK;var LOK=C(()=>{d7();v1();QQ();ZN1();W1();COK=a1(async(A)=>{try{return(await FQ("output-styles",A)).map(({filePath:Y,frontmatter:z,content:w,source:H})=>{try{let O=ty2(Y).replace(/\.md$/,""),X=z.name||O,$=z.description||gQ(w,`Custom ${O} output style`),_=z["keep-coding-instructions"],Z=_===!0||_==="true"?!0:_===!1||_==="false"?!1:void 0;if(z["force-for-plugin"]!==void 0)h(`Output style "${X}" has force-for-plugin set, but this option only applies to plugin output styles. Ignoring.`,{level:"warn"});return{name:X,description:$,prompt:w.trim(),source:H,keepCodingInstructions:Z}}catch(J){return KA(J instanceof Error?J:Error(String(J))),null}}).filter((Y)=>Y!==null)}catch(K){return KA(K instanceof Error?K:Error(String(K))),[]}})});async function J9A(A){let K=await COK(A),q=await ju6(),Y={...R3A},z=K.filter((O)=>O.source==="policySettings"),w=K.filter((O)=>O.source==="userSettings"),H=K.filter((O)=>O.source==="projectSettings"),J=[q,w,H,z];for(let O of J)for(let X of O)Y[X.name]={name:X.name,description:X.description,prompt:X.prompt,source:X.source,keepCodingInstructions:X.keepCodingInstructions,forceForPlugin:X.forceForPlugin};return Y}async function yOK(){let A=await J9A(b1()),K=Object.values(A).filter((w)=>w!==null&&w.source==="plugin"&&w.forceForPlugin===!0),q=K[0];if(q){if(K.length>1)h(`Multiple plugins have forced output styles: ${K.map((w)=>w.name).join(", ")}. Using: ${q.name}`,{level:"warn"});return h(`Using forced plugin output style: ${q.name}`),q}let z=O8()?.outputStyle||pZ;return A[z]??null}var ROK,pZ="default",R3A;var cB=C(()=>{l4();B8();LOK();ZN1();u4();W1();ROK=`
 ## Insights
 In order to encourage learning, before and after writing code, always provide brief educational explanations about implementation choices using (with backticks):
 "\`${q1.star} Insight ─────────────────────────────────────\`
